<!DOCTYPE html>
<html><head><meta charset="utf-8"><style type="text/css">#pdf-main {  font-family: sans-serif;  position:absolute;  top:0;  left:0;  bottom:0;  right:0;  overflow:auto;  background-color:grey;}#pdf-main > .p {  position:relative;  margin:13px auto;  background-color:white;  overflow:hidden;  display:none;}.p > .t {  position:absolute;  top:0;  left:0;  bottom:0;  right:0;  transform-origin:0% 100%;  -ms-transform-origin:0% 100%;  -moz-transform-origin:0% 100%;  -webkit-transform-origin:0% 100%;  -o-transform-origin:0% 100%;}.t > .l {  position:absolute;   white-space:pre;  transform-origin:0% 100%;  -ms-transform-origin:0% 100%;  -moz-transform-origin:0% 100%;  -webkit-transform-origin:0% 100%;  -o-transform-origin:0% 100%;}.l > .w{  display:inline-block;}::selection{  background: rgba(168,209,255,0.5);}::-moz-selection{  background: rgba(168,209,255,0.5);}</style><link rel="stylesheet" type="text/css" href="all.css" /><script type="text/javascript">function show_pages(){ var pages = document.getElementById('pdf-main').childNodes; var idx = 0; var f = function(){  if (idx < pages.length) {   try{    pages[idx].style.display='block';   }catch(e){}   ++idx;   setTimeout(f,100);  } }; f();};</script></head><body onload="show_pages();"><div id="pdf-main"><div id="page-1" class="p" style="width:612px;height:792px;background-image:url(p1.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f1 s1 t0" style="bottom:696.923px;left:80.5159px;" data-x="80.5159" data-y="700.671" hs="1">T</div><div class="l f1 s1 t0" style="bottom:696.923px;left:91.1501px;" data-x="91.1501" data-y="700.671" hs="1">race-based<span class="w w0"> </span>Just-in-Time<span class="w w0"> </span>T</div><div class="l f1 s1 t0" style="bottom:696.923px;left:291.459px;" data-x="291.459" data-y="700.671" hs="1">ype<span class="w w0"> </span>Specialization<span class="w w0"> </span>for<span class="w w0"> </span>Dynamic</div><div class="l f1 s1 t0" style="bottom:676.997px;left:263.706px;" data-x="263.706" data-y="680.745" hs="1">Languages</div><div class="l f2 s2 t0" style="bottom:642.513px;left:120.322px;" data-x="120.322" data-y="644.88" hs="1">Andreas<span class="w w1"> </span>Gal</div><div class="l f3 s3 t0" style="bottom:647.292px;left:175.401px;" data-x="175.401" data-y="648.839" hs="1">∗</div><div class="l f4 s3 t0" style="bottom:647.292px;left:180.134px;" data-x="180.134" data-y="648.839" hs="1">+</div><div class="l f2 s2 t0" style="bottom:642.513px;left:187.218px;" data-x="187.218" data-y="644.88" hs="1">,<span class="w w1"> </span>Brendan<span class="w w1"> </span>Eich</div><div class="l f3 s3 t0" style="bottom:647.292px;left:252.653px;" data-x="252.653" data-y="648.839" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:642.513px;left:257.386px;" data-x="257.386" data-y="644.88" hs="1">,<span class="w w1"> </span>Mike<span class="w w1"> </span>Shaver</div><div class="l f3 s3 t0" style="bottom:647.292px;left:318.678px;" data-x="318.678" data-y="648.839" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:642.513px;left:323.411px;" data-x="323.411" data-y="644.88" hs="1">,<span class="w w1"> </span>David<span class="w w1"> </span>Anderson</div><div class="l f3 s3 t0" style="bottom:647.292px;left:400.802px;" data-x="400.802" data-y="648.839" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:642.513px;left:405.534px;" data-x="405.534" data-y="644.88" hs="1">,<span class="w w1"> </span>David<span class="w w1"> </span>Mandelin</div><div class="l f3 s3 t0" style="bottom:647.292px;left:482.323px;" data-x="482.323" data-y="648.839" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:642.513px;left:487.055px;" data-x="487.055" data-y="644.88" hs="1">,</div><div class="l f2 s2 t0" style="bottom:629.561px;left:93.5416px;" data-x="93.5416" data-y="631.928" hs="1">Mohammad<span class="w w1"> </span>R.<span class="w w1"> </span>Haghighat</div><div class="l f4 s3 t0" style="bottom:634.341px;left:207.689px;" data-x="207.689" data-y="635.887" hs="1">$</div><div class="l f2 s2 t0" style="bottom:629.561px;left:212.421px;" data-x="212.421" data-y="631.928" hs="1">,<span class="w w1"> </span>Blake<span class="w w1"> </span>Kaplan</div><div class="l f3 s3 t0" style="bottom:634.341px;left:277.746px;" data-x="277.746" data-y="635.887" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:629.561px;left:282.479px;" data-x="282.479" data-y="631.928" hs="1">,<span class="w w1"> </span>Graydon<span class="w w1"> </span>Hoare</div><div class="l f3 s3 t0" style="bottom:634.341px;left:355.815px;" data-x="355.815" data-y="635.887" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:629.561px;left:360.548px;" data-x="360.548" data-y="631.928" hs="1">,<span class="w w1"> </span>Boris<span class="w w1"> </span>Zbarsky</div><div class="l f3 s3 t0" style="bottom:634.341px;left:428.262px;" data-x="428.262" data-y="635.887" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:629.561px;left:432.994px;" data-x="432.994" data-y="631.928" hs="1">,<span class="w w1"> </span>Jason<span class="w w1"> </span>Orendorff</div><div class="l f3 s3 t0" style="bottom:634.341px;left:509.103px;" data-x="509.103" data-y="635.887" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:629.561px;left:513.836px;" data-x="513.836" data-y="631.928" hs="1">,</div><div class="l f2 s2 t0" style="bottom:616.61px;left:68.2749px;" data-x="68.2749" data-y="618.977" hs="1">Jesse<span class="w w1"> </span>Ruderman</div><div class="l f3 s3 t0" style="bottom:621.39px;left:139.189px;" data-x="139.189" data-y="622.936" hs="1">∗</div><div class="l f2 s2 t0" style="bottom:616.61px;left:143.921px;" data-x="143.921" data-y="618.977" hs="1">,<span class="w w1"> </span>Edwin<span class="w w1"> </span>Smith</div><div class="l f4 s3 t0" style="bottom:621.39px;left:206.946px;" data-x="206.946" data-y="622.936" hs="1">#</div><div class="l f2 s2 t0" style="bottom:616.61px;left:214.501px;" data-x="214.501" data-y="618.977" hs="1">,<span class="w w1"> </span>Rick<span class="w w1"> </span>Reitmaier</div><div class="l f4 s3 t0" style="bottom:621.39px;left:286.642px;" data-x="286.642" data-y="622.936" hs="1">#</div><div class="l f2 s2 t0" style="bottom:616.61px;left:294.197px;" data-x="294.197" data-y="618.977" hs="1">,<span class="w w1"> </span>Michael<span class="w w1"> </span>Bebenita</div><div class="l f4 s3 t0" style="bottom:621.39px;left:377.286px;" data-x="377.286" data-y="622.936" hs="1">+</div><div class="l f2 s2 t0" style="bottom:616.61px;left:384.371px;" data-x="384.371" data-y="618.977" hs="1">,<span class="w w1"> </span>Mason<span class="w w1"> </span>Chang</div><div class="l f4 s3 t0" style="bottom:621.39px;left:451.034px;" data-x="451.034" data-y="622.936" hs="1">+#</div><div class="l f2 s2 t0" style="bottom:616.61px;left:465.673px;" data-x="465.673" data-y="618.977" hs="1">,<span class="w w1"> </span>Michael<span class="w w1"> </span>Franz</div><div class="l f4 s3 t0" style="bottom:621.39px;left:534.758px;" data-x="534.758" data-y="622.936" hs="1">+</div><div class="l f2 s4 t0" style="bottom:602.096px;left:266.165px;" data-x="266.165" data-y="604.033" hs="1">Mozilla<span class="w w1"> </span>Corporation</div><div class="l f5 s5 t0" style="bottom:606.682px;left:339.635px;" data-x="339.635" data-y="607.842" hs="1">∗</div><div class="l f6 s4 t0" style="bottom:592.331px;left:90.9763px;" data-x="90.9763" data-y="594.07" hs="1">{</div><div class="l f7 s4 t0" style="bottom:592.08px;left:95.584px;" data-x="95.584" data-y="594.07" hs="1">gal,brendan,shaver,danderson,dmandelin,mrbkap,graydon,bz,jorendorff,jruderman</div><div class="l f6 s4 t0" style="bottom:592.331px;left:458.045px;" data-x="458.045" data-y="594.07" hs="1">}</div><div class="l f7 s4 t0" style="bottom:592.08px;left:462.653px;" data-x="462.653" data-y="594.07" hs="1">@mozilla.com</div><div class="l f2 s4 t0" style="bottom:575.954px;left:267.081px;" data-x="267.081" data-y="577.891" hs="1">Adobe<span class="w w1"> </span>Corporation</div><div class="l f8 s5 t0" style="bottom:580.54px;left:336.561px;" data-x="336.561" data-y="581.7" hs="1">#</div><div class="l f6 s4 t0" style="bottom:566.189px;left:236.902px;" data-x="236.902" data-y="567.928" hs="1">{</div><div class="l f7 s4 t0" style="bottom:565.938px;left:241.51px;" data-x="241.51" data-y="567.928" hs="1">edwsmith,rreitmai</div><div class="l f6 s4 t0" style="bottom:566.189px;left:321.534px;" data-x="321.534" data-y="567.928" hs="1">}</div><div class="l f7 s4 t0" style="bottom:565.938px;left:326.142px;" data-x="326.142" data-y="567.928" hs="1">@adobe.com</div><div class="l f2 s4 t0" style="bottom:549.48px;left:271.978px;" data-x="271.978" data-y="551.417" hs="1">Intel<span class="w w1"> </span>Corporation</div><div class="l f8 s5 t0" style="bottom:554.066px;left:333.988px;" data-x="333.988" data-y="555.226" hs="1">$</div><div class="l f6 s4 t0" style="bottom:539.715px;left:229.841px;" data-x="229.841" data-y="541.454" hs="1">{</div><div class="l f7 s4 t0" style="bottom:539.464px;left:234.449px;" data-x="234.449" data-y="541.454" hs="1">mohammad.r.haghighat</div><div class="l f6 s4 t0" style="bottom:539.715px;left:328.595px;" data-x="328.595" data-y="541.454" hs="1">}</div><div class="l f7 s4 t0" style="bottom:539.464px;left:333.203px;" data-x="333.203" data-y="541.454" hs="1">@intel.com</div><div class="l f2 s4 t0" style="bottom:523.671px;left:246.163px;" data-x="246.163" data-y="525.607" hs="1">University<span class="w w1"> </span>of<span class="w w2"> </span>California,<span class="w w2"> </span>Irvine</div><div class="l f8 s5 t0" style="bottom:528.257px;left:357.865px;" data-x="357.865" data-y="529.416" hs="1">+</div><div class="l f6 s4 t0" style="bottom:513.905px;left:232.195px;" data-x="232.195" data-y="515.645" hs="1">{</div><div class="l f7 s4 t0" style="bottom:513.654px;left:236.803px;" data-x="236.803" data-y="515.645" hs="1">mbebenit,changm,franz</div><div class="l f6 s4 t0" style="bottom:513.905px;left:335.656px;" data-x="335.656" data-y="515.645" hs="1">}</div><div class="l f7 s4 t0" style="bottom:513.654px;left:340.264px;" data-x="340.264" data-y="515.645" hs="1">@uci.edu</div><div class="l f1 s2 t0" style="bottom:445.608px;left:54px;" data-x="54" data-y="447.899" hs="1">Abstract</div><div class="l f2 s4 t0" style="bottom:432.014px;left:54px;" data-x="54" data-y="433.951" hs="1">Dynamic<span class="w w1"> </span>languages<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w1"> </span>JavaScript<span class="w w1"> </span>are<span class="w w1"> </span>more<span class="w w0"> </span>difficult<span class="w w2"> </span>to<span class="w w1"> </span>com-</div><div class="l f2 s4 t0" style="bottom:422.052px;left:54px;" data-x="54" data-y="423.988" hs="1">pile<span class="w w1"> </span>than<span class="w w2"> </span>statically<span class="w w1"> </span>typed<span class="w w1"> </span>ones.<span class="w w1"> </span>Since<span class="w w1"> </span>no<span class="w w2"> </span>concrete<span class="w w1"> </span>type<span class="w w1"> </span>information</div><div class="l f2 s4 t0" style="bottom:412.089px;left:54px;" data-x="54" data-y="414.026" hs="1">is<span class="w w2"> </span>available,<span class="w w2"> </span>traditional<span class="w w2"> </span>compilers<span class="w w1"> </span>need<span class="w w2"> </span>to<span class="w w2"> </span>emit<span class="w w2"> </span>generic<span class="w w1"> </span>code<span class="w w2"> </span>that<span class="w w2"> </span>can</div><div class="l f2 s4 t0" style="bottom:402.126px;left:54px;" data-x="54" data-y="404.063" hs="1">handle<span class="w w2"> </span>all<span class="w w1"> </span>possible<span class="w w2"> </span>type<span class="w w1"> </span>combinations<span class="w w2"> </span>at<span class="w w1"> </span>runtime.<span class="w w2"> </span>We<span class="w w2"> </span>present<span class="w w1"> </span>an<span class="w w2"> </span>al-</div><div class="l f2 s4 t0" style="bottom:392.164px;left:54px;" data-x="54" data-y="394.1" hs="1">ternative<span class="w w1"> </span>compilation<span class="w w1"> </span>technique<span class="w w0"> </span>for<span class="w w1"> </span>dynamically-typed<span class="w w0"> </span>languages</div><div class="l f2 s4 t0" style="bottom:382.201px;left:54px;" data-x="54" data-y="384.138" hs="1">that<span class="w w1"> </span>identifies<span class="w w2"> </span>frequently<span class="w w1"> </span>executed<span class="w w1"> </span>loop<span class="w w2"> </span>traces<span class="w w1"> </span>at<span class="w w1"> </span>run-time<span class="w w1"> </span>and<span class="w w2"> </span>then</div><div class="l f2 s4 t0" style="bottom:372.238px;left:54px;" data-x="54" data-y="374.175" hs="1">generates<span class="w w1"> </span>machine<span class="w w0"> </span>code<span class="w w1"> </span>on<span class="w w1"> </span>the<span class="w w0"> </span>fly<span class="w w1"> </span>that<span class="w w1"> </span>is<span class="w w0"> </span>specialized<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w0"> </span>ac-</div><div class="l f2 s4 t0" style="bottom:362.276px;left:54px;" data-x="54" data-y="364.212" hs="1">tual<span class="w w1"> </span>dynamic<span class="w w1"> </span>types<span class="w w1"> </span>occurring<span class="w w1"> </span>on<span class="w w0"> </span>each<span class="w w2"> </span>path<span class="w w0"> </span>through<span class="w w1"> </span>the<span class="w w1"> </span>loop.<span class="w w1"> </span>Our</div><div class="l f2 s4 t0" style="bottom:352.313px;left:54px;" data-x="54" data-y="354.25" hs="1">method<span class="w w2"> </span>provides<span class="w w1"> </span>cheap<span class="w w2"> </span>inter-procedural<span class="w w1"> </span>type<span class="w w2"> </span>specialization,<span class="w w1"> </span>and<span class="w w2"> </span>an</div><div class="l f2 s4 t0" style="bottom:342.351px;left:54px;" data-x="54" data-y="344.287" hs="1">elegant<span class="w w2"> </span>and<span class="w w1"> </span>efficient<span class="w w2"> </span>way<span class="w w1"> </span>of<span class="w w2"> </span>incrementally<span class="w w1"> </span>compiling<span class="w w2"> </span>lazily<span class="w w1"> </span>discov-</div><div class="l f2 s4 t0" style="bottom:332.388px;left:54px;" data-x="54" data-y="334.325" hs="1">ered<span class="w w1"> </span>alternative<span class="w w2"> </span>paths<span class="w w1"> </span>through<span class="w w1"> </span>nested<span class="w w2"> </span>loops.<span class="w w1"> </span>We<span class="w w2"> </span>have<span class="w w1"> </span>implemented</div><div class="l f2 s4 t0" style="bottom:322.425px;left:54px;" data-x="54" data-y="324.362" hs="1">a<span class="w w1"> </span>dynamic<span class="w w2"> </span>compiler<span class="w w1"> </span>for<span class="w w1"> </span>JavaScript<span class="w w1"> </span>based<span class="w w1"> </span>on<span class="w w2"> </span>our<span class="w w1"> </span>technique<span class="w w1"> </span>and<span class="w w1"> </span>we</div><div class="l f2 s4 t0" style="bottom:312.463px;left:54px;" data-x="54" data-y="314.399" hs="1">have<span class="w w1"> </span>measured<span class="w w1"> </span>speedups<span class="w w1"> </span>of<span class="w w0"> </span>10x<span class="w w1"> </span>and<span class="w w1"> </span>more<span class="w w1"> </span>for<span class="w w0"> </span>certain<span class="w w1"> </span>benchmark</div><div class="l f2 s4 t0" style="bottom:302.5px;left:54px;" data-x="54" data-y="304.437" hs="1">programs.</div><div class="l f9 s4 t0" style="bottom:286.959px;left:54px;" data-x="54" data-y="288.833" hs="1">Categories<span class="w w1"> </span>and<span class="w w0"> </span>Subject<span class="w w1"> </span>Descriptors</div><div class="l f2 s4 t0" style="bottom:286.896px;left:196.549px;" data-x="196.549" data-y="288.833" hs="1">D.3.4<span class="w w1"> </span>[</div><div class="l fa s4 t0" style="bottom:287.102px;left:222.971px;" data-x="222.971" data-y="288.833" hs="1">Programming<span class="w w1"> </span>Lan-</div><div class="l fa s4 t0" style="bottom:277.139px;left:54px;" data-x="54" data-y="278.87" hs="1">guages</div><div class="l f2 s4 t0" style="bottom:276.933px;left:79.2223px;" data-x="79.2223" data-y="278.87" hs="1">]:<span class="w w2"> </span>Processors<span class="w w1"> </span>—</div><div class="l fa s4 t0" style="bottom:277.139px;left:138.74px;" data-x="138.74" data-y="278.87" hs="1">Incremental<span class="w w2"> </span>compilers,<span class="w w1"> </span>code<span class="w w2"> </span>generation</div><div class="l f2 s4 t0" style="bottom:276.933px;left:281.528px;" data-x="281.528" data-y="278.87" hs="1">.</div><div class="l f9 s4 t0" style="bottom:261.392px;left:54px;" data-x="54" data-y="263.266" hs="1">General<span class="w w1"> </span>Terms</div><div class="l f2 s4 t0" style="bottom:261.329px;left:118.375px;" data-x="118.375" data-y="263.266" hs="1">Design,<span class="w w1"> </span>Experimentation,<span class="w w1"> </span>Measurement,<span class="w w1"> </span>Perfor-</div><div class="l f2 s4 t0" style="bottom:251.366px;left:54px;" data-x="54" data-y="253.303" hs="1">mance.</div><div class="l f9 s4 t0" style="bottom:235.825px;left:54px;" data-x="54" data-y="237.699" hs="1">Keywords</div><div class="l f2 s4 t0" style="bottom:235.762px;left:98.4728px;" data-x="98.4728" data-y="237.699" hs="1">JavaScript,<span class="w w2"> </span>just-in-time<span class="w w1"> </span>compilation,<span class="w w2"> </span>trace<span class="w w1"> </span>trees.</div><div class="l f1 s2 t0" style="bottom:212.831px;left:54px;" data-x="54" data-y="215.121" hs="1">1.<span class="w w3"> </span>Introduction</div><div class="l fa s4 t0" style="bottom:199.443px;left:54px;" data-x="54" data-y="201.173" hs="1">Dynamic<span class="w w2"> </span>languages</div><div class="l f2 s4 t0" style="bottom:199.237px;left:127.024px;" data-x="127.024" data-y="201.173" hs="1">such<span class="w w2"> </span>as<span class="w w1"> </span>JavaScript,<span class="w w2"> </span>Python,<span class="w w2"> </span>and<span class="w w1"> </span>Ruby,<span class="w w2"> </span>are<span class="w w2"> </span>pop-</div><div class="l f2 s4 t0" style="bottom:189.274px;left:54px;" data-x="54" data-y="191.211" hs="1">ular<span class="w w2"> </span>since<span class="w w1"> </span>they<span class="w w1"> </span>are<span class="w w2"> </span>expressive,<span class="w w1"> </span>accessible<span class="w w2"> </span>to<span class="w w1"> </span>non-experts,<span class="w w1"> </span>and<span class="w w2"> </span>make</div><div class="l f2 s4 t0" style="bottom:179.311px;left:54px;" data-x="54" data-y="181.248" hs="1">deployment<span class="w w1"> </span>as<span class="w w2"> </span>easy<span class="w w1"> </span>as<span class="w w1"> </span>distributing<span class="w w1"> </span>a<span class="w w1"> </span>source<span class="w w2"> </span>file.<span class="w w1"> </span>They<span class="w w1"> </span>are<span class="w w1"> </span>used<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:169.349px;left:54px;" data-x="54" data-y="171.286" hs="1">small<span class="w w1"> </span>scripts<span class="w w0"> </span>as<span class="w w1"> </span>well<span class="w w1"> </span>as<span class="w w1"> </span>for<span class="w w0"> </span>complex<span class="w w1"> </span>applications.<span class="w w1"> </span>JavaScript,<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:159.386px;left:54px;" data-x="54" data-y="161.323" hs="1">example,<span class="w w2"> </span>is<span class="w w1"> </span>the<span class="w w1"> </span>de<span class="w w1"> </span>facto<span class="w w2"> </span>standard<span class="w w1"> </span>for<span class="w w1"> </span>client-side<span class="w w2"> </span>web<span class="w w1"> </span>programming</div><div class="l f2 s6 t0" style="bottom:118.26px;left:54px;" data-x="54" data-y="119.766" hs="1">Permission<span class="w w2"> </span>to<span class="w w1"> </span>make<span class="w w1"> </span>digital<span class="w w2"> </span>or<span class="w w1"> </span>hard<span class="w w1"> </span>copies<span class="w w2"> </span>of<span class="w w1"> </span>all<span class="w w1"> </span>or<span class="w w2"> </span>part<span class="w w1"> </span>of<span class="w w1"> </span>this<span class="w w2"> </span>work<span class="w w1"> </span>for<span class="w w1"> </span>personal<span class="w w2"> </span>or</div><div class="l f2 s6 t0" style="bottom:110.29px;left:54px;" data-x="54" data-y="111.796" hs="1">classroom<span class="w w2"> </span>use<span class="w w1"> </span>is<span class="w w2"> </span>granted<span class="w w2"> </span>without<span class="w w1"> </span>fee<span class="w w2"> </span>provided<span class="w w1"> </span>that<span class="w w2"> </span>copies<span class="w w2"> </span>are<span class="w w1"> </span>not<span class="w w2"> </span>made<span class="w w1"> </span>or<span class="w w2"> </span>distributed</div><div class="l f2 s6 t0" style="bottom:102.32px;left:54px;" data-x="54" data-y="103.826" hs="1">for<span class="w w2"> </span>profit<span class="w w2"> </span>or<span class="w w2"> </span>commercial<span class="w w2"> </span>advantage<span class="w w2"> </span>and<span class="w w1"> </span>that<span class="w w2"> </span>copies<span class="w w2"> </span>bear<span class="w w2"> </span>this<span class="w w2"> </span>notice<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w2"> </span>full<span class="w w2"> </span>citation</div><div class="l f2 s6 t0" style="bottom:94.3498px;left:54px;" data-x="54" data-y="95.8561" hs="1">on<span class="w w2"> </span>the<span class="w w1"> </span>first<span class="w w2"> </span>page.<span class="w w2"> </span>To<span class="w w2"> </span>copy<span class="w w1"> </span>otherwise,<span class="w w2"> </span>to<span class="w w2"> </span>republish,<span class="w w1"> </span>to<span class="w w2"> </span>post<span class="w w1"> </span>on<span class="w w2"> </span>servers<span class="w w2"> </span>or<span class="w w1"> </span>to<span class="w w2"> </span>redistribute</div><div class="l f2 s6 t0" style="bottom:86.3797px;left:54px;" data-x="54" data-y="87.886" hs="1">to<span class="w w2"> </span>lists,<span class="w w2"> </span>requires<span class="w w1"> </span>prior<span class="w w2"> </span>specific<span class="w w2"> </span>permission<span class="w w2"> </span>and/or<span class="w w1"> </span>a<span class="w w2"> </span>fee.</div><div class="l fb s6 t0" style="bottom:76.4171px;left:54px;" data-x="54" data-y="77.9234" hs="1">PLDI’09,</div><div class="l f2 s6 t0" style="bottom:76.4171px;left:87.6277px;" data-x="87.6277" data-y="77.9234" hs="1">June<span class="w w2"> </span>15–20,<span class="w w2"> </span>2009,<span class="w w1"> </span>Dublin,<span class="w w2"> </span>Ireland.</div><div class="l f2 s6 t0" style="bottom:68.447px;left:54px;" data-x="54" data-y="69.9533" hs="1">Copyright</div><div class="l f2 s6 t0" style="bottom:68.6572px;left:86.3825px;" data-x="86.3825" data-y="70.1635" hs="1">c</div><div class="l f2 s6 t0" style="bottom:68.447px;left:93.6453px;" data-x="93.6453" data-y="69.9533" hs="1">2009<span class="w w2"> </span>ACM<span class="w w2"> </span>978-1-60558-392-1/09/06.<span class="w w2"> </span>.<span class="w w2"> </span>.$5.00</div><div class="l f2 s4 t0" style="bottom:445.962px;left:317.014px;" data-x="317.014" data-y="447.899" hs="1">and<span class="w w1"> </span>is<span class="w w2"> </span>used<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>application<span class="w w2"> </span>logic<span class="w w1"> </span>of<span class="w w1"> </span>browser-based<span class="w w2"> </span>productivity</div><div class="l f2 s4 t0" style="bottom:435.999px;left:317.014px;" data-x="317.014" data-y="437.936" hs="1">applications<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w1"> </span>Google<span class="w w1"> </span>Mail,<span class="w w1"> </span>Google<span class="w w0"> </span>Docs<span class="w w2"> </span>and<span class="w w1"> </span>Zimbra<span class="w w0"> </span>Col-</div><div class="l f2 s4 t0" style="bottom:426.037px;left:317.014px;" data-x="317.014" data-y="427.973" hs="1">laboration<span class="w w1"> </span>Suite.<span class="w w0"> </span>In<span class="w w1"> </span>this<span class="w w1"> </span>domain,<span class="w w0"> </span>in<span class="w w1"> </span>order<span class="w w1"> </span>to<span class="w w0"> </span>provide<span class="w w1"> </span>a<span class="w w1"> </span>fluid<span class="w w0"> </span>user</div><div class="l f2 s4 t0" style="bottom:416.074px;left:317.014px;" data-x="317.014" data-y="418.011" hs="1">experience<span class="w w2"> </span>and<span class="w w2"> </span>enable<span class="w w1"> </span>a<span class="w w2"> </span>new<span class="w w2"> </span>generation<span class="w w1"> </span>of<span class="w w2"> </span>applications,<span class="w w1"> </span>virtual<span class="w w2"> </span>ma-</div><div class="l f2 s4 t0" style="bottom:406.111px;left:317.014px;" data-x="317.014" data-y="408.048" hs="1">chines<span class="w w2"> </span>must<span class="w w1"> </span>provide<span class="w w1"> </span>a<span class="w w2"> </span>low<span class="w w1"> </span>startup<span class="w w2"> </span>time<span class="w w1"> </span>and<span class="w w1"> </span>high<span class="w w2"> </span>performance.</div><div class="l f2 s4 t0" style="bottom:396.149px;left:328.969px;" data-x="328.969" data-y="398.086" hs="1">Compilers<span class="w w1"> </span>for<span class="w w1"> </span>statically<span class="w w1"> </span>typed<span class="w w1"> </span>languages<span class="w w1"> </span>rely<span class="w w1"> </span>on<span class="w w2"> </span>type<span class="w w1"> </span>informa-</div><div class="l f2 s4 t0" style="bottom:386.186px;left:317.014px;" data-x="317.014" data-y="388.123" hs="1">tion<span class="w w2"> </span>to<span class="w w2"> </span>generate<span class="w w1"> </span>efficient<span class="w w2"> </span>machine<span class="w w2"> </span>code.<span class="w w1"> </span>In<span class="w w2"> </span>a<span class="w w2"> </span>dynamically<span class="w w1"> </span>typed<span class="w w2"> </span>pro-</div><div class="l f2 s4 t0" style="bottom:376.224px;left:317.014px;" data-x="317.014" data-y="378.16" hs="1">gramming<span class="w w1"> </span>language<span class="w w0"> </span>such<span class="w w1"> </span>as<span class="w w0"> </span>JavaScript,<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w0"> </span>of<span class="w w1"> </span>expressions</div><div class="l f2 s4 t0" style="bottom:366.261px;left:317.014px;" data-x="317.014" data-y="368.198" hs="1">may<span class="w w1"> </span>vary<span class="w w1"> </span>at<span class="w w1"> </span>runtime.<span class="w w1"> </span>This<span class="w w1"> </span>means<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>compiler<span class="w w2"> </span>can<span class="w w1"> </span>no<span class="w w0"> </span>longer</div><div class="l f2 s4 t0" style="bottom:356.298px;left:317.014px;" data-x="317.014" data-y="358.235" hs="1">easily<span class="w w1"> </span>transform<span class="w w1"> </span>operations<span class="w w1"> </span>into<span class="w w1"> </span>machine<span class="w w1"> </span>instructions<span class="w w1"> </span>that<span class="w w1"> </span>operate</div><div class="l f2 s4 t0" style="bottom:346.336px;left:317.014px;" data-x="317.014" data-y="348.272" hs="1">on<span class="w w1"> </span>one<span class="w w2"> </span>specific<span class="w w1"> </span>type.<span class="w w1"> </span>Without<span class="w w2"> </span>exact<span class="w w1"> </span>type<span class="w w1"> </span>information,<span class="w w2"> </span>the<span class="w w1"> </span>compiler</div><div class="l f2 s4 t0" style="bottom:336.373px;left:317.014px;" data-x="317.014" data-y="338.31" hs="1">must<span class="w w1"> </span>emit<span class="w w1"> </span>slower<span class="w w1"> </span>generalized<span class="w w1"> </span>machine<span class="w w1"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>can<span class="w w1"> </span>deal<span class="w w1"> </span>with<span class="w w1"> </span>all</div><div class="l f2 s4 t0" style="bottom:326.41px;left:317.014px;" data-x="317.014" data-y="328.347" hs="1">potential<span class="w w1"> </span>type<span class="w w2"> </span>combinations.<span class="w w1"> </span>While<span class="w w1"> </span>compile-time<span class="w w1"> </span>static<span class="w w1"> </span>type<span class="w w1"> </span>infer-</div><div class="l f2 s4 t0" style="bottom:316.448px;left:317.014px;" data-x="317.014" data-y="318.384" hs="1">ence<span class="w w1"> </span>might<span class="w w0"> </span>be<span class="w w0"> </span>able<span class="w w1"> </span>to<span class="w w0"> </span>gather<span class="w w1"> </span>type<span class="w w0"> </span>information<span class="w w1"> </span>to<span class="w w0"> </span>generate<span class="w w1"> </span>opti-</div><div class="l f2 s4 t0" style="bottom:306.485px;left:317.014px;" data-x="317.014" data-y="308.422" hs="1">mized<span class="w w1"> </span>machine<span class="w w1"> </span>code,<span class="w w0"> </span>traditional<span class="w w1"> </span>static<span class="w w1"> </span>analysis<span class="w w0"> </span>is<span class="w w1"> </span>very<span class="w w1"> </span>expensive</div><div class="l f2 s4 t0" style="bottom:296.522px;left:317.014px;" data-x="317.014" data-y="298.459" hs="1">and<span class="w w2"> </span>hence<span class="w w1"> </span>not<span class="w w1"> </span>well<span class="w w2"> </span>suited<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>highly<span class="w w1"> </span>interactive<span class="w w2"> </span>environment<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:286.56px;left:317.014px;" data-x="317.014" data-y="288.496" hs="1">a<span class="w w2"> </span>web<span class="w w1"> </span>browser.</div><div class="l f2 s4 t0" style="bottom:276.597px;left:328.969px;" data-x="328.969" data-y="278.534" hs="1">We<span class="w w1"> </span>present<span class="w w0"> </span>a<span class="w w1"> </span>trace-based<span class="w w0"> </span>compilation<span class="w w1"> </span>technique<span class="w w0"> </span>for<span class="w w1"> </span>dynamic</div><div class="l f2 s4 t0" style="bottom:266.635px;left:317.014px;" data-x="317.014" data-y="268.571" hs="1">languages<span class="w w1"> </span>that<span class="w w2"> </span>reconciles<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w1"> </span>compilation<span class="w w1"> </span>with<span class="w w1"> </span>excellent<span class="w w2"> </span>per-</div><div class="l f2 s4 t0" style="bottom:256.672px;left:317.014px;" data-x="317.014" data-y="258.609" hs="1">formance<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>generated<span class="w w2"> </span>machine<span class="w w1"> </span>code.<span class="w w2"> </span>Our<span class="w w2"> </span>system<span class="w w1"> </span>uses<span class="w w2"> </span>a<span class="w w2"> </span>mixed-</div><div class="l f2 s4 t0" style="bottom:246.709px;left:317.014px;" data-x="317.014" data-y="248.646" hs="1">mode<span class="w w2"> </span>execution<span class="w w1"> </span>approach:<span class="w w2"> </span>the<span class="w w1"> </span>system<span class="w w2"> </span>starts<span class="w w1"> </span>running<span class="w w2"> </span>JavaScript<span class="w w2"> </span>in<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:236.747px;left:317.014px;" data-x="317.014" data-y="238.683" hs="1">fast-starting<span class="w w1"> </span>bytecode<span class="w w2"> </span>interpreter.<span class="w w1"> </span>As<span class="w w1"> </span>the<span class="w w2"> </span>program<span class="w w1"> </span>runs,<span class="w w1"> </span>the<span class="w w1"> </span>system</div><div class="l f2 s4 t0" style="bottom:226.784px;left:317.014px;" data-x="317.014" data-y="228.721" hs="1">identifies</div><div class="l fa s4 t0" style="bottom:226.99px;left:353.699px;" data-x="353.699" data-y="228.721" hs="1">hot</div><div class="l f2 s4 t0" style="bottom:226.784px;left:369.125px;" data-x="369.125" data-y="228.721" hs="1">(frequently<span class="w w0"> </span>executed)<span class="w w1"> </span>bytecode<span class="w w0"> </span>sequences,<span class="w w1"> </span>records</div><div class="l f2 s4 t0" style="bottom:216.821px;left:317.014px;" data-x="317.014" data-y="218.758" hs="1">them,<span class="w w1"> </span>and<span class="w w0"> </span>compiles<span class="w w1"> </span>them<span class="w w1"> </span>to<span class="w w0"> </span>fast<span class="w w1"> </span>native<span class="w w1"> </span>code.<span class="w w1"> </span>We<span class="w w1"> </span>call<span class="w w1"> </span>such<span class="w w0"> </span>a<span class="w w1"> </span>se-</div><div class="l f2 s4 t0" style="bottom:206.859px;left:317.014px;" data-x="317.014" data-y="208.795" hs="1">quence<span class="w w2"> </span>of<span class="w w1"> </span>instructions<span class="w w1"> </span>a</div><div class="l fa s4 t0" style="bottom:207.065px;left:404.668px;" data-x="404.668" data-y="208.795" hs="1">trace</div><div class="l f2 s4 t0" style="bottom:206.859px;left:422.959px;" data-x="422.959" data-y="208.795" hs="1">.</div><div class="l f2 s4 t0" style="bottom:196.896px;left:328.969px;" data-x="328.969" data-y="198.833" hs="1">Unlike<span class="w w1"> </span>method-based<span class="w w0"> </span>dynamic<span class="w w0"> </span>compilers,<span class="w w1"> </span>our<span class="w w0"> </span>dynamic<span class="w w0"> </span>com-</div><div class="l f2 s4 t0" style="bottom:186.933px;left:317.014px;" data-x="317.014" data-y="188.87" hs="1">piler<span class="w w1"> </span>operates<span class="w w0"> </span>at<span class="w w1"> </span>the<span class="w w0"> </span>granularity<span class="w w1"> </span>of<span class="w w1"> </span>individual<span class="w w0"> </span>loops.<span class="w w1"> </span>This<span class="w w0"> </span>design</div><div class="l f2 s4 t0" style="bottom:176.971px;left:317.014px;" data-x="317.014" data-y="178.907" hs="1">choice<span class="w w1"> </span>is<span class="w w0"> </span>based<span class="w w1"> </span>on<span class="w w0"> </span>the<span class="w w1"> </span>expectation<span class="w w1"> </span>that<span class="w w0"> </span>programs<span class="w w1"> </span>spend<span class="w w0"> </span>most<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:167.008px;left:317.014px;" data-x="317.014" data-y="168.945" hs="1">their<span class="w w1"> </span>time<span class="w w1"> </span>in<span class="w w1"> </span>hot<span class="w w1"> </span>loops.<span class="w w1"> </span>Even<span class="w w1"> </span>in<span class="w w1"> </span>dynamically<span class="w w1"> </span>typed<span class="w w1"> </span>languages,<span class="w w0"> </span>we</div><div class="l f2 s4 t0" style="bottom:157.045px;left:317.014px;" data-x="317.014" data-y="158.982" hs="1">expect<span class="w w2"> </span>hot<span class="w w1"> </span>loops<span class="w w2"> </span>to<span class="w w2"> </span>be<span class="w w1"> </span>mostly</div><div class="l fa s4 t0" style="bottom:157.252px;left:422.929px;" data-x="422.929" data-y="158.982" hs="1">type-stable</div><div class="l f2 s4 t0" style="bottom:157.045px;left:462.273px;" data-x="462.273" data-y="158.982" hs="1">,<span class="w w2"> </span>meaning<span class="w w1"> </span>that<span class="w w2"> </span>the<span class="w w1"> </span>types<span class="w w2"> </span>of</div><div class="l f2 s4 t0" style="bottom:147.083px;left:317.014px;" data-x="317.014" data-y="149.02" hs="1">values<span class="w w2"> </span>are<span class="w w2"> </span>invariant.<span class="w w2"> </span>(12)<span class="w w1"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>we<span class="w w2"> </span>would<span class="w w2"> </span>expect<span class="w w1"> </span>loop<span class="w w2"> </span>coun-</div><div class="l f2 s4 t0" style="bottom:137.12px;left:317.014px;" data-x="317.014" data-y="139.057" hs="1">ters<span class="w w2"> </span>that<span class="w w1"> </span>start<span class="w w1"> </span>as<span class="w w2"> </span>integers<span class="w w1"> </span>to<span class="w w1"> </span>remain<span class="w w2"> </span>integers<span class="w w1"> </span>for<span class="w w2"> </span>all<span class="w w1"> </span>iterations.<span class="w w1"> </span>When</div><div class="l f2 s4 t0" style="bottom:127.158px;left:317.014px;" data-x="317.014" data-y="129.094" hs="1">both<span class="w w1"> </span>of<span class="w w1"> </span>these<span class="w w1"> </span>expectations<span class="w w1"> </span>hold,<span class="w w1"> </span>a<span class="w w1"> </span>trace-based<span class="w w1"> </span>compiler<span class="w w1"> </span>can<span class="w w1"> </span>cover</div><div class="l f2 s4 t0" style="bottom:117.195px;left:317.014px;" data-x="317.014" data-y="119.132" hs="1">the<span class="w w2"> </span>program<span class="w w1"> </span>execution<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>small<span class="w w1"> </span>number<span class="w w2"> </span>of<span class="w w1"> </span>type-specialized,<span class="w w2"> </span>ef-</div><div class="l f2 s4 t0" style="bottom:107.232px;left:317.014px;" data-x="317.014" data-y="109.169" hs="1">ficiently<span class="w w2"> </span>compiled<span class="w w1"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:97.2697px;left:328.969px;" data-x="328.969" data-y="99.2064" hs="1">Each<span class="w w1"> </span>compiled<span class="w w2"> </span>trace<span class="w w1"> </span>covers<span class="w w1"> </span>one<span class="w w2"> </span>path<span class="w w1"> </span>through<span class="w w1"> </span>the<span class="w w1"> </span>program<span class="w w2"> </span>with</div><div class="l f2 s4 t0" style="bottom:87.307px;left:317.014px;" data-x="317.014" data-y="89.2437" hs="1">one<span class="w w2"> </span>mapping<span class="w w1"> </span>of<span class="w w2"> </span>values<span class="w w2"> </span>to<span class="w w1"> </span>types.<span class="w w2"> </span>When<span class="w w1"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>executes<span class="w w2"> </span>a<span class="w w2"> </span>compiled</div><div class="l f2 s4 t0" style="bottom:77.3444px;left:317.014px;" data-x="317.014" data-y="79.2811" hs="1">trace,<span class="w w0"> </span>it<span class="w w0"> </span>cannot<span class="w w0"> </span>guarantee<span class="w w0"> </span>that<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w0"> </span>path<span class="w w0"> </span>will<span class="w w0"> </span>be<span class="w w0"> </span>followed</div><div class="l f2 s4 t0" style="bottom:67.3818px;left:317.014px;" data-x="317.014" data-y="69.3185" hs="1">or<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w1"> </span>types<span class="w w0"> </span>will<span class="w w1"> </span>occur<span class="w w0"> </span>in<span class="w w0"> </span>subsequent<span class="w w1"> </span>loop<span class="w w0"> </span>iterations.</div></div></div><div id="page-2" class="p" style="width:612px;height:792px;background-image:url(p2.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f2 s4 t0" style="bottom:710.093px;left:54px;" data-x="54" data-y="712.03" hs="1">Hence,<span class="w w2"> </span>recording<span class="w w2"> </span>and<span class="w w1"> </span>compiling<span class="w w2"> </span>a<span class="w w1"> </span>trace</div><div class="l fa s4 t0" style="bottom:710.299px;left:195.461px;" data-x="195.461" data-y="712.03" hs="1">speculates</div><div class="l f2 s4 t0" style="bottom:710.093px;left:234.688px;" data-x="234.688" data-y="712.03" hs="1">that<span class="w w2"> </span>the<span class="w w2"> </span>path<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:700.13px;left:54px;" data-x="54" data-y="702.067" hs="1">typing<span class="w w2"> </span>will<span class="w w1"> </span>be<span class="w w2"> </span>exactly<span class="w w2"> </span>as<span class="w w1"> </span>they<span class="w w2"> </span>were<span class="w w1"> </span>during<span class="w w2"> </span>recording<span class="w w2"> </span>for<span class="w w1"> </span>subsequent</div><div class="l f2 s4 t0" style="bottom:690.168px;left:54px;" data-x="54" data-y="692.105" hs="1">iterations<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>loop.</div><div class="l f2 s4 t0" style="bottom:680.205px;left:65.9552px;" data-x="65.9552" data-y="682.142" hs="1">Every<span class="w w1"> </span>compiled<span class="w w2"> </span>trace<span class="w w1"> </span>contains<span class="w w1"> </span>all<span class="w w1"> </span>the</div><div class="l fa s4 t0" style="bottom:680.411px;left:203.17px;" data-x="203.17" data-y="682.142" hs="1">guards</div><div class="l f2 s4 t0" style="bottom:680.205px;left:230.303px;" data-x="230.303" data-y="682.142" hs="1">(checks)<span class="w w1"> </span>required</div><div class="l f2 s4 t0" style="bottom:670.243px;left:54px;" data-x="54" data-y="672.179" hs="1">to<span class="w w1"> </span>validate<span class="w w0"> </span>the<span class="w w1"> </span>speculation.<span class="w w0"> </span>If<span class="w w1"> </span>one<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>guards<span class="w w1"> </span>fails<span class="w w0"> </span>(if<span class="w w1"> </span>control</div><div class="l f2 s4 t0" style="bottom:660.28px;left:54px;" data-x="54" data-y="662.217" hs="1">flow<span class="w w1"> </span>is<span class="w w1"> </span>different,<span class="w w0"> </span>or<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w1"> </span>of<span class="w w0"> </span>a<span class="w w1"> </span>different<span class="w w1"> </span>type<span class="w w1"> </span>is<span class="w w0"> </span>generated),<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:650.317px;left:54px;" data-x="54" data-y="652.254" hs="1">trace<span class="w w1"> </span>exits.<span class="w w0"> </span>If<span class="w w1"> </span>an<span class="w w1"> </span>exit<span class="w w1"> </span>becomes<span class="w w0"> </span>hot,<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w0"> </span>can<span class="w w1"> </span>record<span class="w w1"> </span>a</div><div class="l fa s4 t0" style="bottom:650.523px;left:267.971px;" data-x="267.971" data-y="652.254" hs="1">branch</div><div class="l fa s4 t0" style="bottom:640.561px;left:54px;" data-x="54" data-y="642.291" hs="1">trace</div><div class="l f2 s4 t0" style="bottom:640.355px;left:74.4956px;" data-x="74.4956" data-y="642.291" hs="1">starting<span class="w w2"> </span>at<span class="w w1"> </span>the<span class="w w1"> </span>exit<span class="w w2"> </span>to<span class="w w1"> </span>cover<span class="w w2"> </span>the<span class="w w1"> </span>new<span class="w w2"> </span>path.<span class="w w1"> </span>In<span class="w w2"> </span>this<span class="w w1"> </span>way,<span class="w w2"> </span>the<span class="w w1"> </span>VM</div><div class="l f2 s4 t0" style="bottom:630.392px;left:54px;" data-x="54" data-y="632.329" hs="1">records<span class="w w2"> </span>a</div><div class="l fa s4 t0" style="bottom:630.598px;left:88.852px;" data-x="88.852" data-y="632.329" hs="1">trace<span class="w w2"> </span>tree</div><div class="l f2 s4 t0" style="bottom:630.392px;left:125.237px;" data-x="125.237" data-y="632.329" hs="1">covering<span class="w w2"> </span>all<span class="w w1"> </span>the<span class="w w2"> </span>hot<span class="w w1"> </span>paths<span class="w w1"> </span>through<span class="w w2"> </span>the<span class="w w1"> </span>loop.</div><div class="l f2 s4 t0" style="bottom:620.429px;left:65.9552px;" data-x="65.9552" data-y="622.366" hs="1">Nested<span class="w w1"> </span>loops<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w1"> </span>difficult<span class="w w1"> </span>to<span class="w w0"> </span>optimize<span class="w w1"> </span>for<span class="w w1"> </span>tracing<span class="w w1"> </span>VMs.<span class="w w0"> </span>In</div><div class="l f2 s4 t0" style="bottom:610.467px;left:54px;" data-x="54" data-y="612.404" hs="1">a<span class="w w1"> </span>na</div><div class="l f2 s4 t0" style="bottom:610.512px;left:69.3806px;" data-x="69.3806" data-y="612.448" hs="1">¨</div><div class="l f2 s4 t0" style="bottom:610.467px;left:69.6272px;" data-x="69.6272" data-y="612.404" hs="1">ıve<span class="w w1"> </span>implementation,<span class="w w1"> </span>inner<span class="w w0"> </span>loops<span class="w w1"> </span>would<span class="w w1"> </span>become<span class="w w1"> </span>hot<span class="w w0"> </span>first,<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:600.504px;left:54px;" data-x="54" data-y="602.441" hs="1">the<span class="w w1"> </span>VM<span class="w w1"> </span>would<span class="w w1"> </span>start<span class="w w0"> </span>tracing<span class="w w1"> </span>there.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>exits,<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:590.541px;left:54px;" data-x="54" data-y="592.478" hs="1">VM<span class="w w2"> </span>would<span class="w w1"> </span>detect<span class="w w2"> </span>that<span class="w w1"> </span>a<span class="w w2"> </span>different<span class="w w2"> </span>branch<span class="w w1"> </span>was<span class="w w2"> </span>taken.<span class="w w1"> </span>The<span class="w w2"> </span>VM<span class="w w1"> </span>would</div><div class="l f2 s4 t0" style="bottom:580.579px;left:54px;" data-x="54" data-y="582.516" hs="1">try<span class="w w1"> </span>to<span class="w w2"> </span>record<span class="w w1"> </span>a<span class="w w1"> </span>branch<span class="w w1"> </span>trace,<span class="w w1"> </span>and<span class="w w1"> </span>find<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>reaches<span class="w w1"> </span>not<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:570.616px;left:54px;" data-x="54" data-y="572.553" hs="1">inner<span class="w w1"> </span>loop<span class="w w2"> </span>header,<span class="w w1"> </span>but<span class="w w2"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w1"> </span>header.<span class="w w2"> </span>At<span class="w w1"> </span>this<span class="w w2"> </span>point,<span class="w w1"> </span>the<span class="w w1"> </span>VM</div><div class="l f2 s4 t0" style="bottom:560.654px;left:54px;" data-x="54" data-y="562.59" hs="1">could<span class="w w1"> </span>continue<span class="w w2"> </span>tracing<span class="w w1"> </span>until<span class="w w1"> </span>it<span class="w w1"> </span>reaches<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w2"> </span>again,</div><div class="l f2 s4 t0" style="bottom:550.691px;left:54px;" data-x="54" data-y="552.628" hs="1">thus<span class="w w1"> </span>tracing<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w0"> </span>inside<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>tree<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w0"> </span>loop.</div><div class="l f2 s4 t0" style="bottom:540.728px;left:54px;" data-x="54" data-y="542.665" hs="1">But<span class="w w2"> </span>this<span class="w w1"> </span>requires<span class="w w2"> </span>tracing<span class="w w1"> </span>a<span class="w w2"> </span>copy<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>for<span class="w w1"> </span>every<span class="w w2"> </span>side<span class="w w2"> </span>exit</div><div class="l f2 s4 t0" style="bottom:530.766px;left:54px;" data-x="54" data-y="532.702" hs="1">and<span class="w w1"> </span>type<span class="w w1"> </span>combination<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop.<span class="w w1"> </span>In<span class="w w1"> </span>essence,<span class="w w1"> </span>this<span class="w w1"> </span>is<span class="w w1"> </span>a<span class="w w0"> </span>form</div><div class="l f2 s4 t0" style="bottom:520.803px;left:54px;" data-x="54" data-y="522.74" hs="1">of<span class="w w1"> </span>unintended<span class="w w1"> </span>tail<span class="w w2"> </span>duplication,<span class="w w1"> </span>which<span class="w w1"> </span>can<span class="w w1"> </span>easily<span class="w w1"> </span>overflow<span class="w w2"> </span>the<span class="w w1"> </span>code</div><div class="l f2 s4 t0" style="bottom:510.84px;left:54px;" data-x="54" data-y="512.777" hs="1">cache.<span class="w w2"> </span>Alternatively,<span class="w w2"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>could<span class="w w2"> </span>simply<span class="w w2"> </span>stop<span class="w w1"> </span>tracing,<span class="w w2"> </span>and<span class="w w1"> </span>give<span class="w w2"> </span>up</div><div class="l f2 s4 t0" style="bottom:500.878px;left:54px;" data-x="54" data-y="502.814" hs="1">on<span class="w w2"> </span>ever<span class="w w1"> </span>tracing<span class="w w2"> </span>outer<span class="w w1"> </span>loops.</div><div class="l f2 s4 t0" style="bottom:490.915px;left:65.9552px;" data-x="65.9552" data-y="492.852" hs="1">We<span class="w w1"> </span>solve<span class="w w1"> </span>the<span class="w w0"> </span>nested<span class="w w1"> </span>loop<span class="w w0"> </span>problem<span class="w w1"> </span>by<span class="w w0"> </span>recording</div><div class="l fa s4 t0" style="bottom:491.121px;left:248.302px;" data-x="248.302" data-y="492.852" hs="1">nested<span class="w w1"> </span>trace</div><div class="l fa s4 t0" style="bottom:481.159px;left:54px;" data-x="54" data-y="482.889" hs="1">trees</div><div class="l f2 s4 t0" style="bottom:480.952px;left:71.0985px;" data-x="71.0985" data-y="482.889" hs="1">.<span class="w w2"> </span>Our<span class="w w1"> </span>system<span class="w w2"> </span>traces<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>loop<span class="w w2"> </span>exactly<span class="w w1"> </span>as<span class="w w2"> </span>the<span class="w w1"> </span>na</div><div class="l f2 s4 t0" style="bottom:480.997px;left:251.467px;" data-x="251.467" data-y="482.934" hs="1">¨</div><div class="l f2 s4 t0" style="bottom:480.952px;left:251.713px;" data-x="251.713" data-y="482.889" hs="1">ıve<span class="w w2"> </span>version.</div><div class="l f2 s4 t0" style="bottom:470.99px;left:54px;" data-x="54" data-y="472.927" hs="1">The<span class="w w2"> </span>system<span class="w w1"> </span>stops<span class="w w1"> </span>extending<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>when<span class="w w2"> </span>it<span class="w w1"> </span>reaches<span class="w w1"> </span>an<span class="w w2"> </span>outer</div><div class="l f2 s4 t0" style="bottom:461.027px;left:54px;" data-x="54" data-y="462.964" hs="1">loop,<span class="w w1"> </span>but<span class="w w1"> </span>then<span class="w w1"> </span>it<span class="w w1"> </span>starts<span class="w w1"> </span>a<span class="w w1"> </span>new<span class="w w2"> </span>trace<span class="w w1"> </span>at<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w1"> </span>header.<span class="w w1"> </span>When</div><div class="l f2 s4 t0" style="bottom:451.065px;left:54px;" data-x="54" data-y="453.001" hs="1">the<span class="w w2"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>reaches<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>loop<span class="w w2"> </span>header,<span class="w w2"> </span>the<span class="w w1"> </span>system<span class="w w2"> </span>tries<span class="w w1"> </span>to<span class="w w2"> </span>call</div><div class="l f2 s4 t0" style="bottom:441.102px;left:54px;" data-x="54" data-y="443.039" hs="1">the<span class="w w2"> </span>trace<span class="w w2"> </span>tree<span class="w w1"> </span>for<span class="w w2"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>loop.<span class="w w2"> </span>If<span class="w w2"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>succeeds,<span class="w w2"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>records</div><div class="l f2 s4 t0" style="bottom:431.139px;left:54px;" data-x="54" data-y="433.076" hs="1">the<span class="w w0"> </span>call<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>inner<span class="w w0"> </span>tree<span class="w w0"> </span>as<span class="w w1"> </span>part<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>outer<span class="w w0"> </span>trace<span class="w w1"> </span>and<span class="w w0"> </span>finishes</div><div class="l f2 s4 t0" style="bottom:421.177px;left:54px;" data-x="54" data-y="423.113" hs="1">the<span class="w w1"> </span>outer<span class="w w0"> </span>trace<span class="w w1"> </span>as<span class="w w1"> </span>normal.<span class="w w0"> </span>In<span class="w w1"> </span>this<span class="w w0"> </span>way</div><div class="l f2 s4 t0" style="bottom:421.177px;left:194.36px;" data-x="194.36" data-y="423.113" hs="1">,<span class="w w1"> </span>our<span class="w w0"> </span>system<span class="w w1"> </span>can<span class="w w1"> </span>trace<span class="w w0"> </span>any</div><div class="l f2 s4 t0" style="bottom:411.214px;left:54px;" data-x="54" data-y="413.151" hs="1">number<span class="w w2"> </span>of<span class="w w1"> </span>loops<span class="w w1"> </span>nested<span class="w w2"> </span>to<span class="w w1"> </span>any<span class="w w2"> </span>depth<span class="w w1"> </span>without<span class="w w1"> </span>causing<span class="w w2"> </span>excessive<span class="w w2"> </span>tail</div><div class="l f2 s4 t0" style="bottom:401.251px;left:54px;" data-x="54" data-y="403.188" hs="1">duplication.</div><div class="l f2 s4 t0" style="bottom:391.289px;left:65.9552px;" data-x="65.9552" data-y="393.225" hs="1">These<span class="w w1"> </span>techniques<span class="w w1"> </span>allow<span class="w w0"> </span>a<span class="w w1"> </span>VM<span class="w w1"> </span>to<span class="w w1"> </span>dynamically<span class="w w0"> </span>translate<span class="w w1"> </span>a<span class="w w1"> </span>pro-</div><div class="l f2 s4 t0" style="bottom:381.326px;left:54px;" data-x="54" data-y="383.263" hs="1">gram<span class="w w0"> </span>to<span class="w w1"> </span>nested,<span class="w w0"> </span>type-specialized<span class="w w1"> </span>trace<span class="w w0"> </span>trees.<span class="w w0"> </span>Because<span class="w w1"> </span>traces<span class="w w0"> </span>can</div><div class="l f2 s4 t0" style="bottom:371.363px;left:54px;" data-x="54" data-y="373.3" hs="1">cross<span class="w w1"> </span>function<span class="w w1"> </span>call<span class="w w2"> </span>boundaries,<span class="w w1"> </span>our<span class="w w1"> </span>techniques<span class="w w1"> </span>also<span class="w w1"> </span>achieve<span class="w w1"> </span>the<span class="w w1"> </span>ef-</div><div class="l f2 s4 t0" style="bottom:361.401px;left:54px;" data-x="54" data-y="363.338" hs="1">fects<span class="w w2"> </span>of<span class="w w1"> </span>inlining.<span class="w w2"> </span>Because<span class="w w2"> </span>traces<span class="w w1"> </span>have<span class="w w2"> </span>no<span class="w w2"> </span>internal<span class="w w1"> </span>control-flow<span class="w w2"> </span>joins,</div><div class="l f2 s4 t0" style="bottom:351.438px;left:54px;" data-x="54" data-y="353.375" hs="1">they<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w1"> </span>optimized<span class="w w1"> </span>in<span class="w w0"> </span>linear<span class="w w1"> </span>time<span class="w w0"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>simple<span class="w w0"> </span>compiler<span class="w w1"> </span>(10).</div><div class="l f2 s4 t0" style="bottom:341.475px;left:54px;" data-x="54" data-y="343.412" hs="1">Thus,<span class="w w1"> </span>our<span class="w w0"> </span>tracing<span class="w w1"> </span>VM<span class="w w0"> </span>efficiently<span class="w w1"> </span>performs<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w1"> </span>kind<span class="w w1"> </span>of<span class="w w0"> </span>op-</div><div class="l f2 s4 t0" style="bottom:331.513px;left:54px;" data-x="54" data-y="333.45" hs="1">timizations<span class="w w1"> </span>that<span class="w w1"> </span>would<span class="w w1"> </span>require<span class="w w0"> </span>interprocedural<span class="w w1"> </span>analysis<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>static</div><div class="l f2 s4 t0" style="bottom:321.55px;left:54px;" data-x="54" data-y="323.487" hs="1">optimization<span class="w w2"> </span>setting.<span class="w w1"> </span>This<span class="w w1"> </span>makes<span class="w w1"> </span>tracing<span class="w w2"> </span>an<span class="w w1"> </span>attractive<span class="w w2"> </span>and<span class="w w1"> </span>effective</div><div class="l f2 s4 t0" style="bottom:311.588px;left:54px;" data-x="54" data-y="313.524" hs="1">tool<span class="w w2"> </span>to<span class="w w1"> </span>type<span class="w w1"> </span>specialize<span class="w w2"> </span>even<span class="w w1"> </span>complex<span class="w w2"> </span>function<span class="w w1"> </span>call-rich<span class="w w2"> </span>code.</div><div class="l f2 s4 t0" style="bottom:301.625px;left:65.9552px;" data-x="65.9552" data-y="303.562" hs="1">We<span class="w w2"> </span>implemented<span class="w w2"> </span>these<span class="w w1"> </span>techniques<span class="w w1"> </span>for<span class="w w2"> </span>an<span class="w w1"> </span>existing<span class="w w2"> </span>JavaScript<span class="w w1"> </span>in-</div><div class="l f2 s4 t0" style="bottom:291.662px;left:54px;" data-x="54" data-y="293.599" hs="1">terpreter,<span class="w w1"> </span>SpiderMonkey</div><div class="l f2 s4 t0" style="bottom:291.662px;left:141.548px;" data-x="141.548" data-y="293.599" hs="1">.<span class="w w1"> </span>We<span class="w w2"> </span>call<span class="w w1"> </span>the<span class="w w1"> </span>resulting<span class="w w1"> </span>tracing<span class="w w0"> </span>VM</div><div class="l fa s4 t0" style="bottom:291.868px;left:269.827px;" data-x="269.827" data-y="293.599" hs="1">Trace-</div><div class="l fa s4 t0" style="bottom:281.906px;left:54px;" data-x="54" data-y="283.636" hs="1">Monkey</div><div class="l f2 s4 t0" style="bottom:281.7px;left:82.0198px;" data-x="82.0198" data-y="283.636" hs="1">.<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>supports<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>JavaScript<span class="w w1"> </span>features<span class="w w2"> </span>of<span class="w w1"> </span>Spi-</div><div class="l f2 s4 t0" style="bottom:271.737px;left:54px;" data-x="54" data-y="273.674" hs="1">derMonkey,<span class="w w2"> </span>with<span class="w w2"> </span>a<span class="w w1"> </span>2x-20x<span class="w w1"> </span>speedup<span class="w w2"> </span>for<span class="w w1"> </span>traceable<span class="w w1"> </span>programs.</div><div class="l f2 s4 t0" style="bottom:261.774px;left:65.9552px;" data-x="65.9552" data-y="263.711" hs="1">This<span class="w w2"> </span>paper<span class="w w1"> </span>makes<span class="w w1"> </span>the<span class="w w2"> </span>following<span class="w w1"> </span>contributions:</div><div class="l f3 s3 t0" style="bottom:244.134px;left:59.2303px;" data-x="59.2303" data-y="245.68" hs="1">•</div><div class="l f2 s4 t0" style="bottom:242.845px;left:66.9514px;" data-x="66.9514" data-y="244.782" hs="1">We<span class="w w2"> </span>explain<span class="w w2"> </span>an<span class="w w1"> </span>algorithm<span class="w w1"> </span>for<span class="w w2"> </span>dynamically<span class="w w1"> </span>forming<span class="w w2"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:232.883px;left:66.9514px;" data-x="66.9514" data-y="234.82" hs="1">cover<span class="w w2"> </span>a<span class="w w2"> </span>program,<span class="w w1"> </span>representing<span class="w w2"> </span>nested<span class="w w2"> </span>loops<span class="w w2"> </span>as<span class="w w1"> </span>nested<span class="w w2"> </span>trace<span class="w w2"> </span>trees.</div><div class="l f3 s3 t0" style="bottom:220.224px;left:59.2303px;" data-x="59.2303" data-y="221.77" hs="1">•</div><div class="l f2 s4 t0" style="bottom:218.935px;left:66.9514px;" data-x="66.9514" data-y="220.872" hs="1">Weexplain<span class="w w1"> </span>how<span class="w w2"> </span>to<span class="w w2"> </span>speculatively<span class="w w2"> </span>generate<span class="w w2"> </span>efficient<span class="w w2"> </span>type-specialized</div><div class="l f2 s4 t0" style="bottom:208.972px;left:66.9514px;" data-x="66.9514" data-y="210.909" hs="1">code<span class="w w2"> </span>for<span class="w w1"> </span>traces<span class="w w1"> </span>from<span class="w w2"> </span>dynamic<span class="w w1"> </span>language<span class="w w1"> </span>programs.</div><div class="l f3 s3 t0" style="bottom:196.314px;left:59.2303px;" data-x="59.2303" data-y="197.86" hs="1">•</div><div class="l f2 s4 t0" style="bottom:195.025px;left:66.9514px;" data-x="66.9514" data-y="196.962" hs="1">We<span class="w w2"> </span>validate<span class="w w1"> </span>our<span class="w w2"> </span>tracing<span class="w w1"> </span>techniques<span class="w w1"> </span>in<span class="w w2"> </span>an<span class="w w1"> </span>implementation<span class="w w1"> </span>based</div><div class="l f2 s4 t0" style="bottom:185.062px;left:66.9514px;" data-x="66.9514" data-y="186.999" hs="1">on<span class="w w1"> </span>the<span class="w w1"> </span>SpiderMonkey<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter,<span class="w w2"> </span>achieving<span class="w w1"> </span>2x-20x</div><div class="l f2 s4 t0" style="bottom:175.099px;left:66.9514px;" data-x="66.9514" data-y="177.036" hs="1">speedups<span class="w w2"> </span>on<span class="w w1"> </span>many<span class="w w1"> </span>programs.</div><div class="l f2 s4 t0" style="bottom:156.17px;left:65.9551px;" data-x="65.9551" data-y="158.107" hs="1">The<span class="w w2"> </span>remainder<span class="w w1"> </span>of<span class="w w2"> </span>this<span class="w w2"> </span>paper<span class="w w1"> </span>is<span class="w w2"> </span>organized<span class="w w1"> </span>as<span class="w w2"> </span>follows.<span class="w w2"> </span>Section<span class="w w1"> </span>3<span class="w w2"> </span>is</div><div class="l f2 s4 t0" style="bottom:146.208px;left:54px;" data-x="54" data-y="148.145" hs="1">a<span class="w w1"> </span>general<span class="w w1"> </span>overview<span class="w w2"> </span>of<span class="w w1"> </span>trace<span class="w w1"> </span>tree<span class="w w1"> </span>based<span class="w w1"> </span>compilation<span class="w w1"> </span>we<span class="w w1"> </span>use<span class="w w1"> </span>to<span class="w w1"> </span>cap-</div><div class="l f2 s4 t0" style="bottom:136.245px;left:54px;" data-x="54" data-y="138.182" hs="1">ture<span class="w w1"> </span>and<span class="w w0"> </span>compile<span class="w w1"> </span>frequently<span class="w w1"> </span>executed<span class="w w0"> </span>code<span class="w w1"> </span>regions.<span class="w w1"> </span>In<span class="w w0"> </span>Section<span class="w w1"> </span>4</div><div class="l f2 s4 t0" style="bottom:126.283px;left:54px;" data-x="54" data-y="128.219" hs="1">we<span class="w w1"> </span>describe<span class="w w1"> </span>our<span class="w w1"> </span>approach<span class="w w0"> </span>of<span class="w w1"> </span>covering<span class="w w1"> </span>nested<span class="w w1"> </span>loops<span class="w w1"> </span>using<span class="w w1"> </span>a<span class="w w0"> </span>num-</div><div class="l f2 s4 t0" style="bottom:116.32px;left:54px;" data-x="54" data-y="118.257" hs="1">ber<span class="w w1"> </span>of<span class="w w0"> </span>individual<span class="w w2"> </span>trace<span class="w w0"> </span>trees.<span class="w w1"> </span>In<span class="w w1"> </span>Section<span class="w w0"> </span>5<span class="w w1"> </span>we<span class="w w1"> </span>describe<span class="w w0"> </span>our<span class="w w1"> </span>trace-</div><div class="l f2 s4 t0" style="bottom:106.357px;left:54px;" data-x="54" data-y="108.294" hs="1">compilation<span class="w w2"> </span>based<span class="w w1"> </span>speculative<span class="w w2"> </span>type<span class="w w1"> </span>specialization<span class="w w1"> </span>approach<span class="w w2"> </span>we<span class="w w1"> </span>use</div><div class="l f2 s4 t0" style="bottom:96.3947px;left:54px;" data-x="54" data-y="98.3314" hs="1">to<span class="w w1"> </span>generate<span class="w w1"> </span>efficient<span class="w w2"> </span>machine<span class="w w1"> </span>code<span class="w w1"> </span>from<span class="w w1"> </span>recorded<span class="w w1"> </span>bytecode<span class="w w1"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:86.432px;left:54px;" data-x="54" data-y="88.3687" hs="1">Our<span class="w w1"> </span>implementation<span class="w w0"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>dynamic<span class="w w1"> </span>type-specializing<span class="w w0"> </span>compiler<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:76.4694px;left:54px;" data-x="54" data-y="78.4061" hs="1">JavaScript<span class="w w1"> </span>is<span class="w w1"> </span>described<span class="w w1"> </span>in<span class="w w1"> </span>Section<span class="w w1"> </span>6.<span class="w w1"> </span>Related<span class="w w1"> </span>work<span class="w w1"> </span>is<span class="w w1"> </span>discussed<span class="w w1"> </span>in</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:54px;" data-x="54" data-y="68.4434" hs="1">Section<span class="w w2"> </span>8.<span class="w w1"> </span>In<span class="w w2"> </span>Section<span class="w w1"> </span>7<span class="w w2"> </span>we<span class="w w1"> </span>evaluate<span class="w w2"> </span>our<span class="w w2"> </span>dynamic<span class="w w1"> </span>compiler<span class="w w2"> </span>based<span class="w w1"> </span>on</div><div class="l f7 s4 t0" style="bottom:711.783px;left:317.014px;" data-x="317.014" data-y="713.773" hs="1">1<span class="w w0"> </span>for<span class="w w0"> </span>(var<span class="w w0"> </span>i<span class="w w0"> </span>=<span class="w w4"> </span>2;<span class="w w0"> </span>i<span class="w w0"> </span>&lt;<span class="w w0"> </span>100;<span class="w w0"> </span>++i)<span class="w w4"> </span>{</div><div class="l f7 s4 t0" style="bottom:701.82px;left:317.014px;" data-x="317.014" data-y="703.811" hs="1">2<span class="w w5"> </span>if<span class="w w0"> </span>(!primes[i])</div><div class="l f7 s4 t0" style="bottom:691.858px;left:317.014px;" data-x="317.014" data-y="693.848" hs="1">3<span class="w w6"> </span>continue;</div><div class="l f7 s4 t0" style="bottom:681.895px;left:317.014px;" data-x="317.014" data-y="683.886" hs="1">4<span class="w w5"> </span>for<span class="w w0"> </span>(var<span class="w w0"> </span>k<span class="w w0"> </span>=<span class="w w0"> </span>i<span class="w w4"> </span>+<span class="w w0"> </span>i;<span class="w w0"> </span>i<span class="w w0"> </span>&lt;<span class="w w0"> </span>100;<span class="w w4"> </span>k<span class="w w0"> </span>+=<span class="w w0"> </span>i)</div><div class="l f7 s4 t0" style="bottom:671.932px;left:317.014px;" data-x="317.014" data-y="673.923" hs="1">5<span class="w w6"> </span>primes[k]<span class="w w0"> </span>=<span class="w w0"> </span>false;</div><div class="l f7 s4 t0" style="bottom:661.97px;left:317.014px;" data-x="317.014" data-y="663.96" hs="1">6<span class="w w0"> </span>}</div><div class="l f1 s4 t0" style="bottom:639.888px;left:317.014px;" data-x="317.014" data-y="641.762" hs="1">Figure<span class="w w1"> </span>1.<span class="w w0"> </span>Sample<span class="w w0"> </span>program:<span class="w w1"> </span>sieve<span class="w w0"> </span>of<span class="w w1"> </span>Eratosthenes.</div><div class="l f7 s4 t0" style="bottom:639.772px;left:518.232px;" data-x="518.232" data-y="641.762" hs="1">primes</div><div class="l f2 s4 t0" style="bottom:639.826px;left:550.137px;" data-x="550.137" data-y="641.762" hs="1">is</div><div class="l f2 s4 t0" style="bottom:629.863px;left:317.014px;" data-x="317.014" data-y="631.8" hs="1">initialized<span class="w w1"> </span>to<span class="w w1"> </span>an<span class="w w0"> </span>array<span class="w w1"> </span>of<span class="w w1"> </span>100</div><div class="l f7 s4 t0" style="bottom:629.809px;left:426.649px;" data-x="426.649" data-y="631.8" hs="1">false</div><div class="l f2 s4 t0" style="bottom:629.863px;left:453.351px;" data-x="453.351" data-y="631.8" hs="1">values<span class="w w1"> </span>on<span class="w w1"> </span>entry<span class="w w0"> </span>to<span class="w w1"> </span>this<span class="w w1"> </span>code</div><div class="l f2 s4 t0" style="bottom:619.9px;left:317.014px;" data-x="317.014" data-y="621.837" hs="1">snippet.</div></div><div class="t t1"><div class="l fd s7 t2" style="bottom:-3.23px;left:-24.3369px;" data-x="405.402" data-y="575.895" hs="1">Interpret</div><div class="l fe s7 t2" style="bottom:-3.23px;left:24.3369px;" data-x="426.372" data-y="575.895" hs="1"> </div><div class="l fe s7 t2" style="bottom:10.77px;left:-28.0166px;" data-x="403.817" data-y="569.864" hs="1">Bytecodes</div></div><div class="t t3"><div class="l fd s7 t2" style="bottom:3.77px;left:-21.9932px;" data-x="406.412" data-y="529.797" hs="1">Monitor</div><div class="l fe s7 t2" style="bottom:3.77px;left:21.9932px;" data-x="425.362" data-y="529.797" hs="1"> </div></div><div class="t t4"><div class="l fd s7 t2" style="bottom:-3.23px;left:-20.6719px;" data-x="337.619" data-y="513.426" hs="1">Record</div><div class="l fe s7 t2" style="bottom:10.77px;left:-26.0156px;" data-x="335.317" data-y="507.395" hs="1">LIR </div><div class="l fe s7 t2" style="bottom:10.77px;left:-4.21875px;" data-x="344.707" data-y="507.395" hs="1">T</div><div class="l fe s7 t2" style="bottom:10.77px;left:2.67187px;" data-x="347.676" data-y="507.395" hs="1">race</div></div><div class="t t5"><div class="l fd s7 t2" style="bottom:-3.23px;left:-23.0127px;" data-x="473.396" data-y="473.791" hs="1">Execute</div><div class="l fe s7 t2" style="bottom:-3.23px;left:23.0127px;" data-x="493.225" data-y="473.791" hs="1"> </div><div class="l fe s7 t2" style="bottom:10.77px;left:-42.0234px;" data-x="465.206" data-y="467.759" hs="1">Compiled </div><div class="l fe s7 t2" style="bottom:10.77px;left:11.7891px;" data-x="488.389" data-y="467.759" hs="1">T</div><div class="l fe s7 t2" style="bottom:10.77px;left:18.6797px;" data-x="491.358" data-y="467.759" hs="1">race</div></div><div class="t t6"><div class="l fd s7 t2" style="bottom:-3.23px;left:-15.3369px;" data-x="476.703" data-y="513.426" hs="1">Enter</div><div class="l fe s7 t2" style="bottom:-3.23px;left:15.3369px;" data-x="489.918" data-y="513.426" hs="1"> </div><div class="l fe s7 t2" style="bottom:10.77px;left:-42.0234px;" data-x="465.206" data-y="507.395" hs="1">Compiled </div><div class="l fe s7 t2" style="bottom:10.77px;left:11.7891px;" data-x="488.389" data-y="507.395" hs="1">T</div><div class="l fe s7 t2" style="bottom:10.77px;left:18.6797px;" data-x="491.358" data-y="507.395" hs="1">race</div></div><div class="t t7"><div class="l fd s7 t2" style="bottom:-3.23px;left:-23.669px;" data-x="336.328" data-y="473.791" hs="1">Compile</div><div class="l fe s7 t2" style="bottom:10.77px;left:-26.0156px;" data-x="335.317" data-y="467.759" hs="1">LIR </div><div class="l fe s7 t2" style="bottom:10.77px;left:-4.21875px;" data-x="344.707" data-y="467.759" hs="1">T</div><div class="l fe s7 t2" style="bottom:10.77px;left:2.67187px;" data-x="347.676" data-y="467.759" hs="1">race</div></div><div class="t t8"><div class="l fd s7 t2" style="bottom:-3.23px;left:-17.0127px;" data-x="475.981" data-y="434.155" hs="1">Leave</div><div class="l fe s7 t2" style="bottom:-3.23px;left:17.0127px;" data-x="490.64" data-y="434.155" hs="1"> </div><div class="l fe s7 t2" style="bottom:10.77px;left:-42.0234px;" data-x="465.206" data-y="428.124" hs="1">Compiled </div><div class="l fe s7 t2" style="bottom:10.77px;left:11.7891px;" data-x="488.389" data-y="428.124" hs="1">T</div><div class="l fe s7 t2" style="bottom:10.77px;left:18.6797px;" data-x="491.358" data-y="428.124" hs="1">race</div></div><div class="t t9"><div class="l fe s7 t2" style="bottom:-3.23px;left:-11.3438px;" data-x="402.383" data-y="556.077" hs="1">loop </div><div class="l fe s7 t2" style="bottom:10.77px;left:-13.3477px;" data-x="401.52" data-y="550.046" hs="1">edge</div></div><div class="t ta"><div class="l fe s7 t2" style="bottom:-3.23px;left:-8.34082px;" data-x="383.859" data-y="516.442" hs="1">hot</div><div class="l fe s7 t2" style="bottom:10.77px;left:-22.3477px;" data-x="377.825" data-y="510.411" hs="1">loop/exit</div></div><div class="t tb"><div class="l fe s7 t2" style="bottom:-3.23px;left:-13.6758px;" data-x="335.248" data-y="531.952" hs="1">abort </div><div class="l fe s7 t2" style="bottom:10.77px;left:-25.0137px;" data-x="330.363" data-y="525.92" hs="1">recording</div></div><div class="t tc"><div class="l fe s7 t2" style="bottom:-3.23px;left:-20.6777px;" data-x="353.557" data-y="497.055" hs="1">fi</div><div class="l fe s7 t2" style="bottom:-3.23px;left:-14.6777px;" data-x="356.142" data-y="497.055" hs="1">nish at </div><div class="l fe s7 t2" style="bottom:10.77px;left:-31.6934px;" data-x="348.811" data-y="491.024" hs="1">loop header</div></div><div class="t td"><div class="l fe s7 t2" style="bottom:-3.23px;left:-40.6875px;" data-x="441.44" data-y="550.908" hs="1">cold/blacklisted</div><div class="l fe s7 t2" style="bottom:10.77px;left:-22.3477px;" data-x="449.341" data-y="544.876" hs="1">loop/exit</div></div><div class="t te"><div class="l fe s7 t2" style="bottom:-3.23px;left:-39.0176px;" data-x="444.313" data-y="529.797" hs="1">compiled trace </div><div class="l fe s7 t2" style="bottom:10.77px;left:-15.0088px;" data-x="454.657" data-y="523.766" hs="1">ready</div></div><div class="t tf"><div class="l fe s7 t2" style="bottom:-3.23px;left:-38.6953px;" data-x="425.065" data-y="492.101" hs="1">loop edge with </div><div class="l fe s7 t2" style="bottom:10.77px;left:-30.6797px;" data-x="428.519" data-y="486.069" hs="1">same types</div></div><div class="t t10"><div class="l fe s7 t2" style="bottom:-3.23px;left:-28.6816px;" data-x="518.559" data-y="444.926" hs="1">side exit to </div><div class="l fe s7 t2" style="bottom:10.77px;left:-35.3496px;" data-x="515.687" data-y="438.894" hs="1">existing trace</div></div><div class="t t11"><div class="l fe s7 t2" style="bottom:-3.23px;left:-23.6777px;" data-x="427.442" data-y="447.08" hs="1">side exit,</div><div class="l fe s7 t2" style="bottom:10.77px;left:-43.6904px;" data-x="418.821" data-y="441.049" hs="1">no existing trace</div></div><div class="t t12"><div class="l fe s7 t2" style="bottom:3.77px;left:-26.3496px;" data-x="507.07" data-y="571.587" hs="1">Overhead</div><div class="l fe s7 t2" style="bottom:3.77px;left:26.3496px;" data-x="529.774" data-y="571.587" hs="1"> </div></div><div class="t t13"><div class="l fe s7 t2" style="bottom:3.77px;left:-30.3516px;" data-x="505.346" data-y="558.662" hs="1">Interpreting</div></div><div class="t t14"><div class="l fe s7 t2" style="bottom:3.77px;left:-17.0068px;" data-x="511.095" data-y="546.169" hs="1">Native</div></div><div class="t t15"><div class="l fd s7 t2" style="bottom:-42.23px;left:-34.3447px;" data-x="504.918" data-y="582.788" hs="1">Symbol Key</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:391.444px;left:317.014px;" data-x="317.014" data-y="393.318" hs="1">Figure<span class="w w1"> </span>2.</div><div class="l f2 s4 t0" style="bottom:391.381px;left:356.264px;" data-x="356.264" data-y="393.318" hs="1">State<span class="w w1"> </span>machine<span class="w w1"> </span>describing<span class="w w1"> </span>the<span class="w w1"> </span>major<span class="w w1"> </span>activities<span class="w w1"> </span>of<span class="w w1"> </span>Trace-</div><div class="l f2 s4 t0" style="bottom:381.419px;left:317.014px;" data-x="317.014" data-y="383.355" hs="1">Monkey<span class="w w1"> </span>and<span class="w w1"> </span>the<span class="w w0"> </span>conditions<span class="w w1"> </span>that<span class="w w1"> </span>cause<span class="w w1"> </span>transitions<span class="w w1"> </span>to<span class="w w0"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>activ-</div><div class="l f2 s4 t0" style="bottom:371.456px;left:317.014px;" data-x="317.014" data-y="373.393" hs="1">ity.<span class="w w1"> </span>In<span class="w w0"> </span>the<span class="w w1"> </span>dark<span class="w w0"> </span>box,<span class="w w1"> </span>TM<span class="w w1"> </span>executes<span class="w w0"> </span>JS<span class="w w1"> </span>as<span class="w w0"> </span>compiled<span class="w w1"> </span>traces.<span class="w w0"> </span>In<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:361.493px;left:317.014px;" data-x="317.014" data-y="363.43" hs="1">light<span class="w w2"> </span>gray<span class="w w1"> </span>boxes,<span class="w w2"> </span>TM<span class="w w1"> </span>executes<span class="w w2"> </span>JS<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>standard<span class="w w1"> </span>interpreter.<span class="w w2"> </span>White</div><div class="l f2 s4 t0" style="bottom:351.531px;left:317.014px;" data-x="317.014" data-y="353.467" hs="1">boxes<span class="w w1"> </span>are<span class="w w1"> </span>overhead.<span class="w w1"> </span>Thus,<span class="w w0"> </span>to<span class="w w1"> </span>maximize<span class="w w1"> </span>performance,<span class="w w1"> </span>we<span class="w w1"> </span>need<span class="w w0"> </span>to</div><div class="l f2 s4 t0" style="bottom:341.568px;left:317.014px;" data-x="317.014" data-y="343.505" hs="1">maximize<span class="w w2"> </span>time<span class="w w1"> </span>spent<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>darkest<span class="w w1"> </span>box<span class="w w2"> </span>and<span class="w w1"> </span>minimize<span class="w w2"> </span>time<span class="w w1"> </span>spent<span class="w w2"> </span>in</div><div class="l f2 s4 t0" style="bottom:331.605px;left:317.014px;" data-x="317.014" data-y="333.542" hs="1">the<span class="w w2"> </span>white<span class="w w1"> </span>boxes.<span class="w w2"> </span>The<span class="w w1"> </span>best<span class="w w1"> </span>case<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>loop<span class="w w1"> </span>where<span class="w w2"> </span>the<span class="w w1"> </span>types<span class="w w1"> </span>at<span class="w w2"> </span>the<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:321.643px;left:317.014px;" data-x="317.014" data-y="323.579" hs="1">edge<span class="w w2"> </span>are<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w2"> </span>types<span class="w w1"> </span>on<span class="w w2"> </span>entry–then<span class="w w1"> </span>TM<span class="w w1"> </span>can<span class="w w2"> </span>stay<span class="w w1"> </span>in<span class="w w2"> </span>native</div><div class="l f2 s4 t0" style="bottom:311.68px;left:317.014px;" data-x="317.014" data-y="313.617" hs="1">code<span class="w w2"> </span>until<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w2"> </span>is<span class="w w1"> </span>done.</div><div class="l f2 s4 t0" style="bottom:283.185px;left:317.014px;" data-x="317.014" data-y="285.121" hs="1">a<span class="w w1"> </span>set<span class="w w1"> </span>of<span class="w w1"> </span>industry<span class="w w1"> </span>benchmarks.<span class="w w1"> </span>The<span class="w w1"> </span>paper<span class="w w1"> </span>ends<span class="w w1"> </span>with<span class="w w1"> </span>conclusions<span class="w w1"> </span>in</div><div class="l f2 s4 t0" style="bottom:273.222px;left:317.014px;" data-x="317.014" data-y="275.159" hs="1">Section<span class="w w2"> </span>9<span class="w w1"> </span>and<span class="w w2"> </span>an<span class="w w1"> </span>outlook<span class="w w2"> </span>on<span class="w w1"> </span>future<span class="w w2"> </span>work<span class="w w1"> </span>is<span class="w w2"> </span>presented<span class="w w1"> </span>in<span class="w w2"> </span>Section<span class="w w1"> </span>10.</div><div class="l f1 s2 t0" style="bottom:249.465px;left:317.014px;" data-x="317.014" data-y="251.756" hs="1">2.<span class="w w3"> </span>Overview:<span class="w w1"> </span>Example<span class="w w1"> </span>T</div><div class="l f1 s2 t0" style="bottom:249.465px;left:438.044px;" data-x="438.044" data-y="251.756" hs="1">racing<span class="w w1"> </span>Run</div><div class="l f2 s4 t0" style="bottom:235.871px;left:317.014px;" data-x="317.014" data-y="237.808" hs="1">This<span class="w w0"> </span>section<span class="w w1"> </span>provides<span class="w w0"> </span>an<span class="w w1"> </span>overview<span class="w w0"> </span>of<span class="w w0"> </span>our<span class="w w1"> </span>system<span class="w w0"> </span>by<span class="w w0"> </span>describing</div><div class="l f2 s4 t0" style="bottom:225.909px;left:317.014px;" data-x="317.014" data-y="227.846" hs="1">how<span class="w w0"> </span>T</div><div class="l f2 s4 t0" style="bottom:225.909px;left:341.393px;" data-x="341.393" data-y="227.846" hs="1">raceMonkey<span class="w w0"> </span>executes<span class="w w1"> </span>an<span class="w w0"> </span>example<span class="w w1"> </span>program.<span class="w w0"> </span>The<span class="w w0"> </span>example</div><div class="l f2 s4 t0" style="bottom:215.946px;left:317.014px;" data-x="317.014" data-y="217.883" hs="1">program,<span class="w w2"> </span>shown<span class="w w1"> </span>in<span class="w w2"> </span>Figure<span class="w w1"> </span>1,<span class="w w2"> </span>computes<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w2"> </span>100<span class="w w1"> </span>prime<span class="w w2"> </span>numbers</div><div class="l f2 s4 t0" style="bottom:205.984px;left:317.014px;" data-x="317.014" data-y="207.92" hs="1">with<span class="w w2"> </span>nested<span class="w w2"> </span>loops.<span class="w w1"> </span>The<span class="w w2"> </span>narrative<span class="w w2"> </span>should<span class="w w2"> </span>be<span class="w w2"> </span>read<span class="w w1"> </span>along<span class="w w2"> </span>with<span class="w w2"> </span>Figure<span class="w w1"> </span>2,</div><div class="l f2 s4 t0" style="bottom:196.021px;left:317.014px;" data-x="317.014" data-y="197.958" hs="1">which<span class="w w1"> </span>describes<span class="w w1"> </span>the<span class="w w1"> </span>activities<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>performs<span class="w w1"> </span>and<span class="w w1"> </span>when<span class="w w1"> </span>it</div><div class="l f2 s4 t0" style="bottom:186.058px;left:317.014px;" data-x="317.014" data-y="187.995" hs="1">transitions<span class="w w2"> </span>between<span class="w w1"> </span>the<span class="w w1"> </span>loops.</div><div class="l f2 s4 t0" style="bottom:176.096px;left:328.969px;" data-x="328.969" data-y="178.032" hs="1">TraceMonkey<span class="w w1"> </span>always<span class="w w1"> </span>begins<span class="w w1"> </span>executing<span class="w w1"> </span>a<span class="w w1"> </span>program<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w0"> </span>byte-</div><div class="l f2 s4 t0" style="bottom:166.133px;left:317.014px;" data-x="317.014" data-y="168.07" hs="1">code<span class="w w1"> </span>interpreter.<span class="w w1"> </span>Every<span class="w w1"> </span>loop<span class="w w0"> </span>back<span class="w w1"> </span>edge<span class="w w1"> </span>is<span class="w w0"> </span>a<span class="w w1"> </span>potential<span class="w w1"> </span>trace<span class="w w0"> </span>point.</div><div class="l f2 s4 t0" style="bottom:156.17px;left:317.014px;" data-x="317.014" data-y="158.107" hs="1">When<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>crosses<span class="w w1"> </span>a<span class="w w0"> </span>loop<span class="w w1"> </span>edge,<span class="w w0"> </span>TraceMonkey<span class="w w1"> </span>invokes</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.144" hs="1">the</div><div class="l fa s4 t0" style="bottom:146.414px;left:330.558px;" data-x="330.558" data-y="148.144" hs="1">trace<span class="w w1"> </span>monitor</div><div class="l f2 s4 t0" style="bottom:146.208px;left:379.834px;" data-x="379.834" data-y="148.144" hs="1">,<span class="w w1"> </span>which<span class="w w1"> </span>may<span class="w w2"> </span>decide<span class="w w1"> </span>to<span class="w w1"> </span>record<span class="w w1"> </span>or<span class="w w1"> </span>execute<span class="w w1"> </span>a<span class="w w1"> </span>native</div><div class="l f2 s4 t0" style="bottom:136.245px;left:317.014px;" data-x="317.014" data-y="138.182" hs="1">trace.<span class="w w2"> </span>At<span class="w w1"> </span>the<span class="w w1"> </span>start<span class="w w2"> </span>of<span class="w w1"> </span>execution,<span class="w w2"> </span>there<span class="w w1"> </span>are<span class="w w2"> </span>no<span class="w w1"> </span>compiled<span class="w w1"> </span>traces<span class="w w2"> </span>yet,<span class="w w1"> </span>so</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">the<span class="w w2"> </span>trace<span class="w w2"> </span>monitor<span class="w w1"> </span>counts<span class="w w2"> </span>the<span class="w w2"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>times<span class="w w2"> </span>each<span class="w w2"> </span>loop<span class="w w1"> </span>back<span class="w w2"> </span>edge<span class="w w2"> </span>is</div><div class="l f2 s4 t0" style="bottom:116.32px;left:317.014px;" data-x="317.014" data-y="118.256" hs="1">executed<span class="w w2"> </span>until<span class="w w2"> </span>a<span class="w w1"> </span>loop<span class="w w2"> </span>becomes</div><div class="l fa s4 t0" style="bottom:116.526px;left:426.223px;" data-x="426.223" data-y="118.256" hs="1">hot</div><div class="l f2 s4 t0" style="bottom:116.32px;left:437.682px;" data-x="437.682" data-y="118.256" hs="1">,<span class="w w2"> </span>currently<span class="w w1"> </span>after<span class="w w2"> </span>2<span class="w w1"> </span>crossings.<span class="w w2"> </span>Note</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">that<span class="w w2"> </span>the<span class="w w2"> </span>way<span class="w w1"> </span>our<span class="w w2"> </span>loops<span class="w w2"> </span>are<span class="w w1"> </span>compiled,<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>edge<span class="w w2"> </span>is<span class="w w1"> </span>crossed<span class="w w2"> </span>before</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:317.014px;" data-x="317.014" data-y="98.3312" hs="1">entering<span class="w w1"> </span>the<span class="w w2"> </span>loop,<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w1"> </span>second<span class="w w1"> </span>crossing<span class="w w2"> </span>occurs<span class="w w1"> </span>immediately<span class="w w1"> </span>after</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">the<span class="w w2"> </span>first<span class="w w1"> </span>iteration.</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:328.969px;" data-x="328.969" data-y="78.406" hs="1">Here<span class="w w0"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>sequence<span class="w w0"> </span>of<span class="w w0"> </span>events<span class="w w0"> </span>broken<span class="w w0"> </span>down<span class="w w1"> </span>by<span class="w w0"> </span>outer<span class="w w0"> </span>loop</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">iteration:</div></div></div><div id="page-3" class="p" style="width:612px;height:792px;background-image:url(p3.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f7 s4 t0" style="bottom:711.783px;left:54px;" data-x="54" data-y="713.773" hs="1">v0<span class="w w0"> </span>:=<span class="w w0"> </span>ld<span class="w w0"> </span>state[748]<span class="w w6"> </span>//<span class="w w0"> </span>load<span class="w w4"> </span>primes<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w0"> </span>trace<span class="w w0"> </span>activation<span class="w w4"> </span>record</div><div class="l f7 s4 t0" style="bottom:701.82px;left:82.2438px;" data-x="82.2438" data-y="703.811" hs="1">st<span class="w w0"> </span>sp[0],<span class="w w0"> </span>v0<span class="w w7"> </span>//<span class="w w0"> </span>store<span class="w w0"> </span>primes<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w4"> </span>stack</div><div class="l f7 s4 t0" style="bottom:691.858px;left:54px;" data-x="54" data-y="693.848" hs="1">v1<span class="w w0"> </span>:=<span class="w w0"> </span>ld<span class="w w0"> </span>state[764]<span class="w w6"> </span>//<span class="w w0"> </span>load<span class="w w4"> </span>k<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w0"> </span>trace<span class="w w0"> </span>activation<span class="w w4"> </span>record</div><div class="l f7 s4 t0" style="bottom:681.895px;left:54px;" data-x="54" data-y="683.885" hs="1">v2<span class="w w0"> </span>:=<span class="w w0"> </span>i2f(v1)<span class="w w8"> </span>//<span class="w w0"> </span>convert<span class="w w0"> </span>k<span class="w w0"> </span>from<span class="w w0"> </span>int<span class="w w4"> </span>to<span class="w w0"> </span>double</div><div class="l f7 s4 t0" style="bottom:671.932px;left:82.2438px;" data-x="82.2438" data-y="673.923" hs="1">st<span class="w w0"> </span>sp[8],<span class="w w0"> </span>v1<span class="w w7"> </span>//<span class="w w0"> </span>store<span class="w w0"> </span>k<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w4"> </span>stack</div><div class="l f7 s4 t0" style="bottom:661.97px;left:82.2438px;" data-x="82.2438" data-y="663.96" hs="1">st<span class="w w0"> </span>sp[16],<span class="w w0"> </span>0<span class="w w7"> </span>//<span class="w w0"> </span>store<span class="w w0"> </span>false<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w4"> </span>stack</div><div class="l f7 s4 t0" style="bottom:652.007px;left:54px;" data-x="54" data-y="653.998" hs="1">v3<span class="w w0"> </span>:=<span class="w w0"> </span>ld<span class="w w0"> </span>v0[4]<span class="w w9"> </span>//<span class="w w0"> </span>load<span class="w w0"> </span>class<span class="w w0"> </span>word<span class="w w0"> </span>for<span class="w w4"> </span>primes</div><div class="l f7 s4 t0" style="bottom:642.044px;left:54px;" data-x="54" data-y="644.035" hs="1">v4<span class="w w0"> </span>:=<span class="w w0"> </span>and<span class="w w0"> </span>v3,<span class="w w0"> </span>-4<span class="w wa"> </span>//<span class="w w0"> </span>mask<span class="w w0"> </span>out<span class="w w0"> </span>object<span class="w w0"> </span>class<span class="w w4"> </span>tag<span class="w w0"> </span>for<span class="w w0"> </span>primes</div><div class="l f7 s4 t0" style="bottom:632.082px;left:54px;" data-x="54" data-y="634.072" hs="1">v5<span class="w w0"> </span>:=<span class="w w0"> </span>eq<span class="w w0"> </span>v4,<span class="w w0"> </span>Array<span class="w w7"> </span>//<span class="w w0"> </span>test<span class="w w0"> </span>whether<span class="w w4"> </span>primes<span class="w w0"> </span>is<span class="w w0"> </span>an<span class="w w0"> </span>array</div><div class="l f7 s4 t0" style="bottom:622.119px;left:82.2438px;" data-x="82.2438" data-y="624.11" hs="1">xf<span class="w w0"> </span>v5<span class="w wb"> </span>//<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>v5<span class="w w4"> </span>is<span class="w w0"> </span>false</div><div class="l f7 s4 t0" style="bottom:612.156px;left:54px;" data-x="54" data-y="614.147" hs="1">v6<span class="w w0"> </span>:=<span class="w w0"> </span>js_Array_set(v0,<span class="w w0"> </span>v2,<span class="w w0"> </span>false)<span class="w w3"> </span>//<span class="w w0"> </span>call<span class="w w0"> </span>function<span class="w w0"> </span>to<span class="w w0"> </span>set<span class="w w0"> </span>array<span class="w w0"> </span>element</div><div class="l f7 s4 t0" style="bottom:602.194px;left:54px;" data-x="54" data-y="604.184" hs="1">v7<span class="w w0"> </span>:=<span class="w w0"> </span>eq<span class="w w0"> </span>v6,<span class="w w0"> </span>0<span class="w w9"> </span>//<span class="w w0"> </span>test<span class="w w0"> </span>return<span class="w w0"> </span>value<span class="w w4"> </span>from<span class="w w0"> </span>call</div><div class="l f7 s4 t0" style="bottom:592.231px;left:82.2438px;" data-x="82.2438" data-y="594.222" hs="1">xt<span class="w w0"> </span>v7<span class="w wb"> </span>//<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>js_Array_set<span class="w w4"> </span>returns<span class="w w0"> </span>false.</div><div class="l f1 s4 t0" style="bottom:568.905px;left:54px;" data-x="54" data-y="570.779" hs="1">Figure<span class="w w1"> </span>3.<span class="w w0"> </span>LIR<span class="w w1"> </span>snippet<span class="w w0"> </span>for<span class="w w2"> </span>sample<span class="w w0"> </span>program.</div><div class="l f2 s4 t0" style="bottom:568.842px;left:227.171px;" data-x="227.171" data-y="570.779" hs="1">This<span class="w w1"> </span>is<span class="w w1"> </span>the<span class="w w0"> </span>LIR<span class="w w1"> </span>recorded<span class="w w1"> </span>for<span class="w w1"> </span>line<span class="w w0"> </span>5<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>sample<span class="w w1"> </span>program<span class="w w0"> </span>in<span class="w w1"> </span>Figure<span class="w w1"> </span>1.<span class="w w1"> </span>The<span class="w w0"> </span>LIR<span class="w w1"> </span>encodes</div><div class="l f2 s4 t0" style="bottom:558.879px;left:54px;" data-x="54" data-y="560.816" hs="1">the<span class="w w1"> </span>semantics<span class="w w1"> </span>in<span class="w w1"> </span>SSA<span class="w w1"> </span>form<span class="w w0"> </span>using<span class="w w2"> </span>temporary<span class="w w0"> </span>variables.<span class="w w2"> </span>The<span class="w w1"> </span>LIR<span class="w w0"> </span>also<span class="w w2"> </span>encodes<span class="w w0"> </span>all<span class="w w2"> </span>the<span class="w w0"> </span>stores<span class="w w2"> </span>that<span class="w w0"> </span>the<span class="w w2"> </span>interpreter<span class="w w0"> </span>would<span class="w w2"> </span>do<span class="w w1"> </span>to<span class="w w0"> </span>its<span class="w w2"> </span>data<span class="w w0"> </span>stack.</div><div class="l f2 s4 t0" style="bottom:548.917px;left:54px;" data-x="54" data-y="550.853" hs="1">Sometimes<span class="w w2"> </span>these<span class="w w1"> </span>stores<span class="w w1"> </span>can<span class="w w2"> </span>be<span class="w w1"> </span>optimized<span class="w w1"> </span>away<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w1"> </span>stack<span class="w w2"> </span>locations<span class="w w1"> </span>are<span class="w w1"> </span>live<span class="w w2"> </span>only<span class="w w1"> </span>on<span class="w w2"> </span>exits<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.<span class="w w1"> </span>Finally,<span class="w w2"> </span>the<span class="w w2"> </span>LIR<span class="w w1"> </span>records<span class="w w1"> </span>guards</div><div class="l f2 s4 t0" style="bottom:538.954px;left:54px;" data-x="54" data-y="540.891" hs="1">and<span class="w w2"> </span>side<span class="w w1"> </span>exits<span class="w w1"> </span>to<span class="w w2"> </span>verify<span class="w w1"> </span>the<span class="w w2"> </span>assumptions<span class="w w1"> </span>made<span class="w w1"> </span>in<span class="w w2"> </span>this<span class="w w1"> </span>recording:<span class="w w1"> </span>that</div><div class="l f7 s4 t0" style="bottom:538.9px;left:298.295px;" data-x="298.295" data-y="540.891" hs="1">primes</div><div class="l f2 s4 t0" style="bottom:538.954px;left:328.78px;" data-x="328.78" data-y="540.891" hs="1">is<span class="w w2"> </span>an<span class="w w1"> </span>array<span class="w w1"> </span>and<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>to<span class="w w1"> </span>set<span class="w w2"> </span>its<span class="w w1"> </span>element<span class="w w1"> </span>succeeds.</div><div class="l f7 s4 t0" style="bottom:512.748px;left:54px;" data-x="54" data-y="514.739" hs="1">mov<span class="w w0"> </span>edx,<span class="w w0"> </span>ebx(748)<span class="w w7"> </span>//<span class="w w0"> </span>load<span class="w w0"> </span>primes<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w4"> </span>trace<span class="w w0"> </span>activation<span class="w w0"> </span>record</div><div class="l f7 s4 t0" style="bottom:502.786px;left:54px;" data-x="54" data-y="504.776" hs="1">mov<span class="w w0"> </span>edi(0),<span class="w w0"> </span>edx<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>store<span class="w w0"> </span>primes<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w0"> </span>stack</div><div class="l f7 s4 t0" style="bottom:492.823px;left:54px;" data-x="54" data-y="494.814" hs="1">mov<span class="w w0"> </span>esi,<span class="w w0"> </span>ebx(764)<span class="w w7"> </span>//<span class="w w0"> </span>load<span class="w w0"> </span>k<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w4"> </span>trace<span class="w w0"> </span>activation<span class="w w0"> </span>record</div><div class="l f7 s4 t0" style="bottom:482.86px;left:54px;" data-x="54" data-y="484.851" hs="1">mov<span class="w w0"> </span>edi(8),<span class="w w0"> </span>esi<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>store<span class="w w0"> </span>k<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w0"> </span>stack</div><div class="l f7 s4 t0" style="bottom:472.898px;left:54px;" data-x="54" data-y="474.888" hs="1">mov<span class="w w0"> </span>edi(16),<span class="w w0"> </span>0<span class="w wc"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>store<span class="w w0"> </span>false<span class="w w0"> </span>to<span class="w w4"> </span>interpreter<span class="w w0"> </span>stack</div><div class="l f7 s4 t0" style="bottom:462.935px;left:54px;" data-x="54" data-y="464.926" hs="1">mov<span class="w w0"> </span>eax,<span class="w w0"> </span>edx(4)<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>load<span class="w w0"> </span>object<span class="w w0"> </span>class<span class="w w0"> </span>word<span class="w w0"> </span>for<span class="w w4"> </span>primes</div><div class="l f7 s4 t0" style="bottom:452.972px;left:54px;" data-x="54" data-y="454.963" hs="1">and<span class="w w0"> </span>eax,<span class="w w0"> </span>-4<span class="w wd"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>mask<span class="w w0"> </span>out<span class="w w0"> </span>object<span class="w w4"> </span>class<span class="w w0"> </span>tag<span class="w w0"> </span>for<span class="w w0"> </span>primes</div><div class="l f7 s4 t0" style="bottom:443.01px;left:54px;" data-x="54" data-y="445" hs="1">cmp<span class="w w0"> </span>eax,<span class="w w0"> </span>Array<span class="w wc"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>test<span class="w w0"> </span>whether<span class="w w0"> </span>primes<span class="w w4"> </span>is<span class="w w0"> </span>an<span class="w w0"> </span>array</div><div class="l f7 s4 t0" style="bottom:433.047px;left:54px;" data-x="54" data-y="435.038" hs="1">jne<span class="w w0"> </span>side_exit_1<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>primes<span class="w w0"> </span>is<span class="w w0"> </span>not<span class="w w4"> </span>an<span class="w w0"> </span>array</div><div class="l f7 s4 t0" style="bottom:423.084px;left:54px;" data-x="54" data-y="425.075" hs="1">sub<span class="w w0"> </span>esp,<span class="w w0"> </span>8<span class="w wb"> </span>//<span class="w w0"> </span>bump<span class="w w0"> </span>stack<span class="w w0"> </span>for<span class="w w4"> </span>call<span class="w w0"> </span>alignment<span class="w w0"> </span>convention</div><div class="l f7 s4 t0" style="bottom:413.122px;left:54px;" data-x="54" data-y="415.112" hs="1">push<span class="w w0"> </span>false<span class="w wb"> </span>//<span class="w w0"> </span>push<span class="w w0"> </span>last<span class="w w0"> </span>argument<span class="w w0"> </span>for<span class="w w4"> </span>call</div><div class="l f7 s4 t0" style="bottom:403.159px;left:54px;" data-x="54" data-y="405.15" hs="1">push<span class="w w0"> </span>esi<span class="w we"> </span>//<span class="w w0"> </span>push<span class="w w0"> </span>first<span class="w w0"> </span>argument<span class="w w0"> </span>for<span class="w w4"> </span>call</div><div class="l f7 s4 t0" style="bottom:393.197px;left:54px;" data-x="54" data-y="395.187" hs="1">call<span class="w w0"> </span>js_Array_set<span class="w w7"> </span>//<span class="w w0"> </span>call<span class="w w0"> </span>function<span class="w w0"> </span>to<span class="w w0"> </span>set<span class="w w0"> </span>array<span class="w w4"> </span>element</div><div class="l f7 s4 t0" style="bottom:383.234px;left:54px;" data-x="54" data-y="385.224" hs="1">add<span class="w w0"> </span>esp,<span class="w w0"> </span>8<span class="w wb"> </span>//<span class="w w0"> </span>clean<span class="w w0"> </span>up<span class="w w0"> </span>extra<span class="w w4"> </span>stack<span class="w w0"> </span>space</div><div class="l f7 s4 t0" style="bottom:373.271px;left:54px;" data-x="54" data-y="375.262" hs="1">mov<span class="w w0"> </span>ecx,<span class="w w0"> </span>ebx<span class="w w8"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>created<span class="w w0"> </span>by<span class="w w0"> </span>register<span class="w w4"> </span>allocator</div><div class="l f7 s4 t0" style="bottom:363.309px;left:54px;" data-x="54" data-y="365.299" hs="1">test<span class="w w0"> </span>eax,<span class="w w0"> </span>eax<span class="w w9"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>test<span class="w w0"> </span>return<span class="w w0"> </span>value<span class="w w0"> </span>of<span class="w w4"> </span>js_Array_set</div><div class="l f7 s4 t0" style="bottom:353.346px;left:54px;" data-x="54" data-y="355.337" hs="1">je<span class="w w0"> </span>side_exit_2<span class="w wc"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>call<span class="w w4"> </span>failed</div><div class="l f7 s4 t0" style="bottom:343.383px;left:54px;" data-x="54" data-y="345.374" hs="1">...</div><div class="l f7 s4 t0" style="bottom:333.421px;left:54px;" data-x="54" data-y="335.411" hs="1">side_exit_1:</div><div class="l f7 s4 t0" style="bottom:323.458px;left:54px;" data-x="54" data-y="325.449" hs="1">mov<span class="w w0"> </span>ecx,<span class="w w0"> </span>ebp(-4)<span class="w wf"> </span>//<span class="w w0"> </span>restore<span class="w w0"> </span>ecx</div><div class="l f7 s4 t0" style="bottom:313.495px;left:54px;" data-x="54" data-y="315.486" hs="1">mov<span class="w w0"> </span>esp,<span class="w w0"> </span>ebp<span class="w w8"> </span>//<span class="w w0"> </span>restore<span class="w w0"> </span>esp</div><div class="l f7 s4 t0" style="bottom:303.533px;left:54px;" data-x="54" data-y="305.523" hs="1">jmp<span class="w w0"> </span>epilog<span class="w wb"> </span>//<span class="w w0"> </span>jump<span class="w w0"> </span>to<span class="w w0"> </span>ret<span class="w w0"> </span>statement</div><div class="l f1 s4 t0" style="bottom:280.206px;left:54px;" data-x="54" data-y="282.08" hs="1">Figure<span class="w w2"> </span>4.<span class="w w0"> </span>x86<span class="w w1"> </span>snippet<span class="w w2"> </span>for<span class="w w2"> </span>sample<span class="w w1"> </span>program.</div><div class="l f2 s4 t0" style="bottom:280.144px;left:217.914px;" data-x="217.914" data-y="282.08" hs="1">This<span class="w w2"> </span>is<span class="w w1"> </span>the<span class="w w2"> </span>x86<span class="w w1"> </span>code<span class="w w2"> </span>compiled<span class="w w1"> </span>from<span class="w w2"> </span>the<span class="w w2"> </span>LIR<span class="w w1"> </span>snippet<span class="w w2"> </span>in<span class="w w1"> </span>Figure<span class="w w2"> </span>3.<span class="w w1"> </span>Most<span class="w w2"> </span>LIR<span class="w w1"> </span>instructions<span class="w w2"> </span>compile</div><div class="l f2 s4 t0" style="bottom:270.181px;left:54px;" data-x="54" data-y="272.118" hs="1">to<span class="w w1"> </span>a<span class="w w1"> </span>single<span class="w w1"> </span>x86<span class="w w1"> </span>instruction.<span class="w w1"> </span>Instructions<span class="w w1"> </span>marked<span class="w w1"> </span>with</div><div class="l f7 s4 t0" style="bottom:270.127px;left:247.567px;" data-x="247.567" data-y="272.118" hs="1">(*)</div><div class="l f2 s4 t0" style="bottom:270.181px;left:264.447px;" data-x="264.447" data-y="272.118" hs="1">would<span class="w w1"> </span>be<span class="w w1"> </span>omitted<span class="w w1"> </span>by<span class="w w1"> </span>an<span class="w w1"> </span>idealized<span class="w w1"> </span>compiler<span class="w w1"> </span>that<span class="w w1"> </span>knew<span class="w w1"> </span>that<span class="w w1"> </span>none<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>side<span class="w w1"> </span>exits</div><div class="l f2 s4 t0" style="bottom:260.218px;left:54px;" data-x="54" data-y="262.155" hs="1">would<span class="w w2"> </span>ever<span class="w w1"> </span>be<span class="w w1"> </span>taken.<span class="w w2"> </span>The<span class="w w1"> </span>17<span class="w w1"> </span>instructions<span class="w w2"> </span>generated<span class="w w1"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>compiler<span class="w w2"> </span>compare<span class="w w1"> </span>favorably<span class="w w2"> </span>with<span class="w w1"> </span>the<span class="w w1"> </span>100+<span class="w w1"> </span>instructions<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>would</div><div class="l f2 s4 t0" style="bottom:250.256px;left:54px;" data-x="54" data-y="252.192" hs="1">execute<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>same<span class="w w1"> </span>code<span class="w w1"> </span>snippet,<span class="w w2"> </span>including<span class="w w1"> </span>4<span class="w w1"> </span>indirect<span class="w w2"> </span>jumps.</div><div class="l f1 s4 t0" style="bottom:220.482px;left:65.9552px;" data-x="65.9552" data-y="222.356" hs="1">i=2.</div><div class="l f2 s4 t0" style="bottom:220.419px;left:83.8015px;" data-x="83.8015" data-y="222.356" hs="1">This<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>first<span class="w w0"> </span>iteration<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop.<span class="w w0"> </span>The<span class="w w1"> </span>loop<span class="w w0"> </span>on</div><div class="l f2 s4 t0" style="bottom:210.456px;left:54px;" data-x="54" data-y="212.393" hs="1">lines<span class="w w2"> </span>4-5<span class="w w1"> </span>becomes<span class="w w1"> </span>hot<span class="w w1"> </span>on<span class="w w2"> </span>its<span class="w w1"> </span>second<span class="w w1"> </span>iteration,<span class="w w1"> </span>so<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>en-</div><div class="l f2 s4 t0" style="bottom:200.494px;left:54px;" data-x="54" data-y="202.43" hs="1">ters<span class="w w1"> </span>recording<span class="w w1"> </span>mode<span class="w w0"> </span>on<span class="w w1"> </span>line<span class="w w1"> </span>4.<span class="w w0"> </span>In<span class="w w1"> </span>recording<span class="w w1"> </span>mode,<span class="w w1"> </span>TraceMonkey</div><div class="l f2 s4 t0" style="bottom:190.531px;left:54px;" data-x="54" data-y="192.468" hs="1">records<span class="w w2"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>along<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w2"> </span>low-level<span class="w w2"> </span>compiler<span class="w w1"> </span>intermedi-</div><div class="l f2 s4 t0" style="bottom:180.568px;left:54px;" data-x="54" data-y="182.505" hs="1">ate<span class="w w2"> </span>representation<span class="w w1"> </span>we<span class="w w1"> </span>call</div><div class="l fa s4 t0" style="bottom:180.775px;left:147.89px;" data-x="147.89" data-y="182.505" hs="1">LIR</div><div class="l f2 s4 t0" style="bottom:180.568px;left:161.34px;" data-x="161.34" data-y="182.505" hs="1">.<span class="w w2"> </span>The<span class="w w1"> </span>LIR<span class="w w1"> </span>trace<span class="w w2"> </span>encodes<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>oper-</div><div class="l f2 s4 t0" style="bottom:170.606px;left:54px;" data-x="54" data-y="172.543" hs="1">ations<span class="w w1"> </span>performed<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w2"> </span>of<span class="w w1"> </span>all<span class="w w1"> </span>operands.<span class="w w1"> </span>The<span class="w w2"> </span>LIR<span class="w w1"> </span>trace<span class="w w1"> </span>also</div><div class="l f2 s4 t0" style="bottom:160.643px;left:54px;" data-x="54" data-y="162.58" hs="1">encodes</div><div class="l fa s4 t0" style="bottom:160.849px;left:85.4698px;" data-x="85.4698" data-y="162.58" hs="1">guards</div><div class="l f2 s4 t0" style="bottom:160.643px;left:110.047px;" data-x="110.047" data-y="162.58" hs="1">,<span class="w w1"> </span>which<span class="w w1"> </span>are<span class="w w2"> </span>checks<span class="w w1"> </span>that<span class="w w1"> </span>verify<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>control<span class="w w1"> </span>flow</div><div class="l f2 s4 t0" style="bottom:150.681px;left:54px;" data-x="54" data-y="152.617" hs="1">and<span class="w w1"> </span>types<span class="w w0"> </span>are<span class="w w1"> </span>identical<span class="w w1"> </span>to<span class="w w0"> </span>those<span class="w w1"> </span>observed<span class="w w1"> </span>during<span class="w w1"> </span>trace<span class="w w0"> </span>recording.</div><div class="l f2 s4 t0" style="bottom:140.718px;left:54px;" data-x="54" data-y="142.655" hs="1">Thus,<span class="w w1"> </span>on<span class="w w1"> </span>later<span class="w w1"> </span>executions,<span class="w w1"> </span>if<span class="w w1"> </span>and<span class="w w1"> </span>only<span class="w w1"> </span>if<span class="w w1"> </span>all<span class="w w1"> </span>guards<span class="w w1"> </span>are<span class="w w1"> </span>passed,<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:130.755px;left:54px;" data-x="54" data-y="132.692" hs="1">trace<span class="w w2"> </span>has<span class="w w1"> </span>the<span class="w w1"> </span>required<span class="w w2"> </span>program<span class="w w1"> </span>semantics.</div><div class="l f2 s4 t0" style="bottom:120.793px;left:65.9552px;" data-x="65.9552" data-y="122.729" hs="1">TraceMonkey<span class="w w1"> </span>stops<span class="w w0"> </span>recording<span class="w w0"> </span>when<span class="w w1"> </span>execution<span class="w w0"> </span>returns<span class="w w0"> </span>to<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:110.83px;left:54px;" data-x="54" data-y="112.767" hs="1">loop<span class="w w1"> </span>header<span class="w w2"> </span>or<span class="w w1"> </span>exits<span class="w w1"> </span>the<span class="w w1"> </span>loop.<span class="w w1"> </span>In<span class="w w1"> </span>this<span class="w w2"> </span>case,<span class="w w1"> </span>execution<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:100.867px;left:54px;" data-x="54" data-y="102.804" hs="1">loop<span class="w w2"> </span>header<span class="w w1"> </span>on<span class="w w1"> </span>line<span class="w w2"> </span>4.</div><div class="l f2 s4 t0" style="bottom:90.9048px;left:65.9552px;" data-x="65.9552" data-y="92.8415" hs="1">After<span class="w w1"> </span>recording<span class="w w2"> </span>is<span class="w w1"> </span>finished,<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>compiles<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:80.9421px;left:54px;" data-x="54" data-y="82.8788" hs="1">native<span class="w w1"> </span>code<span class="w w1"> </span>using<span class="w w1"> </span>the<span class="w w1"> </span>recorded<span class="w w1"> </span>type<span class="w w1"> </span>information<span class="w w1"> </span>for<span class="w w1"> </span>optimization.</div><div class="l f2 s4 t0" style="bottom:70.9795px;left:54px;" data-x="54" data-y="72.9162" hs="1">The<span class="w w0"> </span>result<span class="w w1"> </span>is<span class="w w0"> </span>a<span class="w w0"> </span>native<span class="w w1"> </span>code<span class="w w0"> </span>fragment<span class="w w0"> </span>that<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w0"> </span>entered<span class="w w1"> </span>if<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:220.419px;left:317.014px;" data-x="317.014" data-y="222.356" hs="1">interpreter<span class="w w1"> </span>PC<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w1"> </span>of<span class="w w1"> </span>values<span class="w w1"> </span>match<span class="w w2"> </span>those<span class="w w1"> </span>observed<span class="w w1"> </span>when</div><div class="l f2 s4 t0" style="bottom:210.456px;left:317.014px;" data-x="317.014" data-y="212.393" hs="1">trace<span class="w w1"> </span>recording<span class="w w0"> </span>was<span class="w w1"> </span>started.<span class="w w0"> </span>The<span class="w w1"> </span>first<span class="w w0"> </span>trace<span class="w w1"> </span>in<span class="w w1"> </span>our<span class="w w0"> </span>example,</div><div class="l ff s4 t0" style="bottom:210.654px;left:540.696px;" data-x="540.696" data-y="212.393" hs="1">T</div><div class="l f8 s5 t0" style="bottom:210.237px;left:546.072px;" data-x="546.072" data-y="211.397" hs="1">45</div><div class="l f2 s4 t0" style="bottom:210.456px;left:553.875px;" data-x="553.875" data-y="212.393" hs="1">,</div><div class="l f2 s4 t0" style="bottom:200.494px;left:317.014px;" data-x="317.014" data-y="202.43" hs="1">covers<span class="w w2"> </span>lines<span class="w w1"> </span>4<span class="w w2"> </span>and<span class="w w1"> </span>5.<span class="w w2"> </span>This<span class="w w1"> </span>trace<span class="w w2"> </span>can<span class="w w1"> </span>be<span class="w w1"> </span>entered<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>PC<span class="w w1"> </span>is<span class="w w2"> </span>at<span class="w w1"> </span>line<span class="w w2"> </span>4,</div><div class="l f7 s4 t0" style="bottom:190.477px;left:317.014px;" data-x="317.014" data-y="192.468" hs="1">i</div><div class="l f2 s4 t0" style="bottom:190.531px;left:323.788px;" data-x="323.788" data-y="192.468" hs="1">and</div><div class="l f7 s4 t0" style="bottom:190.477px;left:338.802px;" data-x="338.802" data-y="192.468" hs="1">k</div><div class="l f2 s4 t0" style="bottom:190.531px;left:345.576px;" data-x="345.576" data-y="192.468" hs="1">are<span class="w w2"> </span>integers,<span class="w w1"> </span>and</div><div class="l f7 s4 t0" style="bottom:190.477px;left:406.166px;" data-x="406.166" data-y="192.468" hs="1">primes</div><div class="l f2 s4 t0" style="bottom:190.531px;left:436.476px;" data-x="436.476" data-y="192.468" hs="1">is<span class="w w2"> </span>an<span class="w w1"> </span>object.<span class="w w2"> </span>After<span class="w w1"> </span>compiling</div><div class="l ff s4 t0" style="bottom:190.728px;left:540.696px;" data-x="540.696" data-y="192.468" hs="1">T</div><div class="l f8 s5 t0" style="bottom:190.312px;left:546.072px;" data-x="546.072" data-y="191.472" hs="1">45</div><div class="l f2 s4 t0" style="bottom:190.531px;left:553.875px;" data-x="553.875" data-y="192.468" hs="1">,</div><div class="l f2 s4 t0" style="bottom:180.568px;left:317.014px;" data-x="317.014" data-y="182.505" hs="1">TraceMonkey<span class="w w2"> </span>returns<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>and<span class="w w2"> </span>loops<span class="w w1"> </span>back<span class="w w2"> </span>to<span class="w w1"> </span>line<span class="w w1"> </span>1.</div><div class="l f1 s4 t0" style="bottom:170.669px;left:328.969px;" data-x="328.969" data-y="172.543" hs="1">i=3.</div><div class="l f2 s4 t0" style="bottom:170.606px;left:346.282px;" data-x="346.282" data-y="172.543" hs="1">Now<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>at<span class="w w0"> </span>line<span class="w w2"> </span>1<span class="w w0"> </span>has<span class="w w2"> </span>become<span class="w w0"> </span>hot,<span class="w w1"> </span>so<span class="w w1"> </span>Trace-</div><div class="l f2 s4 t0" style="bottom:160.643px;left:317.014px;" data-x="317.014" data-y="162.58" hs="1">Monkey<span class="w w1"> </span>starts<span class="w w0"> </span>recording.<span class="w w1"> </span>When<span class="w w0"> </span>recording<span class="w w1"> </span>reaches<span class="w w1"> </span>line<span class="w w0"> </span>4,<span class="w w1"> </span>Trace-</div><div class="l f2 s4 t0" style="bottom:150.681px;left:317.014px;" data-x="317.014" data-y="152.617" hs="1">Monkey<span class="w w1"> </span>observes<span class="w w1"> </span>that<span class="w w1"> </span>it<span class="w w1"> </span>has<span class="w w1"> </span>reached<span class="w w1"> </span>an<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>that<span class="w w1"> </span>al-</div><div class="l f2 s4 t0" style="bottom:140.718px;left:317.014px;" data-x="317.014" data-y="142.655" hs="1">ready<span class="w w1"> </span>has<span class="w w1"> </span>a<span class="w w1"> </span>compiled<span class="w w1"> </span>trace,<span class="w w0"> </span>so<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>attempts<span class="w w1"> </span>to<span class="w w0"> </span>nest<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:130.755px;left:317.014px;" data-x="317.014" data-y="132.692" hs="1">inner<span class="w w2"> </span>loop<span class="w w1"> </span>inside<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>trace.<span class="w w1"> </span>The<span class="w w2"> </span>first<span class="w w1"> </span>step<span class="w w1"> </span>is<span class="w w2"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>the<span class="w w2"> </span>inner</div><div class="l f2 s4 t0" style="bottom:120.793px;left:317.014px;" data-x="317.014" data-y="122.729" hs="1">trace<span class="w w2"> </span>as<span class="w w2"> </span>a<span class="w w1"> </span>subroutine.<span class="w w2"> </span>This<span class="w w1"> </span>executes<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w2"> </span>on<span class="w w1"> </span>line<span class="w w2"> </span>4<span class="w w1"> </span>to<span class="w w2"> </span>completion</div><div class="l f2 s4 t0" style="bottom:110.83px;left:317.014px;" data-x="317.014" data-y="112.767" hs="1">and<span class="w w2"> </span>then<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>recorder.<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>verifies<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>call</div><div class="l f2 s4 t0" style="bottom:100.867px;left:317.014px;" data-x="317.014" data-y="102.804" hs="1">was<span class="w w2"> </span>successful<span class="w w1"> </span>and<span class="w w2"> </span>then<span class="w w1"> </span>records<span class="w w2"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>trace<span class="w w2"> </span>as<span class="w w1"> </span>part<span class="w w2"> </span>of</div><div class="l f2 s4 t0" style="bottom:90.9048px;left:317.014px;" data-x="317.014" data-y="92.8415" hs="1">the<span class="w w1"> </span>current<span class="w w2"> </span>trace.<span class="w w1"> </span>Recording<span class="w w1"> </span>continues<span class="w w1"> </span>until<span class="w w1"> </span>execution<span class="w w2"> </span>reaches<span class="w w1"> </span>line</div><div class="l f2 s4 t0" style="bottom:80.9421px;left:317.014px;" data-x="317.014" data-y="82.8788" hs="1">1,<span class="w w1"> </span>and<span class="w w1"> </span>at<span class="w w1"> </span>which<span class="w w1"> </span>point<span class="w w1"> </span>TraceMonkey<span class="w w1"> </span>finishes<span class="w w1"> </span>and<span class="w w1"> </span>compiles<span class="w w1"> </span>a<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:70.9795px;left:317.014px;" data-x="317.014" data-y="72.9162" hs="1">for<span class="w w2"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop,</div><div class="l ff s4 t0" style="bottom:71.1767px;left:384.001px;" data-x="384.001" data-y="72.9162" hs="1">T</div><div class="l f8 s5 t0" style="bottom:70.7603px;left:389.377px;" data-x="389.377" data-y="71.92" hs="1">16</div><div class="l f2 s4 t0" style="bottom:70.9795px;left:397.181px;" data-x="397.181" data-y="72.9162" hs="1">.</div></div></div><div id="page-4" class="p" style="width:612px;height:792px;background-image:url(p4.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f1 s4 t0" style="bottom:710.156px;left:65.9552px;" data-x="65.9552" data-y="712.03" hs="1">i=4.</div><div class="l f2 s4 t0" style="bottom:710.093px;left:82.2805px;" data-x="82.2805" data-y="712.03" hs="1">On<span class="w w2"> </span>this<span class="w w1"> </span>iteration,<span class="w w2"> </span>TraceMonkey<span class="w w2"> </span>calls</div><div class="l ff s4 t0" style="bottom:710.29px;left:214.494px;" data-x="214.494" data-y="712.03" hs="1">T</div><div class="l f8 s5 t0" style="bottom:709.874px;left:219.87px;" data-x="219.87" data-y="711.034" hs="1">16</div><div class="l f2 s4 t0" style="bottom:710.093px;left:227.674px;" data-x="227.674" data-y="712.03" hs="1">.<span class="w w2"> </span>Because</div><div class="l f7 s4 t0" style="bottom:710.039px;left:263.786px;" data-x="263.786" data-y="712.03" hs="1">i=4</div><div class="l f2 s4 t0" style="bottom:710.093px;left:277.908px;" data-x="277.908" data-y="712.03" hs="1">,<span class="w w2"> </span>the</div><div class="l f7 s4 t0" style="bottom:700.077px;left:54px;" data-x="54" data-y="702.067" hs="1">if</div><div class="l f2 s4 t0" style="bottom:700.13px;left:66.3342px;" data-x="66.3342" data-y="702.067" hs="1">statement<span class="w w1"> </span>on<span class="w w1"> </span>line<span class="w w1"> </span>2<span class="w w1"> </span>is<span class="w w1"> </span>taken.<span class="w w1"> </span>This<span class="w w0"> </span>branch<span class="w w2"> </span>was<span class="w w0"> </span>not<span class="w w2"> </span>taken<span class="w w1"> </span>in<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:690.168px;left:54px;" data-x="54" data-y="692.105" hs="1">original<span class="w w2"> </span>trace,<span class="w w1"> </span>so<span class="w w2"> </span>this<span class="w w1"> </span>causes</div><div class="l ff s4 t0" style="bottom:690.365px;left:156.252px;" data-x="156.252" data-y="692.105" hs="1">T</div><div class="l f8 s5 t0" style="bottom:689.949px;left:161.628px;" data-x="161.628" data-y="691.108" hs="1">16</div><div class="l f2 s4 t0" style="bottom:690.168px;left:171.505px;" data-x="171.505" data-y="692.105" hs="1">to<span class="w w2"> </span>fail<span class="w w1"> </span>a<span class="w w2"> </span>guard<span class="w w1"> </span>and<span class="w w2"> </span>take<span class="w w1"> </span>a<span class="w w2"> </span>side<span class="w w1"> </span>exit.</div><div class="l f2 s4 t0" style="bottom:680.205px;left:54px;" data-x="54" data-y="682.142" hs="1">The<span class="w w1"> </span>exit<span class="w w1"> </span>is<span class="w w1"> </span>not<span class="w w1"> </span>yet<span class="w w1"> </span>hot,<span class="w w1"> </span>so<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter,</div><div class="l f2 s4 t0" style="bottom:670.243px;left:54px;" data-x="54" data-y="672.179" hs="1">which<span class="w w2"> </span>executes<span class="w w1"> </span>the<span class="w w2"> </span>continue<span class="w w1"> </span>statement.</div><div class="l f1 s4 t0" style="bottom:660.343px;left:65.9552px;" data-x="65.9552" data-y="662.217" hs="1">i=5.</div><div class="l f2 s4 t0" style="bottom:660.28px;left:82.2987px;" data-x="82.2987" data-y="662.217" hs="1">TraceMonkey<span class="w w2"> </span>calls</div><div class="l ff s4 t0" style="bottom:660.477px;left:152.518px;" data-x="152.518" data-y="662.217" hs="1">T</div><div class="l f8 s5 t0" style="bottom:660.061px;left:157.894px;" data-x="157.894" data-y="661.22" hs="1">16</div><div class="l f2 s4 t0" style="bottom:660.28px;left:165.698px;" data-x="165.698" data-y="662.217" hs="1">,<span class="w w2"> </span>which<span class="w w1"> </span>in<span class="w w2"> </span>turn<span class="w w1"> </span>calls<span class="w w2"> </span>the<span class="w w1"> </span>nested<span class="w w2"> </span>trace</div><div class="l ff s4 t0" style="bottom:650.515px;left:54px;" data-x="54" data-y="652.254" hs="1">T</div><div class="l f8 s5 t0" style="bottom:650.098px;left:59.376px;" data-x="59.376" data-y="651.258" hs="1">45</div><div class="l f2 s4 t0" style="bottom:650.317px;left:67.18px;" data-x="67.18" data-y="652.254" hs="1">.</div><div class="l ff s4 t0" style="bottom:650.515px;left:72.5721px;" data-x="72.5721" data-y="652.254" hs="1">T</div><div class="l f8 s5 t0" style="bottom:650.098px;left:77.9481px;" data-x="77.9481" data-y="651.258" hs="1">16</div><div class="l f2 s4 t0" style="bottom:650.317px;left:88.9025px;" data-x="88.9025" data-y="652.254" hs="1">loops<span class="w w1"> </span>back<span class="w w1"> </span>to<span class="w w0"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>header,<span class="w w1"> </span>starting<span class="w w1"> </span>the<span class="w w1"> </span>next<span class="w w0"> </span>iteration</div><div class="l f2 s4 t0" style="bottom:640.355px;left:54px;" data-x="54" data-y="642.291" hs="1">without<span class="w w2"> </span>ever<span class="w w1"> </span>returning<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>monitor.</div><div class="l f1 s4 t0" style="bottom:630.455px;left:65.9552px;" data-x="65.9552" data-y="632.329" hs="1">i=6.</div><div class="l f2 s4 t0" style="bottom:630.392px;left:82.4598px;" data-x="82.4598" data-y="632.329" hs="1">On<span class="w w2"> </span>this<span class="w w1"> </span>iteration,<span class="w w1"> </span>the<span class="w w2"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>on<span class="w w1"> </span>line<span class="w w2"> </span>2<span class="w w1"> </span>is<span class="w w1"> </span>taken<span class="w w2"> </span>again.<span class="w w1"> </span>This</div><div class="l f2 s4 t0" style="bottom:620.429px;left:54px;" data-x="54" data-y="622.366" hs="1">time,<span class="w w1"> </span>the<span class="w w1"> </span>side<span class="w w0"> </span>exit<span class="w w1"> </span>becomes<span class="w w1"> </span>hot,<span class="w w1"> </span>so<span class="w w0"> </span>a<span class="w w1"> </span>trace</div><div class="l ff s4 t0" style="bottom:620.627px;left:213.742px;" data-x="213.742" data-y="622.366" hs="1">T</div><div class="l f8 s5 t0" style="bottom:620.21px;left:219.118px;" data-x="219.118" data-y="621.37" hs="1">23</div><div class="l f10 s5 t0" style="bottom:620.21px;left:226.424px;" data-x="226.424" data-y="621.37" hs="1">,</div><div class="l f8 s5 t0" style="bottom:620.21px;left:228.693px;" data-x="228.693" data-y="621.37" hs="1">1</div><div class="l f2 s4 t0" style="bottom:620.429px;left:235.999px;" data-x="235.999" data-y="622.366" hs="1">is<span class="w w1"> </span>recorded<span class="w w1"> </span>that</div><div class="l f2 s4 t0" style="bottom:610.467px;left:54px;" data-x="54" data-y="612.404" hs="1">covers<span class="w w2"> </span>line<span class="w w1"> </span>3<span class="w w1"> </span>and<span class="w w2"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>header.<span class="w w2"> </span>Thus,<span class="w w1"> </span>the<span class="w w1"> </span>end<span class="w w2"> </span>of</div><div class="l ff s4 t0" style="bottom:610.664px;left:274.001px;" data-x="274.001" data-y="612.404" hs="1">T</div><div class="l f8 s5 t0" style="bottom:610.248px;left:279.377px;" data-x="279.377" data-y="611.407" hs="1">23</div><div class="l f10 s5 t0" style="bottom:610.248px;left:286.683px;" data-x="286.683" data-y="611.407" hs="1">,</div><div class="l f8 s5 t0" style="bottom:610.248px;left:288.952px;" data-x="288.952" data-y="611.407" hs="1">1</div><div class="l f2 s4 t0" style="bottom:600.504px;left:54px;" data-x="54" data-y="602.441" hs="1">jumps<span class="w w1"> </span>directly<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>start<span class="w w1"> </span>of</div><div class="l ff s4 t0" style="bottom:600.701px;left:161.019px;" data-x="161.019" data-y="602.441" hs="1">T</div><div class="l f8 s5 t0" style="bottom:600.285px;left:166.395px;" data-x="166.395" data-y="601.445" hs="1">16</div><div class="l f2 s4 t0" style="bottom:600.504px;left:174.199px;" data-x="174.199" data-y="602.441" hs="1">.<span class="w w1"> </span>The<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>is<span class="w w1"> </span>patched<span class="w w1"> </span>so<span class="w w1"> </span>that</div><div class="l f2 s4 t0" style="bottom:590.541px;left:54px;" data-x="54" data-y="592.478" hs="1">on<span class="w w2"> </span>future<span class="w w1"> </span>iterations,<span class="w w1"> </span>it<span class="w w2"> </span>jumps<span class="w w1"> </span>directly<span class="w w1"> </span>to</div><div class="l ff s4 t0" style="bottom:590.739px;left:196.958px;" data-x="196.958" data-y="592.478" hs="1">T</div><div class="l f8 s5 t0" style="bottom:590.322px;left:202.334px;" data-x="202.334" data-y="591.482" hs="1">23</div><div class="l f10 s5 t0" style="bottom:590.322px;left:209.64px;" data-x="209.64" data-y="591.482" hs="1">,</div><div class="l f8 s5 t0" style="bottom:590.322px;left:211.909px;" data-x="211.909" data-y="591.482" hs="1">1</div><div class="l f2 s4 t0" style="bottom:590.541px;left:216.06px;" data-x="216.06" data-y="592.478" hs="1">.</div><div class="l f2 s4 t0" style="bottom:580.579px;left:65.9552px;" data-x="65.9552" data-y="582.516" hs="1">At<span class="w w2"> </span>this<span class="w w2"> </span>point,<span class="w w1"> </span>TraceMonkeyhas<span class="w w1"> </span>compiled<span class="w w2"> </span>enough<span class="w w2"> </span>traces<span class="w w2"> </span>to<span class="w w1"> </span>cover</div><div class="l f2 s4 t0" style="bottom:570.616px;left:54px;" data-x="54" data-y="572.553" hs="1">the<span class="w w1"> </span>entire<span class="w w0"> </span>nested<span class="w w1"> </span>loop<span class="w w0"> </span>structure,<span class="w w1"> </span>so<span class="w w0"> </span>the<span class="w w1"> </span>rest<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>program<span class="w w1"> </span>runs</div><div class="l f2 s4 t0" style="bottom:560.654px;left:54px;" data-x="54" data-y="562.59" hs="1">entirely<span class="w w2"> </span>as<span class="w w1"> </span>native<span class="w w2"> </span>code.</div><div class="l f1 s2 t0" style="bottom:533.201px;left:54px;" data-x="54" data-y="535.492" hs="1">3.<span class="w w3"> </span>Trace<span class="w w2"> </span>Trees</div><div class="l f2 s4 t0" style="bottom:519.607px;left:54px;" data-x="54" data-y="521.544" hs="1">In<span class="w w1"> </span>this<span class="w w0"> </span>section,<span class="w w1"> </span>we<span class="w w1"> </span>describe<span class="w w0"> </span>traces,<span class="w w1"> </span>trace<span class="w w1"> </span>trees,<span class="w w0"> </span>and<span class="w w1"> </span>how<span class="w w1"> </span>they<span class="w w1"> </span>are</div><div class="l f2 s4 t0" style="bottom:509.645px;left:54px;" data-x="54" data-y="511.582" hs="1">formed<span class="w w2"> </span>at<span class="w w1"> </span>run<span class="w w1"> </span>time.<span class="w w2"> </span>Although<span class="w w1"> </span>our<span class="w w2"> </span>techniques<span class="w w1"> </span>apply<span class="w w2"> </span>to<span class="w w1"> </span>any<span class="w w1"> </span>dynamic</div><div class="l f2 s4 t0" style="bottom:499.682px;left:54px;" data-x="54" data-y="501.619" hs="1">language<span class="w w1"> </span>interpreter,<span class="w w1"> </span>we<span class="w w1"> </span>will<span class="w w0"> </span>describe<span class="w w1"> </span>them<span class="w w1"> </span>assuming<span class="w w1"> </span>a<span class="w w0"> </span>bytecode</div><div class="l f2 s4 t0" style="bottom:489.72px;left:54px;" data-x="54" data-y="491.656" hs="1">interpreter<span class="w w2"> </span>to<span class="w w1"> </span>keep<span class="w w1"> </span>the<span class="w w2"> </span>exposition<span class="w w1"> </span>simple.</div><div class="l f1 s4 t0" style="bottom:469.06px;left:54px;" data-x="54" data-y="470.934" hs="1">3.1<span class="w w10"> </span>Traces</div><div class="l f2 s4 t0" style="bottom:455.05px;left:54px;" data-x="54" data-y="456.986" hs="1">A</div><div class="l fa s4 t0" style="bottom:455.256px;left:63.4995px;" data-x="63.4995" data-y="456.986" hs="1">trace</div><div class="l f2 s4 t0" style="bottom:455.05px;left:84.8173px;" data-x="84.8173" data-y="456.986" hs="1">is<span class="w w1"> </span>simply<span class="w w1"> </span>a<span class="w w1"> </span>program<span class="w w0"> </span>path,<span class="w w1"> </span>which<span class="w w1"> </span>may<span class="w w1"> </span>cross<span class="w w1"> </span>function<span class="w w1"> </span>call</div><div class="l f2 s4 t0" style="bottom:445.087px;left:54px;" data-x="54" data-y="447.024" hs="1">boundaries.<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>focuses<span class="w w1"> </span>on</div><div class="l fa s4 t0" style="bottom:445.293px;left:191.269px;" data-x="191.269" data-y="447.024" hs="1">loop<span class="w w1"> </span>traces</div><div class="l f2 s4 t0" style="bottom:445.087px;left:231.509px;" data-x="231.509" data-y="447.024" hs="1">,<span class="w w1"> </span>that<span class="w w2"> </span>originate<span class="w w1"> </span>at</div><div class="l f2 s4 t0" style="bottom:435.124px;left:54px;" data-x="54" data-y="437.061" hs="1">a<span class="w w1"> </span>loop<span class="w w2"> </span>edge<span class="w w1"> </span>and<span class="w w1"> </span>represent<span class="w w1"> </span>a<span class="w w1"> </span>single<span class="w w1"> </span>iteration<span class="w w1"> </span>through<span class="w w2"> </span>the<span class="w w1"> </span>associated</div><div class="l f2 s4 t0" style="bottom:425.162px;left:54px;" data-x="54" data-y="427.098" hs="1">loop.</div><div class="l f2 s4 t0" style="bottom:415.199px;left:65.9552px;" data-x="65.9552" data-y="417.136" hs="1">Similar<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w1"> </span>extended<span class="w w1"> </span>basic<span class="w w1"> </span>block,<span class="w w0"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>is<span class="w w0"> </span>only<span class="w w1"> </span>entered<span class="w w1"> </span>at</div><div class="l f2 s4 t0" style="bottom:405.236px;left:54px;" data-x="54" data-y="407.173" hs="1">the<span class="w w1"> </span>top,<span class="w w2"> </span>but<span class="w w1"> </span>may<span class="w w1"> </span>have<span class="w w1"> </span>many<span class="w w2"> </span>exits.<span class="w w1"> </span>In<span class="w w1"> </span>contrast<span class="w w1"> </span>to<span class="w w1"> </span>an<span class="w w2"> </span>extended<span class="w w1"> </span>basic</div><div class="l f2 s4 t0" style="bottom:395.274px;left:54px;" data-x="54" data-y="397.211" hs="1">block,<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>can<span class="w w1"> </span>contain<span class="w w0"> </span>join<span class="w w1"> </span>nodes.<span class="w w0"> </span>Since<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>always<span class="w w1"> </span>only</div><div class="l f2 s4 t0" style="bottom:385.311px;left:54px;" data-x="54" data-y="387.248" hs="1">follows<span class="w w2"> </span>one<span class="w w2"> </span>single<span class="w w1"> </span>path<span class="w w2"> </span>through<span class="w w1"> </span>the<span class="w w2"> </span>original<span class="w w2"> </span>program,<span class="w w1"> </span>however</div><div class="l f2 s4 t0" style="bottom:385.311px;left:275.004px;" data-x="275.004" data-y="387.248" hs="1">,<span class="w w2"> </span>join</div><div class="l f2 s4 t0" style="bottom:375.348px;left:54px;" data-x="54" data-y="377.285" hs="1">nodes<span class="w w1"> </span>are<span class="w w0"> </span>not<span class="w w1"> </span>recognizable<span class="w w0"> </span>as<span class="w w1"> </span>such<span class="w w0"> </span>in<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>and<span class="w w0"> </span>have<span class="w w1"> </span>a<span class="w w1"> </span>single</div><div class="l f2 s4 t0" style="bottom:365.386px;left:54px;" data-x="54" data-y="367.323" hs="1">predecessor<span class="w w2"> </span>node<span class="w w1"> </span>like<span class="w w1"> </span>regular<span class="w w2"> </span>nodes.</div><div class="l f2 s4 t0" style="bottom:355.423px;left:65.9552px;" data-x="65.9552" data-y="357.36" hs="1">A</div><div class="l fa s4 t0" style="bottom:355.629px;left:74.653px;" data-x="74.653" data-y="357.36" hs="1">typed<span class="w w2"> </span>trace</div><div class="l f2 s4 t0" style="bottom:355.423px;left:116.813px;" data-x="116.813" data-y="357.36" hs="1">is<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>annotated<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>type<span class="w w1"> </span>for<span class="w w1"> </span>every<span class="w w2"> </span>variable</div><div class="l f2 s4 t0" style="bottom:345.461px;left:54px;" data-x="54" data-y="347.397" hs="1">(including<span class="w w2"> </span>temporaries)<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w2"> </span>trace.<span class="w w2"> </span>A<span class="w w1"> </span>typed<span class="w w2"> </span>trace<span class="w w2"> </span>also<span class="w w1"> </span>has<span class="w w2"> </span>an<span class="w w2"> </span>entry</div><div class="l fa s4 t0" style="bottom:335.704px;left:54px;" data-x="54" data-y="337.435" hs="1">type<span class="w w1"> </span>map</div><div class="l f2 s4 t0" style="bottom:335.498px;left:89.813px;" data-x="89.813" data-y="337.435" hs="1">giving<span class="w w1"> </span>the<span class="w w1"> </span>required<span class="w w1"> </span>types<span class="w w1"> </span>for<span class="w w1"> </span>variables<span class="w w2"> </span>used<span class="w w1"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:325.535px;left:54px;" data-x="54" data-y="327.472" hs="1">before<span class="w w2"> </span>they<span class="w w1"> </span>are<span class="w w2"> </span>defined.<span class="w w2"> </span>For<span class="w w1"> </span>example,<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w2"> </span>could<span class="w w2"> </span>have<span class="w w1"> </span>a<span class="w w2"> </span>type<span class="w w2"> </span>map</div><div class="l f7 s4 t0" style="bottom:315.519px;left:54px;" data-x="54" data-y="317.509" hs="1">(x:<span class="w w0"> </span>int,<span class="w w0"> </span>b:<span class="w w0"> </span>boolean)</div><div class="l f2 s4 t0" style="bottom:315.573px;left:148.146px;" data-x="148.146" data-y="317.509" hs="1">,<span class="w w1"> </span>meaning<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w1"> </span>entered</div><div class="l f2 s4 t0" style="bottom:305.61px;left:54px;" data-x="54" data-y="307.547" hs="1">only<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w1"> </span>value<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>variable</div><div class="l f7 s4 t0" style="bottom:305.556px;left:169.041px;" data-x="169.041" data-y="307.547" hs="1">x</div><div class="l f2 s4 t0" style="bottom:305.61px;left:176.089px;" data-x="176.089" data-y="307.547" hs="1">is<span class="w w2"> </span>of<span class="w w1"> </span>type</div><div class="l f7 s4 t0" style="bottom:305.556px;left:212.001px;" data-x="212.001" data-y="307.547" hs="1">int</div><div class="l f2 s4 t0" style="bottom:305.61px;left:228.463px;" data-x="228.463" data-y="307.547" hs="1">and<span class="w w2"> </span>the<span class="w w1"> </span>value<span class="w w1"> </span>of</div><div class="l f7 s4 t0" style="bottom:305.556px;left:288.396px;" data-x="288.396" data-y="307.547" hs="1">b</div><div class="l f2 s4 t0" style="bottom:295.647px;left:54px;" data-x="54" data-y="297.584" hs="1">is<span class="w w1"> </span>of<span class="w w2"> </span>type</div><div class="l f7 s4 t0" style="bottom:295.594px;left:90.06px;" data-x="90.06" data-y="297.584" hs="1">boolean</div><div class="l f2 s4 t0" style="bottom:295.647px;left:123.011px;" data-x="123.011" data-y="297.584" hs="1">.<span class="w w1"> </span>The<span class="w w2"> </span>entry<span class="w w1"> </span>type<span class="w w1"> </span>map<span class="w w2"> </span>is<span class="w w1"> </span>much<span class="w w1"> </span>like<span class="w w1"> </span>the<span class="w w2"> </span>signature</div><div class="l f2 s4 t0" style="bottom:285.685px;left:54px;" data-x="54" data-y="287.621" hs="1">of<span class="w w2"> </span>a<span class="w w1"> </span>function.</div><div class="l f2 s4 t0" style="bottom:275.722px;left:65.9552px;" data-x="65.9552" data-y="277.659" hs="1">In<span class="w w1"> </span>this<span class="w w0"> </span>paper,<span class="w w2"> </span>we<span class="w w0"> </span>only<span class="w w1"> </span>discuss<span class="w w1"> </span>typed<span class="w w0"> </span>loop<span class="w w1"> </span>traces,<span class="w w1"> </span>and<span class="w w0"> </span>we<span class="w w1"> </span>will</div><div class="l f2 s4 t0" style="bottom:265.759px;left:54px;" data-x="54" data-y="267.696" hs="1">refer<span class="w w1"> </span>to<span class="w w1"> </span>them<span class="w w0"> </span>simply<span class="w w2"> </span>as<span class="w w0"> </span>“traces”.<span class="w w1"> </span>The<span class="w w1"> </span>key<span class="w w1"> </span>property<span class="w w1"> </span>of<span class="w w0"> </span>typed<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:255.797px;left:54px;" data-x="54" data-y="257.734" hs="1">traces<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w1"> </span>they<span class="w w1"> </span>can<span class="w w2"> </span>be<span class="w w1"> </span>compiled<span class="w w1"> </span>to<span class="w w1"> </span>efficient<span class="w w2"> </span>machine<span class="w w1"> </span>code<span class="w w1"> </span>using</div><div class="l f2 s4 t0" style="bottom:245.834px;left:54px;" data-x="54" data-y="247.771" hs="1">the<span class="w w2"> </span>same<span class="w w1"> </span>techniques<span class="w w1"> </span>used<span class="w w2"> </span>for<span class="w w1"> </span>typed<span class="w w1"> </span>languages.</div><div class="l f2 s4 t0" style="bottom:235.871px;left:65.9552px;" data-x="65.9552" data-y="237.808" hs="1">In<span class="w w2"> </span>TraceMonkey,<span class="w w2"> </span>traces<span class="w w1"> </span>are<span class="w w1"> </span>recorded<span class="w w2"> </span>in<span class="w w1"> </span>trace-flavored<span class="w w1"> </span>SSA</div><div class="l fa s4 t0" style="bottom:236.078px;left:279.654px;" data-x="279.654" data-y="237.808" hs="1">LIR</div><div class="l f2 s4 t0" style="bottom:225.909px;left:54px;" data-x="54" data-y="227.846" hs="1">(low-level<span class="w w1"> </span>intermediate<span class="w w1"> </span>representation).<span class="w w1"> </span>In<span class="w w1"> </span>trace-flavored<span class="w w1"> </span>SSA<span class="w w1"> </span>(or</div><div class="l f2 s4 t0" style="bottom:215.946px;left:54px;" data-x="54" data-y="217.883" hs="1">TSSA),<span class="w w1"> </span>phi<span class="w w2"> </span>nodes<span class="w w1"> </span>appear<span class="w w1"> </span>only<span class="w w1"> </span>at<span class="w w1"> </span>the<span class="w w2"> </span>entry<span class="w w1"> </span>point,<span class="w w1"> </span>which<span class="w w1"> </span>is<span class="w w1"> </span>reached</div><div class="l f2 s4 t0" style="bottom:205.984px;left:54px;" data-x="54" data-y="207.92" hs="1">both<span class="w w1"> </span>on<span class="w w0"> </span>entry<span class="w w1"> </span>and<span class="w w1"> </span>via<span class="w w0"> </span>loop<span class="w w1"> </span>edges.<span class="w w0"> </span>The<span class="w w1"> </span>important<span class="w w1"> </span>LIR<span class="w w0"> </span>primitives</div><div class="l f2 s4 t0" style="bottom:196.021px;left:54px;" data-x="54" data-y="197.958" hs="1">are<span class="w w0"> </span>constant<span class="w w0"> </span>values,<span class="w w0"> </span>memory<span class="w w1"> </span>loads<span class="w w0"> </span>and<span class="w w0"> </span>stores<span class="w w0"> </span>(by<span class="w w0"> </span>address<span class="w w0"> </span>and</div><div class="l f2 s4 t0" style="bottom:186.058px;left:54px;" data-x="54" data-y="187.995" hs="1">offset),<span class="w w1"> </span>integer<span class="w w1"> </span>operators,<span class="w w0"> </span>floating-point<span class="w w1"> </span>operators,<span class="w w0"> </span>function<span class="w w1"> </span>calls,</div><div class="l f2 s4 t0" style="bottom:176.096px;left:54px;" data-x="54" data-y="178.032" hs="1">and<span class="w w1"> </span>conditional<span class="w w2"> </span>exits.<span class="w w1"> </span>Type<span class="w w2"> </span>conversions,<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w2"> </span>integer<span class="w w1"> </span>to<span class="w w1"> </span>double,</div><div class="l f2 s4 t0" style="bottom:166.133px;left:54px;" data-x="54" data-y="168.07" hs="1">are<span class="w w0"> </span>represented<span class="w w1"> </span>by<span class="w w0"> </span>function<span class="w w0"> </span>calls.<span class="w w1"> </span>This<span class="w w0"> </span>makes<span class="w w0"> </span>the<span class="w w0"> </span>LIR<span class="w w1"> </span>used<span class="w w0"> </span>by</div><div class="l f2 s4 t0" style="bottom:156.17px;left:54px;" data-x="54" data-y="158.107" hs="1">TraceMonkey<span class="w w1"> </span>independent<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>concrete<span class="w w0"> </span>type<span class="w w1"> </span>system<span class="w w0"> </span>and<span class="w w1"> </span>type</div><div class="l f2 s4 t0" style="bottom:146.208px;left:54px;" data-x="54" data-y="148.145" hs="1">conversion<span class="w w1"> </span>rules<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>source<span class="w w1"> </span>language.<span class="w w0"> </span>The<span class="w w1"> </span>LIR<span class="w w1"> </span>operations<span class="w w0"> </span>are</div><div class="l f2 s4 t0" style="bottom:136.245px;left:54px;" data-x="54" data-y="138.182" hs="1">generic<span class="w w2"> </span>enough<span class="w w1"> </span>that<span class="w w2"> </span>the<span class="w w1"> </span>backend<span class="w w2"> </span>compiler<span class="w w2"> </span>is<span class="w w1"> </span>language<span class="w w2"> </span>independent.</div><div class="l f2 s4 t0" style="bottom:126.282px;left:54px;" data-x="54" data-y="128.219" hs="1">Figure<span class="w w2"> </span>3<span class="w w1"> </span>shows<span class="w w2"> </span>an<span class="w w1"> </span>example<span class="w w1"> </span>LIR<span class="w w2"> </span>trace.</div><div class="l f2 s4 t0" style="bottom:116.32px;left:65.9552px;" data-x="65.9552" data-y="118.257" hs="1">Bytecode<span class="w w0"> </span>interpreters<span class="w w1"> </span>typically<span class="w w0"> </span>represent<span class="w w0"> </span>values<span class="w w0"> </span>in<span class="w w1"> </span>a<span class="w w0"> </span>various</div><div class="l f2 s4 t0" style="bottom:106.357px;left:54px;" data-x="54" data-y="108.294" hs="1">complex<span class="w w1"> </span>data<span class="w w1"> </span>structures<span class="w w1"> </span>(e.g.,<span class="w w1"> </span>hash<span class="w w1"> </span>tables)<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>boxed<span class="w w2"> </span>format<span class="w w1"> </span>(i.e.,</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:54px;" data-x="54" data-y="98.3313" hs="1">with<span class="w w1"> </span>attached<span class="w w1"> </span>type<span class="w w1"> </span>tag<span class="w w1"> </span>bits).<span class="w w1"> </span>Since<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>intended<span class="w w1"> </span>to<span class="w w1"> </span>represent</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:54px;" data-x="54" data-y="88.3686" hs="1">efficient<span class="w w1"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>eliminates<span class="w w1"> </span>all<span class="w w1"> </span>that<span class="w w0"> </span>complexity</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:230.324px;" data-x="230.324" data-y="88.3686" hs="1">,<span class="w w1"> </span>our<span class="w w1"> </span>traces<span class="w w1"> </span>oper-</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:54px;" data-x="54" data-y="78.406" hs="1">ate<span class="w w1"> </span>on<span class="w w1"> </span>unboxed<span class="w w1"> </span>values<span class="w w1"> </span>in<span class="w w0"> </span>simple<span class="w w1"> </span>variables<span class="w w1"> </span>and<span class="w w1"> </span>arrays<span class="w w1"> </span>as<span class="w w1"> </span>much<span class="w w0"> </span>as</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:54px;" data-x="54" data-y="68.4433" hs="1">possible.</div><div class="l f2 s4 t0" style="bottom:710.093px;left:328.969px;" data-x="328.969" data-y="712.03" hs="1">A<span class="w w1"> </span>trace<span class="w w1"> </span>records<span class="w w1"> </span>all<span class="w w1"> </span>its<span class="w w2"> </span>intermediate<span class="w w1"> </span>values<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>small<span class="w w1"> </span>activation</div><div class="l f2 s4 t0" style="bottom:700.13px;left:317.014px;" data-x="317.014" data-y="702.067" hs="1">record<span class="w w1"> </span>area.<span class="w w2"> </span>To<span class="w w1"> </span>make<span class="w w2"> </span>variable<span class="w w1"> </span>accesses<span class="w w1"> </span>fast<span class="w w1"> </span>on<span class="w w2"> </span>trace,<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>also</div><div class="l f2 s4 t0" style="bottom:690.168px;left:317.014px;" data-x="317.014" data-y="692.105" hs="1">imports<span class="w w1"> </span>local<span class="w w1"> </span>and<span class="w w1"> </span>global<span class="w w1"> </span>variables<span class="w w2"> </span>by<span class="w w1"> </span>unboxing<span class="w w1"> </span>them<span class="w w1"> </span>and<span class="w w1"> </span>copying</div><div class="l f2 s4 t0" style="bottom:680.205px;left:317.014px;" data-x="317.014" data-y="682.142" hs="1">them<span class="w w1"> </span>to<span class="w w0"> </span>its<span class="w w1"> </span>activation<span class="w w1"> </span>record.<span class="w w0"> </span>Thus,<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>can<span class="w w1"> </span>read<span class="w w0"> </span>and<span class="w w1"> </span>write</div><div class="l f2 s4 t0" style="bottom:670.243px;left:317.014px;" data-x="317.014" data-y="672.179" hs="1">these<span class="w w2"> </span>variables<span class="w w2"> </span>with<span class="w w1"> </span>simple<span class="w w2"> </span>loads<span class="w w2"> </span>and<span class="w w2"> </span>stores<span class="w w1"> </span>from<span class="w w2"> </span>a<span class="w w2"> </span>native<span class="w w2"> </span>activation</div><div class="l f2 s4 t0" style="bottom:660.28px;left:317.014px;" data-x="317.014" data-y="662.217" hs="1">recording,<span class="w w0"> </span>independently<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w0"> </span>boxing<span class="w w1"> </span>mechanism<span class="w w0"> </span>used<span class="w w0"> </span>by<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:650.317px;left:317.014px;" data-x="317.014" data-y="652.254" hs="1">interpreter.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>exits,<span class="w w1"> </span>the<span class="w w0"> </span>VM<span class="w w1"> </span>boxes<span class="w w1"> </span>the<span class="w w0"> </span>values<span class="w w1"> </span>from</div><div class="l f2 s4 t0" style="bottom:640.355px;left:317.014px;" data-x="317.014" data-y="642.291" hs="1">this<span class="w w1"> </span>native<span class="w w2"> </span>storage<span class="w w1"> </span>location<span class="w w2"> </span>and<span class="w w1"> </span>copies<span class="w w1"> </span>them<span class="w w1"> </span>back<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter</div><div class="l f2 s4 t0" style="bottom:630.392px;left:317.014px;" data-x="317.014" data-y="632.329" hs="1">structures.</div><div class="l f2 s4 t0" style="bottom:620.429px;left:328.969px;" data-x="328.969" data-y="622.366" hs="1">For<span class="w w0"> </span>every<span class="w w4"> </span>control-flow<span class="w w0"> </span>branch<span class="w w4"> </span>in<span class="w w0"> </span>the<span class="w w4"> </span>source<span class="w w4"> </span>program,<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:610.467px;left:317.014px;" data-x="317.014" data-y="612.404" hs="1">recorder<span class="w w2"> </span>generates<span class="w w1"> </span>conditional<span class="w w2"> </span>exit<span class="w w1"> </span>LIR<span class="w w2"> </span>instructions.<span class="w w1"> </span>These<span class="w w2"> </span>instruc-</div><div class="l f2 s4 t0" style="bottom:600.504px;left:317.014px;" data-x="317.014" data-y="602.441" hs="1">tions<span class="w w1"> </span>exit<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>if<span class="w w1"> </span>required<span class="w w0"> </span>control<span class="w w2"> </span>flow<span class="w w1"> </span>is<span class="w w1"> </span>different<span class="w w1"> </span>from</div><div class="l f2 s4 t0" style="bottom:590.541px;left:317.014px;" data-x="317.014" data-y="592.478" hs="1">what<span class="w w1"> </span>it<span class="w w1"> </span>was<span class="w w1"> </span>at<span class="w w1"> </span>trace<span class="w w1"> </span>recording,<span class="w w1"> </span>ensuring<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>instructions</div><div class="l f2 s4 t0" style="bottom:580.579px;left:317.014px;" data-x="317.014" data-y="582.516" hs="1">are<span class="w w1"> </span>run<span class="w w0"> </span>only<span class="w w0"> </span>if<span class="w w1"> </span>they<span class="w w0"> </span>are<span class="w w1"> </span>supposed<span class="w w0"> </span>to.<span class="w w1"> </span>We<span class="w w0"> </span>call<span class="w w1"> </span>these<span class="w w0"> </span>instructions</div><div class="l fa s4 t0" style="bottom:570.822px;left:317.014px;" data-x="317.014" data-y="572.553" hs="1">guard</div><div class="l f2 s4 t0" style="bottom:570.616px;left:340.586px;" data-x="340.586" data-y="572.553" hs="1">instructions.</div><div class="l f2 s4 t0" style="bottom:560.654px;left:328.969px;" data-x="328.969" data-y="562.59" hs="1">Most<span class="w w2"> </span>of<span class="w w2"> </span>our<span class="w w1"> </span>traces<span class="w w2"> </span>represent<span class="w w2"> </span>loops<span class="w w1"> </span>and<span class="w w2"> </span>end<span class="w w2"> </span>with<span class="w w2"> </span>the<span class="w w1"> </span>special</div><div class="l f7 s4 t0" style="bottom:560.6px;left:537.288px;" data-x="537.288" data-y="562.59" hs="1">loop</div><div class="l f2 s4 t0" style="bottom:550.691px;left:317.014px;" data-x="317.014" data-y="552.628" hs="1">LIR<span class="w w1"> </span>instruction.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w1"> </span>just<span class="w w1"> </span>an<span class="w w1"> </span>unconditional<span class="w w1"> </span>branch<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>top<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:540.728px;left:317.014px;" data-x="317.014" data-y="542.665" hs="1">the<span class="w w2"> </span>trace.<span class="w w1"> </span>Such<span class="w w1"> </span>traces<span class="w w2"> </span>return<span class="w w1"> </span>only<span class="w w1"> </span>via<span class="w w2"> </span>guards.</div><div class="l f2 s4 t0" style="bottom:530.766px;left:328.969px;" data-x="328.969" data-y="532.702" hs="1">Now,<span class="w w2"> </span>we<span class="w w1"> </span>describe<span class="w w0"> </span>the<span class="w w2"> </span>key<span class="w w1"> </span>optimizations<span class="w w1"> </span>that<span class="w w0"> </span>are<span class="w w2"> </span>performed<span class="w w0"> </span>as</div><div class="l f2 s4 t0" style="bottom:520.803px;left:317.014px;" data-x="317.014" data-y="522.74" hs="1">part<span class="w w1"> </span>of<span class="w w1"> </span>recording<span class="w w1"> </span>LIR.<span class="w w1"> </span>All<span class="w w1"> </span>of<span class="w w1"> </span>these<span class="w w1"> </span>optimizations<span class="w w0"> </span>reduce<span class="w w2"> </span>complex</div><div class="l f2 s4 t0" style="bottom:510.84px;left:317.014px;" data-x="317.014" data-y="512.777" hs="1">dynamic<span class="w w1"> </span>language<span class="w w0"> </span>constructs<span class="w w1"> </span>to<span class="w w0"> </span>simple<span class="w w1"> </span>typed<span class="w w0"> </span>constructs<span class="w w1"> </span>by<span class="w w0"> </span>spe-</div><div class="l f2 s4 t0" style="bottom:500.878px;left:317.014px;" data-x="317.014" data-y="502.814" hs="1">cializing<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>trace.<span class="w w1"> </span>Each<span class="w w2"> </span>optimization<span class="w w1"> </span>requires<span class="w w2"> </span>guard<span class="w w1"> </span>in-</div><div class="l f2 s4 t0" style="bottom:490.915px;left:317.014px;" data-x="317.014" data-y="492.852" hs="1">structions<span class="w w1"> </span>to<span class="w w1"> </span>verify<span class="w w1"> </span>their<span class="w w0"> </span>assumptions<span class="w w1"> </span>about<span class="w w1"> </span>the<span class="w w1"> </span>state<span class="w w1"> </span>and<span class="w w0"> </span>exit<span class="w w2"> </span>the</div><div class="l f2 s4 t0" style="bottom:480.952px;left:317.014px;" data-x="317.014" data-y="482.889" hs="1">trace<span class="w w2"> </span>if<span class="w w1"> </span>necessary.</div><div class="l f1 s4 t0" style="bottom:471.053px;left:328.969px;" data-x="328.969" data-y="472.927" hs="1">Type<span class="w w2"> </span>specialization.</div><div class="l f2 s4 t0" style="bottom:461.027px;left:328.969px;" data-x="328.969" data-y="462.964" hs="1">All<span class="w w1"> </span>LIR<span class="w w0"> </span>primitives<span class="w w2"> </span>apply<span class="w w0"> </span>to<span class="w w1"> </span>operands<span class="w w1"> </span>of<span class="w w0"> </span>specific<span class="w w1"> </span>types.<span class="w w1"> </span>Thus,</div><div class="l f2 s4 t0" style="bottom:451.064px;left:317.014px;" data-x="317.014" data-y="453.001" hs="1">LIR<span class="w w0"> </span>traces<span class="w w1"> </span>are<span class="w w0"> </span>necessarily<span class="w w0"> </span>type-specialized,<span class="w w1"> </span>and<span class="w w0"> </span>a<span class="w w0"> </span>compiler<span class="w w1"> </span>can</div><div class="l f2 s4 t0" style="bottom:441.102px;left:317.014px;" data-x="317.014" data-y="443.039" hs="1">easily<span class="w w0"> </span>produce<span class="w w1"> </span>a<span class="w w0"> </span>translation<span class="w w1"> </span>that<span class="w w0"> </span>requires<span class="w w0"> </span>no<span class="w w1"> </span>type<span class="w w0"> </span>dispatches.<span class="w w0"> </span>A</div><div class="l f2 s4 t0" style="bottom:431.139px;left:317.014px;" data-x="317.014" data-y="433.076" hs="1">typical<span class="w w1"> </span>bytecode<span class="w w1"> </span>interpreter<span class="w w2"> </span>carries<span class="w w1"> </span>tag<span class="w w1"> </span>bits<span class="w w1"> </span>along<span class="w w1"> </span>with<span class="w w1"> </span>each<span class="w w1"> </span>value,</div><div class="l f2 s4 t0" style="bottom:421.177px;left:317.014px;" data-x="317.014" data-y="423.113" hs="1">and<span class="w w2"> </span>to<span class="w w1"> </span>perform<span class="w w2"> </span>any<span class="w w1"> </span>operation,<span class="w w1"> </span>must<span class="w w2"> </span>check<span class="w w1"> </span>the<span class="w w2"> </span>tag<span class="w w1"> </span>bits,<span class="w w2"> </span>dynamically</div><div class="l f2 s4 t0" style="bottom:411.214px;left:317.014px;" data-x="317.014" data-y="413.151" hs="1">dispatch,<span class="w w0"> </span>mask<span class="w w0"> </span>out<span class="w w0"> </span>the<span class="w w1"> </span>tag<span class="w w0"> </span>bits<span class="w w0"> </span>to<span class="w w0"> </span>recover<span class="w w0"> </span>the<span class="w w0"> </span>untagged<span class="w w0"> </span>value,</div><div class="l f2 s4 t0" style="bottom:401.251px;left:317.014px;" data-x="317.014" data-y="403.188" hs="1">perform<span class="w w2"> </span>the<span class="w w1"> </span>operation,<span class="w w2"> </span>and<span class="w w1"> </span>then<span class="w w2"> </span>reapply<span class="w w1"> </span>tags.<span class="w w2"> </span>LIR<span class="w w1"> </span>omits<span class="w w2"> </span>everything</div><div class="l f2 s4 t0" style="bottom:391.289px;left:317.014px;" data-x="317.014" data-y="393.225" hs="1">except<span class="w w2"> </span>the<span class="w w1"> </span>operation<span class="w w1"> </span>itself.</div><div class="l f2 s4 t0" style="bottom:381.326px;left:328.969px;" data-x="328.969" data-y="383.263" hs="1">A<span class="w w2"> </span>potential<span class="w w1"> </span>problem<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w1"> </span>some<span class="w w2"> </span>operations<span class="w w1"> </span>can<span class="w w2"> </span>produce<span class="w w1"> </span>values</div><div class="l f2 s4 t0" style="bottom:371.363px;left:317.014px;" data-x="317.014" data-y="373.3" hs="1">of<span class="w w1"> </span>unpredictable<span class="w w0"> </span>types.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w1"> </span>reading<span class="w w0"> </span>a<span class="w w1"> </span>property<span class="w w1"> </span>from<span class="w w0"> </span>an</div><div class="l f2 s4 t0" style="bottom:361.401px;left:317.014px;" data-x="317.014" data-y="363.338" hs="1">object<span class="w w1"> </span>could<span class="w w0"> </span>yield<span class="w w0"> </span>a<span class="w w1"> </span>value<span class="w w1"> </span>of<span class="w w0"> </span>any<span class="w w0"> </span>type,<span class="w w1"> </span>not<span class="w w0"> </span>necessarily<span class="w w1"> </span>the<span class="w w0"> </span>type</div><div class="l f2 s4 t0" style="bottom:351.438px;left:317.014px;" data-x="317.014" data-y="353.375" hs="1">observed<span class="w w1"> </span>during<span class="w w1"> </span>recording.<span class="w w1"> </span>The<span class="w w0"> </span>recorder<span class="w w1"> </span>emits<span class="w w1"> </span>guard<span class="w w1"> </span>instructions</div><div class="l f2 s4 t0" style="bottom:341.475px;left:317.014px;" data-x="317.014" data-y="343.412" hs="1">that<span class="w w1"> </span>conditionally<span class="w w2"> </span>exit<span class="w w1"> </span>if<span class="w w1"> </span>the<span class="w w1"> </span>operation<span class="w w1"> </span>yields<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>different</div><div class="l f2 s4 t0" style="bottom:331.513px;left:317.014px;" data-x="317.014" data-y="333.45" hs="1">type<span class="w w0"> </span>from<span class="w w0"> </span>that<span class="w w1"> </span>seen<span class="w w0"> </span>during<span class="w w0"> </span>recording.<span class="w w0"> </span>These<span class="w w0"> </span>guard<span class="w w1"> </span>instructions</div><div class="l f2 s4 t0" style="bottom:321.55px;left:317.014px;" data-x="317.014" data-y="323.487" hs="1">guarantee<span class="w w1"> </span>that<span class="w w2"> </span>as<span class="w w1"> </span>long<span class="w w1"> </span>as<span class="w w1"> </span>execution<span class="w w1"> </span>is<span class="w w1"> </span>on<span class="w w2"> </span>trace,<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w1"> </span>of<span class="w w1"> </span>values</div><div class="l f2 s4 t0" style="bottom:311.588px;left:317.014px;" data-x="317.014" data-y="313.524" hs="1">match<span class="w w1"> </span>those<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>typed<span class="w w1"> </span>trace.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>observes<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit</div><div class="l f2 s4 t0" style="bottom:301.625px;left:317.014px;" data-x="317.014" data-y="303.562" hs="1">along<span class="w w1"> </span>such<span class="w w2"> </span>a<span class="w w1"> </span>type<span class="w w1"> </span>guard,<span class="w w1"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>typed<span class="w w2"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>recorded<span class="w w1"> </span>originating</div><div class="l f2 s4 t0" style="bottom:291.662px;left:317.014px;" data-x="317.014" data-y="293.599" hs="1">at<span class="w w2"> </span>the<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>location,<span class="w w2"> </span>capturing<span class="w w1"> </span>the<span class="w w1"> </span>new<span class="w w2"> </span>type<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>operation<span class="w w2"> </span>in</div><div class="l f2 s4 t0" style="bottom:281.7px;left:317.014px;" data-x="317.014" data-y="283.636" hs="1">question.</div><div class="l f1 s4 t0" style="bottom:271.8px;left:328.969px;" data-x="328.969" data-y="273.674" hs="1">Representation<span class="w w1"> </span>specialization:<span class="w w0"> </span>objects.</div><div class="l f2 s4 t0" style="bottom:271.737px;left:482.423px;" data-x="482.423" data-y="273.674" hs="1">In<span class="w w0"> </span>Jav</div><div class="l f2 s4 t0" style="bottom:271.737px;left:505.251px;" data-x="505.251" data-y="273.674" hs="1">aScript,<span class="w w0"> </span>name</div><div class="l f2 s4 t0" style="bottom:261.774px;left:317.014px;" data-x="317.014" data-y="263.711" hs="1">lookup<span class="w w1"> </span>semantics<span class="w w1"> </span>are<span class="w w0"> </span>complex<span class="w w1"> </span>and<span class="w w1"> </span>potentially<span class="w w1"> </span>expensive<span class="w w1"> </span>because</div><div class="l f2 s4 t0" style="bottom:251.812px;left:317.014px;" data-x="317.014" data-y="253.748" hs="1">they<span class="w w2"> </span>include<span class="w w1"> </span>features<span class="w w1"> </span>like<span class="w w2"> </span>object<span class="w w1"> </span>inheritance<span class="w w1"> </span>and</div><div class="l f7 s4 t0" style="bottom:251.758px;left:491.658px;" data-x="491.658" data-y="253.748" hs="1">eval</div><div class="l f2 s4 t0" style="bottom:251.812px;left:510.488px;" data-x="510.488" data-y="253.748" hs="1">.<span class="w w2"> </span>To<span class="w w1"> </span>evaluate</div><div class="l f2 s4 t0" style="bottom:241.849px;left:317.014px;" data-x="317.014" data-y="243.786" hs="1">an<span class="w w1"> </span>object<span class="w w0"> </span>property<span class="w w1"> </span>read<span class="w w1"> </span>expression<span class="w w1"> </span>like</div><div class="l f7 s4 t0" style="bottom:241.795px;left:464.267px;" data-x="464.267" data-y="243.786" hs="1">o.x</div><div class="l f2 s4 t0" style="bottom:241.849px;left:478.389px;" data-x="478.389" data-y="243.786" hs="1">,<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>must</div><div class="l f2 s4 t0" style="bottom:231.886px;left:317.014px;" data-x="317.014" data-y="233.823" hs="1">search<span class="w w1"> </span>the<span class="w w2"> </span>property<span class="w w1"> </span>map<span class="w w1"> </span>of</div><div class="l f7 s4 t0" style="bottom:231.833px;left:416.848px;" data-x="416.848" data-y="233.823" hs="1">o</div><div class="l f2 s4 t0" style="bottom:231.886px;left:424.093px;" data-x="424.093" data-y="233.823" hs="1">and<span class="w w1"> </span>all<span class="w w2"> </span>of<span class="w w1"> </span>its<span class="w w1"> </span>prototypes<span class="w w1"> </span>and<span class="w w1"> </span>parents.</div><div class="l f2 s4 t0" style="bottom:221.924px;left:317.014px;" data-x="317.014" data-y="223.861" hs="1">Property<span class="w w1"> </span>maps<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w1"> </span>implemented<span class="w w1"> </span>with<span class="w w1"> </span>different<span class="w w1"> </span>data<span class="w w0"> </span>structures</div><div class="l f2 s4 t0" style="bottom:211.961px;left:317.014px;" data-x="317.014" data-y="213.898" hs="1">(e.g.,<span class="w w1"> </span>per-object<span class="w w1"> </span>hash<span class="w w0"> </span>tables<span class="w w1"> </span>or<span class="w w1"> </span>shared<span class="w w1"> </span>hash<span class="w w0"> </span>tables),<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w0"> </span>search</div><div class="l f2 s4 t0" style="bottom:201.998px;left:317.014px;" data-x="317.014" data-y="203.935" hs="1">process<span class="w w0"> </span>also<span class="w w1"> </span>must<span class="w w0"> </span>dispatch<span class="w w1"> </span>on<span class="w w0"> </span>the<span class="w w1"> </span>representation<span class="w w0"> </span>of<span class="w w0"> </span>each<span class="w w1"> </span>object</div><div class="l f2 s4 t0" style="bottom:192.036px;left:317.014px;" data-x="317.014" data-y="193.973" hs="1">found<span class="w w2"> </span>during<span class="w w2"> </span>search.<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>can<span class="w w2"> </span>simply<span class="w w1"> </span>observe<span class="w w2"> </span>the<span class="w w2"> </span>result<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:182.073px;left:317.014px;" data-x="317.014" data-y="184.01" hs="1">the<span class="w w1"> </span>search<span class="w w1"> </span>process<span class="w w1"> </span>and<span class="w w1"> </span>record<span class="w w1"> </span>the<span class="w w1"> </span>simplest<span class="w w1"> </span>possible<span class="w w1"> </span>LIR<span class="w w1"> </span>to<span class="w w1"> </span>access</div><div class="l f2 s4 t0" style="bottom:172.111px;left:317.014px;" data-x="317.014" data-y="174.047" hs="1">the<span class="w w2"> </span>property<span class="w w1"> </span>value.<span class="w w2"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>the<span class="w w2"> </span>search<span class="w w2"> </span>might<span class="w w1"> </span>finds<span class="w w2"> </span>the<span class="w w1"> </span>value<span class="w w2"> </span>of</div><div class="l f7 s4 t0" style="bottom:162.094px;left:317.014px;" data-x="317.014" data-y="164.085" hs="1">o.x</div><div class="l f2 s4 t0" style="bottom:162.148px;left:333.256px;" data-x="333.256" data-y="164.085" hs="1">in<span class="w w2"> </span>the<span class="w w1"> </span>prototype<span class="w w2"> </span>of</div><div class="l f7 s4 t0" style="bottom:162.094px;left:401.505px;" data-x="401.505" data-y="164.085" hs="1">o</div><div class="l f2 s4 t0" style="bottom:162.148px;left:406.213px;" data-x="406.213" data-y="164.085" hs="1">,<span class="w w2"> </span>which<span class="w w1"> </span>uses<span class="w w2"> </span>a<span class="w w1"> </span>shared<span class="w w2"> </span>hash-table<span class="w w1"> </span>represen-</div><div class="l f2 s4 t0" style="bottom:152.185px;left:317.014px;" data-x="317.014" data-y="154.122" hs="1">tation<span class="w w2"> </span>that<span class="w w1"> </span>places</div><div class="l f7 s4 t0" style="bottom:152.131px;left:379.55px;" data-x="379.55" data-y="154.122" hs="1">x</div><div class="l f2 s4 t0" style="bottom:152.185px;left:386.342px;" data-x="386.342" data-y="154.122" hs="1">in<span class="w w2"> </span>slot<span class="w w1"> </span>2<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w2"> </span>property<span class="w w1"> </span>vector.<span class="w w2"> </span>Then<span class="w w2"> </span>the<span class="w w1"> </span>recorded</div><div class="l f2 s4 t0" style="bottom:142.223px;left:317.014px;" data-x="317.014" data-y="144.159" hs="1">can<span class="w w2"> </span>generate<span class="w w1"> </span>LIR<span class="w w2"> </span>that<span class="w w1"> </span>reads</div><div class="l f7 s4 t0" style="bottom:142.169px;left:416.779px;" data-x="416.779" data-y="144.159" hs="1">o.x</div><div class="l f2 s4 t0" style="bottom:142.223px;left:432.929px;" data-x="432.929" data-y="144.159" hs="1">with<span class="w w2"> </span>just<span class="w w1"> </span>two<span class="w w2"> </span>or<span class="w w1"> </span>three<span class="w w2"> </span>loads:<span class="w w1"> </span>one<span class="w w2"> </span>to</div><div class="l f2 s4 t0" style="bottom:132.26px;left:317.014px;" data-x="317.014" data-y="134.197" hs="1">get<span class="w w2"> </span>the<span class="w w1"> </span>prototype,<span class="w w2"> </span>possibly<span class="w w1"> </span>one<span class="w w2"> </span>to<span class="w w1"> </span>get<span class="w w2"> </span>the<span class="w w2"> </span>property<span class="w w1"> </span>value<span class="w w2"> </span>vector,<span class="w w2"> </span>and</div><div class="l f2 s4 t0" style="bottom:122.297px;left:317.014px;" data-x="317.014" data-y="124.234" hs="1">one<span class="w w2"> </span>more<span class="w w1"> </span>to<span class="w w1"> </span>get<span class="w w1"> </span>slot<span class="w w2"> </span>2<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w2"> </span>vector.<span class="w w1"> </span>This<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w1"> </span>vast<span class="w w2"> </span>simplification</div><div class="l f2 s4 t0" style="bottom:112.335px;left:317.014px;" data-x="317.014" data-y="114.272" hs="1">and<span class="w w2"> </span>speedup<span class="w w1"> </span>compared<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>original<span class="w w1"> </span>interpreter<span class="w w1"> </span>code.<span class="w w2"> </span>Inheritance</div><div class="l f2 s4 t0" style="bottom:102.372px;left:317.014px;" data-x="317.014" data-y="104.309" hs="1">relationships<span class="w w1"> </span>and<span class="w w1"> </span>object<span class="w w1"> </span>representations<span class="w w1"> </span>can<span class="w w1"> </span>change<span class="w w1"> </span>during<span class="w w1"> </span>execu-</div><div class="l f2 s4 t0" style="bottom:92.4095px;left:317.014px;" data-x="317.014" data-y="94.3462" hs="1">tion,<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w2"> </span>simplified<span class="w w1"> </span>code<span class="w w1"> </span>requires<span class="w w1"> </span>guard<span class="w w1"> </span>instructions<span class="w w1"> </span>that<span class="w w1"> </span>ensure</div><div class="l f2 s4 t0" style="bottom:82.4469px;left:317.014px;" data-x="317.014" data-y="84.3836" hs="1">the<span class="w w2"> </span>object<span class="w w2"> </span>representation<span class="w w1"> </span>is<span class="w w2"> </span>the<span class="w w2"> </span>same.<span class="w w1"> </span>In<span class="w w2"> </span>TraceMonkey,objects’<span class="w w1"> </span>rep-</div></div></div><div id="page-5" class="p" style="width:612px;height:792px;background-image:url(p5.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f2 s4 t0" style="bottom:710.093px;left:54px;" data-x="54" data-y="712.03" hs="1">resentations<span class="w w1"> </span>are<span class="w w0"> </span>assigned<span class="w w1"> </span>an<span class="w w0"> </span>integer<span class="w w1"> </span>key<span class="w w1"> </span>called<span class="w w0"> </span>the</div><div class="l fa s4 t0" style="bottom:710.299px;left:244.58px;" data-x="244.58" data-y="712.03" hs="1">object<span class="w w1"> </span>shape</div><div class="l f2 s4 t0" style="bottom:710.093px;left:290.862px;" data-x="290.862" data-y="712.03" hs="1">.</div><div class="l f2 s4 t0" style="bottom:700.13px;left:54px;" data-x="54" data-y="702.067" hs="1">Thus,<span class="w w2"> </span>the<span class="w w1"> </span>guard<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>simple<span class="w w1"> </span>equality<span class="w w2"> </span>check<span class="w w1"> </span>on<span class="w w2"> </span>the<span class="w w1"> </span>object<span class="w w1"> </span>shape.</div><div class="l f1 s4 t0" style="bottom:690.231px;left:65.9552px;" data-x="65.9552" data-y="692.105" hs="1">Representation<span class="w w0"> </span>specialization:<span class="w w1"> </span>numbers.</div><div class="l f2 s4 t0" style="bottom:690.168px;left:227.131px;" data-x="227.131" data-y="692.105" hs="1">JavaScript<span class="w w1"> </span>has<span class="w w0"> </span>no</div><div class="l f2 s4 t0" style="bottom:680.205px;left:54px;" data-x="54" data-y="682.142" hs="1">integer<span class="w w1"> </span>type,<span class="w w0"> </span>only<span class="w w1"> </span>a<span class="w w1"> </span>Number<span class="w w0"> </span>type<span class="w w1"> </span>that<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>set<span class="w w1"> </span>of<span class="w w0"> </span>64-bit<span class="w w1"> </span>IEEE-</div><div class="l f2 s4 t0" style="bottom:670.243px;left:54px;" data-x="54" data-y="672.179" hs="1">754<span class="w w0"> </span>floating-pointer<span class="w w0"> </span>numbers<span class="w w1"> </span>(“doubles”).<span class="w w0"> </span>But<span class="w w0"> </span>many<span class="w w0"> </span>JavaScript</div><div class="l f2 s4 t0" style="bottom:660.28px;left:54px;" data-x="54" data-y="662.217" hs="1">operators,<span class="w w2"> </span>in<span class="w w1"> </span>particular<span class="w w1"> </span>array<span class="w w1"> </span>accesses<span class="w w2"> </span>and<span class="w w1"> </span>bitwise<span class="w w1"> </span>operators,<span class="w w2"> </span>really</div><div class="l f2 s4 t0" style="bottom:650.317px;left:54px;" data-x="54" data-y="652.254" hs="1">operate<span class="w w1"> </span>on<span class="w w1"> </span>integers,<span class="w w2"> </span>so<span class="w w1"> </span>they<span class="w w1"> </span>first<span class="w w1"> </span>convert<span class="w w1"> </span>the<span class="w w1"> </span>number<span class="w w1"> </span>to<span class="w w1"> </span>an<span class="w w1"> </span>integer,</div><div class="l f2 s4 t0" style="bottom:639.992px;left:54px;" data-x="54" data-y="641.929" hs="1">and<span class="w w1"> </span>then<span class="w w0"> </span>conv</div><div class="l f2 s4 t0" style="bottom:639.992px;left:106.005px;" data-x="106.005" data-y="641.929" hs="1">ert<span class="w w1"> </span>any<span class="w w0"> </span>integer<span class="w w1"> </span>result<span class="w w1"> </span>back<span class="w w0"> </span>to<span class="w w1"> </span>a<span class="w w1"> </span>double.</div><div class="l f2 s5 t0" style="bottom:644.447px;left:250.896px;" data-x="250.896" data-y="645.738" hs="1">1</div><div class="l f2 s4 t0" style="bottom:639.992px;left:257.725px;" data-x="257.725" data-y="641.929" hs="1">Clearly,<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:630.03px;left:54px;" data-x="54" data-y="631.967" hs="1">JavaScript<span class="w w2"> </span>VM<span class="w w1"> </span>that<span class="w w1"> </span>wants<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w2"> </span>fast<span class="w w1"> </span>must<span class="w w1"> </span>find<span class="w w1"> </span>a<span class="w w1"> </span>way<span class="w w2"> </span>to<span class="w w1"> </span>operate<span class="w w1"> </span>on</div><div class="l f2 s4 t0" style="bottom:620.067px;left:54px;" data-x="54" data-y="622.004" hs="1">integers<span class="w w2"> </span>directly<span class="w w1"> </span>and<span class="w w1"> </span>avoid<span class="w w2"> </span>these<span class="w w1"> </span>conversions.</div><div class="l f2 s4 t0" style="bottom:610.104px;left:65.9552px;" data-x="65.9552" data-y="612.041" hs="1">In<span class="w w1"> </span>TraceMonkey</div><div class="l f2 s4 t0" style="bottom:610.104px;left:125.376px;" data-x="125.376" data-y="612.041" hs="1">,<span class="w w1"> </span>we<span class="w w1"> </span>support<span class="w w1"> </span>two<span class="w w1"> </span>representations<span class="w w1"> </span>for<span class="w w1"> </span>numbers:</div><div class="l f2 s4 t0" style="bottom:600.142px;left:54px;" data-x="54" data-y="602.079" hs="1">integers<span class="w w1"> </span>and<span class="w w1"> </span>doubles.<span class="w w0"> </span>The<span class="w w1"> </span>interpreter<span class="w w1"> </span>uses<span class="w w1"> </span>integer<span class="w w1"> </span>representations</div><div class="l f2 s4 t0" style="bottom:590.179px;left:54px;" data-x="54" data-y="592.116" hs="1">as<span class="w w2"> </span>much<span class="w w1"> </span>as<span class="w w2"> </span>it<span class="w w1"> </span>can,<span class="w w2"> </span>switching<span class="w w1"> </span>for<span class="w w2"> </span>results<span class="w w2"> </span>that<span class="w w1"> </span>can<span class="w w2"> </span>only<span class="w w1"> </span>be<span class="w w2"> </span>represented</div><div class="l f2 s4 t0" style="bottom:580.217px;left:54px;" data-x="54" data-y="582.153" hs="1">as<span class="w w1"> </span>doubles.<span class="w w1"> </span>When<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>started,<span class="w w1"> </span>some<span class="w w1"> </span>values<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w1"> </span>imported</div><div class="l f2 s4 t0" style="bottom:570.254px;left:54px;" data-x="54" data-y="572.191" hs="1">and<span class="w w1"> </span>represented<span class="w w0"> </span>as<span class="w w1"> </span>integers.<span class="w w1"> </span>Some<span class="w w1"> </span>operations<span class="w w0"> </span>on<span class="w w1"> </span>integers<span class="w w1"> </span>require</div><div class="l f2 s4 t0" style="bottom:560.291px;left:54px;" data-x="54" data-y="562.228" hs="1">guards.<span class="w w1"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>adding<span class="w w1"> </span>two<span class="w w1"> </span>integers<span class="w w1"> </span>can<span class="w w1"> </span>produce<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w2"> </span>too</div><div class="l f2 s4 t0" style="bottom:550.329px;left:54px;" data-x="54" data-y="552.265" hs="1">large<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>integer<span class="w w2"> </span>representation.</div><div class="l f1 s4 t0" style="bottom:540.429px;left:65.9552px;" data-x="65.9552" data-y="542.303" hs="1">Function<span class="w w1"> </span>inlining.</div><div class="l f2 s4 t0" style="bottom:540.366px;left:139.22px;" data-x="139.22" data-y="542.303" hs="1">LIR<span class="w w1"> </span>traces<span class="w w0"> </span>can<span class="w w0"> </span>cross<span class="w w1"> </span>function<span class="w w0"> </span>boundaries</div><div class="l f2 s4 t0" style="bottom:530.403px;left:54px;" data-x="54" data-y="532.34" hs="1">in<span class="w w1"> </span>either<span class="w w1"> </span>direction,<span class="w w1"> </span>achieving<span class="w w1"> </span>function<span class="w w1"> </span>inlining.<span class="w w1"> </span>Move<span class="w w1"> </span>instructions</div><div class="l f2 s4 t0" style="bottom:520.441px;left:54px;" data-x="54" data-y="522.377" hs="1">need<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w2"> </span>recorded<span class="w w1"> </span>for<span class="w w1"> </span>function<span class="w w1"> </span>entry<span class="w w1"> </span>and<span class="w w1"> </span>exit<span class="w w1"> </span>to<span class="w w1"> </span>copy<span class="w w1"> </span>arguments</div><div class="l f2 s4 t0" style="bottom:510.478px;left:54px;" data-x="54" data-y="512.415" hs="1">in<span class="w w2"> </span>and<span class="w w1"> </span>return<span class="w w2"> </span>values<span class="w w2"> </span>out.<span class="w w1"> </span>These<span class="w w2"> </span>move<span class="w w1"> </span>statements<span class="w w2"> </span>are<span class="w w1"> </span>then<span class="w w2"> </span>optimized</div><div class="l f2 s4 t0" style="bottom:500.515px;left:54px;" data-x="54" data-y="502.452" hs="1">away<span class="w w1"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>compiler<span class="w w1"> </span>using<span class="w w1"> </span>copy<span class="w w2"> </span>propagation.<span class="w w1"> </span>In<span class="w w1"> </span>order<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>able</div><div class="l f2 s4 t0" style="bottom:490.553px;left:54px;" data-x="54" data-y="492.49" hs="1">to<span class="w w0"> </span>return<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>interpreter,<span class="w w0"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>must<span class="w w1"> </span>also<span class="w w0"> </span>generate<span class="w w0"> </span>LIR<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:480.59px;left:54px;" data-x="54" data-y="482.527" hs="1">record<span class="w w1"> </span>that<span class="w w0"> </span>a<span class="w w1"> </span>call<span class="w w0"> </span>frame<span class="w w1"> </span>has<span class="w w1"> </span>been<span class="w w0"> </span>entered<span class="w w1"> </span>and<span class="w w0"> </span>exited.<span class="w w1"> </span>The<span class="w w1"> </span>frame</div><div class="l f2 s4 t0" style="bottom:470.627px;left:54px;" data-x="54" data-y="472.564" hs="1">entry<span class="w w0"> </span>and<span class="w w0"> </span>exit<span class="w w1"> </span>LIR<span class="w w0"> </span>saves<span class="w w0"> </span>just<span class="w w0"> </span>enough<span class="w w1"> </span>information<span class="w w0"> </span>to<span class="w w0"> </span>allow<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:460.665px;left:54px;" data-x="54" data-y="462.602" hs="1">intepreter<span class="w w1"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>restored<span class="w w1"> </span>later<span class="w w0"> </span>and<span class="w w2"> </span>is<span class="w w0"> </span>much<span class="w w2"> </span>simpler<span class="w w0"> </span>than</div><div class="l f2 s4 t0" style="bottom:450.702px;left:54px;" data-x="54" data-y="452.639" hs="1">the<span class="w w1"> </span>interpreter’s<span class="w w1"> </span>standard<span class="w w0"> </span>call<span class="w w1"> </span>code.<span class="w w1"> </span>If<span class="w w1"> </span>the<span class="w w0"> </span>function<span class="w w1"> </span>being<span class="w w1"> </span>entered</div><div class="l f2 s4 t0" style="bottom:440.74px;left:54px;" data-x="54" data-y="442.676" hs="1">is<span class="w w1"> </span>not<span class="w w1"> </span>constant<span class="w w1"> </span>(which<span class="w w1"> </span>in<span class="w w1"> </span>JavaScript<span class="w w1"> </span>includes<span class="w w1"> </span>any<span class="w w1"> </span>call<span class="w w1"> </span>by<span class="w w1"> </span>function</div><div class="l f2 s4 t0" style="bottom:430.777px;left:54px;" data-x="54" data-y="432.714" hs="1">name),<span class="w w1"> </span>the<span class="w w1"> </span>recorder<span class="w w1"> </span>must<span class="w w1"> </span>also<span class="w w1"> </span>emit<span class="w w1"> </span>LIR<span class="w w1"> </span>to<span class="w w1"> </span>guard<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>function</div><div class="l f2 s4 t0" style="bottom:420.814px;left:54px;" data-x="54" data-y="422.751" hs="1">is<span class="w w2"> </span>the<span class="w w1"> </span>same.</div><div class="l f1 s4 t0" style="bottom:410.914px;left:65.9552px;" data-x="65.9552" data-y="412.788" hs="1">Guards<span class="w w0"> </span>and<span class="w w0"> </span>side<span class="w w0"> </span>exits.</div><div class="l f2 s4 t0" style="bottom:410.852px;left:161.308px;" data-x="161.308" data-y="412.788" hs="1">Each<span class="w w0"> </span>optimization<span class="w w0"> </span>described<span class="w w0"> </span>above</div><div class="l f2 s4 t0" style="bottom:400.889px;left:54px;" data-x="54" data-y="402.826" hs="1">requires<span class="w w0"> </span>one<span class="w w1"> </span>or<span class="w w0"> </span>more<span class="w w1"> </span>guards<span class="w w0"> </span>to<span class="w w1"> </span>verify<span class="w w0"> </span>the<span class="w w0"> </span>assumptions<span class="w w1"> </span>made<span class="w w0"> </span>in</div><div class="l f2 s4 t0" style="bottom:390.926px;left:54px;" data-x="54" data-y="392.863" hs="1">doing<span class="w w2"> </span>the<span class="w w1"> </span>optimization.<span class="w w1"> </span>A<span class="w w1"> </span>guard<span class="w w2"> </span>is<span class="w w1"> </span>just<span class="w w1"> </span>a<span class="w w2"> </span>group<span class="w w1"> </span>of<span class="w w1"> </span>LIR<span class="w w2"> </span>instructions</div><div class="l f2 s4 t0" style="bottom:380.964px;left:54px;" data-x="54" data-y="382.901" hs="1">that<span class="w w1"> </span>performs<span class="w w0"> </span>a<span class="w w1"> </span>test<span class="w w0"> </span>and<span class="w w1"> </span>conditional<span class="w w1"> </span>exit.<span class="w w0"> </span>The<span class="w w1"> </span>exit<span class="w w1"> </span>branches<span class="w w0"> </span>to<span class="w w1"> </span>a</div><div class="l fa s4 t0" style="bottom:371.207px;left:54px;" data-x="54" data-y="372.938" hs="1">side<span class="w w1"> </span>exit</div><div class="l f2 s4 t0" style="bottom:371.001px;left:84.551px;" data-x="84.551" data-y="372.938" hs="1">,<span class="w w1"> </span>a<span class="w w0"> </span>small<span class="w w1"> </span>off-trace<span class="w w1"> </span>piece<span class="w w0"> </span>of<span class="w w1"> </span>LIR<span class="w w1"> </span>that<span class="w w0"> </span>returns<span class="w w1"> </span>a<span class="w w1"> </span>pointer<span class="w w0"> </span>to</div><div class="l f2 s4 t0" style="bottom:361.038px;left:54px;" data-x="54" data-y="362.975" hs="1">a<span class="w w1"> </span>structure<span class="w w0"> </span>that<span class="w w0"> </span>describes<span class="w w1"> </span>the<span class="w w0"> </span>reason<span class="w w1"> </span>for<span class="w w0"> </span>the<span class="w w1"> </span>exit<span class="w w0"> </span>along<span class="w w0"> </span>with<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:351.076px;left:54px;" data-x="54" data-y="353.013" hs="1">interpreter<span class="w w2"> </span>PC<span class="w w1"> </span>at<span class="w w2"> </span>the<span class="w w1"> </span>exit<span class="w w2"> </span>point<span class="w w1"> </span>and<span class="w w1"> </span>any<span class="w w2"> </span>other<span class="w w1"> </span>data<span class="w w2"> </span>needed<span class="w w1"> </span>to<span class="w w2"> </span>restore</div><div class="l f2 s4 t0" style="bottom:341.113px;left:54px;" data-x="54" data-y="343.05" hs="1">the<span class="w w2"> </span>interpreter’s<span class="w w1"> </span>state<span class="w w2"> </span>structures.</div><div class="l f1 s4 t0" style="bottom:331.213px;left:65.9552px;" data-x="65.9552" data-y="333.087" hs="1">Aborts.</div><div class="l f2 s4 t0" style="bottom:331.151px;left:97.7225px;" data-x="97.7225" data-y="333.087" hs="1">Some<span class="w w1"> </span>constructs<span class="w w1"> </span>are<span class="w w0"> </span>difficult<span class="w w2"> </span>to<span class="w w0"> </span>record<span class="w w1"> </span>in<span class="w w1"> </span>LIR<span class="w w1"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:321.188px;left:54px;" data-x="54" data-y="323.125" hs="1">For<span class="w w1"> </span>example,</div><div class="l f7 s4 t0" style="bottom:321.134px;left:105.54px;" data-x="105.54" data-y="323.125" hs="1">eval</div><div class="l f2 s4 t0" style="bottom:321.188px;left:127.737px;" data-x="127.737" data-y="323.125" hs="1">or<span class="w w1"> </span>calls<span class="w w0"> </span>to<span class="w w1"> </span>external<span class="w w1"> </span>functions<span class="w w0"> </span>can<span class="w w1"> </span>change<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:311.225px;left:54px;" data-x="54" data-y="313.162" hs="1">program<span class="w w0"> </span>state<span class="w w1"> </span>in<span class="w w0"> </span>unpredictable<span class="w w1"> </span>ways,<span class="w w0"> </span>making<span class="w w0"> </span>it<span class="w w1"> </span>difficult<span class="w w0"> </span>for<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:301.263px;left:54px;" data-x="54" data-y="303.199" hs="1">tracer<span class="w w1"> </span>to<span class="w w1"> </span>know<span class="w w1"> </span>the<span class="w w0"> </span>current<span class="w w1"> </span>type<span class="w w1"> </span>map<span class="w w1"> </span>in<span class="w w1"> </span>order<span class="w w0"> </span>to<span class="w w1"> </span>continue<span class="w w1"> </span>tracing.</div><div class="l f2 s4 t0" style="bottom:291.3px;left:54px;" data-x="54" data-y="293.237" hs="1">A<span class="w w1"> </span>tracing<span class="w w2"> </span>implementation<span class="w w1"> </span>can<span class="w w1"> </span>also<span class="w w1"> </span>have<span class="w w2"> </span>any<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>other<span class="w w1"> </span>limi-</div><div class="l f2 s4 t0" style="bottom:281.337px;left:54px;" data-x="54" data-y="283.274" hs="1">tations,<span class="w w1"> </span>e.g.,a<span class="w w2"> </span>small-memory<span class="w w1"> </span>device<span class="w w1"> </span>may<span class="w w2"> </span>limit<span class="w w1"> </span>the<span class="w w1"> </span>length<span class="w w1"> </span>of<span class="w w1"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:271.375px;left:54px;" data-x="54" data-y="273.311" hs="1">When<span class="w w1"> </span>any<span class="w w1"> </span>situation<span class="w w1"> </span>occurs<span class="w w1"> </span>that<span class="w w1"> </span>prevents<span class="w w1"> </span>the<span class="w w1"> </span>implementation<span class="w w1"> </span>from</div><div class="l f2 s4 t0" style="bottom:261.412px;left:54px;" data-x="54" data-y="263.349" hs="1">continuing<span class="w w2"> </span>trace<span class="w w1"> </span>recording,<span class="w w2"> </span>the<span class="w w2"> </span>implementation</div><div class="l fa s4 t0" style="bottom:261.618px;left:223.092px;" data-x="223.092" data-y="263.349" hs="1">aborts</div><div class="l f2 s4 t0" style="bottom:261.412px;left:247.903px;" data-x="247.903" data-y="263.349" hs="1">trace<span class="w w2"> </span>record-</div><div class="l f2 s4 t0" style="bottom:251.449px;left:54px;" data-x="54" data-y="253.386" hs="1">ing<span class="w w2"> </span>and<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor.</div><div class="l f1 s4 t0" style="bottom:227.061px;left:54px;" data-x="54" data-y="228.935" hs="1">3.2<span class="w w10"> </span>Trace<span class="w w2"> </span>Trees</div><div class="l f2 s4 t0" style="bottom:213.05px;left:54px;" data-x="54" data-y="214.987" hs="1">Especially<span class="w w1"> </span>simple<span class="w w0"> </span>loops,<span class="w w1"> </span>namely<span class="w w1"> </span>those<span class="w w0"> </span>where<span class="w w1"> </span>control<span class="w w1"> </span>flow,<span class="w w1"> </span>value</div><div class="l f2 s4 t0" style="bottom:203.088px;left:54px;" data-x="54" data-y="205.024" hs="1">types,<span class="w w2"> </span>value<span class="w w1"> </span>representations,<span class="w w2"> </span>and<span class="w w1"> </span>inlined<span class="w w1"> </span>functions<span class="w w2"> </span>are<span class="w w1"> </span>all<span class="w w2"> </span>invariant,</div><div class="l f2 s4 t0" style="bottom:193.125px;left:54px;" data-x="54" data-y="195.062" hs="1">can<span class="w w1"> </span>be<span class="w w1"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>single<span class="w w1"> </span>trace.<span class="w w1"> </span>But<span class="w w1"> </span>most<span class="w w1"> </span>loops<span class="w w1"> </span>have<span class="w w1"> </span>at<span class="w w1"> </span>least</div><div class="l f2 s4 t0" style="bottom:183.162px;left:54px;" data-x="54" data-y="185.099" hs="1">some<span class="w w1"> </span>variation,<span class="w w1"> </span>and<span class="w w0"> </span>so<span class="w w1"> </span>the<span class="w w1"> </span>program<span class="w w0"> </span>will<span class="w w1"> </span>take<span class="w w1"> </span>side<span class="w w1"> </span>exits<span class="w w0"> </span>from<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:173.2px;left:54px;" data-x="54" data-y="175.136" hs="1">main<span class="w w1"> </span>trace.<span class="w w1"> </span>When<span class="w w1"> </span>a<span class="w w0"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>becomes<span class="w w1"> </span>hot,<span class="w w1"> </span>TraceMonkey<span class="w w1"> </span>starts<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:163.237px;left:54px;" data-x="54" data-y="165.174" hs="1">new</div><div class="l fa s4 t0" style="bottom:163.443px;left:71.021px;" data-x="71.021" data-y="165.174" hs="1">branch<span class="w w2"> </span>trace</div><div class="l f2 s4 t0" style="bottom:163.237px;left:119.059px;" data-x="119.059" data-y="165.174" hs="1">from<span class="w w2"> </span>that<span class="w w1"> </span>point<span class="w w1"> </span>and<span class="w w2"> </span>patches<span class="w w1"> </span>the<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>to<span class="w w1"> </span>jump</div><div class="l f2 s4 t0" style="bottom:153.274px;left:54px;" data-x="54" data-y="155.211" hs="1">directly<span class="w w2"> </span>to<span class="w w1"> </span>that<span class="w w2"> </span>trace.<span class="w w1"> </span>In<span class="w w2"> </span>this<span class="w w1"> </span>way,<span class="w w2"> </span>a<span class="w w1"> </span>single<span class="w w2"> </span>trace<span class="w w1"> </span>expands<span class="w w2"> </span>on<span class="w w1"> </span>demand</div><div class="l f2 s4 t0" style="bottom:143.312px;left:54px;" data-x="54" data-y="145.249" hs="1">to<span class="w w2"> </span>a<span class="w w1"> </span>single-entry,<span class="w w2"> </span>multiple-exit</div><div class="l fa s4 t0" style="bottom:143.518px;left:164.608px;" data-x="164.608" data-y="145.249" hs="1">trace<span class="w w2"> </span>tree</div><div class="l f2 s4 t0" style="bottom:143.312px;left:198.751px;" data-x="198.751" data-y="145.249" hs="1">.</div><div class="l f2 s4 t0" style="bottom:133.349px;left:65.9552px;" data-x="65.9552" data-y="135.286" hs="1">This<span class="w w1"> </span>section<span class="w w2"> </span>explains<span class="w w1"> </span>how<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w2"> </span>are<span class="w w1"> </span>formed<span class="w w1"> </span>during<span class="w w1"> </span>execu-</div><div class="l f2 s4 t0" style="bottom:123.386px;left:54px;" data-x="54" data-y="125.323" hs="1">tion.<span class="w w1"> </span>The<span class="w w2"> </span>goal<span class="w w1"> </span>is<span class="w w1"> </span>to<span class="w w2"> </span>form<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>during<span class="w w2"> </span>execution<span class="w w1"> </span>that<span class="w w1"> </span>cover<span class="w w2"> </span>all</div><div class="l f2 s4 t0" style="bottom:113.424px;left:54px;" data-x="54" data-y="115.361" hs="1">the<span class="w w2"> </span>hot<span class="w w1"> </span>paths<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>program.</div><div class="l f2 s5 t0" style="bottom:87.8977px;left:54px;" data-x="54" data-y="89.1889" hs="1">1</div><div class="l f2 s3 t0" style="bottom:84.6546px;left:58.4832px;" data-x="58.4832" data-y="86.3761" hs="1">Arrays<span class="w w2"> </span>are<span class="w w1"> </span>actually<span class="w w2"> </span>worse<span class="w w2"> </span>than<span class="w w1"> </span>this:<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>index<span class="w w2"> </span>value<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>number,<span class="w w2"> </span>it<span class="w w2"> </span>must</div><div class="l f2 s3 t0" style="bottom:75.6882px;left:54px;" data-x="54" data-y="77.4097" hs="1">be<span class="w w2"> </span>converted<span class="w w2"> </span>from<span class="w w1"> </span>a<span class="w w2"> </span>double<span class="w w1"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>string<span class="w w2"> </span>for<span class="w w2"> </span>the<span class="w w1"> </span>property<span class="w w2"> </span>access<span class="w w1"> </span>operator,<span class="w w2"> </span>and</div><div class="l f2 s3 t0" style="bottom:66.7218px;left:54px;" data-x="54" data-y="68.4433" hs="1">then<span class="w w2"> </span>to<span class="w w1"> </span>an<span class="w w2"> </span>integer<span class="w w2"> </span>internally<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>array<span class="w w2"> </span>implementation.</div><div class="l f1 s4 t0" style="bottom:710.156px;left:328.969px;" data-x="328.969" data-y="712.03" hs="1">Starting<span class="w w2"> </span>a<span class="w w1"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:710.093px;left:388.04px;" data-x="388.04" data-y="712.03" hs="1">Tree<span class="w w2"> </span>trees<span class="w w1"> </span>always<span class="w w2"> </span>start<span class="w w2"> </span>at<span class="w w1"> </span>loop<span class="w w2"> </span>headers,<span class="w w1"> </span>because</div><div class="l f2 s4 t0" style="bottom:700.13px;left:317.014px;" data-x="317.014" data-y="702.067" hs="1">they<span class="w w2"> </span>are<span class="w w1"> </span>a<span class="w w2"> </span>natural<span class="w w1"> </span>place<span class="w w2"> </span>to<span class="w w2"> </span>look<span class="w w1"> </span>for<span class="w w2"> </span>hot<span class="w w1"> </span>paths.<span class="w w2"> </span>In<span class="w w1"> </span>TraceMonkey</div><div class="l f2 s4 t0" style="bottom:700.13px;left:535.919px;" data-x="535.919" data-y="702.067" hs="1">,<span class="w w2"> </span>loop</div><div class="l f2 s4 t0" style="bottom:690.168px;left:317.014px;" data-x="317.014" data-y="692.105" hs="1">headers<span class="w w1"> </span>are<span class="w w0"> </span>easy<span class="w w1"> </span>to<span class="w w0"> </span>detect–the<span class="w w1"> </span>bytecode<span class="w w0"> </span>compiler<span class="w w1"> </span>ensures<span class="w w0"> </span>that<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:680.205px;left:317.014px;" data-x="317.014" data-y="682.142" hs="1">bytecode<span class="w w1"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>iff<span class="w w1"> </span>it<span class="w w1"> </span>is<span class="w w1"> </span>the<span class="w w1"> </span>target<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>backward<span class="w w1"> </span>branch.</div><div class="l f2 s4 t0" style="bottom:670.243px;left:317.014px;" data-x="317.014" data-y="672.179" hs="1">TraceMonkey<span class="w w2"> </span>starts<span class="w w1"> </span>a<span class="w w1"> </span>tree<span class="w w2"> </span>when<span class="w w1"> </span>a<span class="w w1"> </span>given<span class="w w2"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>has<span class="w w2"> </span>been<span class="w w1"> </span>exe-</div><div class="l f2 s4 t0" style="bottom:660.28px;left:317.014px;" data-x="317.014" data-y="662.217" hs="1">cuted<span class="w w1"> </span>a<span class="w w2"> </span>certain<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w1"> </span>times<span class="w w1"> </span>(2<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>current<span class="w w1"> </span>implementation).</div><div class="l f2 s4 t0" style="bottom:650.317px;left:317.014px;" data-x="317.014" data-y="652.254" hs="1">Starting<span class="w w1"> </span>a<span class="w w2"> </span>tree<span class="w w1"> </span>just<span class="w w1"> </span>means<span class="w w1"> </span>starting<span class="w w1"> </span>recording<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>current</div><div class="l f2 s4 t0" style="bottom:640.355px;left:317.014px;" data-x="317.014" data-y="642.291" hs="1">point<span class="w w2"> </span>and<span class="w w1"> </span>type<span class="w w2"> </span>map<span class="w w1"> </span>and<span class="w w2"> </span>marking<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w2"> </span>root<span class="w w1"> </span>of<span class="w w2"> </span>a<span class="w w2"> </span>tree.<span class="w w1"> </span>Each</div><div class="l f2 s4 t0" style="bottom:630.392px;left:317.014px;" data-x="317.014" data-y="632.329" hs="1">tree<span class="w w2"> </span>is<span class="w w1"> </span>associated<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>loop<span class="w w1"> </span>header<span class="w w2"> </span>and<span class="w w1"> </span>type<span class="w w2"> </span>map,<span class="w w1"> </span>so<span class="w w1"> </span>there<span class="w w2"> </span>may<span class="w w1"> </span>be</div><div class="l f2 s4 t0" style="bottom:620.429px;left:317.014px;" data-x="317.014" data-y="622.366" hs="1">several<span class="w w2"> </span>trees<span class="w w1"> </span>for<span class="w w2"> </span>a<span class="w w1"> </span>given<span class="w w2"> </span>loop<span class="w w1"> </span>header.</div><div class="l f1 s4 t0" style="bottom:610.53px;left:328.969px;" data-x="328.969" data-y="612.404" hs="1">Closing<span class="w w2"> </span>the<span class="w w1"> </span>loop.</div><div class="l f2 s4 t0" style="bottom:610.467px;left:395.23px;" data-x="395.23" data-y="612.404" hs="1">Trace<span class="w w2"> </span>recording<span class="w w1"> </span>can<span class="w w2"> </span>end<span class="w w1"> </span>in<span class="w w1"> </span>several<span class="w w2"> </span>ways.</div><div class="l f2 s4 t0" style="bottom:600.504px;left:328.969px;" data-x="328.969" data-y="602.441" hs="1">Ideally,<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>reaches<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w0"> </span>header<span class="w w2"> </span>where<span class="w w1"> </span>it<span class="w w1"> </span>started<span class="w w1"> </span>with</div><div class="l f2 s4 t0" style="bottom:590.541px;left:317.014px;" data-x="317.014" data-y="592.478" hs="1">the<span class="w w1"> </span>same<span class="w w0"> </span>type<span class="w w1"> </span>map<span class="w w1"> </span>as<span class="w w0"> </span>on<span class="w w1"> </span>entry.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w0"> </span>called<span class="w w1"> </span>a</div><div class="l fa s4 t0" style="bottom:590.748px;left:497.521px;" data-x="497.521" data-y="592.478" hs="1">type-stable</div><div class="l f2 s4 t0" style="bottom:590.541px;left:540.175px;" data-x="540.175" data-y="592.478" hs="1">loop</div><div class="l f2 s4 t0" style="bottom:580.579px;left:317.014px;" data-x="317.014" data-y="582.516" hs="1">iteration.<span class="w w1"> </span>In<span class="w w0"> </span>this<span class="w w1"> </span>case,<span class="w w1"> </span>the<span class="w w0"> </span>end<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>can<span class="w w1"> </span>jump<span class="w w0"> </span>right<span class="w w1"> </span>to<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:570.616px;left:317.014px;" data-x="317.014" data-y="572.553" hs="1">beginning,<span class="w w2"> </span>as<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>value<span class="w w2"> </span>representations<span class="w w1"> </span>are<span class="w w1"> </span>exactly<span class="w w2"> </span>as<span class="w w1"> </span>needed<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:560.654px;left:317.014px;" data-x="317.014" data-y="562.59" hs="1">enter<span class="w w1"> </span>the<span class="w w1"> </span>trace.<span class="w w1"> </span>The<span class="w w2"> </span>jump<span class="w w1"> </span>can<span class="w w1"> </span>even<span class="w w1"> </span>skip<span class="w w1"> </span>the<span class="w w1"> </span>usual<span class="w w1"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>would</div><div class="l f2 s4 t0" style="bottom:550.691px;left:317.014px;" data-x="317.014" data-y="552.628" hs="1">copy<span class="w w1"> </span>out<span class="w w2"> </span>the<span class="w w1"> </span>state<span class="w w1"> </span>at<span class="w w1"> </span>the<span class="w w1"> </span>end<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>and<span class="w w1"> </span>copy<span class="w w2"> </span>it<span class="w w1"> </span>back<span class="w w1"> </span>in<span class="w w1"> </span>to<span class="w w2"> </span>the</div><div class="l f2 s4 t0" style="bottom:540.728px;left:317.014px;" data-x="317.014" data-y="542.665" hs="1">trace<span class="w w2"> </span>activation<span class="w w1"> </span>record<span class="w w2"> </span>to<span class="w w1"> </span>enter<span class="w w1"> </span>a<span class="w w2"> </span>trace.</div><div class="l f2 s4 t0" style="bottom:530.766px;left:328.969px;" data-x="328.969" data-y="532.702" hs="1">In<span class="w w1"> </span>certain<span class="w w0"> </span>cases<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>might<span class="w w1"> </span>reach<span class="w w1"> </span>the<span class="w w0"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>with<span class="w w0"> </span>a</div><div class="l f2 s4 t0" style="bottom:520.803px;left:317.014px;" data-x="317.014" data-y="522.74" hs="1">different<span class="w w2"> </span>type<span class="w w1"> </span>map.<span class="w w2"> </span>This<span class="w w1"> </span>scenario<span class="w w2"> </span>is<span class="w w1"> </span>sometime<span class="w w2"> </span>observed<span class="w w1"> </span>for<span class="w w2"> </span>the<span class="w w1"> </span>first</div><div class="l f2 s4 t0" style="bottom:510.84px;left:317.014px;" data-x="317.014" data-y="512.777" hs="1">iteration<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w2"> </span>loop.<span class="w w2"> </span>Some<span class="w w1"> </span>variables<span class="w w2"> </span>inside<span class="w w2"> </span>the<span class="w w1"> </span>loop<span class="w w2"> </span>might<span class="w w1"> </span>initially<span class="w w2"> </span>be</div><div class="l fa s4 t0" style="bottom:501.084px;left:317.014px;" data-x="317.014" data-y="502.814" hs="1">undefined</div><div class="l f2 s4 t0" style="bottom:500.878px;left:351.875px;" data-x="351.875" data-y="502.814" hs="1">,<span class="w w2"> </span>before<span class="w w2"> </span>they<span class="w w1"> </span>are<span class="w w2"> </span>set<span class="w w2"> </span>to<span class="w w1"> </span>a<span class="w w2"> </span>concrete<span class="w w2"> </span>type<span class="w w1"> </span>during<span class="w w2"> </span>the<span class="w w2"> </span>first<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:490.915px;left:317.014px;" data-x="317.014" data-y="492.852" hs="1">iteration.<span class="w w1"> </span>When<span class="w w0"> </span>recording<span class="w w0"> </span>such<span class="w w1"> </span>an<span class="w w0"> </span>iteration,<span class="w w1"> </span>the<span class="w w0"> </span>recorder<span class="w w1"> </span>cannot</div><div class="l f2 s4 t0" style="bottom:480.952px;left:317.014px;" data-x="317.014" data-y="482.889" hs="1">link<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>back<span class="w w1"> </span>to<span class="w w1"> </span>its<span class="w w2"> </span>own<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>since<span class="w w2"> </span>it<span class="w w1"> </span>is</div><div class="l fa s4 t0" style="bottom:481.159px;left:505.565px;" data-x="505.565" data-y="482.889" hs="1">type-unstable</div><div class="l f2 s4 t0" style="bottom:480.952px;left:553.875px;" data-x="553.875" data-y="482.889" hs="1">.</div><div class="l f2 s4 t0" style="bottom:470.99px;left:317.014px;" data-x="317.014" data-y="472.927" hs="1">Instead,<span class="w w2"> </span>the<span class="w w1"> </span>iteration<span class="w w1"> </span>is<span class="w w1"> </span>terminated<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>that<span class="w w1"> </span>will<span class="w w1"> </span>always</div><div class="l f2 s4 t0" style="bottom:461.027px;left:317.014px;" data-x="317.014" data-y="462.964" hs="1">fail<span class="w w1"> </span>and<span class="w w1"> </span>return<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>interpreter.<span class="w w2"> </span>At<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>time<span class="w w1"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>trace<span class="w w1"> </span>is</div><div class="l f2 s4 t0" style="bottom:451.064px;left:317.014px;" data-x="317.014" data-y="453.001" hs="1">recorded<span class="w w1"> </span>with<span class="w w0"> </span>the<span class="w w1"> </span>new<span class="w w1"> </span>type<span class="w w1"> </span>map.<span class="w w0"> </span>Every<span class="w w1"> </span>time<span class="w w1"> </span>an<span class="w w0"> </span>additional<span class="w w1"> </span>type-</div><div class="l f2 s4 t0" style="bottom:441.102px;left:317.014px;" data-x="317.014" data-y="443.039" hs="1">unstable<span class="w w2"> </span>trace<span class="w w1"> </span>is<span class="w w2"> </span>added<span class="w w1"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>region,<span class="w w2"> </span>its<span class="w w1"> </span>exit<span class="w w2"> </span>type<span class="w w1"> </span>map<span class="w w2"> </span>is<span class="w w1"> </span>compared<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:431.139px;left:317.014px;" data-x="317.014" data-y="433.076" hs="1">the<span class="w w1"> </span>entry<span class="w w1"> </span>map<span class="w w1"> </span>of<span class="w w1"> </span>all<span class="w w1"> </span>existing<span class="w w1"> </span>traces<span class="w w1"> </span>in<span class="w w1"> </span>case<span class="w w1"> </span>they<span class="w w1"> </span>complement<span class="w w1"> </span>each</div><div class="l f2 s4 t0" style="bottom:421.177px;left:317.014px;" data-x="317.014" data-y="423.113" hs="1">other.<span class="w w2"> </span>With<span class="w w1"> </span>this<span class="w w1"> </span>approach<span class="w w1"> </span>we<span class="w w1"> </span>are<span class="w w0"> </span>able<span class="w w2"> </span>to<span class="w w1"> </span>cover<span class="w w1"> </span>type-unstable<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:411.214px;left:317.014px;" data-x="317.014" data-y="413.151" hs="1">iterations<span class="w w2"> </span>as<span class="w w1"> </span>long<span class="w w1"> </span>they<span class="w w2"> </span>eventually<span class="w w1"> </span>form<span class="w w2"> </span>a<span class="w w1"> </span>stable<span class="w w2"> </span>equilibrium.</div><div class="l f2 s4 t0" style="bottom:401.251px;left:328.969px;" data-x="328.969" data-y="403.188" hs="1">Finally,<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>might<span class="w w1"> </span>exit<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w0"> </span>before<span class="w w2"> </span>reaching<span class="w w0"> </span>the<span class="w w2"> </span>loop</div><div class="l f2 s4 t0" style="bottom:391.289px;left:317.014px;" data-x="317.014" data-y="393.225" hs="1">header,<span class="w w2"> </span>for<span class="w w1"> </span>example<span class="w w2"> </span>because<span class="w w1"> </span>execution<span class="w w2"> </span>reaches<span class="w w1"> </span>a</div><div class="l f7 s4 t0" style="bottom:391.235px;left:492.524px;" data-x="492.524" data-y="393.225" hs="1">break</div><div class="l f2 s4 t0" style="bottom:391.289px;left:518.233px;" data-x="518.233" data-y="393.225" hs="1">or</div><div class="l f7 s4 t0" style="bottom:391.235px;left:527.873px;" data-x="527.873" data-y="393.225" hs="1">return</div><div class="l f2 s4 t0" style="bottom:381.326px;left:317.014px;" data-x="317.014" data-y="383.263" hs="1">statement.<span class="w w1"> </span>In<span class="w w1"> </span>this<span class="w w1"> </span>case,<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>simply<span class="w w1"> </span>ends<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>with<span class="w w1"> </span>an<span class="w w1"> </span>exit</div><div class="l f2 s4 t0" style="bottom:371.363px;left:317.014px;" data-x="317.014" data-y="373.3" hs="1">to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor.</div><div class="l f2 s4 t0" style="bottom:361.401px;left:328.969px;" data-x="328.969" data-y="363.338" hs="1">As<span class="w w1"> </span>mentioned<span class="w w1"> </span>previously,<span class="w w1"> </span>we<span class="w w1"> </span>may<span class="w w0"> </span>speculatively<span class="w w1"> </span>chose<span class="w w1"> </span>to<span class="w w1"> </span>rep-</div><div class="l f2 s4 t0" style="bottom:351.438px;left:317.014px;" data-x="317.014" data-y="353.375" hs="1">resent<span class="w w1"> </span>certain<span class="w w2"> </span>Number-typed<span class="w w1"> </span>values<span class="w w1"> </span>as<span class="w w1"> </span>integers<span class="w w1"> </span>on<span class="w w2"> </span>trace.<span class="w w1"> </span>We<span class="w w1"> </span>do<span class="w w2"> </span>so</div><div class="l f2 s4 t0" style="bottom:341.475px;left:317.014px;" data-x="317.014" data-y="343.412" hs="1">when<span class="w w1"> </span>we<span class="w w1"> </span>observe<span class="w w1"> </span>that<span class="w w1"> </span>Number-typed<span class="w w0"> </span>variables<span class="w w2"> </span>contain<span class="w w0"> </span>an<span class="w w2"> </span>integer</div><div class="l f2 s4 t0" style="bottom:331.513px;left:317.014px;" data-x="317.014" data-y="333.45" hs="1">value<span class="w w1"> </span>at<span class="w w2"> </span>trace<span class="w w1"> </span>entry.<span class="w w1"> </span>If<span class="w w1"> </span>during<span class="w w1"> </span>trace<span class="w w1"> </span>recording<span class="w w2"> </span>the<span class="w w1"> </span>variable<span class="w w1"> </span>is<span class="w w1"> </span>unex-</div><div class="l f2 s4 t0" style="bottom:321.55px;left:317.014px;" data-x="317.014" data-y="323.487" hs="1">pectedly<span class="w w1"> </span>assigned<span class="w w1"> </span>a<span class="w w1"> </span>non-integer<span class="w w1"> </span>value,<span class="w w1"> </span>we<span class="w w1"> </span>have<span class="w w1"> </span>to<span class="w w1"> </span>widen<span class="w w1"> </span>the<span class="w w1"> </span>type</div><div class="l f2 s4 t0" style="bottom:311.588px;left:317.014px;" data-x="317.014" data-y="313.524" hs="1">of<span class="w w2"> </span>the<span class="w w1"> </span>variable<span class="w w1"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>double.<span class="w w2"> </span>As<span class="w w1"> </span>a<span class="w w1"> </span>result,<span class="w w2"> </span>the<span class="w w1"> </span>recorded<span class="w w1"> </span>trace<span class="w w2"> </span>becomes</div><div class="l f2 s4 t0" style="bottom:301.625px;left:317.014px;" data-x="317.014" data-y="303.562" hs="1">inherently<span class="w w1"> </span>type-unstable<span class="w w0"> </span>since<span class="w w1"> </span>it<span class="w w0"> </span>starts<span class="w w1"> </span>with<span class="w w0"> </span>an<span class="w w1"> </span>integer<span class="w w0"> </span>value<span class="w w1"> </span>but</div><div class="l f2 s4 t0" style="bottom:291.662px;left:317.014px;" data-x="317.014" data-y="293.599" hs="1">ends<span class="w w1"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>double<span class="w w1"> </span>value.<span class="w w1"> </span>This<span class="w w1"> </span>represents<span class="w w1"> </span>a<span class="w w1"> </span>mis-speculation,<span class="w w1"> </span>since</div><div class="l f2 s4 t0" style="bottom:281.7px;left:317.014px;" data-x="317.014" data-y="283.636" hs="1">at<span class="w w2"> </span>trace<span class="w w1"> </span>entry<span class="w w1"> </span>we<span class="w w2"> </span>specialized<span class="w w1"> </span>the<span class="w w2"> </span>Number-typed<span class="w w1"> </span>value<span class="w w2"> </span>to<span class="w w1"> </span>an<span class="w w1"> </span>integer,</div><div class="l f2 s4 t0" style="bottom:271.737px;left:317.014px;" data-x="317.014" data-y="273.674" hs="1">assuming<span class="w w2"> </span>that<span class="w w1"> </span>at<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>edge<span class="w w2"> </span>we<span class="w w2"> </span>would<span class="w w1"> </span>again<span class="w w2"> </span>find<span class="w w1"> </span>an<span class="w w2"> </span>integer<span class="w w2"> </span>value</div><div class="l f2 s4 t0" style="bottom:261.774px;left:317.014px;" data-x="317.014" data-y="263.711" hs="1">in<span class="w w2"> </span>the<span class="w w1"> </span>variable,<span class="w w1"> </span>allowing<span class="w w2"> </span>us<span class="w w1"> </span>to<span class="w w2"> </span>close<span class="w w1"> </span>the<span class="w w1"> </span>loop.<span class="w w2"> </span>To<span class="w w1"> </span>avoid<span class="w w2"> </span>future<span class="w w1"> </span>spec-</div><div class="l f2 s4 t0" style="bottom:251.812px;left:317.014px;" data-x="317.014" data-y="253.748" hs="1">ulative<span class="w w1"> </span>failures<span class="w w2"> </span>involving<span class="w w1"> </span>this<span class="w w1"> </span>variable,<span class="w w1"> </span>and<span class="w w1"> </span>to<span class="w w1"> </span>obtain<span class="w w1"> </span>a<span class="w w1"> </span>type-stable</div><div class="l f2 s4 t0" style="bottom:241.849px;left:317.014px;" data-x="317.014" data-y="243.786" hs="1">trace<span class="w w2"> </span>we<span class="w w1"> </span>note<span class="w w2"> </span>the<span class="w w1"> </span>fact<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w2"> </span>variable<span class="w w2"> </span>in<span class="w w1"> </span>question<span class="w w2"> </span>as<span class="w w1"> </span>been<span class="w w2"> </span>observed</div><div class="l f2 s4 t0" style="bottom:231.886px;left:317.014px;" data-x="317.014" data-y="233.823" hs="1">to<span class="w w2"> </span>sometimes<span class="w w1"> </span>hold<span class="w w1"> </span>non-integer<span class="w w1"> </span>values<span class="w w2"> </span>in<span class="w w1"> </span>an<span class="w w1"> </span>advisory<span class="w w2"> </span>data<span class="w w1"> </span>structure</div><div class="l f2 s4 t0" style="bottom:221.924px;left:317.014px;" data-x="317.014" data-y="223.861" hs="1">which<span class="w w2"> </span>we<span class="w w1"> </span>call<span class="w w1"> </span>the<span class="w w2"> </span>“oracle”.</div><div class="l f2 s4 t0" style="bottom:211.961px;left:328.969px;" data-x="328.969" data-y="213.898" hs="1">When<span class="w w1"> </span>compiling<span class="w w1"> </span>loops,<span class="w w1"> </span>we<span class="w w1"> </span>consult<span class="w w2"> </span>the<span class="w w1"> </span>oracle<span class="w w1"> </span>before<span class="w w1"> </span>specializ-</div><div class="l f2 s4 t0" style="bottom:201.998px;left:317.014px;" data-x="317.014" data-y="203.935" hs="1">ing<span class="w w1"> </span>values<span class="w w1"> </span>to<span class="w w0"> </span>integers.<span class="w w1"> </span>Speculation<span class="w w1"> </span>towards<span class="w w1"> </span>integers<span class="w w1"> </span>is<span class="w w0"> </span>performed</div><div class="l f2 s4 t0" style="bottom:192.036px;left:317.014px;" data-x="317.014" data-y="193.973" hs="1">only<span class="w w1"> </span>if<span class="w w0"> </span>no<span class="w w1"> </span>adverse<span class="w w1"> </span>information<span class="w w1"> </span>is<span class="w w0"> </span>known<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>oracle<span class="w w0"> </span>about<span class="w w1"> </span>that</div><div class="l f2 s4 t0" style="bottom:182.073px;left:317.014px;" data-x="317.014" data-y="184.01" hs="1">particular<span class="w w1"> </span>variable.<span class="w w2"> </span>Whenever<span class="w w1"> </span>we<span class="w w1"> </span>accidentally<span class="w w1"> </span>compile<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>that</div><div class="l f2 s4 t0" style="bottom:172.111px;left:317.014px;" data-x="317.014" data-y="174.047" hs="1">is<span class="w w1"> </span>type-unstable<span class="w w0"> </span>due<span class="w w1"> </span>to<span class="w w0"> </span>mis-speculation<span class="w w1"> </span>of<span class="w w1"> </span>a<span class="w w0"> </span>Number-typed<span class="w w1"> </span>vari-</div><div class="l f2 s4 t0" style="bottom:162.148px;left:317.014px;" data-x="317.014" data-y="164.085" hs="1">able,<span class="w w1"> </span>we<span class="w w1"> </span>immediately<span class="w w1"> </span>trigger<span class="w w1"> </span>the<span class="w w0"> </span>recording<span class="w w2"> </span>of<span class="w w0"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>trace,<span class="w w1"> </span>which</div><div class="l f2 s4 t0" style="bottom:152.185px;left:317.014px;" data-x="317.014" data-y="154.122" hs="1">based<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>now<span class="w w2"> </span>updated<span class="w w1"> </span>oracle<span class="w w1"> </span>information<span class="w w2"> </span>will<span class="w w1"> </span>start<span class="w w1"> </span>with<span class="w w2"> </span>a<span class="w w1"> </span>dou-</div><div class="l f2 s4 t0" style="bottom:142.223px;left:317.014px;" data-x="317.014" data-y="144.159" hs="1">ble<span class="w w2"> </span>value<span class="w w1"> </span>and<span class="w w2"> </span>thus<span class="w w1"> </span>become<span class="w w1"> </span>type<span class="w w2"> </span>stable.</div><div class="l f1 s4 t0" style="bottom:132.323px;left:328.969px;" data-x="328.969" data-y="134.197" hs="1">Extending<span class="w w0"> </span>a<span class="w w1"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:132.26px;left:401.212px;" data-x="401.212" data-y="134.197" hs="1">Side<span class="w w0"> </span>exits<span class="w w1"> </span>lead<span class="w w0"> </span>to<span class="w w1"> </span>different<span class="w w0"> </span>paths<span class="w w1"> </span>through</div><div class="l f2 s4 t0" style="bottom:122.297px;left:317.014px;" data-x="317.014" data-y="124.234" hs="1">the<span class="w w1"> </span>loop,<span class="w w1"> </span>or<span class="w w1"> </span>paths<span class="w w1"> </span>with<span class="w w1"> </span>different<span class="w w2"> </span>types<span class="w w1"> </span>or<span class="w w1"> </span>representations.<span class="w w1"> </span>Thus,<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:112.335px;left:317.014px;" data-x="317.014" data-y="114.272" hs="1">completely<span class="w w2"> </span>cover<span class="w w2"> </span>the<span class="w w1"> </span>loop,<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>must<span class="w w1"> </span>record<span class="w w2"> </span>traces<span class="w w2"> </span>starting<span class="w w1"> </span>at<span class="w w2"> </span>all</div><div class="l f2 s4 t0" style="bottom:102.372px;left:317.014px;" data-x="317.014" data-y="104.309" hs="1">side<span class="w w2"> </span>exits.<span class="w w1"> </span>These<span class="w w1"> </span>traces<span class="w w1"> </span>are<span class="w w2"> </span>recorded<span class="w w1"> </span>much<span class="w w1"> </span>like<span class="w w2"> </span>root<span class="w w1"> </span>traces:<span class="w w1"> </span>there<span class="w w1"> </span>is</div><div class="l f2 s4 t0" style="bottom:92.4095px;left:317.014px;" data-x="317.014" data-y="94.3462" hs="1">a<span class="w w2"> </span>counter<span class="w w1"> </span>for<span class="w w2"> </span>each<span class="w w2"> </span>side<span class="w w1"> </span>exit,<span class="w w2"> </span>and<span class="w w1"> </span>when<span class="w w2"> </span>the<span class="w w2"> </span>counter<span class="w w1"> </span>reaches<span class="w w2"> </span>a<span class="w w1"> </span>hotness</div><div class="l f2 s4 t0" style="bottom:82.4468px;left:317.014px;" data-x="317.014" data-y="84.3835" hs="1">threshold,<span class="w w1"> </span>recording<span class="w w1"> </span>starts.<span class="w w2"> </span>Recording<span class="w w1"> </span>stops<span class="w w1"> </span>exactly<span class="w w1"> </span>as<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>root</div><div class="l f2 s4 t0" style="bottom:72.4842px;left:317.014px;" data-x="317.014" data-y="74.4209" hs="1">trace,<span class="w w2"> </span>using<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w2"> </span>header<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>root<span class="w w1"> </span>trace<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w1"> </span>target<span class="w w2"> </span>to<span class="w w1"> </span>reach.</div></div></div><div id="page-6" class="p" style="width:612px;height:792px;background-image:url(p6.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f2 s4 t0" style="bottom:710.093px;left:65.9552px;" data-x="65.9552" data-y="712.03" hs="1">Our<span class="w w2"> </span>implementation<span class="w w1"> </span>does<span class="w w1"> </span>not<span class="w w1"> </span>extend<span class="w w2"> </span>at<span class="w w1"> </span>all<span class="w w1"> </span>side<span class="w w2"> </span>exits.<span class="w w1"> </span>It<span class="w w1"> </span>extends</div><div class="l f2 s4 t0" style="bottom:700.13px;left:54px;" data-x="54" data-y="702.067" hs="1">only<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>is<span class="w w2"> </span>for<span class="w w1"> </span>a<span class="w w2"> </span>control-flow<span class="w w1"> </span>branch,<span class="w w2"> </span>and<span class="w w1"> </span>only<span class="w w2"> </span>if<span class="w w2"> </span>the<span class="w w1"> </span>side</div><div class="l f2 s4 t0" style="bottom:690.168px;left:54px;" data-x="54" data-y="692.105" hs="1">exit<span class="w w2"> </span>does<span class="w w1"> </span>not<span class="w w1"> </span>leave<span class="w w2"> </span>the<span class="w w1"> </span>loop.<span class="w w2"> </span>In<span class="w w1"> </span>particular<span class="w w1"> </span>we<span class="w w2"> </span>do<span class="w w1"> </span>not<span class="w w1"> </span>want<span class="w w2"> </span>to<span class="w w1"> </span>extend</div><div class="l f2 s4 t0" style="bottom:680.205px;left:54px;" data-x="54" data-y="682.142" hs="1">a<span class="w w1"> </span>trace<span class="w w0"> </span>tree<span class="w w1"> </span>along<span class="w w1"> </span>a<span class="w w1"> </span>path<span class="w w0"> </span>that<span class="w w1"> </span>leads<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w1"> </span>outer<span class="w w1"> </span>loop,<span class="w w1"> </span>because<span class="w w0"> </span>we</div><div class="l f2 s4 t0" style="bottom:670.243px;left:54px;" data-x="54" data-y="672.179" hs="1">want<span class="w w2"> </span>to<span class="w w1"> </span>cover<span class="w w2"> </span>such<span class="w w1"> </span>paths<span class="w w1"> </span>in<span class="w w2"> </span>an<span class="w w1"> </span>outer<span class="w w1"> </span>tree<span class="w w2"> </span>through<span class="w w1"> </span>tree</div><div class="l fa s4 t0" style="bottom:670.449px;left:246.623px;" data-x="246.623" data-y="672.179" hs="1">nesting</div><div class="l f2 s4 t0" style="bottom:670.243px;left:272.527px;" data-x="272.527" data-y="672.179" hs="1">.</div><div class="l f1 s4 t0" style="bottom:652.771px;left:54px;" data-x="54" data-y="654.645" hs="1">3.3<span class="w w10"> </span>Blacklisting</div><div class="l f2 s4 t0" style="bottom:638.761px;left:54px;" data-x="54" data-y="640.697" hs="1">Sometimes,<span class="w w0"> </span>a<span class="w w0"> </span>program<span class="w w1"> </span>follows<span class="w w0"> </span>a<span class="w w0"> </span>path<span class="w w0"> </span>that<span class="w w1"> </span>cannot<span class="w w0"> </span>be<span class="w w0"> </span>compiled</div><div class="l f2 s4 t0" style="bottom:628.798px;left:54px;" data-x="54" data-y="630.735" hs="1">into<span class="w w1"> </span>a<span class="w w1"> </span>trace,<span class="w w1"> </span>usually<span class="w w1"> </span>because<span class="w w1"> </span>of<span class="w w1"> </span>limitations<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>implementation.</div><div class="l f2 s4 t0" style="bottom:618.835px;left:54px;" data-x="54" data-y="620.772" hs="1">TraceMonkey<span class="w w1"> </span>does<span class="w w1"> </span>not<span class="w w1"> </span>currently<span class="w w0"> </span>support<span class="w w1"> </span>recording<span class="w w1"> </span>throwing<span class="w w0"> </span>and</div><div class="l f2 s4 t0" style="bottom:608.873px;left:54px;" data-x="54" data-y="610.809" hs="1">catching<span class="w w1"> </span>of<span class="w w2"> </span>arbitrary<span class="w w1"> </span>exceptions.<span class="w w1"> </span>This<span class="w w2"> </span>design<span class="w w1"> </span>trade<span class="w w1"> </span>off<span class="w w2"> </span>was<span class="w w1"> </span>chosen,</div><div class="l f2 s4 t0" style="bottom:598.91px;left:54px;" data-x="54" data-y="600.847" hs="1">because<span class="w w1"> </span>exceptions<span class="w w0"> </span>are<span class="w w1"> </span>usually<span class="w w0"> </span>rare<span class="w w1"> </span>in<span class="w w0"> </span>JavaScript.<span class="w w1"> </span>However</div><div class="l f2 s4 t0" style="bottom:598.91px;left:274.304px;" data-x="274.304" data-y="600.847" hs="1">,<span class="w w1"> </span>if<span class="w w0"> </span>a</div><div class="l f2 s4 t0" style="bottom:588.947px;left:54px;" data-x="54" data-y="590.884" hs="1">program<span class="w w0"> </span>opts<span class="w w1"> </span>to<span class="w w0"> </span>use<span class="w w1"> </span>exceptions<span class="w w0"> </span>intensively,<span class="w w1"> </span>we<span class="w w0"> </span>would<span class="w w1"> </span>suddenly</div><div class="l f2 s4 t0" style="bottom:578.985px;left:54px;" data-x="54" data-y="580.921" hs="1">incur<span class="w w1"> </span>a<span class="w w1"> </span>punishing<span class="w w1"> </span>runtime<span class="w w1"> </span>overhead<span class="w w1"> </span>if<span class="w w1"> </span>we<span class="w w1"> </span>repeatedly<span class="w w1"> </span>try<span class="w w1"> </span>to<span class="w w1"> </span>record</div><div class="l f2 s4 t0" style="bottom:569.022px;left:54px;" data-x="54" data-y="570.959" hs="1">a<span class="w w1"> </span>trace<span class="w w0"> </span>for<span class="w w1"> </span>this<span class="w w1"> </span>path<span class="w w0"> </span>and<span class="w w1"> </span>repeatedly<span class="w w1"> </span>fail<span class="w w0"> </span>to<span class="w w1"> </span>do<span class="w w1"> </span>so,<span class="w w0"> </span>since<span class="w w1"> </span>we<span class="w w1"> </span>abort</div><div class="l f2 s4 t0" style="bottom:559.06px;left:54px;" data-x="54" data-y="560.996" hs="1">tracing<span class="w w2"> </span>every<span class="w w1"> </span>time<span class="w w2"> </span>we<span class="w w1"> </span>observe<span class="w w1"> </span>an<span class="w w2"> </span>exception<span class="w w1"> </span>being<span class="w w2"> </span>thrown.</div><div class="l f2 s4 t0" style="bottom:549.097px;left:65.9552px;" data-x="65.9552" data-y="551.034" hs="1">As<span class="w w2"> </span>a<span class="w w1"> </span>result,<span class="w w2"> </span>if<span class="w w1"> </span>a<span class="w w2"> </span>hot<span class="w w2"> </span>loop<span class="w w1"> </span>contains<span class="w w2"> </span>traces<span class="w w1"> </span>that<span class="w w2"> </span>always<span class="w w2"> </span>fail,<span class="w w1"> </span>the<span class="w w2"> </span>VM</div><div class="l f2 s4 t0" style="bottom:539.134px;left:54px;" data-x="54" data-y="541.071" hs="1">could<span class="w w1"> </span>potentially<span class="w w1"> </span>run<span class="w w1"> </span>much<span class="w w1"> </span>more<span class="w w1"> </span>slowly<span class="w w1"> </span>than<span class="w w1"> </span>the<span class="w w1"> </span>base<span class="w w1"> </span>interpreter:</div><div class="l f2 s4 t0" style="bottom:529.172px;left:54px;" data-x="54" data-y="531.108" hs="1">the<span class="w w2"> </span>VM<span class="w w1"> </span>repeatedly<span class="w w1"> </span>spends<span class="w w2"> </span>time<span class="w w1"> </span>trying<span class="w w1"> </span>to<span class="w w2"> </span>record<span class="w w1"> </span>traces,<span class="w w1"> </span>but<span class="w w2"> </span>is<span class="w w1"> </span>never</div><div class="l f2 s4 t0" style="bottom:519.209px;left:54px;" data-x="54" data-y="521.146" hs="1">able<span class="w w1"> </span>to<span class="w w1"> </span>run<span class="w w2"> </span>any.<span class="w w1"> </span>To<span class="w w2"> </span>avoid<span class="w w1"> </span>this<span class="w w1"> </span>problem,<span class="w w1"> </span>whenever<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w1"> </span>is<span class="w w1"> </span>about</div><div class="l f2 s4 t0" style="bottom:509.246px;left:54px;" data-x="54" data-y="511.183" hs="1">to<span class="w w2"> </span>start<span class="w w1"> </span>tracing,<span class="w w2"> </span>it<span class="w w1"> </span>must<span class="w w2"> </span>try<span class="w w1"> </span>to<span class="w w2"> </span>predict<span class="w w1"> </span>whether<span class="w w2"> </span>it<span class="w w1"> </span>will<span class="w w2"> </span>finish<span class="w w1"> </span>the<span class="w w2"> </span>trace.</div><div class="l f2 s4 t0" style="bottom:499.284px;left:65.9552px;" data-x="65.9552" data-y="501.22" hs="1">Our<span class="w w0"> </span>prediction<span class="w w1"> </span>algorithm<span class="w w0"> </span>is<span class="w w1"> </span>based<span class="w w0"> </span>on</div><div class="l fa s4 t0" style="bottom:499.49px;left:209.431px;" data-x="209.431" data-y="501.22" hs="1">blacklisting</div><div class="l f2 s4 t0" style="bottom:499.284px;left:254.921px;" data-x="254.921" data-y="501.22" hs="1">traces<span class="w w0"> </span>that</div><div class="l f2 s4 t0" style="bottom:489.321px;left:54px;" data-x="54" data-y="491.258" hs="1">have<span class="w w2"> </span>been<span class="w w2"> </span>tried<span class="w w1"> </span>and<span class="w w2"> </span>failed.<span class="w w2"> </span>When<span class="w w1"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>fails<span class="w w2"> </span>to<span class="w w2"> </span>finish<span class="w w1"> </span>a<span class="w w2"> </span>trace<span class="w w2"> </span>start-</div><div class="l f2 s4 t0" style="bottom:479.358px;left:54px;" data-x="54" data-y="481.295" hs="1">ing<span class="w w2"> </span>at<span class="w w1"> </span>a<span class="w w2"> </span>given<span class="w w2"> </span>point,<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>records<span class="w w1"> </span>that<span class="w w2"> </span>a<span class="w w2"> </span>failure<span class="w w1"> </span>has<span class="w w2"> </span>occurred.<span class="w w1"> </span>The</div><div class="l f2 s4 t0" style="bottom:469.396px;left:54px;" data-x="54" data-y="471.333" hs="1">VM<span class="w w2"> </span>also<span class="w w2"> </span>sets<span class="w w1"> </span>a<span class="w w2"> </span>counter<span class="w w2"> </span>so<span class="w w2"> </span>that<span class="w w1"> </span>it<span class="w w2"> </span>will<span class="w w2"> </span>not<span class="w w2"> </span>try<span class="w w1"> </span>to<span class="w w2"> </span>record<span class="w w2"> </span>a<span class="w w2"> </span>trace<span class="w w1"> </span>starting</div><div class="l f2 s4 t0" style="bottom:459.433px;left:54px;" data-x="54" data-y="461.37" hs="1">at<span class="w w1"> </span>that<span class="w w1"> </span>point<span class="w w1"> </span>until<span class="w w1"> </span>it<span class="w w1"> </span>is<span class="w w1"> </span>passed<span class="w w1"> </span>a<span class="w w1"> </span>few<span class="w w1"> </span>more<span class="w w0"> </span>times<span class="w w2"> </span>(32<span class="w w1"> </span>in<span class="w w1"> </span>our<span class="w w0"> </span>imple-</div><div class="l f2 s4 t0" style="bottom:449.47px;left:54px;" data-x="54" data-y="451.407" hs="1">mentation).<span class="w w1"> </span>This</div><div class="l fa s4 t0" style="bottom:449.677px;left:117.226px;" data-x="117.226" data-y="451.407" hs="1">backoff</div><div class="l f2 s4 t0" style="bottom:449.47px;left:147.597px;" data-x="147.597" data-y="451.407" hs="1">counter<span class="w w1"> </span>gives<span class="w w1"> </span>temporary<span class="w w1"> </span>conditions<span class="w w0"> </span>that</div><div class="l f2 s4 t0" style="bottom:439.508px;left:54px;" data-x="54" data-y="441.445" hs="1">prevent<span class="w w1"> </span>tracing<span class="w w1"> </span>a<span class="w w1"> </span>chance<span class="w w1"> </span>to<span class="w w1"> </span>end.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>may<span class="w w1"> </span>behave</div><div class="l f2 s4 t0" style="bottom:429.545px;left:54px;" data-x="54" data-y="431.482" hs="1">differently<span class="w w2"> </span>during<span class="w w2"> </span>startup<span class="w w1"> </span>than<span class="w w2"> </span>during<span class="w w2"> </span>its<span class="w w1"> </span>steady-state<span class="w w2"> </span>execution.<span class="w w2"> </span>Af-</div><div class="l f2 s4 t0" style="bottom:419.583px;left:54px;" data-x="54" data-y="421.519" hs="1">ter<span class="w w1"> </span>a<span class="w w1"> </span>given<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w1"> </span>failures<span class="w w1"> </span>(2<span class="w w1"> </span>in<span class="w w1"> </span>our<span class="w w1"> </span>implementation),<span class="w w1"> </span>the<span class="w w1"> </span>VM</div><div class="l f2 s4 t0" style="bottom:409.62px;left:54px;" data-x="54" data-y="411.557" hs="1">marks<span class="w w2"> </span>the<span class="w w1"> </span>fragment<span class="w w2"> </span>as<span class="w w1"> </span>blacklisted,<span class="w w1"> </span>which<span class="w w2"> </span>means<span class="w w1"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>will<span class="w w2"> </span>never</div><div class="l f2 s4 t0" style="bottom:399.657px;left:54px;" data-x="54" data-y="401.594" hs="1">again<span class="w w2"> </span>start<span class="w w1"> </span>recording<span class="w w1"> </span>at<span class="w w2"> </span>that<span class="w w1"> </span>point.</div><div class="l f2 s4 t0" style="bottom:389.695px;left:65.9552px;" data-x="65.9552" data-y="391.631" hs="1">After<span class="w w0"> </span>implementing<span class="w w1"> </span>this<span class="w w0"> </span>basic<span class="w w1"> </span>strategy,<span class="w w0"> </span>we<span class="w w1"> </span>observed<span class="w w0"> </span>that<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:379.732px;left:54px;" data-x="54" data-y="381.669" hs="1">small<span class="w w1"> </span>loops<span class="w w2"> </span>that<span class="w w1"> </span>get<span class="w w1"> </span>blacklisted,<span class="w w1"> </span>the<span class="w w1"> </span>system<span class="w w2"> </span>can<span class="w w1"> </span>spend<span class="w w1"> </span>a<span class="w w1"> </span>noticeable</div><div class="l f2 s4 t0" style="bottom:369.769px;left:54px;" data-x="54" data-y="371.706" hs="1">amount<span class="w w2"> </span>of<span class="w w1"> </span>time<span class="w w2"> </span>just<span class="w w1"> </span>finding<span class="w w1"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>fragment<span class="w w2"> </span>and<span class="w w1"> </span>determining<span class="w w2"> </span>that</div><div class="l f2 s4 t0" style="bottom:359.807px;left:54px;" data-x="54" data-y="361.744" hs="1">it<span class="w w2"> </span>has<span class="w w1"> </span>been<span class="w w2"> </span>blacklisted.<span class="w w1"> </span>We<span class="w w2"> </span>now<span class="w w2"> </span>avoid<span class="w w1"> </span>that<span class="w w2"> </span>problem<span class="w w1"> </span>by<span class="w w2"> </span>patching<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:349.844px;left:54px;" data-x="54" data-y="351.781" hs="1">bytecode.<span class="w w1"> </span>We<span class="w w2"> </span>define<span class="w w1"> </span>an<span class="w w1"> </span>extra<span class="w w1"> </span>no-op<span class="w w1"> </span>bytecode<span class="w w2"> </span>that<span class="w w1"> </span>indicates<span class="w w1"> </span>a<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:339.881px;left:54px;" data-x="54" data-y="341.818" hs="1">header.<span class="w w1"> </span>The<span class="w w1"> </span>VM<span class="w w1"> </span>calls<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor<span class="w w0"> </span>ev</div><div class="l f2 s4 t0" style="bottom:339.881px;left:226.729px;" data-x="226.729" data-y="341.818" hs="1">ery<span class="w w1"> </span>time<span class="w w1"> </span>the<span class="w w1"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:329.919px;left:54px;" data-x="54" data-y="331.856" hs="1">preter<span class="w w1"> </span>executes<span class="w w1"> </span>a<span class="w w0"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>no-op.<span class="w w1"> </span>To<span class="w w1"> </span>blacklist<span class="w w1"> </span>a<span class="w w0"> </span>fragment,<span class="w w1"> </span>we</div><div class="l f2 s4 t0" style="bottom:319.956px;left:54px;" data-x="54" data-y="321.893" hs="1">simply<span class="w w1"> </span>replace<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>no-op<span class="w w1"> </span>with<span class="w w1"> </span>a<span class="w w1"> </span>regular<span class="w w1"> </span>no-op.<span class="w w0"> </span>Thus,</div><div class="l f2 s4 t0" style="bottom:309.994px;left:54px;" data-x="54" data-y="311.93" hs="1">the<span class="w w2"> </span>interpreter<span class="w w1"> </span>will<span class="w w1"> </span>never<span class="w w2"> </span>again<span class="w w1"> </span>even<span class="w w2"> </span>call<span class="w w1"> </span>into<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor.</div><div class="l f2 s4 t0" style="bottom:300.031px;left:65.9552px;" data-x="65.9552" data-y="301.968" hs="1">There<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>related<span class="w w2"> </span>problem<span class="w w1"> </span>we<span class="w w2"> </span>have<span class="w w1"> </span>not<span class="w w2"> </span>yet<span class="w w2"> </span>solved,<span class="w w1"> </span>which<span class="w w2"> </span>occurs</div><div class="l f2 s4 t0" style="bottom:290.068px;left:54px;" data-x="54" data-y="292.005" hs="1">when<span class="w w2"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>meets<span class="w w2"> </span>all<span class="w w1"> </span>of<span class="w w1"> </span>these<span class="w w2"> </span>conditions:</div><div class="l f3 s3 t0" style="bottom:276.513px;left:59.2303px;" data-x="59.2303" data-y="278.059" hs="1">•</div><div class="l f2 s4 t0" style="bottom:275.224px;left:66.9514px;" data-x="66.9514" data-y="277.161" hs="1">The<span class="w w2"> </span>VM<span class="w w1"> </span>can<span class="w w1"> </span>form<span class="w w2"> </span>at<span class="w w1"> </span>least<span class="w w1"> </span>one<span class="w w2"> </span>root<span class="w w1"> </span>trace<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>loop.</div><div class="l f3 s3 t0" style="bottom:262.565px;left:59.2303px;" data-x="59.2303" data-y="264.111" hs="1">•</div><div class="l f2 s4 t0" style="bottom:261.276px;left:66.9514px;" data-x="66.9514" data-y="263.213" hs="1">There<span class="w w1"> </span>is<span class="w w0"> </span>at<span class="w w1"> </span>least<span class="w w0"> </span>one<span class="w w1"> </span>hot<span class="w w0"> </span>side<span class="w w1"> </span>exit<span class="w w0"> </span>for<span class="w w1"> </span>which<span class="w w1"> </span>the<span class="w w0"> </span>VM<span class="w w1"> </span>cannot</div><div class="l f2 s4 t0" style="bottom:251.314px;left:66.9514px;" data-x="66.9514" data-y="253.25" hs="1">complete<span class="w w2"> </span>a<span class="w w1"> </span>trace.</div><div class="l f3 s3 t0" style="bottom:238.655px;left:59.2303px;" data-x="59.2303" data-y="240.201" hs="1">•</div><div class="l f2 s4 t0" style="bottom:237.366px;left:66.9514px;" data-x="66.9514" data-y="239.303" hs="1">The<span class="w w2"> </span>loop<span class="w w1"> </span>body<span class="w w1"> </span>is<span class="w w2"> </span>short.</div><div class="l f2 s4 t0" style="bottom:222.522px;left:65.9551px;" data-x="65.9551" data-y="224.458" hs="1">In<span class="w w2"> </span>this<span class="w w1"> </span>case,<span class="w w2"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>will<span class="w w2"> </span>repeatedly<span class="w w1"> </span>pass<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>header,<span class="w w2"> </span>search</div><div class="l f2 s4 t0" style="bottom:212.559px;left:54px;" data-x="54" data-y="214.496" hs="1">for<span class="w w0"> </span>a<span class="w w0"> </span>trace,<span class="w w1"> </span>find<span class="w w0"> </span>it,<span class="w w0"> </span>execute<span class="w w0"> </span>it,<span class="w w0"> </span>and<span class="w w0"> </span>fall<span class="w w1"> </span>back<span class="w w0"> </span>to<span class="w w0"> </span>the<span class="w w0"> </span>interpreter.</div><div class="l f2 s4 t0" style="bottom:202.596px;left:54px;" data-x="54" data-y="204.533" hs="1">With<span class="w w1"> </span>a<span class="w w0"> </span>short<span class="w w1"> </span>loop<span class="w w0"> </span>body</div><div class="l f2 s4 t0" style="bottom:202.596px;left:141.091px;" data-x="141.091" data-y="204.533" hs="1">,<span class="w w1"> </span>the<span class="w w0"> </span>overhead<span class="w w1"> </span>of<span class="w w0"> </span>finding<span class="w w1"> </span>and<span class="w w0"> </span>calling<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:192.634px;left:54px;" data-x="54" data-y="194.57" hs="1">trace<span class="w w1"> </span>is<span class="w w1"> </span>high,<span class="w w1"> </span>and<span class="w w0"> </span>causes<span class="w w1"> </span>performance<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>even<span class="w w1"> </span>slower<span class="w w1"> </span>than<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:182.671px;left:54px;" data-x="54" data-y="184.608" hs="1">basic<span class="w w1"> </span>interpreter.<span class="w w0"> </span>So<span class="w w1"> </span>far,<span class="w w0"> </span>in<span class="w w1"> </span>this<span class="w w0"> </span>situation<span class="w w1"> </span>we<span class="w w0"> </span>have<span class="w w1"> </span>improved<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:172.708px;left:54px;" data-x="54" data-y="174.645" hs="1">implementation<span class="w w0"> </span>so<span class="w w1"> </span>that<span class="w w0"> </span>the<span class="w w0"> </span>VM<span class="w w1"> </span>can<span class="w w0"> </span>complete<span class="w w0"> </span>the<span class="w w0"> </span>branch<span class="w w1"> </span>trace.</div><div class="l f2 s4 t0" style="bottom:162.746px;left:54px;" data-x="54" data-y="164.683" hs="1">But<span class="w w1"> </span>it<span class="w w0"> </span>is<span class="w w1"> </span>hard<span class="w w0"> </span>to<span class="w w1"> </span>guarantee<span class="w w0"> </span>that<span class="w w1"> </span>this<span class="w w1"> </span>situation<span class="w w0"> </span>will<span class="w w1"> </span>never<span class="w w0"> </span>happen.</div><div class="l f2 s4 t0" style="bottom:152.783px;left:54px;" data-x="54" data-y="154.72" hs="1">As<span class="w w1"> </span>future<span class="w w1"> </span>work,<span class="w w0"> </span>this<span class="w w1"> </span>situation<span class="w w1"> </span>could<span class="w w1"> </span>be<span class="w w0"> </span>avoided<span class="w w1"> </span>by<span class="w w1"> </span>detecting<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:142.82px;left:54px;" data-x="54" data-y="144.757" hs="1">blacklisting<span class="w w1"> </span>loops<span class="w w0"> </span>for<span class="w w1"> </span>which<span class="w w0"> </span>the<span class="w w0"> </span>av</div><div class="l f2 s4 t0" style="bottom:142.82px;left:184.945px;" data-x="184.945" data-y="144.757" hs="1">erage<span class="w w1"> </span>trace<span class="w w0"> </span>call<span class="w w1"> </span>executes<span class="w w0"> </span>few</div><div class="l f2 s4 t0" style="bottom:132.858px;left:54px;" data-x="54" data-y="134.794" hs="1">bytecodes<span class="w w2"> </span>before<span class="w w1"> </span>returning<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>interpreter.</div><div class="l f1 s2 t0" style="bottom:109.989px;left:54px;" data-x="54" data-y="112.279" hs="1">4.<span class="w w3"> </span>Nested<span class="w w1"> </span>Trace<span class="w w2"> </span>Tree<span class="w w2"> </span>Formation</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:54px;" data-x="54" data-y="98.3313" hs="1">Figure<span class="w w2"> </span>7<span class="w w1"> </span>shows<span class="w w2"> </span>basic<span class="w w2"> </span>trace<span class="w w1"> </span>tree<span class="w w2"> </span>compilation<span class="w w1"> </span>(11)<span class="w w2"> </span>applied<span class="w w2"> </span>to<span class="w w1"> </span>a<span class="w w2"> </span>nested</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:54px;" data-x="54" data-y="88.3686" hs="1">loop<span class="w w1"> </span>where<span class="w w0"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>contains<span class="w w0"> </span>two<span class="w w1"> </span>paths.<span class="w w1"> </span>Usually,<span class="w w1"> </span>the<span class="w w0"> </span>inner</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:54px;" data-x="54" data-y="78.406" hs="1">loop<span class="w w2"> </span>(with<span class="w w1"> </span>header<span class="w w2"> </span>at</div><div class="l ff s4 t0" style="bottom:76.6665px;left:127.814px;" data-x="127.814" data-y="78.406" hs="1">i</div><div class="l f8 s5 t0" style="bottom:76.2501px;left:130.967px;" data-x="130.967" data-y="77.4098" hs="1">2</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:135.118px;" data-x="135.118" data-y="78.406" hs="1">)<span class="w w2"> </span>becomes<span class="w w1"> </span>hot<span class="w w2"> </span>first,<span class="w w1"> </span>and<span class="w w1"> </span>a<span class="w w2"> </span>trace<span class="w w1"> </span>tree<span class="w w2"> </span>is<span class="w w1"> </span>rooted</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:54px;" data-x="54" data-y="68.4434" hs="1">at<span class="w w1"> </span>that<span class="w w1"> </span>point.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w1"> </span>recorded<span class="w w1"> </span>trace<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w1"> </span>a<span class="w w1"> </span>cycle</div></div><div class="t t16"><div class="l f11 s7 t17" style="bottom:8.23099px;left:-5.94141px;" data-x="407.908" data-y="702.485" hs="1">T</div></div><div class="t t18"><div class="l f11 s7 t2" style="bottom:3.731px;left:-28.6289px;" data-x="449.541" data-y="683.903" hs="1">T</div><div class="l f11 s7 t2" style="bottom:3.731px;left:-23.3027px;" data-x="451.523" data-y="683.903" hs="1">runk T</div><div class="l f11 s7 t2" style="bottom:3.731px;left:7.64062px;" data-x="463.038" data-y="683.903" hs="1">r</div><div class="l f11 s7 t2" style="bottom:3.731px;left:11.6426px;" data-x="464.527" data-y="683.903" hs="1">ace</div></div><div class="t t19"><div class="l f11 s7 t2" style="bottom:3.731px;left:-30.0703px;" data-x="449.004" data-y="693.951" hs="1">T</div><div class="l f11 s7 t2" style="bottom:3.731px;left:-24.7441px;" data-x="450.986" data-y="693.951" hs="1">r</div><div class="l f11 s7 t2" style="bottom:3.731px;left:-20.6133px;" data-x="452.524" data-y="693.951" hs="1">ee Anchor</div></div><div class="t t1a"><div class="l f11 s7 t2" style="bottom:3.731px;left:-32.458px;" data-x="448.116" data-y="673.856" hs="1">T</div><div class="l f11 s7 t2" style="bottom:3.731px;left:-27.1318px;" data-x="450.098" data-y="673.856" hs="1">r</div><div class="l f11 s7 t2" style="bottom:3.731px;left:-23.1299px;" data-x="451.587" data-y="673.856" hs="1">ace Anchor</div></div><div class="t t1b"><div class="l f11 s7 t2" style="bottom:3.731px;left:-31.79px;" data-x="448.364" data-y="663.808" hs="1">Br</div><div class="l f11 s7 t2" style="bottom:3.731px;left:-21.0615px;" data-x="452.357" data-y="663.808" hs="1">anch T</div><div class="l f11 s7 t2" style="bottom:3.731px;left:10.8018px;" data-x="464.214" data-y="663.808" hs="1">r</div><div class="l f11 s7 t2" style="bottom:3.731px;left:14.8037px;" data-x="465.703" data-y="663.808" hs="1">ace</div></div><div class="t t1c"><div class="l f11 s7 t2" style="bottom:3.731px;left:-15.2842px;" data-x="454.507" data-y="653.761" hs="1">Guar</div><div class="l f11 s7 t2" style="bottom:3.731px;left:8.84473px;" data-x="463.486" data-y="653.761" hs="1">d</div></div><div class="t t1d"><div class="l f11 s7 t2" style="bottom:3.731px;left:-21.1436px;" data-x="452.326" data-y="643.713" hs="1">Side Exit</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:560.476px;left:317.014px;" data-x="317.014" data-y="562.35" hs="1">Figure<span class="w w1"> </span>5.</div><div class="l f2 s4 t0" style="bottom:560.413px;left:357.068px;" data-x="357.068" data-y="562.35" hs="1">A<span class="w w1"> </span>tree<span class="w w0"> </span>with<span class="w w1"> </span>two<span class="w w0"> </span>traces,<span class="w w1"> </span>a<span class="w w0"> </span>trunk<span class="w w1"> </span>trace<span class="w w0"> </span>and<span class="w w1"> </span>one<span class="w w0"> </span>branch</div><div class="l f2 s4 t0" style="bottom:550.45px;left:317.014px;" data-x="317.014" data-y="552.387" hs="1">trace.<span class="w w2"> </span>The<span class="w w1"> </span>trunk<span class="w w1"> </span>trace<span class="w w2"> </span>contains<span class="w w1"> </span>a<span class="w w2"> </span>guard<span class="w w1"> </span>to<span class="w w1"> </span>which<span class="w w2"> </span>a<span class="w w1"> </span>branch<span class="w w2"> </span>trace<span class="w w1"> </span>was</div><div class="l f2 s4 t0" style="bottom:540.488px;left:317.014px;" data-x="317.014" data-y="542.424" hs="1">attached.<span class="w w2"> </span>The<span class="w w1"> </span>branch<span class="w w2"> </span>trace<span class="w w1"> </span>contain<span class="w w2"> </span>a<span class="w w1"> </span>guard<span class="w w2"> </span>that<span class="w w1"> </span>may<span class="w w2"> </span>fail<span class="w w1"> </span>and<span class="w w2"> </span>trigger</div><div class="l f2 s4 t0" style="bottom:530.525px;left:317.014px;" data-x="317.014" data-y="532.462" hs="1">a<span class="w w2"> </span>side<span class="w w1"> </span>exit.<span class="w w2"> </span>Both<span class="w w2"> </span>the<span class="w w1"> </span>trunk<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w2"> </span>branch<span class="w w1"> </span>trace<span class="w w2"> </span>loop<span class="w w1"> </span>back<span class="w w2"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>tree</div><div class="l f2 s4 t0" style="bottom:520.562px;left:317.014px;" data-x="317.014" data-y="522.499" hs="1">anchor,<span class="w w2"> </span>which<span class="w w1"> </span>is<span class="w w2"> </span>the<span class="w w1"> </span>beginning<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>tree.</div></div><div class="t t1e"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="400.607" data-y="492.915" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="402.676" data-y="492.915" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="404.231" data-y="492.915" hs="1">ace 2</div></div><div class="t t20"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="367.039" data-y="492.916" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="369.109" data-y="492.916" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="370.663" data-y="492.916" hs="1">ace 1</div></div><div class="t t21"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="490.121" data-y="492.916" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="492.191" data-y="492.916" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="493.745" data-y="492.916" hs="1">ace 2</div></div><div class="t t22"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="456.553" data-y="492.916" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="458.623" data-y="492.916" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="460.178" data-y="492.916" hs="1">ace 1</div></div><div class="t t23"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.7573px;" data-x="367.446" data-y="426.237" hs="1">Closed</div></div><div class="t t24"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.4888px;" data-x="401.139" data-y="426.238" hs="1">Link</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:3.08838px;" data-x="408.867" data-y="426.238" hs="1">ed</div></div><div class="t t25"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.4888px;" data-x="457.085" data-y="426.238" hs="1">Link</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:3.08838px;" data-x="464.814" data-y="426.238" hs="1">ed</div></div><div class="t t26"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.4888px;" data-x="490.653" data-y="426.238" hs="1">Link</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:3.08838px;" data-x="498.381" data-y="426.238" hs="1">ed</div></div><div class="t t27"><div class="l f12 s7 t28" style="bottom:2.731px;left:-19px;" data-x="358.474" data-y="386.695" hs="1">Number</div></div><div class="t t29"><div class="l f12 s7 t28" style="bottom:2.731px;left:-19px;" data-x="397.637" data-y="348.759" hs="1">Number</div></div><div class="t t2a"><div class="l f12 s7 t28" style="bottom:2.731px;left:-15px;" data-x="485.924" data-y="384.83" hs="1">String</div></div><div class="t t2b"><div class="l f12 s7 t28" style="bottom:2.731px;left:-4.44922px;" data-x="441.718" data-y="348.759" hs="1">String</div></div><div class="t t2c"><div class="l f12 s7 t28" style="bottom:2.731px;left:-15px;" data-x="485.924" data-y="349.398" hs="1">String</div></div><div class="t t2d"><div class="l f12 s7 t28" style="bottom:2.731px;left:-15px;" data-x="362.204" data-y="341.938" hs="1">String</div></div><div class="t t2e"><div class="l f12 s7 t28" style="bottom:2.731px;left:-6.32031px;" data-x="441.778" data-y="386.056" hs="1">Boolean</div></div><div class="t t2f"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="431.112" data-y="402.176" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="433.182" data-y="402.176" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="434.736" data-y="402.176" hs="1">ace 2</div></div><div class="t t30"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="367.039" data-y="402.176" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="369.109" data-y="402.176" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="370.663" data-y="402.176" hs="1">ace 1</div></div><div class="t t31"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-14.6289px;" data-x="490.76" data-y="402.176" hs="1">T</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-10.1904px;" data-x="492.829" data-y="402.176" hs="1">r</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:-6.85547px;" data-x="494.384" data-y="402.176" hs="1">ace 3</div></div><div class="t t32"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.4888px;" data-x="367.571" data-y="328.504" hs="1">Link</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:3.08838px;" data-x="375.299" data-y="328.504" hs="1">ed</div></div><div class="t t33"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.4888px;" data-x="406.733" data-y="332.234" hs="1">Link</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:3.08838px;" data-x="414.462" data-y="332.234" hs="1">ed</div></div><div class="t t34"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.4888px;" data-x="431.644" data-y="332.234" hs="1">Link</div><div class="l f12 s7 t1f" style="bottom:3.231px;left:3.08838px;" data-x="439.372" data-y="332.234" hs="1">ed</div></div><div class="t t35"><div class="l f12 s7 t1f" style="bottom:3.231px;left:-13.7573px;" data-x="490.528" data-y="332.009" hs="1">Closed</div></div><div class="t t36"><div class="l f12 s7 t28" style="bottom:2.731px;left:-19px;" data-x="358.474" data-y="477.435" hs="1">Number</div></div><div class="t t37"><div class="l f12 s7 t28" style="bottom:2.731px;left:-19px;" data-x="358.474" data-y="438.273" hs="1">Number</div></div><div class="t t38"><div class="l f12 s7 t28" style="bottom:2.731px;left:-6.23438px;" data-x="410.115" data-y="438.273" hs="1">Number</div></div><div class="t t39"><div class="l f12 s7 t28" style="bottom:2.731px;left:-6.32031px;" data-x="410.075" data-y="477.435" hs="1">Boolean</div></div><div class="t t3a"><div class="l f12 s7 t28" style="bottom:2.731px;left:-19px;" data-x="447.988" data-y="477.435" hs="1">Number</div></div><div class="t t3b"><div class="l f12 s7 t28" style="bottom:2.731px;left:-19px;" data-x="447.988" data-y="438.273" hs="1">Boolean</div></div><div class="t t3c"><div class="l f12 s7 t28" style="bottom:2.731px;left:-6.23438px;" data-x="499.63" data-y="438.273" hs="1">Number</div></div><div class="t t3d"><div class="l f12 s7 t28" style="bottom:2.731px;left:-6.32031px;" data-x="499.59" data-y="477.435" hs="1">Boolean</div></div><div class="t t3e"><div class="l f12 s7 t3f" style="bottom:4.231px;left:-7.63379px;" data-x="387.084" data-y="418.458" hs="1">(a)</div></div><div class="t t40"><div class="l f12 s7 t3f" style="bottom:4.231px;left:-7.73535px;" data-x="476.151" data-y="419.073" hs="1">(b)</div></div><div class="t t41"><div class="l f12 s7 t3f" style="bottom:4.231px;left:-7.08106px;" data-x="436.062" data-y="321.891" hs="1">(c)</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:291.866px;left:317.014px;" data-x="317.014" data-y="293.74" hs="1">Figure<span class="w w0"> </span>6.</div><div class="l f2 s4 t0" style="bottom:291.803px;left:357.371px;" data-x="357.371" data-y="293.74" hs="1">We<span class="w w1"> </span>handle<span class="w w0"> </span>type-unstable<span class="w w0"> </span>loops<span class="w w1"> </span>by<span class="w w0"> </span>allowing<span class="w w1"> </span>traces<span class="w w0"> </span>to</div><div class="l f2 s4 t0" style="bottom:281.841px;left:317.014px;" data-x="317.014" data-y="283.778" hs="1">compile<span class="w w1"> </span>that<span class="w w0"> </span>cannot<span class="w w1"> </span>loop<span class="w w0"> </span>back<span class="w w1"> </span>to<span class="w w1"> </span>themselves<span class="w w0"> </span>due<span class="w w1"> </span>to<span class="w w0"> </span>a<span class="w w1"> </span>type<span class="w w1"> </span>mis-</div><div class="l f2 s4 t0" style="bottom:271.878px;left:317.014px;" data-x="317.014" data-y="273.815" hs="1">match.<span class="w w2"> </span>As<span class="w w1"> </span>such<span class="w w2"> </span>traces<span class="w w1"> </span>accumulate,<span class="w w2"> </span>we<span class="w w2"> </span>attempt<span class="w w1"> </span>to<span class="w w2"> </span>connect<span class="w w1"> </span>their<span class="w w2"> </span>loop</div><div class="l f2 s4 t0" style="bottom:261.916px;left:317.014px;" data-x="317.014" data-y="263.852" hs="1">edges<span class="w w2"> </span>to<span class="w w1"> </span>form<span class="w w2"> </span>groups<span class="w w1"> </span>of<span class="w w1"> </span>trace<span class="w w2"> </span>trees<span class="w w1"> </span>that<span class="w w2"> </span>can<span class="w w1"> </span>execute<span class="w w2"> </span>without<span class="w w1"> </span>having</div><div class="l f2 s4 t0" style="bottom:251.953px;left:317.014px;" data-x="317.014" data-y="253.89" hs="1">to<span class="w w1"> </span>side-exit<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>to<span class="w w1"> </span>cover<span class="w w1"> </span>odd<span class="w w1"> </span>type<span class="w w1"> </span>cases.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w1"> </span>par-</div><div class="l f2 s4 t0" style="bottom:241.99px;left:317.014px;" data-x="317.014" data-y="243.927" hs="1">ticularly<span class="w w2"> </span>important<span class="w w1"> </span>for<span class="w w2"> </span>nested<span class="w w1"> </span>trace<span class="w w2"> </span>trees<span class="w w2"> </span>where<span class="w w1"> </span>an<span class="w w2"> </span>outer<span class="w w1"> </span>tree<span class="w w2"> </span>tries<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:232.028px;left:317.014px;" data-x="317.014" data-y="233.964" hs="1">call<span class="w w2"> </span>an<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w2"> </span>(or<span class="w w1"> </span>in<span class="w w2"> </span>this<span class="w w1"> </span>case<span class="w w1"> </span>a<span class="w w2"> </span>forest<span class="w w1"> </span>of<span class="w w2"> </span>inner<span class="w w1"> </span>trees),<span class="w w1"> </span>since<span class="w w2"> </span>inner</div><div class="l f2 s4 t0" style="bottom:222.065px;left:317.014px;" data-x="317.014" data-y="224.002" hs="1">loops<span class="w w2"> </span>frequently<span class="w w1"> </span>have<span class="w w2"> </span>initially<span class="w w1"> </span>undefined<span class="w w2"> </span>values<span class="w w1"> </span>which<span class="w w1"> </span>change<span class="w w2"> </span>type</div><div class="l f2 s4 t0" style="bottom:212.102px;left:317.014px;" data-x="317.014" data-y="214.039" hs="1">to<span class="w w2"> </span>a<span class="w w1"> </span>concrete<span class="w w1"> </span>value<span class="w w2"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>first<span class="w w1"> </span>iteration.</div><div class="l f2 s4 t0" style="bottom:186.058px;left:317.014px;" data-x="317.014" data-y="187.995" hs="1">through<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>loop,</div><div class="l f6 s4 t0" style="bottom:186.256px;left:407.042px;" data-x="407.042" data-y="187.995" hs="1">{</div><div class="l ff s4 t0" style="bottom:186.256px;left:411.65px;" data-x="411.65" data-y="187.995" hs="1">i</div><div class="l f8 s5 t0" style="bottom:185.839px;left:414.803px;" data-x="414.803" data-y="186.999" hs="1">2</div><div class="l ff s4 t0" style="bottom:186.256px;left:418.954px;" data-x="418.954" data-y="187.995" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:185.839px;left:426.203px;" data-x="426.203" data-y="186.999" hs="1">3</div><div class="l ff s4 t0" style="bottom:186.256px;left:430.354px;" data-x="430.354" data-y="187.995" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:185.839px;left:437.603px;" data-x="437.604" data-y="186.999" hs="1">5</div><div class="l ff s4 t0" style="bottom:186.256px;left:441.755px;" data-x="441.755" data-y="187.995" hs="1">,<span class="w w2"> </span>α</div><div class="l f6 s4 t0" style="bottom:186.256px;left:451.763px;" data-x="451.763" data-y="187.995" hs="1">}</div><div class="l f2 s4 t0" style="bottom:186.058px;left:456.371px;" data-x="456.371" data-y="187.995" hs="1">.<span class="w w1"> </span>The</div><div class="l ff s4 t0" style="bottom:186.256px;left:479.839px;" data-x="479.839" data-y="187.995" hs="1">α</div><div class="l f2 s4 t0" style="bottom:186.058px;left:489.394px;" data-x="489.394" data-y="187.995" hs="1">symbol<span class="w w1"> </span>is<span class="w w0"> </span>used<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:176.096px;left:317.014px;" data-x="317.014" data-y="178.032" hs="1">indicate<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>loops<span class="w w1"> </span>back<span class="w w1"> </span>the<span class="w w2"> </span>tree<span class="w w1"> </span>anchor.</div><div class="l f2 s4 t0" style="bottom:166.133px;left:328.969px;" data-x="328.969" data-y="168.07" hs="1">When<span class="w w2"> </span>execution<span class="w w1"> </span>leaves<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop,<span class="w w1"> </span>the<span class="w w2"> </span>basic<span class="w w1"> </span>design<span class="w w1"> </span>has<span class="w w2"> </span>two</div><div class="l f2 s4 t0" style="bottom:156.17px;left:317.014px;" data-x="317.014" data-y="158.107" hs="1">choices.<span class="w w2"> </span>First,<span class="w w1"> </span>the<span class="w w2"> </span>system<span class="w w2"> </span>can<span class="w w1"> </span>stop<span class="w w2"> </span>tracing<span class="w w2"> </span>and<span class="w w1"> </span>give<span class="w w2"> </span>up<span class="w w2"> </span>on<span class="w w1"> </span>compiling</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.144" hs="1">the<span class="w w1"> </span>outer<span class="w w2"> </span>loop,<span class="w w1"> </span>clearly<span class="w w1"> </span>an<span class="w w1"> </span>undesirable<span class="w w2"> </span>solution.<span class="w w1"> </span>The<span class="w w1"> </span>other<span class="w w1"> </span>choice<span class="w w1"> </span>is</div><div class="l f2 s4 t0" style="bottom:136.245px;left:317.014px;" data-x="317.014" data-y="138.182" hs="1">to<span class="w w1"> </span>continue<span class="w w1"> </span>tracing,<span class="w w1"> </span>compiling<span class="w w1"> </span>traces<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w0"> </span>loop<span class="w w2"> </span>inside<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">inner<span class="w w2"> </span>loop’s<span class="w w1"> </span>trace<span class="w w2"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:116.32px;left:328.969px;" data-x="328.969" data-y="118.257" hs="1">For<span class="w w1"> </span>example,<span class="w w2"> </span>the<span class="w w1"> </span>program<span class="w w1"> </span>might<span class="w w1"> </span>exit<span class="w w1"> </span>at</div><div class="l ff s4 t0" style="bottom:116.517px;left:474.128px;" data-x="474.128" data-y="118.257" hs="1">i</div><div class="l f8 s5 t0" style="bottom:116.101px;left:477.281px;" data-x="477.281" data-y="117.26" hs="1">5</div><div class="l f2 s4 t0" style="bottom:116.32px;left:484.047px;" data-x="484.047" data-y="118.257" hs="1">and<span class="w w1"> </span>record<span class="w w1"> </span>a<span class="w w2"> </span>branch</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">trace<span class="w w0"> </span>that<span class="w w4"> </span>incorporates<span class="w w0"> </span>the<span class="w w4"> </span>outer<span class="w w0"> </span>loop:</div><div class="l f6 s4 t0" style="bottom:106.554px;left:470.346px;" data-x="470.346" data-y="108.294" hs="1">{</div><div class="l ff s4 t0" style="bottom:106.554px;left:474.954px;" data-x="474.954" data-y="108.294" hs="1">i</div><div class="l f8 s5 t0" style="bottom:106.138px;left:478.108px;" data-x="478.108" data-y="107.298" hs="1">5</div><div class="l ff s4 t0" style="bottom:106.554px;left:482.259px;" data-x="482.259" data-y="108.294" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:106.138px;left:489.508px;" data-x="489.508" data-y="107.298" hs="1">7</div><div class="l ff s4 t0" style="bottom:106.554px;left:493.659px;" data-x="493.659" data-y="108.294" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:106.138px;left:500.908px;" data-x="500.908" data-y="107.298" hs="1">1</div><div class="l ff s4 t0" style="bottom:106.554px;left:505.059px;" data-x="505.059" data-y="108.294" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:106.138px;left:512.308px;" data-x="512.308" data-y="107.298" hs="1">6</div><div class="l ff s4 t0" style="bottom:106.554px;left:516.459px;" data-x="516.459" data-y="108.294" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:106.138px;left:523.708px;" data-x="523.708" data-y="107.298" hs="1">7</div><div class="l ff s4 t0" style="bottom:106.554px;left:527.859px;" data-x="527.859" data-y="108.294" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:106.138px;left:535.108px;" data-x="535.108" data-y="107.298" hs="1">1</div><div class="l ff s4 t0" style="bottom:106.554px;left:539.259px;" data-x="539.259" data-y="108.294" hs="1">,<span class="w w2"> </span>α</div><div class="l f6 s4 t0" style="bottom:106.554px;left:549.268px;" data-x="549.268" data-y="108.294" hs="1">}</div><div class="l f2 s4 t0" style="bottom:106.357px;left:553.875px;" data-x="553.875" data-y="108.294" hs="1">.</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:317.014px;" data-x="317.014" data-y="98.3312" hs="1">Later,<span class="w w0"> </span>the<span class="w w1"> </span>program<span class="w w0"> </span>might<span class="w w0"> </span>take<span class="w w0"> </span>the<span class="w w1"> </span>other<span class="w w0"> </span>branch<span class="w w0"> </span>at</div><div class="l ff s4 t0" style="bottom:96.5917px;left:512.199px;" data-x="512.199" data-y="98.3312" hs="1">i</div><div class="l f8 s5 t0" style="bottom:96.1753px;left:515.352px;" data-x="515.352" data-y="97.335" hs="1">2</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:523.616px;" data-x="523.616" data-y="98.3312" hs="1">and<span class="w w0"> </span>then</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">exit,<span class="w w1"> </span>recording<span class="w w1"> </span>another<span class="w w1"> </span>branch<span class="w w0"> </span>trace<span class="w w2"> </span>incorporating<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop:</div><div class="l f6 s4 t0" style="bottom:76.6665px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">{</div><div class="l ff s4 t0" style="bottom:76.6665px;left:321.621px;" data-x="321.621" data-y="78.406" hs="1">i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:324.775px;" data-x="324.775" data-y="77.4097" hs="1">2</div><div class="l ff s4 t0" style="bottom:76.6665px;left:328.926px;" data-x="328.926" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:336.175px;" data-x="336.175" data-y="77.4097" hs="1">4</div><div class="l ff s4 t0" style="bottom:76.6665px;left:340.326px;" data-x="340.326" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:347.575px;" data-x="347.575" data-y="77.4097" hs="1">5</div><div class="l ff s4 t0" style="bottom:76.6665px;left:351.726px;" data-x="351.726" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:358.975px;" data-x="358.975" data-y="77.4097" hs="1">7</div><div class="l ff s4 t0" style="bottom:76.6665px;left:363.126px;" data-x="363.126" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:370.375px;" data-x="370.375" data-y="77.4097" hs="1">1</div><div class="l ff s4 t0" style="bottom:76.6665px;left:374.526px;" data-x="374.526" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:381.775px;" data-x="381.775" data-y="77.4097" hs="1">6</div><div class="l ff s4 t0" style="bottom:76.6665px;left:385.926px;" data-x="385.926" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:393.176px;" data-x="393.176" data-y="77.4097" hs="1">7</div><div class="l ff s4 t0" style="bottom:76.6665px;left:397.327px;" data-x="397.327" data-y="78.406" hs="1">,<span class="w w2"> </span>i</div><div class="l f8 s5 t0" style="bottom:76.25px;left:404.576px;" data-x="404.576" data-y="77.4097" hs="1">1</div><div class="l ff s4 t0" style="bottom:76.6665px;left:408.727px;" data-x="408.727" data-y="78.406" hs="1">,<span class="w w2"> </span>α</div><div class="l f6 s4 t0" style="bottom:76.6665px;left:418.735px;" data-x="418.735" data-y="78.406" hs="1">}</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:423.343px;" data-x="423.343" data-y="78.406" hs="1">.<span class="w w2"> </span>Thus,<span class="w w1"> </span>the<span class="w w2"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>is<span class="w w1"> </span>recorded<span class="w w2"> </span>and</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">compiled<span class="w w2"> </span>twice,<span class="w w2"> </span>and<span class="w w1"> </span>both<span class="w w2"> </span>copies<span class="w w2"> </span>must<span class="w w2"> </span>be<span class="w w1"> </span>retained<span class="w w2"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>cache.</div></div></div><div id="page-7" class="p" style="width:612px;height:792px;background-image:url(p7.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"></div><div class="t t42"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.25343px;" data-x="133.648" data-y="685.424" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.814957px;" data-x="134.852" data-y="685.424" hs="1">2</div></div><div class="t t43"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="120.938" data-y="659.087" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="122.141" data-y="659.087" hs="1">3</div></div><div class="t t44"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.25343px;" data-x="146.138" data-y="659.087" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.814957px;" data-x="147.341" data-y="659.087" hs="1">4</div></div><div class="t t45"><div class="l f13 s7 t3f" style="bottom:4.23094px;left:-4.25343px;" data-x="133.823" data-y="637.276" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.23094px;left:-0.814957px;" data-x="135.027" data-y="637.276" hs="1">5</div></div><div class="t t46"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.25343px;" data-x="133.363" data-y="707.212" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.814957px;" data-x="134.566" data-y="707.212" hs="1">1</div></div><div class="t t47"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="102.522" data-y="659.973" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="103.726" data-y="659.973" hs="1">6</div></div><div class="t t48"><div class="l f13 s7 t3f" style="bottom:4.23094px;left:-4.25343px;" data-x="133.363" data-y="615.53" hs="1">i</div><div class="l f13 s7 t1f" style="bottom:4.23094px;left:-0.814957px;" data-x="134.566" data-y="615.53" hs="1">7</div></div><div class="t t49"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.96094px;" data-x="178.122" data-y="706.102" hs="1">t</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.107422px;" data-x="179.82" data-y="706.102" hs="1">1</div></div><div class="t t4a"><div class="l f13 s7 t3f" style="bottom:4.231px;left:-4.96094px;" data-x="209.557" data-y="662.287" hs="1">t</div><div class="l f13 s7 t1f" style="bottom:4.231px;left:-0.107422px;" data-x="211.256" data-y="662.287" hs="1">2</div></div><div class="t t4b"><div class="l f13 s7 t2" style="bottom:3.731px;left:-21.2109px;" data-x="222.77" data-y="696.967" hs="1">T</div><div class="l f13 s7 t2" style="bottom:3.731px;left:-15.8848px;" data-x="224.634" data-y="696.967" hs="1">r</div><div class="l f13 s7 t2" style="bottom:3.731px;left:-11.7539px;" data-x="226.079" data-y="696.967" hs="1">ee Call</div></div><div class="t t4c"><div class="l f13 s7 t2" style="bottom:3.731px;left:-26.5635px;" data-x="211.446" data-y="709.556" hs="1">Out</div><div class="l f13 s7 t2" style="bottom:3.731px;left:-7.99512px;" data-x="217.945" data-y="709.556" hs="1">er T</div><div class="l f13 s7 t2" style="bottom:3.731px;left:10.3506px;" data-x="224.366" data-y="709.556" hs="1">r</div><div class="l f13 s7 t2" style="bottom:3.731px;left:14.4815px;" data-x="225.812" data-y="709.556" hs="1">ee</div></div><div class="t t4d"><div class="l f13 s7 t2" style="bottom:3.731px;left:-29.6719px;" data-x="222.958" data-y="678.085" hs="1">Nes</div><div class="l f13 s7 t2" style="bottom:3.731px;left:-11.0742px;" data-x="229.467" data-y="678.085" hs="1">t</div><div class="l f13 s7 t2" style="bottom:3.731px;left:-7.06055px;" data-x="230.872" data-y="678.085" hs="1">ed T</div><div class="l f13 s7 t2" style="bottom:3.731px;left:13.459px;" data-x="238.054" data-y="678.085" hs="1">r</div><div class="l f13 s7 t2" style="bottom:3.731px;left:17.5898px;" data-x="239.5" data-y="678.085" hs="1">ee</div></div><div class="t t4e"><div class="l f13 s7 t2" style="bottom:3.731px;left:-25.8779px;" data-x="224.286" data-y="617.81" hs="1">Exit Guar</div><div class="l f13 s7 t2" style="bottom:3.731px;left:19.4385px;" data-x="240.147" data-y="617.81" hs="1">d</div></div><div class="t t4f"><div class="l f13 s7 t50" style="bottom:5.731px;left:-9.60059px;" data-x="131.69" data-y="586.823" hs="1">(a)</div></div><div class="t t51"><div class="l f13 s7 t50" style="bottom:5.731px;left:-10.374px;" data-x="203.52" data-y="588.223" hs="1">(b)</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:558.073px;left:54px;" data-x="54" data-y="559.947" hs="1">Figure<span class="w w2"> </span>7.</div><div class="l f2 s4 t0" style="bottom:558.011px;left:92.6815px;" data-x="92.6815" data-y="559.947" hs="1">Control<span class="w w2"> </span>flow<span class="w w1"> </span>graph<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>nested<span class="w w2"> </span>loop<span class="w w1"> </span>with<span class="w w1"> </span>an<span class="w w2"> </span>if<span class="w w1"> </span>statement</div><div class="l f2 s4 t0" style="bottom:548.048px;left:54px;" data-x="54" data-y="549.985" hs="1">inside<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w0"> </span>most<span class="w w1"> </span>loop<span class="w w0"> </span>(a).<span class="w w1"> </span>An<span class="w w0"> </span>inner<span class="w w1"> </span>tree<span class="w w0"> </span>captures<span class="w w1"> </span>the<span class="w w0"> </span>inner</div><div class="l f2 s4 t0" style="bottom:538.085px;left:54px;" data-x="54" data-y="540.022" hs="1">loop,<span class="w w2"> </span>and<span class="w w1"> </span>is<span class="w w2"> </span>nested<span class="w w1"> </span>inside<span class="w w1"> </span>an<span class="w w2"> </span>outer<span class="w w1"> </span>tree<span class="w w2"> </span>which<span class="w w1"> </span>“calls”<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:528.123px;left:54px;" data-x="54" data-y="530.059" hs="1">The<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree<span class="w w1"> </span>once<span class="w w1"> </span>it<span class="w w1"> </span>exits<span class="w w1"> </span>along<span class="w w1"> </span>its<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:518.16px;left:54px;" data-x="54" data-y="520.097" hs="1">condition<span class="w w2"> </span>guard<span class="w w1"> </span>(b).</div><div class="l f2 s4 t0" style="bottom:489.476px;left:54px;" data-x="54" data-y="491.413" hs="1">In<span class="w w2"> </span>general,<span class="w w1"> </span>if<span class="w w2"> </span>loops<span class="w w1"> </span>are<span class="w w2"> </span>nested<span class="w w1"> </span>to<span class="w w2"> </span>depth</div><div class="l ff s4 t0" style="bottom:489.673px;left:191.924px;" data-x="191.924" data-y="491.413" hs="1">k</div><div class="l f2 s4 t0" style="bottom:489.476px;left:196.985px;" data-x="196.985" data-y="491.413" hs="1">,<span class="w w2"> </span>and<span class="w w1"> </span>each<span class="w w2"> </span>loop<span class="w w1"> </span>has</div><div class="l ff s4 t0" style="bottom:489.673px;left:266.596px;" data-x="266.596" data-y="491.413" hs="1">n</div><div class="l f2 s4 t0" style="bottom:489.476px;left:274.176px;" data-x="274.176" data-y="491.413" hs="1">paths</div><div class="l f2 s4 t0" style="bottom:479.077px;left:54px;" data-x="54" data-y="481.013" hs="1">(on<span class="w w1"> </span>geometric<span class="w w0"> </span>average),<span class="w w1"> </span>this<span class="w w0"> </span>na</div><div class="l f2 s4 t0" style="bottom:479.122px;left:170.207px;" data-x="170.207" data-y="481.058" hs="1">¨</div><div class="l f2 s4 t0" style="bottom:479.077px;left:170.454px;" data-x="170.454" data-y="481.013" hs="1">ıve<span class="w w1"> </span>strategy<span class="w w0"> </span>yields</div><div class="l ff s4 t0" style="bottom:479.274px;left:241.776px;" data-x="241.776" data-y="481.013" hs="1">O</div><div class="l f14 s4 t0" style="bottom:479.274px;left:249.044px;" data-x="249.044" data-y="481.013" hs="1">(</div><div class="l ff s4 t0" style="bottom:479.274px;left:252.628px;" data-x="252.628" data-y="481.013" hs="1">n</div><div class="l f10 s5 t0" style="bottom:483.663px;left:258.187px;" data-x="258.187" data-y="484.822" hs="1">k</div><div class="l f14 s4 t0" style="bottom:479.274px;left:262.76px;" data-x="262.76" data-y="481.013" hs="1">)</div><div class="l f2 s4 t0" style="bottom:479.077px;left:269.953px;" data-x="269.953" data-y="481.013" hs="1">traces,</div><div class="l f2 s4 t0" style="bottom:469.114px;left:54px;" data-x="54" data-y="471.051" hs="1">which<span class="w w2"> </span>can<span class="w w1"> </span>easily<span class="w w1"> </span>fill<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>cache.</div><div class="l f2 s4 t0" style="bottom:459.151px;left:65.9552px;" data-x="65.9552" data-y="461.088" hs="1">In<span class="w w1"> </span>order<span class="w w0"> </span>to<span class="w w1"> </span>execute<span class="w w0"> </span>programs<span class="w w1"> </span>with<span class="w w0"> </span>nested<span class="w w1"> </span>loops<span class="w w0"> </span>efficiently,<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:449.189px;left:54px;" data-x="54" data-y="451.126" hs="1">tracing<span class="w w2"> </span>system<span class="w w1"> </span>needs<span class="w w2"> </span>a<span class="w w2"> </span>technique<span class="w w1"> </span>for<span class="w w2"> </span>covering<span class="w w2"> </span>the<span class="w w1"> </span>nested<span class="w w2"> </span>loops<span class="w w1"> </span>with</div><div class="l f2 s4 t0" style="bottom:439.226px;left:54px;" data-x="54" data-y="441.163" hs="1">native<span class="w w2"> </span>code<span class="w w1"> </span>without<span class="w w2"> </span>exponential<span class="w w1"> </span>trace<span class="w w1"> </span>duplication.</div><div class="l f1 s4 t0" style="bottom:420.936px;left:54px;" data-x="54" data-y="422.81" hs="1">4.1<span class="w w10"> </span>Nesting<span class="w w2"> </span>Algorithm</div><div class="l f2 s4 t0" style="bottom:406.926px;left:54px;" data-x="54" data-y="408.862" hs="1">The<span class="w w1"> </span>key<span class="w w2"> </span>insight<span class="w w1"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>if<span class="w w1"> </span>each<span class="w w1"> </span>loop<span class="w w1"> </span>is<span class="w w2"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:396.963px;left:54px;" data-x="54" data-y="398.9" hs="1">tree,<span class="w w1"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>for<span class="w w1"> </span>each<span class="w w2"> </span>loop<span class="w w1"> </span>can<span class="w w1"> </span>be<span class="w w1"> </span>contained<span class="w w1"> </span>only<span class="w w1"> </span>in<span class="w w1"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>tree,</div><div class="l f2 s4 t0" style="bottom:387px;left:54px;" data-x="54" data-y="388.937" hs="1">and<span class="w w2"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>paths<span class="w w1"> </span>will<span class="w w2"> </span>not<span class="w w1"> </span>be<span class="w w2"> </span>duplicated.<span class="w w1"> </span>Another<span class="w w2"> </span>key<span class="w w2"> </span>fact<span class="w w1"> </span>is<span class="w w2"> </span>that</div><div class="l f2 s4 t0" style="bottom:377.038px;left:54px;" data-x="54" data-y="378.975" hs="1">we<span class="w w2"> </span>are<span class="w w1"> </span>not<span class="w w2"> </span>tracing<span class="w w1"> </span>arbitrary<span class="w w1"> </span>bytecodes<span class="w w2"> </span>that<span class="w w1"> </span>might<span class="w w2"> </span>have<span class="w w1"> </span>irreduceable</div><div class="l f2 s4 t0" style="bottom:367.075px;left:54px;" data-x="54" data-y="369.012" hs="1">control<span class="w w1"> </span>flow<span class="w w1"> </span>graphs,<span class="w w1"> </span>but<span class="w w1"> </span>rather<span class="w w1"> </span>bytecodes<span class="w w1"> </span>produced<span class="w w1"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>compiler</div><div class="l f2 s4 t0" style="bottom:357.113px;left:54px;" data-x="54" data-y="359.049" hs="1">for<span class="w w1"> </span>a<span class="w w1"> </span>language<span class="w w1"> </span>with<span class="w w1"> </span>structured<span class="w w1"> </span>control<span class="w w1"> </span>flow.<span class="w w1"> </span>Thus,<span class="w w1"> </span>given<span class="w w1"> </span>two<span class="w w1"> </span>loop</div><div class="l f2 s4 t0" style="bottom:347.15px;left:54px;" data-x="54" data-y="349.087" hs="1">edges,<span class="w w1"> </span>the<span class="w w0"> </span>system<span class="w w0"> </span>can<span class="w w1"> </span>easily<span class="w w0"> </span>determine<span class="w w1"> </span>whether<span class="w w0"> </span>they<span class="w w1"> </span>are<span class="w w0"> </span>nested</div><div class="l f2 s4 t0" style="bottom:337.187px;left:54px;" data-x="54" data-y="339.124" hs="1">and<span class="w w1"> </span>which<span class="w w2"> </span>is<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop.<span class="w w2"> </span>Using<span class="w w1"> </span>this<span class="w w1"> </span>knowledge,<span class="w w2"> </span>the<span class="w w1"> </span>system<span class="w w1"> </span>can</div><div class="l f2 s4 t0" style="bottom:327.225px;left:54px;" data-x="54" data-y="329.161" hs="1">compile<span class="w w2"> </span>inner<span class="w w1"> </span>and<span class="w w2"> </span>outer<span class="w w2"> </span>loops<span class="w w1"> </span>separately,<span class="w w2"> </span>and<span class="w w2"> </span>make<span class="w w1"> </span>the<span class="w w2"> </span>outer<span class="w w2"> </span>loop’s</div><div class="l f2 s4 t0" style="bottom:317.262px;left:54px;" data-x="54" data-y="319.199" hs="1">traces</div><div class="l fa s4 t0" style="bottom:317.468px;left:77.1508px;" data-x="77.1508" data-y="319.199" hs="1">call</div><div class="l f2 s4 t0" style="bottom:317.262px;left:92.8506px;" data-x="92.8506" data-y="319.199" hs="1">the<span class="w w2"> </span>inner<span class="w w1"> </span>loop’s<span class="w w2"> </span>trace<span class="w w1"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:307.299px;left:65.9552px;" data-x="65.9552" data-y="309.236" hs="1">The<span class="w w1"> </span>algorithm<span class="w w1"> </span>for<span class="w w1"> </span>building<span class="w w2"> </span>nested<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>is<span class="w w1"> </span>as<span class="w w1"> </span>follows.<span class="w w1"> </span>We</div><div class="l f2 s4 t0" style="bottom:297.337px;left:54px;" data-x="54" data-y="299.273" hs="1">start<span class="w w1"> </span>tracing<span class="w w2"> </span>at<span class="w w1"> </span>loop<span class="w w1"> </span>headers<span class="w w1"> </span>exactly<span class="w w1"> </span>as<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>basic<span class="w w1"> </span>tracing<span class="w w1"> </span>system.</div><div class="l f2 s4 t0" style="bottom:287.374px;left:54px;" data-x="54" data-y="289.311" hs="1">When<span class="w w1"> </span>we<span class="w w0"> </span>exit<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w0"> </span>(detected<span class="w w1"> </span>by<span class="w w0"> </span>comparing<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>PC</div><div class="l f2 s4 t0" style="bottom:277.411px;left:54px;" data-x="54" data-y="279.348" hs="1">with<span class="w w1"> </span>the<span class="w w0"> </span>range<span class="w w0"> </span>given<span class="w w1"> </span>by<span class="w w0"> </span>the<span class="w w1"> </span>loop<span class="w w0"> </span>edge),<span class="w w1"> </span>we<span class="w w0"> </span>stop<span class="w w1"> </span>the<span class="w w0"> </span>trace.<span class="w w0"> </span>The</div><div class="l f2 s4 t0" style="bottom:267.449px;left:54px;" data-x="54" data-y="269.386" hs="1">key<span class="w w1"> </span>step<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>algorithm<span class="w w1"> </span>occurs<span class="w w1"> </span>when<span class="w w0"> </span>we<span class="w w1"> </span>are<span class="w w0"> </span>recording<span class="w w1"> </span>a<span class="w w0"> </span>trace</div><div class="l f2 s4 t0" style="bottom:257.486px;left:54px;" data-x="54" data-y="259.423" hs="1">for<span class="w w1"> </span>loop</div><div class="l ff s4 t0" style="bottom:257.683px;left:85.7379px;" data-x="85.7379" data-y="259.423" hs="1">L</div><div class="l f10 s5 t0" style="bottom:257.267px;left:92.0088px;" data-x="92.0088" data-y="258.427" hs="1">R</div><div class="l f2 s4 t0" style="bottom:257.486px;left:100.712px;" data-x="100.712" data-y="259.423" hs="1">(</div><div class="l ff s4 t0" style="bottom:257.683px;left:103.697px;" data-x="103.697" data-y="259.423" hs="1">R</div><div class="l f2 s4 t0" style="bottom:257.486px;left:113.403px;" data-x="113.403" data-y="259.423" hs="1">for<span class="w w1"> </span>loop<span class="w w1"> </span>being<span class="w w1"> </span>recorded)<span class="w w1"> </span>and<span class="w w1"> </span>we<span class="w w2"> </span>reach<span class="w w1"> </span>the<span class="w w1"> </span>header</div><div class="l f2 s4 t0" style="bottom:247.524px;left:54.0001px;" data-x="54.0001" data-y="249.46" hs="1">of<span class="w w2"> </span>a<span class="w w1"> </span>different<span class="w w2"> </span>loop</div><div class="l ff s4 t0" style="bottom:247.721px;left:120.731px;" data-x="120.731" data-y="249.46" hs="1">L</div><div class="l f10 s5 t0" style="bottom:247.304px;left:127.001px;" data-x="127.001" data-y="248.464" hs="1">O</div><div class="l f2 s4 t0" style="bottom:247.524px;left:135.45px;" data-x="135.45" data-y="249.46" hs="1">(</div><div class="l ff s4 t0" style="bottom:247.721px;left:138.435px;" data-x="138.435" data-y="249.46" hs="1">O</div><div class="l f2 s4 t0" style="bottom:247.524px;left:147.877px;" data-x="147.877" data-y="249.46" hs="1">for<span class="w w2"> </span>other<span class="w w1"> </span>loop).<span class="w w1"> </span>Note<span class="w w2"> </span>that</div><div class="l ff s4 t0" style="bottom:247.721px;left:239.671px;" data-x="239.671" data-y="249.46" hs="1">L</div><div class="l f10 s5 t0" style="bottom:247.304px;left:245.942px;" data-x="245.942" data-y="248.464" hs="1">O</div><div class="l f2 s4 t0" style="bottom:247.524px;left:254.39px;" data-x="254.39" data-y="249.46" hs="1">must<span class="w w2"> </span>be<span class="w w1"> </span>an</div><div class="l f2 s4 t0" style="bottom:237.561px;left:54.0001px;" data-x="54.0001" data-y="239.498" hs="1">inner<span class="w w2"> </span>loop<span class="w w1"> </span>of</div><div class="l ff s4 t0" style="bottom:237.758px;left:102.562px;" data-x="102.562" data-y="239.498" hs="1">L</div><div class="l f10 s5 t0" style="bottom:237.342px;left:108.833px;" data-x="108.833" data-y="238.501" hs="1">R</div><div class="l f2 s4 t0" style="bottom:237.561px;left:117.106px;" data-x="117.106" data-y="239.498" hs="1">because<span class="w w2"> </span>we<span class="w w1"> </span>stop<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>when<span class="w w1"> </span>we<span class="w w2"> </span>exit<span class="w w1"> </span>a<span class="w w2"> </span>loop.</div><div class="l f3 s3 t0" style="bottom:223.696px;left:59.2304px;" data-x="59.2304" data-y="225.242" hs="1">•</div><div class="l f2 s4 t0" style="bottom:222.407px;left:66.9516px;" data-x="66.9516" data-y="224.344" hs="1">If</div><div class="l ff s4 t0" style="bottom:222.604px;left:75.6513px;" data-x="75.6513" data-y="224.344" hs="1">L</div><div class="l f10 s5 t0" style="bottom:222.188px;left:81.9222px;" data-x="81.9222" data-y="223.347" hs="1">O</div><div class="l f2 s4 t0" style="bottom:222.407px;left:90.9257px;" data-x="90.9257" data-y="224.344" hs="1">has<span class="w w1"> </span>a<span class="w w1"> </span>type-matching<span class="w w1"> </span>compiled<span class="w w1"> </span>trace<span class="w w1"> </span>tree,<span class="w w1"> </span>we<span class="w w1"> </span>call</div><div class="l ff s4 t0" style="bottom:222.604px;left:270.36px;" data-x="270.36" data-y="224.344" hs="1">L</div><div class="l f10 s5 t0" style="bottom:222.188px;left:276.631px;" data-x="276.631" data-y="223.347" hs="1">O</div><div class="l f2 s4 t0" style="bottom:222.407px;left:285.635px;" data-x="285.635" data-y="224.344" hs="1">as</div><div class="l f2 s4 t0" style="bottom:212.444px;left:66.9516px;" data-x="66.9516" data-y="214.381" hs="1">a<span class="w w1"> </span>nested<span class="w w2"> </span>trace<span class="w w1"> </span>tree.<span class="w w1"> </span>If<span class="w w1"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>succeeds,<span class="w w1"> </span>then<span class="w w1"> </span>we<span class="w w1"> </span>record<span class="w w2"> </span>the<span class="w w1"> </span>call</div><div class="l f2 s4 t0" style="bottom:202.482px;left:66.9516px;" data-x="66.9516" data-y="204.418" hs="1">in<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>for</div><div class="l ff s4 t0" style="bottom:202.679px;left:122.101px;" data-x="122.101" data-y="204.418" hs="1">L</div><div class="l f10 s5 t0" style="bottom:202.263px;left:128.372px;" data-x="128.372" data-y="203.422" hs="1">R</div><div class="l f2 s4 t0" style="bottom:202.482px;left:134.404px;" data-x="134.404" data-y="204.418" hs="1">.<span class="w w2"> </span>On<span class="w w1"> </span>future<span class="w w1"> </span>executions,<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>for</div><div class="l ff s4 t0" style="bottom:202.679px;left:264.514px;" data-x="264.514" data-y="204.418" hs="1">L</div><div class="l f10 s5 t0" style="bottom:202.263px;left:270.785px;" data-x="270.785" data-y="203.422" hs="1">R</div><div class="l f2 s4 t0" style="bottom:202.482px;left:279.152px;" data-x="279.152" data-y="204.418" hs="1">will</div><div class="l f2 s4 t0" style="bottom:192.519px;left:66.9516px;" data-x="66.9516" data-y="194.456" hs="1">call<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>trace<span class="w w2"> </span>directly.</div><div class="l f3 s3 t0" style="bottom:179.86px;left:59.2305px;" data-x="59.2305" data-y="181.406" hs="1">•</div><div class="l f2 s4 t0" style="bottom:178.571px;left:66.9516px;" data-x="66.9516" data-y="180.508" hs="1">If</div><div class="l ff s4 t0" style="bottom:178.769px;left:75.9145px;" data-x="75.9145" data-y="180.508" hs="1">L</div><div class="l f10 s5 t0" style="bottom:178.352px;left:82.1854px;" data-x="82.1854" data-y="179.512" hs="1">O</div><div class="l f2 s4 t0" style="bottom:178.571px;left:91.4521px;" data-x="91.4521" data-y="180.508" hs="1">does<span class="w w1"> </span>not<span class="w w1"> </span>have<span class="w w1"> </span>a<span class="w w1"> </span>type-matching<span class="w w1"> </span>compiled<span class="w w0"> </span>trace<span class="w w1"> </span>tree<span class="w w1"> </span>yet,</div><div class="l f2 s4 t0" style="bottom:168.609px;left:66.9516px;" data-x="66.9516" data-y="170.546" hs="1">we<span class="w w1"> </span>have<span class="w w0"> </span>to<span class="w w1"> </span>obtain<span class="w w1"> </span>it<span class="w w0"> </span>before<span class="w w1"> </span>we<span class="w w0"> </span>are<span class="w w1"> </span>able<span class="w w1"> </span>to<span class="w w0"> </span>proceed.<span class="w w1"> </span>In<span class="w w0"> </span>order</div><div class="l f2 s4 t0" style="bottom:158.646px;left:66.9516px;" data-x="66.9516" data-y="160.583" hs="1">to<span class="w w1"> </span>do<span class="w w1"> </span>this,<span class="w w1"> </span>we<span class="w w1"> </span>simply<span class="w w1"> </span>abort<span class="w w1"> </span>recording<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w0"> </span>trace.<span class="w w2"> </span>The<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:148.684px;left:66.9516px;" data-x="66.9516" data-y="150.62" hs="1">monitor<span class="w w1"> </span>will<span class="w w0"> </span>see<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w0"> </span>header,<span class="w w1"> </span>and<span class="w w1"> </span>will<span class="w w0"> </span>immediately</div><div class="l f2 s4 t0" style="bottom:138.359px;left:66.9516px;" data-x="66.9516" data-y="140.295" hs="1">start<span class="w w2"> </span>recording<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w2"> </span>loop.</div><div class="l f2 s5 t0" style="bottom:142.813px;left:175.524px;" data-x="175.524" data-y="144.104" hs="1">2</div><div class="l f2 s4 t0" style="bottom:123.205px;left:65.9554px;" data-x="65.9554" data-y="125.141" hs="1">If<span class="w w2"> </span>all<span class="w w2"> </span>the<span class="w w1"> </span>loops<span class="w w2"> </span>in<span class="w w2"> </span>a<span class="w w1"> </span>nest<span class="w w2"> </span>are<span class="w w2"> </span>type-stable,<span class="w w1"> </span>then<span class="w w2"> </span>loop<span class="w w2"> </span>nesting<span class="w w1"> </span>creates</div><div class="l f2 s4 t0" style="bottom:113.242px;left:54.0002px;" data-x="54.0002" data-y="115.179" hs="1">no<span class="w w2"> </span>duplication.<span class="w w2"> </span>Otherwise,<span class="w w1"> </span>if<span class="w w2"> </span>loops<span class="w w2"> </span>are<span class="w w1"> </span>nested<span class="w w2"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>depth</div><div class="l ff s4 t0" style="bottom:113.439px;left:252.739px;" data-x="252.739" data-y="115.179" hs="1">k</div><div class="l f2 s4 t0" style="bottom:113.242px;left:257.799px;" data-x="257.799" data-y="115.179" hs="1">,<span class="w w2"> </span>and<span class="w w2"> </span>each</div><div class="l f2 s5 t0" style="bottom:96.864px;left:54px;" data-x="54" data-y="98.1552" hs="1">2</div><div class="l f2 s3 t0" style="bottom:93.6209px;left:58.4832px;" data-x="58.4832" data-y="95.3424" hs="1">Instead<span class="w w2"> </span>of<span class="w w1"> </span>aborting<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w2"> </span>recording,<span class="w w1"> </span>we<span class="w w1"> </span>could<span class="w w2"> </span>principally<span class="w w1"> </span>merely<span class="w w1"> </span>sus-</div><div class="l f2 s3 t0" style="bottom:84.6545px;left:54px;" data-x="54" data-y="86.376" hs="1">pend<span class="w w1"> </span>the<span class="w w1"> </span>recording,<span class="w w1"> </span>but<span class="w w1"> </span>that<span class="w w1"> </span>would<span class="w w1"> </span>require<span class="w w1"> </span>the<span class="w w1"> </span>implementation<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>able</div><div class="l f2 s3 t0" style="bottom:75.6882px;left:54px;" data-x="54" data-y="77.4097" hs="1">to<span class="w w1"> </span>record<span class="w w1"> </span>several<span class="w w2"> </span>traces<span class="w w1"> </span>simultaneously,<span class="w w1"> </span>complicating<span class="w w1"> </span>the<span class="w w1"> </span>implementation,</div><div class="l f2 s3 t0" style="bottom:66.7218px;left:54px;" data-x="54" data-y="68.4433" hs="1">while<span class="w w2"> </span>saving<span class="w w1"> </span>only<span class="w w2"> </span>a<span class="w w2"> </span>few<span class="w w1"> </span>iterations<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.</div></div><div class="t t52"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="398.856" data-y="686.831" hs="1">i</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="399.991" data-y="686.831" hs="1">2</div></div><div class="t t53"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="398.856" data-y="667.028" hs="1">i</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="399.991" data-y="667.028" hs="1">3</div></div><div class="t t54"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="398.856" data-y="707.954" hs="1">i</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="399.991" data-y="707.954" hs="1">1</div></div><div class="t t55"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="398.856" data-y="607.619" hs="1">i</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="399.991" data-y="607.619" hs="1">6</div></div><div class="t t56"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="398.856" data-y="645.905" hs="1">i</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="399.991" data-y="645.905" hs="1">4</div></div><div class="t t57"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.25342px;" data-x="398.856" data-y="626.102" hs="1">i</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.814941px;" data-x="399.991" data-y="626.102" hs="1">5</div></div><div class="t t58"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.96094px;" data-x="447.409" data-y="686.978" hs="1">t</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.107422px;" data-x="449.011" data-y="686.978" hs="1">2</div></div><div class="t t59"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.96094px;" data-x="430.308" data-y="709.275" hs="1">t</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.107422px;" data-x="431.909" data-y="709.275" hs="1">1</div></div><div class="t t5a"><div class="l f15 s7 t3f" style="bottom:4.231px;left:-4.96094px;" data-x="447.409" data-y="643.925" hs="1">t</div><div class="l f15 s7 t1f" style="bottom:4.231px;left:-0.107422px;" data-x="449.011" data-y="643.925" hs="1">4</div></div><div class="t t5b"><div class="l f15 s7 t2" style="bottom:3.731px;left:-25.8779px;" data-x="463.34" data-y="652.341" hs="1">Exit Guar</div><div class="l f15 s7 t2" style="bottom:3.731px;left:19.4385px;" data-x="478.297" data-y="652.341" hs="1">d</div></div><div class="t t5c"><div class="l f15 s7 t2" style="bottom:3.731px;left:-29.6719px;" data-x="459.447" data-y="702.509" hs="1">Nes</div><div class="l f15 s7 t2" style="bottom:3.731px;left:-11.0742px;" data-x="465.586" data-y="702.509" hs="1">t</div><div class="l f15 s7 t2" style="bottom:3.731px;left:-7.06055px;" data-x="466.91" data-y="702.509" hs="1">ed T</div><div class="l f15 s7 t2" style="bottom:3.731px;left:13.459px;" data-x="473.683" data-y="702.509" hs="1">r</div><div class="l f15 s7 t2" style="bottom:3.731px;left:17.5898px;" data-x="475.046" data-y="702.509" hs="1">ee</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:576.869px;left:317.014px;" data-x="317.014" data-y="578.743" hs="1">Figure<span class="w w2"> </span>8.</div><div class="l f2 s4 t0" style="bottom:576.806px;left:355.477px;" data-x="355.477" data-y="578.743" hs="1">Control<span class="w w2"> </span>flow<span class="w w1"> </span>graph<span class="w w2"> </span>of<span class="w w2"> </span>a<span class="w w1"> </span>loop<span class="w w2"> </span>with<span class="w w1"> </span>two<span class="w w2"> </span>nested<span class="w w1"> </span>loops<span class="w w2"> </span>(left)</div><div class="l f2 s4 t0" style="bottom:566.843px;left:317.014px;" data-x="317.014" data-y="568.78" hs="1">and<span class="w w1"> </span>its<span class="w w1"> </span>nested<span class="w w1"> </span>trace<span class="w w1"> </span>tree<span class="w w1"> </span>configuration<span class="w w1"> </span>(right).<span class="w w1"> </span>The<span class="w w0"> </span>outer<span class="w w2"> </span>tree<span class="w w1"> </span>calls</div><div class="l f2 s4 t0" style="bottom:556.88px;left:317.014px;" data-x="317.014" data-y="558.817" hs="1">the<span class="w w1"> </span>two<span class="w w2"> </span>inner<span class="w w1"> </span>nested<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w2"> </span>and<span class="w w1"> </span>places<span class="w w1"> </span>guards<span class="w w1"> </span>at<span class="w w2"> </span>their<span class="w w1"> </span>side<span class="w w1"> </span>exit</div><div class="l f2 s4 t0" style="bottom:546.918px;left:317.014px;" data-x="317.014" data-y="548.855" hs="1">locations.</div><div class="l f2 s4 t0" style="bottom:513.53px;left:317.014px;" data-x="317.014" data-y="515.467" hs="1">loop<span class="w w2"> </span>is<span class="w w1"> </span>entered<span class="w w2"> </span>with</div><div class="l ff s4 t0" style="bottom:513.728px;left:389.714px;" data-x="389.714" data-y="515.467" hs="1">m</div><div class="l f2 s4 t0" style="bottom:513.53px;left:399.945px;" data-x="399.945" data-y="515.467" hs="1">different<span class="w w2"> </span>type<span class="w w1"> </span>maps<span class="w w2"> </span>(on<span class="w w1"> </span>geometric<span class="w w2"> </span>average),</div><div class="l f2 s4 t0" style="bottom:503.131px;left:317.014px;" data-x="317.014" data-y="505.068" hs="1">then<span class="w w1"> </span>we<span class="w w1"> </span>compile</div><div class="l ff s4 t0" style="bottom:503.328px;left:379.553px;" data-x="379.553" data-y="505.068" hs="1">O</div><div class="l f14 s4 t0" style="bottom:503.328px;left:386.821px;" data-x="386.821" data-y="505.068" hs="1">(</div><div class="l ff s4 t0" style="bottom:503.328px;left:390.405px;" data-x="390.405" data-y="505.068" hs="1">m</div><div class="l f10 s5 t0" style="bottom:507.717px;left:398.524px;" data-x="398.524" data-y="508.877" hs="1">k</div><div class="l f14 s4 t0" style="bottom:503.328px;left:403.097px;" data-x="403.097" data-y="505.068" hs="1">)</div><div class="l f2 s4 t0" style="bottom:503.131px;left:409.266px;" data-x="409.266" data-y="505.068" hs="1">copies<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>innermost<span class="w w1"> </span>loop.<span class="w w1"> </span>As<span class="w w1"> </span>long<span class="w w1"> </span>as</div><div class="l ff s4 t0" style="bottom:493.366px;left:317.014px;" data-x="317.014" data-y="495.105" hs="1">m</div><div class="l f2 s4 t0" style="bottom:493.168px;left:327.374px;" data-x="327.374" data-y="495.105" hs="1">is<span class="w w2"> </span>close<span class="w w1"> </span>to<span class="w w1"> </span>1,<span class="w w2"> </span>the<span class="w w1"> </span>resulting<span class="w w1"> </span>trace<span class="w w2"> </span>trees<span class="w w1"> </span>will<span class="w w2"> </span>be<span class="w w1"> </span>tractable.</div><div class="l f2 s4 t0" style="bottom:483.206px;left:328.969px;" data-x="328.969" data-y="485.142" hs="1">An<span class="w w2"> </span>important<span class="w w2"> </span>detail<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w2"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>trace<span class="w w2"> </span>tree<span class="w w2"> </span>must<span class="w w2"> </span>act</div><div class="l f2 s4 t0" style="bottom:473.243px;left:317.014px;" data-x="317.014" data-y="475.18" hs="1">like<span class="w w2"> </span>a<span class="w w1"> </span>function<span class="w w2"> </span>call<span class="w w1"> </span>site:<span class="w w2"> </span>it<span class="w w1"> </span>must<span class="w w1"> </span>return<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>same<span class="w w1"> </span>point<span class="w w2"> </span>every<span class="w w1"> </span>time.</div><div class="l f2 s4 t0" style="bottom:463.28px;left:317.014px;" data-x="317.014" data-y="465.217" hs="1">The<span class="w w1"> </span>goal<span class="w w1"> </span>of<span class="w w2"> </span>nesting<span class="w w1"> </span>is<span class="w w1"> </span>to<span class="w w1"> </span>make<span class="w w1"> </span>inner<span class="w w1"> </span>and<span class="w w1"> </span>outer<span class="w w1"> </span>loops<span class="w w2"> </span>independent;</div><div class="l f2 s4 t0" style="bottom:453.318px;left:317.014px;" data-x="317.014" data-y="455.254" hs="1">thus<span class="w w1"> </span>when<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>is<span class="w w0"> </span>called,<span class="w w1"> </span>it<span class="w w1"> </span>must<span class="w w1"> </span>exit<span class="w w0"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>point</div><div class="l f2 s4 t0" style="bottom:443.355px;left:317.014px;" data-x="317.014" data-y="445.292" hs="1">in<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree<span class="w w1"> </span>every<span class="w w1"> </span>time<span class="w w1"> </span>with<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w2"> </span>type<span class="w w0"> </span>map.<span class="w w2"> </span>Because<span class="w w0"> </span>we</div><div class="l f2 s4 t0" style="bottom:433.392px;left:317.014px;" data-x="317.014" data-y="435.329" hs="1">cannot<span class="w w1"> </span>actually<span class="w w1"> </span>guarantee<span class="w w1"> </span>this<span class="w w1"> </span>property,<span class="w w1"> </span>we<span class="w w1"> </span>must<span class="w w1"> </span>guard<span class="w w1"> </span>on<span class="w w1"> </span>it<span class="w w1"> </span>after</div><div class="l f2 s4 t0" style="bottom:423.43px;left:317.014px;" data-x="317.014" data-y="425.367" hs="1">the<span class="w w1"> </span>call,<span class="w w0"> </span>and<span class="w w1"> </span>side<span class="w w0"> </span>exit<span class="w w1"> </span>if<span class="w w1"> </span>the<span class="w w0"> </span>property<span class="w w1"> </span>does<span class="w w0"> </span>not<span class="w w1"> </span>hold.<span class="w w1"> </span>A<span class="w w0"> </span>common</div><div class="l f2 s4 t0" style="bottom:413.467px;left:317.014px;" data-x="317.014" data-y="415.404" hs="1">reason<span class="w w0"> </span>for<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>tree<span class="w w0"> </span>not<span class="w w0"> </span>to<span class="w w1"> </span>return<span class="w w0"> </span>to<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w0"> </span>point<span class="w w1"> </span>would</div><div class="l f2 s4 t0" style="bottom:403.504px;left:317.014px;" data-x="317.014" data-y="405.441" hs="1">be<span class="w w1"> </span>if<span class="w w0"> </span>the<span class="w w1"> </span>inner<span class="w w0"> </span>tree<span class="w w1"> </span>took<span class="w w0"> </span>a<span class="w w1"> </span>new<span class="w w0"> </span>side<span class="w w1"> </span>exit<span class="w w0"> </span>for<span class="w w1"> </span>which<span class="w w1"> </span>it<span class="w w0"> </span>had<span class="w w1"> </span>never</div><div class="l f2 s4 t0" style="bottom:393.542px;left:317.014px;" data-x="317.014" data-y="395.479" hs="1">compiled<span class="w w1"> </span>a<span class="w w1"> </span>trace.<span class="w w0"> </span>At<span class="w w1"> </span>this<span class="w w1"> </span>point,<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>PC<span class="w w1"> </span>is<span class="w w1"> </span>in<span class="w w0"> </span>the<span class="w w1"> </span>inner</div><div class="l f2 s4 t0" style="bottom:383.579px;left:317.014px;" data-x="317.014" data-y="385.516" hs="1">tree,<span class="w w1"> </span>so<span class="w w1"> </span>we<span class="w w1"> </span>cannot<span class="w w1"> </span>continue<span class="w w1"> </span>recording<span class="w w1"> </span>or<span class="w w1"> </span>executing<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w0"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:373.617px;left:317.014px;" data-x="317.014" data-y="375.553" hs="1">If<span class="w w1"> </span>this<span class="w w1"> </span>happens<span class="w w1"> </span>during<span class="w w1"> </span>recording,<span class="w w1"> </span>we<span class="w w1"> </span>abort<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>trace,<span class="w w1"> </span>to<span class="w w1"> </span>give</div><div class="l f2 s4 t0" style="bottom:363.654px;left:317.014px;" data-x="317.014" data-y="365.591" hs="1">the<span class="w w2"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>a<span class="w w2"> </span>chance<span class="w w1"> </span>to<span class="w w1"> </span>finish<span class="w w1"> </span>growing.<span class="w w2"> </span>A<span class="w w1"> </span>future<span class="w w2"> </span>execution<span class="w w1"> </span>of<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:353.691px;left:317.014px;" data-x="317.014" data-y="355.628" hs="1">outer<span class="w w2"> </span>tree<span class="w w1"> </span>would<span class="w w1"> </span>then<span class="w w2"> </span>be<span class="w w1"> </span>able<span class="w w2"> </span>to<span class="w w1"> </span>properly<span class="w w1"> </span>finish<span class="w w2"> </span>and<span class="w w1"> </span>record<span class="w w1"> </span>a<span class="w w2"> </span>call<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:343.729px;left:317.014px;" data-x="317.014" data-y="345.665" hs="1">the<span class="w w2"> </span>inner<span class="w w1"> </span>tree.<span class="w w2"> </span>If<span class="w w1"> </span>an<span class="w w2"> </span>inner<span class="w w1"> </span>tree<span class="w w2"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>happens<span class="w w1"> </span>during<span class="w w2"> </span>execution<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:333.766px;left:317.014px;" data-x="317.014" data-y="335.703" hs="1">a<span class="w w1"> </span>compiled<span class="w w1"> </span>trace<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree,<span class="w w1"> </span>we<span class="w w1"> </span>simply<span class="w w1"> </span>exit<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:323.803px;left:317.014px;" data-x="317.014" data-y="325.74" hs="1">and<span class="w w2"> </span>start<span class="w w1"> </span>recording<span class="w w1"> </span>a<span class="w w2"> </span>new<span class="w w1"> </span>branch<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w2"> </span>tree.</div><div class="l f1 s4 t0" style="bottom:302.243px;left:317.014px;" data-x="317.014" data-y="304.117" hs="1">4.2<span class="w w10"> </span>Blacklisting<span class="w w2"> </span>with<span class="w w1"> </span>Nesting</div><div class="l f2 s4 t0" style="bottom:288.232px;left:317.014px;" data-x="317.014" data-y="290.169" hs="1">The<span class="w w1"> </span>blacklisting<span class="w w0"> </span>algorithm<span class="w w1"> </span>needs<span class="w w1"> </span>modification<span class="w w1"> </span>to<span class="w w0"> </span>work<span class="w w1"> </span>well<span class="w w1"> </span>with</div><div class="l f2 s4 t0" style="bottom:278.269px;left:317.014px;" data-x="317.014" data-y="280.206" hs="1">nesting.<span class="w w1"> </span>The<span class="w w1"> </span>problem<span class="w w0"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>outer<span class="w w0"> </span>loop<span class="w w1"> </span>traces<span class="w w1"> </span>often<span class="w w1"> </span>abort<span class="w w0"> </span>during</div><div class="l f2 s4 t0" style="bottom:268.307px;left:317.014px;" data-x="317.014" data-y="270.244" hs="1">startup<span class="w w2"> </span>(because<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w2"> </span>is<span class="w w1"> </span>not<span class="w w1"> </span>available<span class="w w2"> </span>or<span class="w w1"> </span>takes<span class="w w1"> </span>a<span class="w w2"> </span>side<span class="w w1"> </span>exit),</div><div class="l f2 s4 t0" style="bottom:258.344px;left:317.014px;" data-x="317.014" data-y="260.281" hs="1">which<span class="w w1"> </span>would<span class="w w1"> </span>lead<span class="w w0"> </span>to<span class="w w1"> </span>their<span class="w w1"> </span>being<span class="w w0"> </span>quickly<span class="w w1"> </span>blacklisted<span class="w w1"> </span>by<span class="w w0"> </span>the<span class="w w1"> </span>basic</div><div class="l f2 s4 t0" style="bottom:248.382px;left:317.014px;" data-x="317.014" data-y="250.318" hs="1">algorithm.</div><div class="l f2 s4 t0" style="bottom:238.419px;left:328.969px;" data-x="328.969" data-y="240.356" hs="1">The<span class="w w1"> </span>key<span class="w w2"> </span>observation<span class="w w1"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>when<span class="w w1"> </span>an<span class="w w2"> </span>outer<span class="w w1"> </span>trace<span class="w w1"> </span>aborts<span class="w w1"> </span>because</div><div class="l f2 s4 t0" style="bottom:228.456px;left:317.014px;" data-x="317.014" data-y="230.393" hs="1">the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>is<span class="w w1"> </span>not<span class="w w1"> </span>ready,<span class="w w2"> </span>this<span class="w w1"> </span>is<span class="w w1"> </span>probably<span class="w w1"> </span>a<span class="w w1"> </span>temporary<span class="w w1"> </span>condition.</div><div class="l f2 s4 t0" style="bottom:218.494px;left:317.014px;" data-x="317.014" data-y="220.43" hs="1">Thus,<span class="w w1"> </span>we<span class="w w2"> </span>should<span class="w w1"> </span>not<span class="w w1"> </span>count<span class="w w1"> </span>such<span class="w w1"> </span>aborts<span class="w w1"> </span>toward<span class="w w2"> </span>blacklisting<span class="w w1"> </span>as<span class="w w1"> </span>long</div><div class="l f2 s4 t0" style="bottom:208.531px;left:317.014px;" data-x="317.014" data-y="210.468" hs="1">as<span class="w w2"> </span>we<span class="w w1"> </span>are<span class="w w1"> </span>able<span class="w w2"> </span>to<span class="w w1"> </span>build<span class="w w2"> </span>up<span class="w w1"> </span>more<span class="w w1"> </span>traces<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w2"> </span>tree.</div><div class="l f2 s4 t0" style="bottom:198.568px;left:328.969px;" data-x="328.969" data-y="200.505" hs="1">In<span class="w w1"> </span>our<span class="w w1"> </span>implementation,<span class="w w1"> </span>when<span class="w w1"> </span>an<span class="w w1"> </span>outer<span class="w w0"> </span>tree<span class="w w2"> </span>aborts<span class="w w0"> </span>on<span class="w w2"> </span>the<span class="w w0"> </span>inner</div><div class="l f2 s4 t0" style="bottom:188.606px;left:317.014px;" data-x="317.014" data-y="190.542" hs="1">tree,<span class="w w1"> </span>we<span class="w w1"> </span>increment<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree’s<span class="w w1"> </span>blacklist<span class="w w1"> </span>counter<span class="w w0"> </span>as<span class="w w1"> </span>usual<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:178.643px;left:317.014px;" data-x="317.014" data-y="180.58" hs="1">back<span class="w w1"> </span>off<span class="w w1"> </span>on<span class="w w1"> </span>compiling<span class="w w1"> </span>it.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>finishes<span class="w w1"> </span>a<span class="w w1"> </span>trace,<span class="w w1"> </span>we</div><div class="l f2 s4 t0" style="bottom:168.68px;left:317.014px;" data-x="317.014" data-y="170.617" hs="1">decrement<span class="w w1"> </span>the<span class="w w1"> </span>blacklist<span class="w w1"> </span>counter<span class="w w1"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop,<span class="w w1"> </span>“forgiving”<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:158.718px;left:317.014px;" data-x="317.014" data-y="160.654" hs="1">outer<span class="w w2"> </span>loop<span class="w w1"> </span>for<span class="w w2"> </span>aborting<span class="w w2"> </span>previously.<span class="w w2"> </span>We<span class="w w2"> </span>also<span class="w w1"> </span>undo<span class="w w2"> </span>the<span class="w w2"> </span>backoff<span class="w w1"> </span>so<span class="w w2"> </span>that</div><div class="l f2 s4 t0" style="bottom:148.755px;left:317.014px;" data-x="317.014" data-y="150.692" hs="1">the<span class="w w2"> </span>outer<span class="w w1"> </span>tree<span class="w w1"> </span>can<span class="w w2"> </span>start<span class="w w1"> </span>immediately<span class="w w2"> </span>trying<span class="w w1"> </span>to<span class="w w1"> </span>compile<span class="w w2"> </span>the<span class="w w1"> </span>next<span class="w w2"> </span>time</div><div class="l f2 s4 t0" style="bottom:138.792px;left:317.014px;" data-x="317.014" data-y="140.729" hs="1">we<span class="w w2"> </span>reach<span class="w w1"> </span>it.</div><div class="l f1 s2 t0" style="bottom:109.988px;left:317.014px;" data-x="317.014" data-y="112.279" hs="1">5.<span class="w w3"> </span>Trace<span class="w w2"> </span>Tree<span class="w w2"> </span>Optimization</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:317.014px;" data-x="317.014" data-y="98.3312" hs="1">This<span class="w w0"> </span>section<span class="w w0"> </span>explains<span class="w w0"> </span>how<span class="w w1"> </span>a<span class="w w0"> </span>recorded<span class="w w0"> </span>trace<span class="w w0"> </span>is<span class="w w0"> </span>translated<span class="w w0"> </span>to<span class="w w0"> </span>an</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">optimized<span class="w w1"> </span>machine<span class="w w1"> </span>code<span class="w w0"> </span>trace.<span class="w w1"> </span>The<span class="w w1"> </span>trace<span class="w w0"> </span>compilation<span class="w w1"> </span>subsystem,</div><div class="l f2 s8 t0" style="bottom:76.8565px;left:317.238px;" data-x="317.238" data-y="78.4059" hs="1">NAN<span class="w w2"> </span>OJI<span class="w w2"> </span>T</div><div class="l f2 s4 t0" style="bottom:76.4692px;left:350.153px;" data-x="350.153" data-y="78.4059" hs="1">,<span class="w w0"> </span>is<span class="w w0"> </span>separate<span class="w w1"> </span>from<span class="w w0"> </span>the<span class="w w0"> </span>VM<span class="w w0"> </span>and<span class="w w0"> </span>can<span class="w w0"> </span>be<span class="w w0"> </span>used<span class="w w1"> </span>for<span class="w w0"> </span>other</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">applications.</div></div></div><div id="page-8" class="p" style="width:612px;height:792px;background-image:url(p8.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f1 s4 t0" style="bottom:710.156px;left:54px;" data-x="54" data-y="712.03" hs="1">5.1<span class="w w10"> </span>Optimizations</div><div class="l f2 s4 t0" style="bottom:696.145px;left:54px;" data-x="54" data-y="698.082" hs="1">Because<span class="w w0"> </span>traces<span class="w w1"> </span>are<span class="w w0"> </span>in<span class="w w1"> </span>SSA<span class="w w0"> </span>form<span class="w w0"> </span>and<span class="w w1"> </span>have<span class="w w0"> </span>no<span class="w w1"> </span>join<span class="w w0"> </span>points<span class="w w0"> </span>or</div><div class="l ff s4 t0" style="bottom:696.343px;left:284.633px;" data-x="284.633" data-y="698.082" hs="1">φ</div><div class="l f2 s4 t0" style="bottom:696.145px;left:290.118px;" data-x="290.118" data-y="698.082" hs="1">-</div><div class="l f2 s4 t0" style="bottom:686.183px;left:54px;" data-x="54" data-y="688.12" hs="1">nodes,<span class="w w0"> </span>certain<span class="w w1"> </span>optimizations<span class="w w0"> </span>are<span class="w w0"> </span>easy<span class="w w1"> </span>to<span class="w w0"> </span>implement.<span class="w w1"> </span>In<span class="w w0"> </span>order<span class="w w0"> </span>to</div><div class="l f2 s4 t0" style="bottom:676.22px;left:54px;" data-x="54" data-y="678.157" hs="1">get<span class="w w1"> </span>good<span class="w w1"> </span>startup<span class="w w2"> </span>performance,<span class="w w1"> </span>the<span class="w w1"> </span>optimizations<span class="w w1"> </span>must<span class="w w1"> </span>run<span class="w w1"> </span>quickly,</div><div class="l f2 s4 t0" style="bottom:666.258px;left:54px;" data-x="54" data-y="668.194" hs="1">so<span class="w w0"> </span>we<span class="w w1"> </span>chose<span class="w w0"> </span>a<span class="w w0"> </span>small<span class="w w1"> </span>set<span class="w w0"> </span>of<span class="w w0"> </span>optimizations.<span class="w w1"> </span>We<span class="w w1"> </span>implemented<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:656.295px;left:54px;" data-x="54" data-y="658.232" hs="1">optimizations<span class="w w1"> </span>as<span class="w w2"> </span>pipelined<span class="w w1"> </span>filters<span class="w w1"> </span>so<span class="w w1"> </span>that<span class="w w2"> </span>they<span class="w w1"> </span>can<span class="w w1"> </span>be<span class="w w2"> </span>turned<span class="w w1"> </span>on<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:646.332px;left:54px;" data-x="54" data-y="648.269" hs="1">off<span class="w w1"> </span>independently,<span class="w w2"> </span>and<span class="w w1"> </span>yet<span class="w w1"> </span>all<span class="w w1"> </span>run<span class="w w1"> </span>in<span class="w w1"> </span>just<span class="w w1"> </span>two<span class="w w1"> </span>loop<span class="w w1"> </span>passes<span class="w w1"> </span>over<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:636.37px;left:54px;" data-x="54" data-y="638.306" hs="1">trace:<span class="w w2"> </span>one<span class="w w1"> </span>forward<span class="w w1"> </span>and<span class="w w2"> </span>one<span class="w w1"> </span>backward.</div><div class="l f2 s4 t0" style="bottom:626.407px;left:65.9552px;" data-x="65.9552" data-y="628.344" hs="1">Every<span class="w w1"> </span>time<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>recorder<span class="w w1"> </span>emits<span class="w w0"> </span>a<span class="w w1"> </span>LIR<span class="w w1"> </span>instruction,<span class="w w1"> </span>the<span class="w w0"> </span>in-</div><div class="l f2 s4 t0" style="bottom:616.444px;left:54px;" data-x="54" data-y="618.381" hs="1">struction<span class="w w0"> </span>is<span class="w w1"> </span>immediately<span class="w w0"> </span>passed<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w0"> </span>first<span class="w w1"> </span>filter<span class="w w0"> </span>in<span class="w w1"> </span>the<span class="w w0"> </span>forward</div><div class="l f2 s4 t0" style="bottom:606.482px;left:54px;" data-x="54" data-y="608.418" hs="1">pipeline.<span class="w w1"> </span>Thus,<span class="w w0"> </span>forward<span class="w w1"> </span>filter<span class="w w1"> </span>optimizations<span class="w w0"> </span>are<span class="w w1"> </span>performed<span class="w w1"> </span>as<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:596.519px;left:54px;" data-x="54" data-y="598.456" hs="1">trace<span class="w w1"> </span>is<span class="w w1"> </span>recorded.<span class="w w2"> </span>Each<span class="w w1"> </span>filter<span class="w w1"> </span>may<span class="w w1"> </span>pass<span class="w w1"> </span>each<span class="w w1"> </span>instruction<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>next</div><div class="l f2 s4 t0" style="bottom:586.556px;left:54px;" data-x="54" data-y="588.493" hs="1">filter<span class="w w1"> </span>unchanged,<span class="w w1"> </span>write<span class="w w1"> </span>a<span class="w w0"> </span>different<span class="w w2"> </span>instruction<span class="w w0"> </span>to<span class="w w2"> </span>the<span class="w w0"> </span>next<span class="w w2"> </span>filter,<span class="w w1"> </span>or</div><div class="l f2 s4 t0" style="bottom:576.594px;left:54px;" data-x="54" data-y="578.531" hs="1">write<span class="w w1"> </span>no<span class="w w1"> </span>instruction<span class="w w1"> </span>at<span class="w w1"> </span>all.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w2"> </span>the<span class="w w1"> </span>constant<span class="w w1"> </span>folding<span class="w w1"> </span>filter</div><div class="l f2 s4 t0" style="bottom:566.631px;left:54px;" data-x="54" data-y="568.568" hs="1">can<span class="w w1"> </span>replace<span class="w w1"> </span>a<span class="w w1"> </span>multiply<span class="w w1"> </span>instruction<span class="w w1"> </span>like</div><div class="l ff s4 t0" style="bottom:566.828px;left:195.046px;" data-x="195.046" data-y="568.568" hs="1">v</div><div class="l f8 s5 t0" style="bottom:566.412px;left:199.522px;" data-x="199.522" data-y="567.572" hs="1">13</div><div class="l f14 s4 t0" style="bottom:566.828px;left:210.892px;" data-x="210.892" data-y="568.568" hs="1">:=</div><div class="l ff s4 t0" style="bottom:566.828px;left:224.185px;" data-x="224.185" data-y="568.568" hs="1">mul</div><div class="l f14 s4 t0" style="bottom:566.828px;left:240.506px;" data-x="240.506" data-y="568.568" hs="1">3</div><div class="l ff s4 t0" style="bottom:566.828px;left:245.114px;" data-x="245.114" data-y="568.568" hs="1">,</div><div class="l f14 s4 t0" style="bottom:566.828px;left:249.209px;" data-x="249.209" data-y="568.568" hs="1">1000</div><div class="l f2 s4 t0" style="bottom:566.631px;left:270.41px;" data-x="270.41" data-y="568.568" hs="1">with<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:556.668px;left:54px;" data-x="54" data-y="558.605" hs="1">constant<span class="w w2"> </span>instruction</div><div class="l ff s4 t0" style="bottom:556.866px;left:126.725px;" data-x="126.725" data-y="558.605" hs="1">v</div><div class="l f8 s5 t0" style="bottom:556.449px;left:131.202px;" data-x="131.202" data-y="557.609" hs="1">13</div><div class="l f14 s4 t0" style="bottom:556.866px;left:141.565px;" data-x="141.565" data-y="558.605" hs="1">=<span class="w w1"> </span>3000</div><div class="l f2 s4 t0" style="bottom:556.668px;left:169.723px;" data-x="169.723" data-y="558.605" hs="1">.</div><div class="l f2 s4 t0" style="bottom:546.706px;left:65.9551px;" data-x="65.9551" data-y="548.643" hs="1">We<span class="w w2"> </span>currently<span class="w w2"> </span>apply<span class="w w1"> </span>four<span class="w w1"> </span>forward<span class="w w2"> </span>filters:</div><div class="l f3 s3 t0" style="bottom:530.66px;left:59.2303px;" data-x="59.2303" data-y="532.206" hs="1">•</div><div class="l f2 s4 t0" style="bottom:529.371px;left:66.9514px;" data-x="66.9514" data-y="531.308" hs="1">On<span class="w w1"> </span>ISAs<span class="w w0"> </span>without<span class="w w1"> </span>floating-point<span class="w w1"> </span>instructions,<span class="w w0"> </span>a<span class="w w1"> </span>soft-float<span class="w w1"> </span>filter</div><div class="l f2 s4 t0" style="bottom:519.408px;left:66.9514px;" data-x="66.9514" data-y="521.345" hs="1">converts<span class="w w2"> </span>floating-point<span class="w w1"> </span>LIR<span class="w w2"> </span>instructions<span class="w w1"> </span>to<span class="w w1"> </span>sequences<span class="w w2"> </span>of<span class="w w1"> </span>integer</div><div class="l f2 s4 t0" style="bottom:509.446px;left:66.9514px;" data-x="66.9514" data-y="511.382" hs="1">instructions.</div><div class="l f3 s3 t0" style="bottom:496.787px;left:59.2303px;" data-x="59.2303" data-y="498.333" hs="1">•</div><div class="l f2 s4 t0" style="bottom:495.498px;left:66.9514px;" data-x="66.9514" data-y="497.435" hs="1">CSE<span class="w w2"> </span>(constant<span class="w w1"> </span>subexpression<span class="w w1"> </span>elimination),</div><div class="l f3 s3 t0" style="bottom:482.839px;left:59.2303px;" data-x="59.2303" data-y="484.385" hs="1">•</div><div class="l f2 s4 t0" style="bottom:481.55px;left:66.9514px;" data-x="66.9514" data-y="483.487" hs="1">expression<span class="w w2"> </span>simplification,<span class="w w1"> </span>including<span class="w w1"> </span>constant<span class="w w1"> </span>folding<span class="w w2"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>few</div><div class="l f2 s4 t0" style="bottom:471.588px;left:66.9514px;" data-x="66.9514" data-y="473.524" hs="1">algebraic<span class="w w2"> </span>identities<span class="w w1"> </span>(e.g.,</div><div class="l ff s4 t0" style="bottom:471.785px;left:157.591px;" data-x="157.591" data-y="473.524" hs="1">a</div><div class="l f6 s4 t0" style="bottom:471.785px;left:164.521px;" data-x="164.521" data-y="473.524" hs="1">−</div><div class="l ff s4 t0" style="bottom:471.785px;left:173.736px;" data-x="173.736" data-y="473.524" hs="1">a</div><div class="l f14 s4 t0" style="bottom:471.785px;left:181.178px;" data-x="181.178" data-y="473.524" hs="1">=<span class="w w1"> </span>0</div><div class="l f2 s4 t0" style="bottom:471.588px;left:195.513px;" data-x="195.513" data-y="473.524" hs="1">),<span class="w w2"> </span>and</div><div class="l f3 s3 t0" style="bottom:458.929px;left:59.2303px;" data-x="59.2303" data-y="460.475" hs="1">•</div><div class="l f2 s4 t0" style="bottom:457.64px;left:66.9514px;" data-x="66.9514" data-y="459.577" hs="1">source<span class="w w0"> </span>language<span class="w w0"> </span>semantic-specific<span class="w w0"> </span>expression<span class="w w0"> </span>simplification,</div><div class="l f2 s4 t0" style="bottom:447.677px;left:66.9514px;" data-x="66.9514" data-y="449.614" hs="1">primarily<span class="w w2"> </span>algebraic<span class="w w1"> </span>identities<span class="w w2"> </span>that<span class="w w1"> </span>allow</div><div class="l f2 s8 t0" style="bottom:448.065px;left:209.65px;" data-x="209.65" data-y="449.614" hs="1">DOU<span class="w w2"> </span>BLE</div><div class="l f2 s4 t0" style="bottom:447.677px;left:243.209px;" data-x="243.209" data-y="449.614" hs="1">to<span class="w w2"> </span>be<span class="w w1"> </span>replaced</div><div class="l f2 s4 t0" style="bottom:437.715px;left:66.9514px;" data-x="66.9514" data-y="439.651" hs="1">with</div><div class="l f2 s8 t0" style="bottom:438.102px;left:85.6326px;" data-x="85.6326" data-y="439.651" hs="1">INT</div><div class="l f2 s4 t0" style="bottom:437.715px;left:98.6874px;" data-x="98.6874" data-y="439.651" hs="1">.<span class="w w1"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>LIR<span class="w w1"> </span>that<span class="w w1"> </span>converts<span class="w w2"> </span>an</div><div class="l f2 s8 t0" style="bottom:438.102px;left:229.806px;" data-x="229.806" data-y="439.651" hs="1">INT</div><div class="l f2 s4 t0" style="bottom:437.715px;left:245.376px;" data-x="245.376" data-y="439.651" hs="1">to<span class="w w1"> </span>a</div><div class="l f2 s8 t0" style="bottom:438.102px;left:261.587px;" data-x="261.587" data-y="439.651" hs="1">DOU<span class="w w2"> </span>BLE</div><div class="l f2 s4 t0" style="bottom:427.752px;left:66.9514px;" data-x="66.9514" data-y="429.689" hs="1">and<span class="w w2"> </span>then<span class="w w1"> </span>back<span class="w w1"> </span>again<span class="w w2"> </span>would<span class="w w1"> </span>be<span class="w w2"> </span>removed<span class="w w1"> </span>by<span class="w w1"> </span>this<span class="w w2"> </span>filter.</div><div class="l f2 s4 t0" style="bottom:410.417px;left:65.9551px;" data-x="65.9551" data-y="412.354" hs="1">When<span class="w w1"> </span>trace<span class="w w1"> </span>recording<span class="w w1"> </span>is<span class="w w1"> </span>completed,<span class="w w1"> </span>nanojit<span class="w w1"> </span>runs<span class="w w1"> </span>the<span class="w w1"> </span>backward</div><div class="l f2 s4 t0" style="bottom:400.454px;left:54px;" data-x="54" data-y="402.391" hs="1">optimization<span class="w w1"> </span>filters.<span class="w w1"> </span>These<span class="w w1"> </span>are<span class="w w0"> </span>used<span class="w w1"> </span>for<span class="w w1"> </span>optimizations<span class="w w1"> </span>that<span class="w w1"> </span>require</div><div class="l f2 s4 t0" style="bottom:390.492px;left:54px;" data-x="54" data-y="392.428" hs="1">backward<span class="w w1"> </span>program<span class="w w0"> </span>analysis.<span class="w w1"> </span>When<span class="w w0"> </span>running<span class="w w1"> </span>the<span class="w w0"> </span>backward<span class="w w1"> </span>filters,</div><div class="l f2 s4 t0" style="bottom:380.529px;left:54px;" data-x="54" data-y="382.466" hs="1">nanojit<span class="w w2"> </span>reads<span class="w w1"> </span>one<span class="w w2"> </span>LIR<span class="w w2"> </span>instruction<span class="w w1"> </span>at<span class="w w2"> </span>a<span class="w w1"> </span>time,<span class="w w2"> </span>and<span class="w w2"> </span>the<span class="w w1"> </span>reads<span class="w w2"> </span>are<span class="w w1"> </span>passed</div><div class="l f2 s4 t0" style="bottom:370.566px;left:54px;" data-x="54" data-y="372.503" hs="1">through<span class="w w2"> </span>the<span class="w w1"> </span>pipeline.</div><div class="l f2 s4 t0" style="bottom:360.604px;left:65.9551px;" data-x="65.9551" data-y="362.541" hs="1">We<span class="w w2"> </span>currently<span class="w w2"> </span>apply<span class="w w1"> </span>three<span class="w w1"> </span>backward<span class="w w2"> </span>filters:</div><div class="l f3 s3 t0" style="bottom:344.558px;left:59.2303px;" data-x="59.2303" data-y="346.104" hs="1">•</div><div class="l f2 s4 t0" style="bottom:343.269px;left:66.9514px;" data-x="66.9514" data-y="345.206" hs="1">Dead<span class="w w2"> </span>data-stack<span class="w w1"> </span>store<span class="w w2"> </span>elimination.<span class="w w1"> </span>The<span class="w w2"> </span>LIR<span class="w w2"> </span>trace<span class="w w1"> </span>encodes<span class="w w2"> </span>many</div><div class="l f2 s4 t0" style="bottom:333.306px;left:66.9514px;" data-x="66.9514" data-y="335.243" hs="1">stores<span class="w w1"> </span>to<span class="w w2"> </span>locations<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>stack.<span class="w w2"> </span>But<span class="w w1"> </span>these<span class="w w1"> </span>values<span class="w w1"> </span>are</div><div class="l f2 s4 t0" style="bottom:323.343px;left:66.9514px;" data-x="66.9514" data-y="325.28" hs="1">never<span class="w w1"> </span>read<span class="w w1"> </span>back<span class="w w1"> </span>before<span class="w w1"> </span>exiting<span class="w w0"> </span>the<span class="w w2"> </span>trace<span class="w w0"> </span>(by<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>or</div><div class="l f2 s4 t0" style="bottom:313.381px;left:66.9514px;" data-x="66.9514" data-y="315.318" hs="1">another<span class="w w0"> </span>trace).<span class="w w1"> </span>Thus,<span class="w w0"> </span>stores<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>stack<span class="w w0"> </span>that<span class="w w0"> </span>are<span class="w w1"> </span>overwritten</div><div class="l f2 s4 t0" style="bottom:303.418px;left:66.9514px;" data-x="66.9514" data-y="305.355" hs="1">before<span class="w w1"> </span>the<span class="w w0"> </span>next<span class="w w1"> </span>exit<span class="w w1"> </span>are<span class="w w0"> </span>dead.<span class="w w1"> </span>Stores<span class="w w1"> </span>to<span class="w w0"> </span>locations<span class="w w1"> </span>that<span class="w w1"> </span>are<span class="w w0"> </span>off</div><div class="l f2 s4 t0" style="bottom:293.456px;left:66.9514px;" data-x="66.9514" data-y="295.392" hs="1">the<span class="w w2"> </span>top<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>interpreter<span class="w w1"> </span>stack<span class="w w1"> </span>at<span class="w w2"> </span>future<span class="w w1"> </span>exits<span class="w w2"> </span>are<span class="w w1"> </span>also<span class="w w1"> </span>dead.</div><div class="l f3 s3 t0" style="bottom:280.797px;left:59.2303px;" data-x="59.2303" data-y="282.343" hs="1">•</div><div class="l f2 s4 t0" style="bottom:279.508px;left:66.9514px;" data-x="66.9514" data-y="281.445" hs="1">Dead<span class="w w2"> </span>call-stack<span class="w w1"> </span>store<span class="w w2"> </span>elimination.<span class="w w2"> </span>This<span class="w w1"> </span>is<span class="w w2"> </span>the<span class="w w1"> </span>same<span class="w w2"> </span>optimization</div><div class="l f2 s4 t0" style="bottom:269.545px;left:66.9514px;" data-x="66.9514" data-y="271.482" hs="1">as<span class="w w1"> </span>above,<span class="w w2"> </span>except<span class="w w1"> </span>applied<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter’s<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>used<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:259.583px;left:66.9514px;" data-x="66.9514" data-y="261.519" hs="1">function<span class="w w2"> </span>call<span class="w w1"> </span>inlining.</div><div class="l f3 s3 t0" style="bottom:246.924px;left:59.2303px;" data-x="59.2303" data-y="248.47" hs="1">•</div><div class="l f2 s4 t0" style="bottom:245.635px;left:66.9514px;" data-x="66.9514" data-y="247.572" hs="1">Dead<span class="w w0"> </span>code<span class="w w0"> </span>elimination.<span class="w w4"> </span>This<span class="w w0"> </span>eliminates<span class="w w0"> </span>any<span class="w w4"> </span>operation<span class="w w0"> </span>that</div><div class="l f2 s4 t0" style="bottom:235.672px;left:66.9514px;" data-x="66.9514" data-y="237.609" hs="1">stores<span class="w w2"> </span>to<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w2"> </span>that<span class="w w1"> </span>is<span class="w w2"> </span>never<span class="w w1"> </span>used.</div><div class="l f2 s4 t0" style="bottom:218.337px;left:65.9551px;" data-x="65.9551" data-y="220.274" hs="1">After<span class="w w0"> </span>a<span class="w w1"> </span>LIR<span class="w w0"> </span>instruction<span class="w w0"> </span>is<span class="w w0"> </span>successfully<span class="w w1"> </span>read<span class="w w0"> </span>(“pulled”)<span class="w w0"> </span>from</div><div class="l f2 s4 t0" style="bottom:208.375px;left:54px;" data-x="54" data-y="210.311" hs="1">the<span class="w w1"> </span>backward<span class="w w1"> </span>filter<span class="w w1"> </span>pipeline,<span class="w w1"> </span>nanojit’s<span class="w w1"> </span>code<span class="w w1"> </span>generator<span class="w w1"> </span>emits<span class="w w1"> </span>native</div><div class="l f2 s4 t0" style="bottom:198.412px;left:54px;" data-x="54" data-y="200.349" hs="1">machine<span class="w w2"> </span>instruction(s)<span class="w w1"> </span>for<span class="w w1"> </span>it.</div><div class="l f1 s4 t0" style="bottom:180.144px;left:54px;" data-x="54" data-y="182.018" hs="1">5.2<span class="w w10"> </span>Register<span class="w w2"> </span>Allocation</div><div class="l f2 s4 t0" style="bottom:166.133px;left:54px;" data-x="54" data-y="168.07" hs="1">We<span class="w w1"> </span>use<span class="w w0"> </span>a<span class="w w0"> </span>simple<span class="w w0"> </span>greedy<span class="w w0"> </span>register<span class="w w0"> </span>allocator<span class="w w0"> </span>that<span class="w w0"> </span>makes<span class="w w0"> </span>a<span class="w w0"> </span>single</div><div class="l f2 s4 t0" style="bottom:156.17px;left:54px;" data-x="54" data-y="158.107" hs="1">backward<span class="w w1"> </span>pass<span class="w w1"> </span>over<span class="w w0"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>(it<span class="w w1"> </span>is<span class="w w0"> </span>integrated<span class="w w1"> </span>with<span class="w w1"> </span>the<span class="w w1"> </span>code<span class="w w0"> </span>gen-</div><div class="l f2 s4 t0" style="bottom:146.208px;left:54px;" data-x="54" data-y="148.145" hs="1">erator).<span class="w w1"> </span>By<span class="w w0"> </span>the<span class="w w1"> </span>time<span class="w w1"> </span>the<span class="w w0"> </span>allocator<span class="w w1"> </span>has<span class="w w1"> </span>reached<span class="w w0"> </span>an<span class="w w1"> </span>instruction<span class="w w1"> </span>like</div><div class="l ff s4 t0" style="bottom:136.442px;left:54px;" data-x="54" data-y="138.182" hs="1">v</div><div class="l f8 s5 t0" style="bottom:136.026px;left:58.4762px;" data-x="58.4762" data-y="137.186" hs="1">3</div><div class="l f14 s4 t0" style="bottom:136.442px;left:65.5404px;" data-x="65.5404" data-y="138.182" hs="1">=</div><div class="l ff s4 t0" style="bottom:136.442px;left:75.6211px;" data-x="75.6211" data-y="138.182" hs="1">add<span class="w w1"> </span>v</div><div class="l f8 s5 t0" style="bottom:136.026px;left:96.9561px;" data-x="96.9561" data-y="137.186" hs="1">1</div><div class="l ff s4 t0" style="bottom:136.442px;left:101.107px;" data-x="101.107" data-y="138.182" hs="1">,<span class="w w2"> </span>v</div><div class="l f8 s5 t0" style="bottom:136.026px;left:109.679px;" data-x="109.679" data-y="137.186" hs="1">2</div><div class="l f2 s4 t0" style="bottom:136.245px;left:113.83px;" data-x="113.83" data-y="138.182" hs="1">,<span class="w w1"> </span>it<span class="w w2"> </span>has<span class="w w1"> </span>already<span class="w w1"> </span>assigned<span class="w w1"> </span>a<span class="w w2"> </span>register<span class="w w1"> </span>to</div><div class="l ff s4 t0" style="bottom:136.442px;left:247.407px;" data-x="247.407" data-y="138.182" hs="1">v</div><div class="l f8 s5 t0" style="bottom:136.026px;left:251.883px;" data-x="251.883" data-y="137.186" hs="1">3</div><div class="l f2 s4 t0" style="bottom:136.245px;left:256.034px;" data-x="256.034" data-y="138.182" hs="1">.<span class="w w1"> </span>If</div><div class="l ff s4 t0" style="bottom:136.442px;left:269.101px;" data-x="269.101" data-y="138.182" hs="1">v</div><div class="l f8 s5 t0" style="bottom:136.026px;left:273.578px;" data-x="273.578" data-y="137.186" hs="1">1</div><div class="l f2 s4 t0" style="bottom:136.245px;left:280.156px;" data-x="280.156" data-y="138.182" hs="1">and</div><div class="l ff s4 t0" style="bottom:126.48px;left:53.9999px;" data-x="53.9999" data-y="128.219" hs="1">v</div><div class="l f8 s5 t0" style="bottom:126.063px;left:58.4762px;" data-x="58.4762" data-y="127.223" hs="1">2</div><div class="l f2 s4 t0" style="bottom:126.282px;left:64.9004px;" data-x="64.9004" data-y="128.219" hs="1">have<span class="w w2"> </span>not<span class="w w1"> </span>yet<span class="w w1"> </span>been<span class="w w2"> </span>assigned<span class="w w1"> </span>registers,<span class="w w2"> </span>the<span class="w w1"> </span>allocator<span class="w w1"> </span>assigns<span class="w w2"> </span>a<span class="w w1"> </span>free</div><div class="l f2 s4 t0" style="bottom:116.32px;left:53.9999px;" data-x="53.9999" data-y="118.257" hs="1">register<span class="w w2"> </span>to<span class="w w1"> </span>each.<span class="w w2"> </span>If<span class="w w1"> </span>there<span class="w w2"> </span>are<span class="w w1"> </span>no<span class="w w1"> </span>free<span class="w w2"> </span>registers,<span class="w w1"> </span>a<span class="w w2"> </span>value<span class="w w1"> </span>is<span class="w w2"> </span>selected<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:106.357px;left:53.9999px;" data-x="53.9999" data-y="108.294" hs="1">spilling.<span class="w w1"> </span>We<span class="w w2"> </span>use<span class="w w1"> </span>a<span class="w w1"> </span>class<span class="w w1"> </span>heuristic<span class="w w1"> </span>that<span class="w w1"> </span>selects<span class="w w1"> </span>the<span class="w w1"> </span>“oldest”<span class="w w1"> </span>register-</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:53.9999px;" data-x="53.9999" data-y="98.3313" hs="1">carried<span class="w w2"> </span>value<span class="w w1"> </span>(6).</div><div class="l f2 s4 t0" style="bottom:86.432px;left:65.9551px;" data-x="65.9551" data-y="88.3687" hs="1">The<span class="w w2"> </span>heuristic<span class="w w1"> </span>considers<span class="w w1"> </span>the<span class="w w2"> </span>set</div><div class="l ff s4 t0" style="bottom:86.6292px;left:176.891px;" data-x="176.891" data-y="88.3687" hs="1">R</div><div class="l f2 s4 t0" style="bottom:86.432px;left:186.192px;" data-x="186.192" data-y="88.3687" hs="1">of<span class="w w2"> </span>values</div><div class="l ff s4 t0" style="bottom:86.6292px;left:220.878px;" data-x="220.878" data-y="88.3687" hs="1">v</div><div class="l f2 s4 t0" style="bottom:86.432px;left:227.942px;" data-x="227.942" data-y="88.3687" hs="1">in<span class="w w2"> </span>registers<span class="w w1"> </span>imme-</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:53.9999px;" data-x="53.9999" data-y="78.406" hs="1">diately<span class="w w1"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>instruction<span class="w w1"> </span>for<span class="w w1"> </span>spilling.<span class="w w1"> </span>Let</div><div class="l ff s4 t0" style="bottom:76.6665px;left:241.91px;" data-x="241.91" data-y="78.406" hs="1">v</div><div class="l f10 s5 t0" style="bottom:76.2501px;left:246.387px;" data-x="246.387" data-y="77.4098" hs="1">m</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:256.025px;" data-x="256.025" data-y="78.406" hs="1">be<span class="w w1"> </span>the<span class="w w1"> </span>last</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:53.9999px;" data-x="53.9999" data-y="68.4434" hs="1">instruction<span class="w w2"> </span>before<span class="w w1"> </span>the<span class="w w1"> </span>current<span class="w w2"> </span>where<span class="w w1"> </span>each</div><div class="l ff s4 t0" style="bottom:66.7039px;left:203.802px;" data-x="203.802" data-y="68.4434" hs="1">v</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:210.911px;" data-x="210.911" data-y="68.4434" hs="1">is<span class="w w2"> </span>referred<span class="w w1"> </span>to.<span class="w w1"> </span>Then<span class="w w2"> </span>the</div><div class="l f2 s4 t0" style="bottom:711.089px;left:323.551px;" data-x="323.551" data-y="713.026" hs="1">Tag</div><div class="l f2 s4 t0" style="bottom:711.089px;left:348.956px;" data-x="348.956" data-y="713.026" hs="1">JS<span class="w w2"> </span>Type</div><div class="l f2 s4 t0" style="bottom:711.089px;left:396.274px;" data-x="396.274" data-y="713.026" hs="1">Description</div><div class="l f2 s4 t0" style="bottom:700.728px;left:323.551px;" data-x="323.551" data-y="702.665" hs="1">xx1</div><div class="l f2 s4 t0" style="bottom:700.728px;left:348.956px;" data-x="348.956" data-y="702.665" hs="1">number</div><div class="l f2 s4 t0" style="bottom:700.728px;left:396.274px;" data-x="396.274" data-y="702.665" hs="1">31-bit<span class="w w2"> </span>integer<span class="w w1"> </span>representation</div><div class="l f2 s4 t0" style="bottom:690.766px;left:323.551px;" data-x="323.551" data-y="692.702" hs="1">000</div><div class="l f2 s4 t0" style="bottom:690.766px;left:348.956px;" data-x="348.956" data-y="692.702" hs="1">object</div><div class="l f2 s4 t0" style="bottom:690.766px;left:396.274px;" data-x="396.274" data-y="692.702" hs="1">pointer<span class="w w2"> </span>to<span class="w w1"> </span>JSObject<span class="w w1"> </span>handle</div><div class="l f2 s4 t0" style="bottom:680.803px;left:323.551px;" data-x="323.551" data-y="682.74" hs="1">010</div><div class="l f2 s4 t0" style="bottom:680.803px;left:348.956px;" data-x="348.956" data-y="682.74" hs="1">number</div><div class="l f2 s4 t0" style="bottom:680.803px;left:396.274px;" data-x="396.274" data-y="682.74" hs="1">pointer<span class="w w2"> </span>to<span class="w w1"> </span>double<span class="w w1"> </span>handle</div><div class="l f2 s4 t0" style="bottom:670.84px;left:323.551px;" data-x="323.551" data-y="672.777" hs="1">100</div><div class="l f2 s4 t0" style="bottom:670.84px;left:348.956px;" data-x="348.956" data-y="672.777" hs="1">string</div><div class="l f2 s4 t0" style="bottom:670.84px;left:396.274px;" data-x="396.274" data-y="672.777" hs="1">pointer<span class="w w2"> </span>to<span class="w w1"> </span>JSString<span class="w w1"> </span>handle</div><div class="l f2 s4 t0" style="bottom:660.878px;left:323.551px;" data-x="323.551" data-y="662.815" hs="1">110</div><div class="l f2 s4 t0" style="bottom:660.878px;left:348.956px;" data-x="348.956" data-y="662.814" hs="1">boolean</div><div class="l f2 s4 t0" style="bottom:660.878px;left:396.274px;" data-x="396.274" data-y="662.814" hs="1">enumeration<span class="w w2"> </span>for<span class="w w1"> </span>null,<span class="w w1"> </span>undefined,<span class="w w2"> </span>true,<span class="w w1"> </span>false</div><div class="l f2 s4 t0" style="bottom:650.915px;left:348.956px;" data-x="348.956" data-y="652.852" hs="1">null,<span class="w w2"> </span>or</div><div class="l f2 s4 t0" style="bottom:640.952px;left:348.956px;" data-x="348.956" data-y="642.889" hs="1">undefined</div><div class="l f1 s4 t0" style="bottom:623.55px;left:317.014px;" data-x="317.014" data-y="625.424" hs="1">Figure<span class="w w1"> </span>9.<span class="w w0"> </span>Tagged<span class="w w1"> </span>values<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w0"> </span>SpiderMonkey<span class="w w1"> </span>JS<span class="w w1"> </span>interpreter.</div><div class="l f2 s4 t0" style="bottom:613.524px;left:317.014px;" data-x="317.014" data-y="615.461" hs="1">Testing<span class="w w2"> </span>tags,<span class="w w1"> </span>unboxing<span class="w w1"> </span>(extracting<span class="w w2"> </span>the<span class="w w1"> </span>untagged<span class="w w1"> </span>value)<span class="w w1"> </span>and<span class="w w2"> </span>boxing</div><div class="l f2 s4 t0" style="bottom:603.562px;left:317.014px;" data-x="317.014" data-y="605.498" hs="1">(creating<span class="w w1"> </span>tagged<span class="w w2"> </span>values)<span class="w w1"> </span>are<span class="w w1"> </span>significant<span class="w w1"> </span>costs.<span class="w w2"> </span>Avoiding<span class="w w1"> </span>these<span class="w w2"> </span>costs</div><div class="l f2 s4 t0" style="bottom:593.599px;left:317.014px;" data-x="317.014" data-y="595.536" hs="1">is<span class="w w2"> </span>a<span class="w w1"> </span>key<span class="w w2"> </span>benefit<span class="w w1"> </span>of<span class="w w1"> </span>tracing.</div><div class="l f2 s4 t0" style="bottom:556.514px;left:317.014px;" data-x="317.014" data-y="558.451" hs="1">heuristic<span class="w w1"> </span>selects</div><div class="l ff s4 t0" style="bottom:556.711px;left:377.839px;" data-x="377.839" data-y="558.451" hs="1">v</div><div class="l f2 s4 t0" style="bottom:556.514px;left:385.657px;" data-x="385.657" data-y="558.451" hs="1">with<span class="w w1"> </span>minimum</div><div class="l ff s4 t0" style="bottom:556.711px;left:442.52px;" data-x="442.52" data-y="558.451" hs="1">v</div><div class="l f10 s5 t0" style="bottom:556.295px;left:446.996px;" data-x="446.996" data-y="557.454" hs="1">m</div><div class="l f2 s4 t0" style="bottom:556.514px;left:454.032px;" data-x="454.032" data-y="558.451" hs="1">.<span class="w w1"> </span>The<span class="w w1"> </span>motivation<span class="w w1"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>this</div><div class="l f2 s4 t0" style="bottom:546.551px;left:317.014px;" data-x="317.014" data-y="548.488" hs="1">frees<span class="w w2"> </span>up<span class="w w1"> </span>a<span class="w w1"> </span>register<span class="w w2"> </span>for<span class="w w1"> </span>as<span class="w w2"> </span>long<span class="w w1"> </span>as<span class="w w1"> </span>possible<span class="w w2"> </span>given<span class="w w1"> </span>a<span class="w w2"> </span>single<span class="w w1"> </span>spill.</div><div class="l f2 s4 t0" style="bottom:536.589px;left:328.969px;" data-x="328.969" data-y="538.525" hs="1">If<span class="w w1"> </span>we<span class="w w0"> </span>need<span class="w w0"> </span>to<span class="w w1"> </span>spill<span class="w w0"> </span>a<span class="w w1"> </span>value</div><div class="l ff s4 t0" style="bottom:536.786px;left:433.684px;" data-x="433.684" data-y="538.525" hs="1">v</div><div class="l f10 s5 t0" style="bottom:536.369px;left:438.16px;" data-x="438.16" data-y="537.529" hs="1">s</div><div class="l f2 s4 t0" style="bottom:536.589px;left:445.832px;" data-x="445.832" data-y="538.525" hs="1">at<span class="w w1"> </span>this<span class="w w0"> </span>point,<span class="w w0"> </span>we<span class="w w1"> </span>generate<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:526.626px;left:317.014px;" data-x="317.014" data-y="528.563" hs="1">restore<span class="w w0"> </span>code<span class="w w1"> </span>just<span class="w w0"> </span>after<span class="w w0"> </span>the<span class="w w1"> </span>code<span class="w w0"> </span>for<span class="w w0"> </span>the<span class="w w1"> </span>current<span class="w w0"> </span>instruction.<span class="w w0"> </span>The</div><div class="l f2 s4 t0" style="bottom:516.663px;left:317.014px;" data-x="317.014" data-y="518.6" hs="1">corresponding<span class="w w2"> </span>spill<span class="w w1"> </span>code<span class="w w2"> </span>is<span class="w w1"> </span>generated<span class="w w1"> </span>just<span class="w w2"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>last<span class="w w1"> </span>point<span class="w w2"> </span>where</div><div class="l ff s4 t0" style="bottom:506.898px;left:317.014px;" data-x="317.014" data-y="508.637" hs="1">v</div><div class="l f10 s5 t0" style="bottom:506.482px;left:321.49px;" data-x="321.49" data-y="507.641" hs="1">s</div><div class="l f2 s4 t0" style="bottom:506.701px;left:327.529px;" data-x="327.529" data-y="508.637" hs="1">was<span class="w w2"> </span>used.<span class="w w1"> </span>The<span class="w w2"> </span>register<span class="w w1"> </span>that<span class="w w2"> </span>was<span class="w w2"> </span>assigned<span class="w w1"> </span>to</div><div class="l ff s4 t0" style="bottom:506.898px;left:482.291px;" data-x="482.291" data-y="508.637" hs="1">v</div><div class="l f10 s5 t0" style="bottom:506.482px;left:486.768px;" data-x="486.768" data-y="507.641" hs="1">s</div><div class="l f2 s4 t0" style="bottom:506.701px;left:492.807px;" data-x="492.807" data-y="508.637" hs="1">is<span class="w w2"> </span>marked<span class="w w1"> </span>free<span class="w w2"> </span>for</div><div class="l f2 s4 t0" style="bottom:496.738px;left:317.014px;" data-x="317.014" data-y="498.675" hs="1">the<span class="w w1"> </span>preceding<span class="w w1"> </span>code,<span class="w w0"> </span>because<span class="w w1"> </span>that<span class="w w1"> </span>register<span class="w w1"> </span>can<span class="w w0"> </span>now<span class="w w2"> </span>be<span class="w w0"> </span>used<span class="w w1"> </span>freely</div><div class="l f2 s4 t0" style="bottom:486.775px;left:317.014px;" data-x="317.014" data-y="488.712" hs="1">without<span class="w w2"> </span>affecting<span class="w w1"> </span>the<span class="w w2"> </span>following<span class="w w1"> </span>code</div><div class="l f1 s2 t0" style="bottom:461.807px;left:317.014px;" data-x="317.014" data-y="464.098" hs="1">6.<span class="w w3"> </span>Implementation</div><div class="l f2 s4 t0" style="bottom:448.213px;left:317.014px;" data-x="317.014" data-y="450.15" hs="1">To<span class="w w1"> </span>demonstrate<span class="w w0"> </span>the<span class="w w1"> </span>effectiveness<span class="w w0"> </span>of<span class="w w1"> </span>our<span class="w w0"> </span>approach,<span class="w w0"> </span>we<span class="w w1"> </span>have<span class="w w0"> </span>im-</div><div class="l f2 s4 t0" style="bottom:438.25px;left:317.014px;" data-x="317.014" data-y="440.187" hs="1">plemented<span class="w w1"> </span>a<span class="w w1"> </span>trace-based<span class="w w1"> </span>dynamic<span class="w w1"> </span>compiler<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>SpiderMonkey</div><div class="l f2 s4 t0" style="bottom:428.288px;left:317.014px;" data-x="317.014" data-y="430.225" hs="1">JavaScript<span class="w w1"> </span>Virtual<span class="w w0"> </span>Machine<span class="w w1"> </span>(4).<span class="w w0"> </span>SpiderMonkey<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>JavaScript</div><div class="l f2 s4 t0" style="bottom:418.325px;left:317.014px;" data-x="317.014" data-y="420.262" hs="1">VM<span class="w w1"> </span>embedded<span class="w w2"> </span>in<span class="w w1"> </span>Mozilla’s<span class="w w1"> </span>Firefox<span class="w w1"> </span>open-source<span class="w w1"> </span>web<span class="w w2"> </span>browser<span class="w w1"> </span>(2),</div><div class="l f2 s4 t0" style="bottom:408.363px;left:317.014px;" data-x="317.014" data-y="410.299" hs="1">which<span class="w w2"> </span>is<span class="w w1"> </span>used<span class="w w2"> </span>by<span class="w w2"> </span>more<span class="w w1"> </span>than<span class="w w2"> </span>200<span class="w w1"> </span>million<span class="w w2"> </span>users<span class="w w2"> </span>world-wide.<span class="w w1"> </span>The<span class="w w2"> </span>core</div><div class="l f2 s4 t0" style="bottom:398.4px;left:317.014px;" data-x="317.014" data-y="400.337" hs="1">of<span class="w w2"> </span>SpiderMonkey<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>bytecode<span class="w w1"> </span>interpreter<span class="w w2"> </span>implemented<span class="w w1"> </span>in<span class="w w1"> </span>C++.</div><div class="l f2 s4 t0" style="bottom:388.437px;left:328.969px;" data-x="328.969" data-y="390.374" hs="1">In<span class="w w1"> </span>SpiderMonkey,<span class="w w1"> </span>all<span class="w w1"> </span>JavaScript<span class="w w1"> </span>values<span class="w w1"> </span>are<span class="w w1"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:378.475px;left:317.014px;" data-x="317.014" data-y="380.411" hs="1">type</div><div class="l f7 s4 t0" style="bottom:378.421px;left:334.917px;" data-x="334.917" data-y="380.411" hs="1">jsval</div><div class="l f2 s4 t0" style="bottom:378.475px;left:358.453px;" data-x="358.453" data-y="380.411" hs="1">.<span class="w w1"> </span>A</div><div class="l f7 s4 t0" style="bottom:378.421px;left:372.095px;" data-x="372.095" data-y="380.411" hs="1">jsval</div><div class="l f2 s4 t0" style="bottom:378.475px;left:398.094px;" data-x="398.094" data-y="380.411" hs="1">is<span class="w w1"> </span>machine<span class="w w2"> </span>word<span class="w w1"> </span>in<span class="w w1"> </span>which<span class="w w1"> </span>up<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>3<span class="w w1"> </span>of<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:368.512px;left:317.014px;" data-x="317.014" data-y="370.449" hs="1">least<span class="w w2"> </span>significant<span class="w w1"> </span>bits<span class="w w1"> </span>are<span class="w w2"> </span>a<span class="w w1"> </span>type<span class="w w1"> </span>tag,<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>remaining<span class="w w2"> </span>bits<span class="w w1"> </span>are<span class="w w1"> </span>data.</div><div class="l f2 s4 t0" style="bottom:358.549px;left:317.014px;" data-x="317.014" data-y="360.486" hs="1">See<span class="w w1"> </span>Figure<span class="w w2"> </span>6<span class="w w1"> </span>for<span class="w w1"> </span>details.<span class="w w2"> </span>All<span class="w w1"> </span>pointers<span class="w w1"> </span>contained<span class="w w1"> </span>in</div><div class="l f7 s4 t0" style="bottom:358.496px;left:497.678px;" data-x="497.678" data-y="360.486" hs="1">jsvals</div><div class="l f2 s4 t0" style="bottom:358.549px;left:528.314px;" data-x="528.314" data-y="360.486" hs="1">point<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:348.587px;left:317.014px;" data-x="317.014" data-y="350.523" hs="1">GC-controlled<span class="w w2"> </span>blocks<span class="w w1"> </span>aligned<span class="w w1"> </span>on<span class="w w2"> </span>8-byte<span class="w w1"> </span>boundaries.</div><div class="l f2 s4 t0" style="bottom:338.624px;left:328.969px;" data-x="328.969" data-y="340.561" hs="1">JavaScript</div><div class="l fa s4 t0" style="bottom:338.83px;left:368.016px;" data-x="368.016" data-y="340.561" hs="1">object</div><div class="l f2 s4 t0" style="bottom:338.624px;left:392.189px;" data-x="392.189" data-y="340.561" hs="1">values<span class="w w2"> </span>are<span class="w w1"> </span>mappings<span class="w w2"> </span>of<span class="w w1"> </span>string-valued<span class="w w2"> </span>property</div><div class="l f2 s4 t0" style="bottom:328.661px;left:317.014px;" data-x="317.014" data-y="330.598" hs="1">names<span class="w w2"> </span>to<span class="w w1"> </span>arbitrary<span class="w w2"> </span>values.<span class="w w1"> </span>They<span class="w w2"> </span>are<span class="w w1"> </span>represented<span class="w w1"> </span>in<span class="w w2"> </span>one<span class="w w1"> </span>of<span class="w w2"> </span>two<span class="w w1"> </span>ways</div><div class="l f2 s4 t0" style="bottom:318.699px;left:317.014px;" data-x="317.014" data-y="320.636" hs="1">in<span class="w w1"> </span>SpiderMonkey.<span class="w w2"> </span>Most<span class="w w1"> </span>objects<span class="w w1"> </span>are<span class="w w1"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>shared<span class="w w1"> </span>struc-</div><div class="l f2 s4 t0" style="bottom:308.736px;left:317.014px;" data-x="317.014" data-y="310.673" hs="1">tural<span class="w w2"> </span>description,<span class="w w1"> </span>called<span class="w w2"> </span>the</div><div class="l fa s4 t0" style="bottom:308.942px;left:415.671px;" data-x="415.671" data-y="310.673" hs="1">object<span class="w w2"> </span>shape</div><div class="l f2 s4 t0" style="bottom:308.736px;left:460.445px;" data-x="460.445" data-y="310.673" hs="1">,<span class="w w2"> </span>that<span class="w w1"> </span>maps<span class="w w2"> </span>property<span class="w w2"> </span>names</div><div class="l f2 s4 t0" style="bottom:298.773px;left:317.014px;" data-x="317.014" data-y="300.71" hs="1">to<span class="w w1"> </span>array<span class="w w1"> </span>indexes<span class="w w1"> </span>using<span class="w w1"> </span>a<span class="w w1"> </span>hash<span class="w w1"> </span>table.<span class="w w1"> </span>The<span class="w w1"> </span>object<span class="w w1"> </span>stores<span class="w w1"> </span>a<span class="w w1"> </span>pointer<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:288.811px;left:317.014px;" data-x="317.014" data-y="290.748" hs="1">the<span class="w w1"> </span>shape<span class="w w1"> </span>and<span class="w w0"> </span>the<span class="w w1"> </span>array<span class="w w1"> </span>of<span class="w w0"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>property<span class="w w1"> </span>values.<span class="w w0"> </span>Objects<span class="w w1"> </span>with</div><div class="l f2 s4 t0" style="bottom:278.848px;left:317.014px;" data-x="317.014" data-y="280.785" hs="1">large,<span class="w w1"> </span>unique<span class="w w2"> </span>sets<span class="w w1"> </span>of<span class="w w1"> </span>property<span class="w w1"> </span>names<span class="w w1"> </span>store<span class="w w1"> </span>their<span class="w w1"> </span>properties<span class="w w1"> </span>directly</div><div class="l f2 s4 t0" style="bottom:268.886px;left:317.014px;" data-x="317.014" data-y="270.822" hs="1">in<span class="w w2"> </span>a<span class="w w1"> </span>hash<span class="w w1"> </span>table.</div><div class="l f2 s4 t0" style="bottom:258.923px;left:328.969px;" data-x="328.969" data-y="260.86" hs="1">The<span class="w w1"> </span>garbage<span class="w w0"> </span>collector<span class="w w1"> </span>is<span class="w w1"> </span>an<span class="w w0"> </span>exact,<span class="w w1"> </span>non-generational,<span class="w w1"> </span>stop-the-</div><div class="l f2 s4 t0" style="bottom:248.96px;left:317.014px;" data-x="317.014" data-y="250.897" hs="1">world<span class="w w2"> </span>mark-and-sweep<span class="w w1"> </span>collector.</div><div class="l f2 s4 t0" style="bottom:238.998px;left:328.969px;" data-x="328.969" data-y="240.934" hs="1">In<span class="w w2"> </span>the<span class="w w1"> </span>rest<span class="w w2"> </span>of<span class="w w1"> </span>this<span class="w w2"> </span>section<span class="w w2"> </span>we<span class="w w1"> </span>discuss<span class="w w2"> </span>key<span class="w w1"> </span>areas<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>TraceMon-</div><div class="l f2 s4 t0" style="bottom:229.035px;left:317.014px;" data-x="317.014" data-y="230.972" hs="1">key<span class="w w2"> </span>implementation.</div><div class="l f1 s4 t0" style="bottom:210.031px;left:317.014px;" data-x="317.014" data-y="211.905" hs="1">6.1<span class="w w10"> </span>Calling<span class="w w2"> </span>Compiled<span class="w w1"> </span>Traces</div><div class="l f2 s4 t0" style="bottom:196.021px;left:317.014px;" data-x="317.014" data-y="197.958" hs="1">Compiled<span class="w w1"> </span>traces<span class="w w1"> </span>are<span class="w w1"> </span>stored<span class="w w2"> </span>in<span class="w w1"> </span>a</div><div class="l fa s4 t0" style="bottom:196.227px;left:432.865px;" data-x="432.865" data-y="197.958" hs="1">trace<span class="w w1"> </span>cache</div><div class="l f2 s4 t0" style="bottom:196.021px;left:474.556px;" data-x="474.556" data-y="197.958" hs="1">,<span class="w w1"> </span>indexed<span class="w w2"> </span>by<span class="w w1"> </span>intepreter</div><div class="l f2 s4 t0" style="bottom:186.058px;left:317.014px;" data-x="317.014" data-y="187.995" hs="1">PC<span class="w w0"> </span>and<span class="w w0"> </span>type<span class="w w4"> </span>map.<span class="w w0"> </span>Traces<span class="w w0"> </span>are<span class="w w0"> </span>compiled<span class="w w4"> </span>so<span class="w w0"> </span>that<span class="w w0"> </span>they<span class="w w4"> </span>may<span class="w w0"> </span>be</div><div class="l f2 s4 t0" style="bottom:176.096px;left:317.014px;" data-x="317.014" data-y="178.032" hs="1">called<span class="w w1"> </span>as<span class="w w2"> </span>functions<span class="w w1"> </span>using<span class="w w1"> </span>standard<span class="w w1"> </span>native<span class="w w2"> </span>calling<span class="w w1"> </span>conventions<span class="w w1"> </span>(e.g.,</div><div class="l f7 s4 t0" style="bottom:166.079px;left:317.014px;" data-x="317.014" data-y="168.07" hs="1">FASTCALL</div><div class="l f2 s4 t0" style="bottom:166.133px;left:356.914px;" data-x="356.914" data-y="168.07" hs="1">on<span class="w w2"> </span>x86).</div><div class="l f2 s4 t0" style="bottom:156.17px;left:328.969px;" data-x="328.969" data-y="158.107" hs="1">The<span class="w w1"> </span>interpreter<span class="w w1"> </span>must<span class="w w0"> </span>hit<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>edge<span class="w w0"> </span>and<span class="w w1"> </span>enter<span class="w w1"> </span>the<span class="w w1"> </span>monitor<span class="w w0"> </span>in</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.145" hs="1">order<span class="w w2"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>a<span class="w w2"> </span>native<span class="w w1"> </span>trace<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w2"> </span>time.<span class="w w1"> </span>The<span class="w w1"> </span>monitor<span class="w w2"> </span>computes</div><div class="l f2 s4 t0" style="bottom:136.245px;left:317.014px;" data-x="317.014" data-y="138.182" hs="1">the<span class="w w1"> </span>current<span class="w w0"> </span>type<span class="w w1"> </span>map,<span class="w w0"> </span>checks<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>cache<span class="w w0"> </span>for<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>for<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">current<span class="w w2"> </span>PC<span class="w w1"> </span>and<span class="w w1"> </span>type<span class="w w2"> </span>map,<span class="w w1"> </span>and<span class="w w1"> </span>if<span class="w w2"> </span>it<span class="w w1"> </span>finds<span class="w w2"> </span>one,<span class="w w1"> </span>executes<span class="w w1"> </span>the<span class="w w2"> </span>trace.</div><div class="l f2 s4 t0" style="bottom:116.32px;left:328.969px;" data-x="328.969" data-y="118.257" hs="1">To<span class="w w1"> </span>execute<span class="w w1"> </span>a<span class="w w0"> </span>trace,<span class="w w1"> </span>the<span class="w w0"> </span>monitor<span class="w w1"> </span>must<span class="w w0"> </span>build<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>activation</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">record<span class="w w1"> </span>containing<span class="w w1"> </span>imported<span class="w w0"> </span>local<span class="w w1"> </span>and<span class="w w1"> </span>global<span class="w w1"> </span>variables,<span class="w w1"> </span>temporary</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:317.014px;" data-x="317.014" data-y="98.3313" hs="1">stack<span class="w w1"> </span>space,<span class="w w2"> </span>and<span class="w w1"> </span>space<span class="w w1"> </span>for<span class="w w1"> </span>arguments<span class="w w2"> </span>to<span class="w w1"> </span>native<span class="w w2"> </span>calls.<span class="w w1"> </span>The<span class="w w1"> </span>local<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">global<span class="w w1"> </span>values<span class="w w2"> </span>are<span class="w w1"> </span>then<span class="w w1"> </span>copied<span class="w w2"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>state<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">activation<span class="w w2"> </span>record.<span class="w w1"> </span>Then,<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>is<span class="w w1"> </span>called<span class="w w1"> </span>like<span class="w w2"> </span>a<span class="w w1"> </span>normal<span class="w w2"> </span>C<span class="w w1"> </span>function</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:317.014px;" data-x="317.014" data-y="68.4434" hs="1">pointer.</div></div></div><div id="page-9" class="p" style="width:612px;height:792px;background-image:url(p9.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f2 s4 t0" style="bottom:710.093px;left:65.9552px;" data-x="65.9552" data-y="712.03" hs="1">When<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>call<span class="w w1"> </span>returns,<span class="w w1"> </span>the<span class="w w1"> </span>monitor<span class="w w0"> </span>restores<span class="w w1"> </span>the<span class="w w1"> </span>interpreter</div><div class="l f2 s4 t0" style="bottom:700.13px;left:54px;" data-x="54" data-y="702.067" hs="1">state.<span class="w w1"> </span>First,<span class="w w0"> </span>the<span class="w w1"> </span>monitor<span class="w w0"> </span>checks<span class="w w1"> </span>the<span class="w w0"> </span>reason<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>exit<span class="w w0"> </span>and</div><div class="l f2 s4 t0" style="bottom:690.168px;left:54px;" data-x="54" data-y="692.105" hs="1">applies<span class="w w1"> </span>blacklisting<span class="w w1"> </span>if<span class="w w0"> </span>needed.<span class="w w1"> </span>Then,<span class="w w1"> </span>it<span class="w w1"> </span>pops<span class="w w0"> </span>or<span class="w w1"> </span>synthesizes<span class="w w1"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:680.205px;left:54px;" data-x="54" data-y="682.142" hs="1">preter<span class="w w1"> </span>JavaScript<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>frames<span class="w w2"> </span>as<span class="w w1"> </span>needed.<span class="w w1"> </span>Finally,<span class="w w2"> </span>it<span class="w w1"> </span>copies<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:670.243px;left:54px;" data-x="54" data-y="672.179" hs="1">imported<span class="w w1"> </span>variables<span class="w w2"> </span>back<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>activation<span class="w w1"> </span>record<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>in-</div><div class="l f2 s4 t0" style="bottom:660.28px;left:54px;" data-x="54" data-y="662.217" hs="1">terpreter<span class="w w2"> </span>state.</div><div class="l f2 s4 t0" style="bottom:650.317px;left:65.9552px;" data-x="65.9552" data-y="652.254" hs="1">At<span class="w w1"> </span>least<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>implementation,<span class="w w1"> </span>these<span class="w w1"> </span>steps<span class="w w1"> </span>have<span class="w w1"> </span>a<span class="w w1"> </span>non-</div><div class="l f2 s4 t0" style="bottom:640.355px;left:54px;" data-x="54" data-y="642.291" hs="1">negligible<span class="w w1"> </span>runtime<span class="w w1"> </span>cost,<span class="w w1"> </span>so<span class="w w1"> </span>minimizing<span class="w w1"> </span>the<span class="w w0"> </span>number<span class="w w2"> </span>of<span class="w w0"> </span>interpreter-</div><div class="l f2 s4 t0" style="bottom:630.392px;left:54px;" data-x="54" data-y="632.329" hs="1">to-trace<span class="w w1"> </span>and<span class="w w1"> </span>trace-to-interpreter<span class="w w0"> </span>transitions<span class="w w1"> </span>is<span class="w w1"> </span>essential<span class="w w1"> </span>for<span class="w w1"> </span>perfor-</div><div class="l f2 s4 t0" style="bottom:620.429px;left:54px;" data-x="54" data-y="622.366" hs="1">mance.<span class="w w0"> </span>(see<span class="w w1"> </span>also<span class="w w0"> </span>Section<span class="w w1"> </span>3.3).<span class="w w0"> </span>Our<span class="w w1"> </span>experiments<span class="w w0"> </span>(see<span class="w w0"> </span>Figure<span class="w w1"> </span>12)</div><div class="l f2 s4 t0" style="bottom:610.467px;left:54px;" data-x="54" data-y="612.404" hs="1">show<span class="w w1"> </span>that<span class="w w0"> </span>for<span class="w w1"> </span>programs<span class="w w0"> </span>we<span class="w w0"> </span>can<span class="w w1"> </span>trace<span class="w w0"> </span>well<span class="w w1"> </span>such<span class="w w0"> </span>transitions<span class="w w1"> </span>hap-</div><div class="l f2 s4 t0" style="bottom:600.504px;left:54px;" data-x="54" data-y="602.441" hs="1">pen<span class="w w1"> </span>infrequently<span class="w w1"> </span>and<span class="w w1"> </span>hence<span class="w w1"> </span>do<span class="w w1"> </span>not<span class="w w1"> </span>contribute<span class="w w1"> </span>significantly<span class="w w1"> </span>to<span class="w w1"> </span>total</div><div class="l f2 s4 t0" style="bottom:590.541px;left:54px;" data-x="54" data-y="592.478" hs="1">runtime.<span class="w w1"> </span>In<span class="w w1"> </span>a<span class="w w0"> </span>few<span class="w w1"> </span>programs,<span class="w w1"> </span>where<span class="w w1"> </span>the<span class="w w0"> </span>system<span class="w w1"> </span>is<span class="w w1"> </span>prevented<span class="w w1"> </span>from</div><div class="l f2 s4 t0" style="bottom:580.579px;left:54px;" data-x="54" data-y="582.516" hs="1">recording<span class="w w1"> </span>branch<span class="w w1"> </span>traces<span class="w w1"> </span>for<span class="w w0"> </span>hot<span class="w w1"> </span>side<span class="w w1"> </span>exits<span class="w w1"> </span>by<span class="w w1"> </span>aborts,<span class="w w1"> </span>this<span class="w w0"> </span>cost<span class="w w2"> </span>can</div><div class="l f2 s4 t0" style="bottom:570.616px;left:54px;" data-x="54" data-y="572.553" hs="1">rise<span class="w w2"> </span>to<span class="w w1"> </span>up<span class="w w1"> </span>to<span class="w w2"> </span>10%<span class="w w1"> </span>of<span class="w w1"> </span>total<span class="w w2"> </span>execution<span class="w w1"> </span>time.</div><div class="l f1 s4 t0" style="bottom:551.75px;left:54px;" data-x="54" data-y="553.624" hs="1">6.2<span class="w w10"> </span>Trace<span class="w w2"> </span>Stitching</div><div class="l f2 s4 t0" style="bottom:537.739px;left:54px;" data-x="54" data-y="539.676" hs="1">Transitions<span class="w w1"> </span>from<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>to<span class="w w1"> </span>a<span class="w w0"> </span>branch<span class="w w2"> </span>trace<span class="w w0"> </span>at<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>avoid<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:527.777px;left:54px;" data-x="54" data-y="529.714" hs="1">costs<span class="w w1"> </span>of<span class="w w1"> </span>calling<span class="w w0"> </span>traces<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>monitor,<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w0"> </span>feature<span class="w w1"> </span>called</div><div class="l fa s4 t0" style="bottom:527.983px;left:274.812px;" data-x="274.812" data-y="529.714" hs="1">trace</div><div class="l fa s4 t0" style="bottom:518.02px;left:54px;" data-x="54" data-y="519.751" hs="1">stitching</div><div class="l f2 s4 t0" style="bottom:517.814px;left:84.7542px;" data-x="84.7542" data-y="519.751" hs="1">.<span class="w w1"> </span>At<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit,<span class="w w1"> </span>the<span class="w w0"> </span>exiting<span class="w w2"> </span>trace<span class="w w1"> </span>only<span class="w w0"> </span>needs<span class="w w2"> </span>to<span class="w w0"> </span>write<span class="w w2"> </span>live</div><div class="l f2 s4 t0" style="bottom:507.852px;left:54px;" data-x="54" data-y="509.788" hs="1">register-carried<span class="w w2"> </span>values<span class="w w2"> </span>back<span class="w w1"> </span>to<span class="w w2"> </span>its<span class="w w1"> </span>trace<span class="w w2"> </span>activation<span class="w w2"> </span>record.<span class="w w1"> </span>In<span class="w w2"> </span>our<span class="w w1"> </span>im-</div><div class="l f2 s4 t0" style="bottom:497.889px;left:54px;" data-x="54" data-y="499.826" hs="1">plementation,<span class="w w1"> </span>identical<span class="w w1"> </span>type<span class="w w2"> </span>maps<span class="w w1"> </span>yield<span class="w w1"> </span>identical<span class="w w1"> </span>activation<span class="w w1"> </span>record</div><div class="l f2 s4 t0" style="bottom:487.926px;left:54px;" data-x="54" data-y="489.863" hs="1">layouts,<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>activation<span class="w w2"> </span>record<span class="w w0"> </span>can<span class="w w1"> </span>be<span class="w w1"> </span>reused<span class="w w1"> </span>immediately</div><div class="l f2 s4 t0" style="bottom:477.964px;left:54px;" data-x="54" data-y="479.9" hs="1">by<span class="w w2"> </span>the<span class="w w1"> </span>branch<span class="w w1"> </span>trace.</div><div class="l f2 s4 t0" style="bottom:468.001px;left:65.9552px;" data-x="65.9552" data-y="469.938" hs="1">In<span class="w w1"> </span>programs<span class="w w0"> </span>with<span class="w w1"> </span>branchy<span class="w w1"> </span>trace<span class="w w0"> </span>trees<span class="w w1"> </span>with<span class="w w0"> </span>small<span class="w w1"> </span>traces,<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:458.038px;left:54px;" data-x="54" data-y="459.975" hs="1">stitching<span class="w w1"> </span>has<span class="w w0"> </span>a<span class="w w1"> </span>noticeable<span class="w w1"> </span>cost.<span class="w w1"> </span>Although<span class="w w0"> </span>writing<span class="w w1"> </span>to<span class="w w1"> </span>memory<span class="w w0"> </span>and</div><div class="l f2 s4 t0" style="bottom:448.076px;left:54px;" data-x="54" data-y="450.012" hs="1">then<span class="w w0"> </span>soon<span class="w w0"> </span>reading<span class="w w0"> </span>back<span class="w w1"> </span>would<span class="w w0"> </span>be<span class="w w0"> </span>expected<span class="w w0"> </span>to<span class="w w0"> </span>have<span class="w w1"> </span>a<span class="w w0"> </span>high<span class="w w0"> </span>L1</div><div class="l f2 s4 t0" style="bottom:438.113px;left:54px;" data-x="54" data-y="440.05" hs="1">cache<span class="w w1"> </span>hit<span class="w w1"> </span>rate,<span class="w w1"> </span>for<span class="w w1"> </span>small<span class="w w1"> </span>traces<span class="w w1"> </span>the<span class="w w1"> </span>increased<span class="w w1"> </span>instruction<span class="w w1"> </span>count<span class="w w1"> </span>has</div><div class="l f2 s4 t0" style="bottom:428.15px;left:54px;" data-x="54" data-y="430.087" hs="1">a<span class="w w0"> </span>noticeable<span class="w w0"> </span>cost.<span class="w w0"> </span>Also,<span class="w w1"> </span>if<span class="w w0"> </span>the<span class="w w0"> </span>writes<span class="w w0"> </span>and<span class="w w0"> </span>reads<span class="w w0"> </span>are<span class="w w0"> </span>very<span class="w w0"> </span>close</div><div class="l f2 s4 t0" style="bottom:418.188px;left:54px;" data-x="54" data-y="420.125" hs="1">in<span class="w w0"> </span>the<span class="w w0"> </span>dynamic<span class="w w0"> </span>instruction<span class="w w0"> </span>stream,<span class="w w1"> </span>we<span class="w w0"> </span>have<span class="w w0"> </span>found<span class="w w0"> </span>that<span class="w w0"> </span>current</div><div class="l f2 s4 t0" style="bottom:408.225px;left:54px;" data-x="54" data-y="410.162" hs="1">x86<span class="w w1"> </span>processors<span class="w w1"> </span>often<span class="w w0"> </span>incur<span class="w w1"> </span>penalties<span class="w w1"> </span>of<span class="w w0"> </span>6<span class="w w1"> </span>cycles<span class="w w1"> </span>or<span class="w w1"> </span>more<span class="w w0"> </span>(e.g.,<span class="w w1"> </span>if</div><div class="l f2 s4 t0" style="bottom:398.262px;left:54px;" data-x="54" data-y="400.199" hs="1">the<span class="w w1"> </span>instructions<span class="w w1"> </span>use<span class="w w1"> </span>different<span class="w w1"> </span>base<span class="w w1"> </span>registers<span class="w w1"> </span>with<span class="w w1"> </span>equal<span class="w w0"> </span>values,<span class="w w2"> </span>the</div><div class="l f2 s4 t0" style="bottom:388.3px;left:54px;" data-x="54" data-y="390.237" hs="1">processor<span class="w w2"> </span>may<span class="w w1"> </span>not<span class="w w1"> </span>be<span class="w w2"> </span>able<span class="w w1"> </span>to<span class="w w1"> </span>detect<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w2"> </span>addresses<span class="w w1"> </span>are<span class="w w1"> </span>the<span class="w w2"> </span>same</div><div class="l f2 s4 t0" style="bottom:378.337px;left:54px;" data-x="54" data-y="380.274" hs="1">right<span class="w w2"> </span>away).</div><div class="l f2 s4 t0" style="bottom:368.375px;left:65.9552px;" data-x="65.9552" data-y="370.311" hs="1">The<span class="w w1"> </span>alternate<span class="w w1"> </span>solution<span class="w w1"> </span>is<span class="w w1"> </span>to<span class="w w1"> </span>recompile<span class="w w1"> </span>an<span class="w w1"> </span>entire<span class="w w1"> </span>trace<span class="w w1"> </span>tree,<span class="w w1"> </span>thus</div><div class="l f2 s4 t0" style="bottom:358.412px;left:54px;" data-x="54" data-y="360.349" hs="1">achieving<span class="w w1"> </span>inter-trace<span class="w w1"> </span>register<span class="w w1"> </span>allocation<span class="w w0"> </span>(10).<span class="w w1"> </span>The<span class="w w1"> </span>disadvantage<span class="w w1"> </span>is</div><div class="l f2 s4 t0" style="bottom:348.449px;left:54px;" data-x="54" data-y="350.386" hs="1">that<span class="w w2"> </span>tree<span class="w w2"> </span>recompilation<span class="w w1"> </span>takes<span class="w w2"> </span>time<span class="w w1"> </span>quadratic<span class="w w2"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>number<span class="w w2"> </span>of<span class="w w2"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:338.487px;left:54px;" data-x="54" data-y="340.423" hs="1">We<span class="w w1"> </span>believe<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>cost<span class="w w1"> </span>of<span class="w w0"> </span>recompiling<span class="w w0"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>tree<span class="w w1"> </span>every<span class="w w0"> </span>time</div><div class="l f2 s4 t0" style="bottom:328.524px;left:54px;" data-x="54" data-y="330.461" hs="1">a<span class="w w1"> </span>branch<span class="w w0"> </span>is<span class="w w1"> </span>added<span class="w w0"> </span>would<span class="w w1"> </span>be<span class="w w0"> </span>prohibitive.<span class="w w1"> </span>That<span class="w w1"> </span>problem<span class="w w0"> </span>might<span class="w w1"> </span>be</div><div class="l f2 s4 t0" style="bottom:318.561px;left:54px;" data-x="54" data-y="320.498" hs="1">mitigated<span class="w w1"> </span>by<span class="w w1"> </span>recompiling<span class="w w0"> </span>only<span class="w w1"> </span>at<span class="w w1"> </span>certain<span class="w w0"> </span>points,<span class="w w1"> </span>or<span class="w w1"> </span>only<span class="w w1"> </span>for<span class="w w0"> </span>very</div><div class="l f2 s4 t0" style="bottom:308.599px;left:54px;" data-x="54" data-y="310.536" hs="1">hot,<span class="w w2"> </span>stable<span class="w w1"> </span>trees.</div><div class="l f2 s4 t0" style="bottom:298.636px;left:65.9552px;" data-x="65.9552" data-y="300.573" hs="1">In<span class="w w1"> </span>the<span class="w w0"> </span>future,<span class="w w1"> </span>multicore<span class="w w1"> </span>hardware<span class="w w0"> </span>is<span class="w w1"> </span>expected<span class="w w1"> </span>to<span class="w w0"> </span>be<span class="w w1"> </span>common,</div><div class="l f2 s4 t0" style="bottom:288.673px;left:54px;" data-x="54" data-y="290.61" hs="1">making<span class="w w1"> </span>background<span class="w w1"> </span>tree<span class="w w1"> </span>recompilation<span class="w w0"> </span>attractive.<span class="w w2"> </span>In<span class="w w0"> </span>a<span class="w w1"> </span>closely<span class="w w1"> </span>re-</div><div class="l f2 s4 t0" style="bottom:278.711px;left:54px;" data-x="54" data-y="280.648" hs="1">lated<span class="w w1"> </span>project<span class="w w0"> </span>(13)<span class="w w1"> </span>background<span class="w w1"> </span>recompilation<span class="w w1"> </span>yielded<span class="w w0"> </span>speedups<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:268.748px;left:54px;" data-x="54" data-y="270.685" hs="1">up<span class="w w1"> </span>to<span class="w w1"> </span>1.25x<span class="w w1"> </span>on<span class="w w0"> </span>benchmarks<span class="w w1"> </span>with<span class="w w1"> </span>many<span class="w w1"> </span>branch<span class="w w1"> </span>traces.<span class="w w1"> </span>We<span class="w w1"> </span>plan<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:258.786px;left:54px;" data-x="54" data-y="260.722" hs="1">apply<span class="w w2"> </span>this<span class="w w1"> </span>technique<span class="w w1"> </span>to<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>as<span class="w w2"> </span>future<span class="w w1"> </span>work.</div><div class="l f1 s4 t0" style="bottom:239.919px;left:54px;" data-x="54" data-y="241.793" hs="1">6.3<span class="w w10"> </span>Trace<span class="w w2"> </span>Recording</div><div class="l f2 s4 t0" style="bottom:225.909px;left:54px;" data-x="54" data-y="227.846" hs="1">The<span class="w w2"> </span>job<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>recorder<span class="w w2"> </span>is<span class="w w2"> </span>to<span class="w w1"> </span>emit<span class="w w2"> </span>LIR<span class="w w2"> </span>with<span class="w w1"> </span>identical<span class="w w2"> </span>semantics</div><div class="l f2 s4 t0" style="bottom:215.946px;left:54px;" data-x="54" data-y="217.883" hs="1">to<span class="w w1"> </span>the<span class="w w1"> </span>currently<span class="w w1"> </span>running<span class="w w2"> </span>interpreter<span class="w w1"> </span>bytecode<span class="w w1"> </span>trace.<span class="w w1"> </span>A<span class="w w1"> </span>good<span class="w w1"> </span>imple-</div><div class="l f2 s4 t0" style="bottom:205.984px;left:54px;" data-x="54" data-y="207.92" hs="1">mentation<span class="w w1"> </span>should<span class="w w1"> </span>have<span class="w w1"> </span>low<span class="w w1"> </span>impact<span class="w w1"> </span>on<span class="w w1"> </span>non-tracing<span class="w w1"> </span>interpreter<span class="w w1"> </span>per-</div><div class="l f2 s4 t0" style="bottom:196.021px;left:54px;" data-x="54" data-y="197.958" hs="1">formance<span class="w w1"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>convenient<span class="w w1"> </span>way<span class="w w1"> </span>for<span class="w w1"> </span>implementers<span class="w w1"> </span>to<span class="w w0"> </span>maintain<span class="w w2"> </span>se-</div><div class="l f2 s4 t0" style="bottom:186.058px;left:54px;" data-x="54" data-y="187.995" hs="1">mantic<span class="w w2"> </span>equivalence.</div><div class="l f2 s4 t0" style="bottom:176.096px;left:65.9552px;" data-x="65.9552" data-y="178.032" hs="1">In<span class="w w2"> </span>our<span class="w w1"> </span>implementation,<span class="w w2"> </span>the<span class="w w1"> </span>only<span class="w w1"> </span>direct<span class="w w2"> </span>modification<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:166.133px;left:54px;" data-x="54" data-y="168.07" hs="1">preter<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>call<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>monitor<span class="w w1"> </span>at<span class="w w2"> </span>loop<span class="w w1"> </span>edges.<span class="w w1"> </span>In<span class="w w2"> </span>our<span class="w w1"> </span>benchmark</div><div class="l f2 s4 t0" style="bottom:156.17px;left:54px;" data-x="54" data-y="158.107" hs="1">results<span class="w w1"> </span>(see<span class="w w1"> </span>Figure<span class="w w1"> </span>12)<span class="w w1"> </span>the<span class="w w0"> </span>total<span class="w w2"> </span>time<span class="w w0"> </span>spent<span class="w w2"> </span>in<span class="w w0"> </span>the<span class="w w2"> </span>monitor<span class="w w0"> </span>(for<span class="w w2"> </span>all</div><div class="l f2 s4 t0" style="bottom:146.208px;left:54px;" data-x="54" data-y="148.145" hs="1">activities)<span class="w w1"> </span>is<span class="w w1"> </span>usually<span class="w w0"> </span>less<span class="w w1"> </span>than<span class="w w1"> </span>5%,<span class="w w1"> </span>so<span class="w w0"> </span>we<span class="w w1"> </span>consider<span class="w w1"> </span>the<span class="w w1"> </span>interpreter</div><div class="l f2 s4 t0" style="bottom:136.245px;left:54px;" data-x="54" data-y="138.182" hs="1">impact<span class="w w1"> </span>requirement<span class="w w1"> </span>met.<span class="w w1"> </span>Incrementing<span class="w w0"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>hit<span class="w w1"> </span>counter<span class="w w1"> </span>is<span class="w w1"> </span>ex-</div><div class="l f2 s4 t0" style="bottom:126.282px;left:54px;" data-x="54" data-y="128.219" hs="1">pensive<span class="w w2"> </span>because<span class="w w2"> </span>it<span class="w w1"> </span>requires<span class="w w2"> </span>us<span class="w w1"> </span>to<span class="w w2"> </span>look<span class="w w2"> </span>up<span class="w w1"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>in<span class="w w2"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>cache,</div><div class="l f2 s4 t0" style="bottom:116.32px;left:54px;" data-x="54" data-y="118.257" hs="1">but<span class="w w2"> </span>we<span class="w w1"> </span>have<span class="w w1"> </span>tuned<span class="w w1"> </span>our<span class="w w1"> </span>loops<span class="w w2"> </span>to<span class="w w1"> </span>become<span class="w w1"> </span>hot<span class="w w1"> </span>and<span class="w w1"> </span>trace<span class="w w2"> </span>very<span class="w w1"> </span>quickly</div><div class="l f2 s4 t0" style="bottom:106.357px;left:54px;" data-x="54" data-y="108.294" hs="1">(on<span class="w w2"> </span>the<span class="w w1"> </span>second<span class="w w1"> </span>iteration).<span class="w w1"> </span>The<span class="w w2"> </span>hit<span class="w w1"> </span>counter<span class="w w1"> </span>implementation<span class="w w2"> </span>could<span class="w w1"> </span>be</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:54px;" data-x="54" data-y="98.3313" hs="1">improved,<span class="w w1"> </span>which<span class="w w1"> </span>might<span class="w w1"> </span>give<span class="w w2"> </span>us<span class="w w1"> </span>a<span class="w w1"> </span>small<span class="w w1"> </span>increase<span class="w w0"> </span>in<span class="w w2"> </span>overall<span class="w w1"> </span>perfor-</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:54px;" data-x="54" data-y="88.3686" hs="1">mance,<span class="w w1"> </span>as<span class="w w1"> </span>well<span class="w w1"> </span>as<span class="w w1"> </span>more<span class="w w1"> </span>flexibility<span class="w w1"> </span>with<span class="w w1"> </span>tuning<span class="w w1"> </span>hotness<span class="w w1"> </span>thresholds.</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:54px;" data-x="54" data-y="78.406" hs="1">Once<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w2"> </span>is<span class="w w1"> </span>blacklisted<span class="w w1"> </span>we<span class="w w1"> </span>never<span class="w w1"> </span>call<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>monitor<span class="w w1"> </span>for</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:54px;" data-x="54" data-y="68.4433" hs="1">that<span class="w w2"> </span>loop<span class="w w1"> </span>(see<span class="w w1"> </span>Section<span class="w w2"> </span>3.3).</div><div class="l f2 s4 t0" style="bottom:710.093px;left:328.969px;" data-x="328.969" data-y="712.03" hs="1">Recording<span class="w w0"> </span>is<span class="w w1"> </span>activated<span class="w w0"> </span>by<span class="w w1"> </span>a<span class="w w0"> </span>pointer<span class="w w1"> </span>swap<span class="w w0"> </span>that<span class="w w0"> </span>sets<span class="w w1"> </span>the<span class="w w0"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:700.13px;left:317.014px;" data-x="317.014" data-y="702.067" hs="1">preter’s<span class="w w1"> </span>dispatch<span class="w w1"> </span>table<span class="w w0"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>a<span class="w w0"> </span>single<span class="w w1"> </span>“interrupt”<span class="w w0"> </span>routine<span class="w w1"> </span>for<span class="w w1"> </span>ev-</div><div class="l f2 s4 t0" style="bottom:690.168px;left:317.014px;" data-x="317.014" data-y="692.105" hs="1">ery<span class="w w1"> </span>bytecode.<span class="w w1"> </span>The<span class="w w0"> </span>interrupt<span class="w w1"> </span>routine<span class="w w1"> </span>first<span class="w w0"> </span>calls<span class="w w1"> </span>a<span class="w w1"> </span>bytecode-specific</div><div class="l f2 s4 t0" style="bottom:680.205px;left:317.014px;" data-x="317.014" data-y="682.142" hs="1">recording<span class="w w1"> </span>routine.<span class="w w0"> </span>Then,<span class="w w1"> </span>it<span class="w w1"> </span>turns<span class="w w0"> </span>off<span class="w w1"> </span>recording<span class="w w1"> </span>if<span class="w w0"> </span>necessary<span class="w w1"> </span>(e.g.,</div><div class="l f2 s4 t0" style="bottom:670.243px;left:317.014px;" data-x="317.014" data-y="672.179" hs="1">the<span class="w w1"> </span>trace<span class="w w1"> </span>ended).<span class="w w2"> </span>Finally,<span class="w w1"> </span>it<span class="w w1"> </span>jumps<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>standard<span class="w w2"> </span>interpreter<span class="w w1"> </span>byte-</div><div class="l f2 s4 t0" style="bottom:660.28px;left:317.014px;" data-x="317.014" data-y="662.217" hs="1">code<span class="w w2"> </span>implementation.<span class="w w2"> </span>Some<span class="w w1"> </span>bytecodes<span class="w w2"> </span>have<span class="w w2"> </span>effects<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w2"> </span>type<span class="w w2"> </span>map</div><div class="l f2 s4 t0" style="bottom:650.317px;left:317.014px;" data-x="317.014" data-y="652.254" hs="1">that<span class="w w1"> </span>cannot<span class="w w1"> </span>be<span class="w w1"> </span>predicted<span class="w w1"> </span>before<span class="w w1"> </span>executing<span class="w w1"> </span>the<span class="w w1"> </span>bytecode<span class="w w1"> </span>(e.g.,<span class="w w1"> </span>call-</div><div class="l f2 s4 t0" style="bottom:640.355px;left:317.014px;" data-x="317.014" data-y="642.291" hs="1">ing</div><div class="l f7 s4 t0" style="bottom:640.301px;left:331.189px;" data-x="331.189" data-y="642.291" hs="1">String.charCodeAt</div><div class="l f2 s4 t0" style="bottom:640.355px;left:411.213px;" data-x="411.213" data-y="642.291" hs="1">,<span class="w w1"> </span>which<span class="w w1"> </span>returns<span class="w w1"> </span>an<span class="w w1"> </span>integer<span class="w w1"> </span>or</div><div class="l fa s4 t0" style="bottom:640.561px;left:517.267px;" data-x="517.267" data-y="642.291" hs="1">NaN</div><div class="l f2 s4 t0" style="bottom:640.355px;left:536.965px;" data-x="536.965" data-y="642.291" hs="1">if<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:630.392px;left:317.014px;" data-x="317.014" data-y="632.329" hs="1">index<span class="w w2"> </span>argument<span class="w w1"> </span>is<span class="w w2"> </span>out<span class="w w1"> </span>of<span class="w w2"> </span>range).<span class="w w2"> </span>For<span class="w w1"> </span>these,<span class="w w2"> </span>we<span class="w w1"> </span>arrange<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:620.429px;left:317.014px;" data-x="317.014" data-y="622.366" hs="1">preter<span class="w w1"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>recorder<span class="w w1"> </span>again<span class="w w1"> </span>after<span class="w w1"> </span>executing<span class="w w1"> </span>the<span class="w w1"> </span>bytecode.</div><div class="l f2 s4 t0" style="bottom:610.467px;left:317.014px;" data-x="317.014" data-y="612.404" hs="1">Since<span class="w w1"> </span>such<span class="w w1"> </span>hooks<span class="w w1"> </span>are<span class="w w1"> </span>relatively<span class="w w2"> </span>rare,<span class="w w1"> </span>we<span class="w w1"> </span>embed<span class="w w1"> </span>them<span class="w w1"> </span>directly<span class="w w1"> </span>into</div><div class="l f2 s4 t0" style="bottom:600.504px;left:317.014px;" data-x="317.014" data-y="602.441" hs="1">the<span class="w w1"> </span>interpreter,<span class="w w1"> </span>with<span class="w w1"> </span>an<span class="w w1"> </span>additional<span class="w w1"> </span>runtime<span class="w w1"> </span>check<span class="w w1"> </span>to<span class="w w1"> </span>see<span class="w w1"> </span>whether<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:590.541px;left:317.014px;" data-x="317.014" data-y="592.478" hs="1">recorder<span class="w w2"> </span>is<span class="w w1"> </span>currently<span class="w w1"> </span>active.</div><div class="l f2 s4 t0" style="bottom:580.579px;left:328.969px;" data-x="328.969" data-y="582.516" hs="1">While<span class="w w2"> </span>separating<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>from<span class="w w1"> </span>the<span class="w w2"> </span>recorder<span class="w w1"> </span>reduces<span class="w w1"> </span>indi-</div><div class="l f2 s4 t0" style="bottom:570.616px;left:317.014px;" data-x="317.014" data-y="572.553" hs="1">vidual<span class="w w2"> </span>code<span class="w w1"> </span>complexity,it<span class="w w1"> </span>also<span class="w w2"> </span>requires<span class="w w1"> </span>careful<span class="w w2"> </span>implementation<span class="w w2"> </span>and</div><div class="l f2 s4 t0" style="bottom:560.654px;left:317.014px;" data-x="317.014" data-y="562.59" hs="1">extensive<span class="w w2"> </span>testing<span class="w w1"> </span>to<span class="w w2"> </span>achieve<span class="w w1"> </span>semantic<span class="w w2"> </span>equivalence.</div><div class="l f2 s4 t0" style="bottom:550.691px;left:328.969px;" data-x="328.969" data-y="552.628" hs="1">In<span class="w w1"> </span>some<span class="w w1"> </span>cases<span class="w w1"> </span>achieving<span class="w w2"> </span>this<span class="w w1"> </span>equivalence<span class="w w1"> </span>is<span class="w w1"> </span>difficult<span class="w w1"> </span>since<span class="w w1"> </span>Spi-</div><div class="l f2 s4 t0" style="bottom:540.728px;left:317.014px;" data-x="317.014" data-y="542.665" hs="1">derMonkey<span class="w w1"> </span>follows<span class="w w1"> </span>a</div><div class="l fa s4 t0" style="bottom:540.934px;left:397.193px;" data-x="397.193" data-y="542.665" hs="1">fat-bytecode</div><div class="l f2 s4 t0" style="bottom:540.728px;left:444.318px;" data-x="444.318" data-y="542.665" hs="1">design,<span class="w w1"> </span>which<span class="w w1"> </span>was<span class="w w1"> </span>found<span class="w w1"> </span>to<span class="w w1"> </span>be</div><div class="l f2 s4 t0" style="bottom:530.766px;left:317.014px;" data-x="317.014" data-y="532.702" hs="1">beneficial<span class="w w2"> </span>to<span class="w w1"> </span>pure<span class="w w1"> </span>interpreter<span class="w w2"> </span>performance.</div><div class="l f2 s4 t0" style="bottom:520.803px;left:328.969px;" data-x="328.969" data-y="522.74" hs="1">In<span class="w w0"> </span>fat-bytecode<span class="w w1"> </span>designs,<span class="w w0"> </span>individual<span class="w w1"> </span>bytecodes<span class="w w0"> </span>can<span class="w w0"> </span>implement</div><div class="l f2 s4 t0" style="bottom:510.84px;left:317.014px;" data-x="317.014" data-y="512.777" hs="1">complex<span class="w w0"> </span>processing<span class="w w1"> </span>(e.g.,<span class="w w0"> </span>the</div><div class="l f7 s4 t0" style="bottom:510.787px;left:431.235px;" data-x="431.235" data-y="512.777" hs="1">getprop</div><div class="l f2 s4 t0" style="bottom:510.84px;left:468.185px;" data-x="468.185" data-y="512.777" hs="1">bytecode,<span class="w w0"> </span>which<span class="w w1"> </span>imple-</div><div class="l f2 s4 t0" style="bottom:500.878px;left:317.014px;" data-x="317.014" data-y="502.814" hs="1">ments<span class="w w2"> </span>full<span class="w w1"> </span>JavaScript<span class="w w2"> </span>property<span class="w w2"> </span>value<span class="w w1"> </span>access,<span class="w w2"> </span>including<span class="w w2"> </span>special<span class="w w1"> </span>cases</div><div class="l f2 s4 t0" style="bottom:490.915px;left:317.014px;" data-x="317.014" data-y="492.852" hs="1">for<span class="w w2"> </span>cached<span class="w w1"> </span>and<span class="w w1"> </span>dense<span class="w w2"> </span>array<span class="w w1"> </span>access).</div><div class="l f2 s4 t0" style="bottom:480.952px;left:328.969px;" data-x="328.969" data-y="482.889" hs="1">Fat<span class="w w0"> </span>bytecodes<span class="w w1"> </span>have<span class="w w0"> </span>two<span class="w w0"> </span>advantages:<span class="w w1"> </span>fewer<span class="w w0"> </span>bytecodes<span class="w w0"> </span>means</div><div class="l f2 s4 t0" style="bottom:470.99px;left:317.014px;" data-x="317.014" data-y="472.927" hs="1">lower<span class="w w2"> </span>dispatch<span class="w w1"> </span>cost,<span class="w w1"> </span>and<span class="w w2"> </span>bigger<span class="w w1"> </span>bytecode<span class="w w1"> </span>implementations<span class="w w2"> </span>give<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:461.027px;left:317.014px;" data-x="317.014" data-y="462.964" hs="1">compiler<span class="w w2"> </span>more<span class="w w1"> </span>opportunities<span class="w w1"> </span>to<span class="w w2"> </span>optimize<span class="w w1"> </span>the<span class="w w1"> </span>interpreter.</div><div class="l f2 s4 t0" style="bottom:451.064px;left:328.969px;" data-x="328.969" data-y="453.001" hs="1">Fat<span class="w w0"> </span>bytecodes<span class="w w1"> </span>are<span class="w w0"> </span>a<span class="w w0"> </span>problem<span class="w w1"> </span>for<span class="w w0"> </span>TraceMonkey<span class="w w1"> </span>because<span class="w w0"> </span>they</div><div class="l f2 s4 t0" style="bottom:441.102px;left:317.014px;" data-x="317.014" data-y="443.039" hs="1">require<span class="w w1"> </span>the<span class="w w0"> </span>recorder<span class="w w0"> </span>to<span class="w w1"> </span>reimplement<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w0"> </span>special<span class="w w1"> </span>case<span class="w w0"> </span>logic</div><div class="l f2 s4 t0" style="bottom:431.139px;left:317.014px;" data-x="317.014" data-y="433.076" hs="1">in<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w0"> </span>way.<span class="w w1"> </span>Also,<span class="w w0"> </span>the<span class="w w1"> </span>advantages<span class="w w0"> </span>are<span class="w w0"> </span>reduced<span class="w w1"> </span>because<span class="w w0"> </span>(a)</div><div class="l f2 s4 t0" style="bottom:421.177px;left:317.014px;" data-x="317.014" data-y="423.113" hs="1">dispatch<span class="w w1"> </span>costs<span class="w w0"> </span>are<span class="w w1"> </span>eliminated<span class="w w1"> </span>entirely<span class="w w0"> </span>in<span class="w w1"> </span>compiled<span class="w w1"> </span>traces,<span class="w w0"> </span>(b)<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:411.214px;left:317.014px;" data-x="317.014" data-y="413.151" hs="1">traces<span class="w w0"> </span>contain<span class="w w1"> </span>only<span class="w w0"> </span>one<span class="w w0"> </span>special<span class="w w0"> </span>case,<span class="w w0"> </span>not<span class="w w1"> </span>the<span class="w w0"> </span>interpreter’s<span class="w w0"> </span>large</div><div class="l f2 s4 t0" style="bottom:401.251px;left:317.014px;" data-x="317.014" data-y="403.188" hs="1">chunk<span class="w w1"> </span>of<span class="w w2"> </span>code,<span class="w w1"> </span>and<span class="w w1"> </span>(c)<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>spends<span class="w w1"> </span>less<span class="w w1"> </span>time<span class="w w1"> </span>running<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:391.289px;left:317.014px;" data-x="317.014" data-y="393.225" hs="1">base<span class="w w2"> </span>interpreter.</div><div class="l f2 s4 t0" style="bottom:381.326px;left:328.969px;" data-x="328.969" data-y="383.263" hs="1">One<span class="w w2"> </span>way<span class="w w1"> </span>we<span class="w w1"> </span>have<span class="w w2"> </span>mitigated<span class="w w2"> </span>these<span class="w w1"> </span>problems<span class="w w1"> </span>is<span class="w w2"> </span>by<span class="w w1"> </span>implementing</div><div class="l f2 s4 t0" style="bottom:371.363px;left:317.014px;" data-x="317.014" data-y="373.3" hs="1">certain<span class="w w1"> </span>complex<span class="w w1"> </span>bytecodes<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>recorder<span class="w w1"> </span>as<span class="w w1"> </span>sequences<span class="w w1"> </span>of<span class="w w1"> </span>simple</div><div class="l f2 s4 t0" style="bottom:361.401px;left:317.014px;" data-x="317.014" data-y="363.338" hs="1">bytecodes.<span class="w w2"> </span>Expressing<span class="w w2"> </span>the<span class="w w1"> </span>original<span class="w w2"> </span>semantics<span class="w w2"> </span>this<span class="w w2"> </span>way<span class="w w2"> </span>is<span class="w w1"> </span>not<span class="w w2"> </span>too<span class="w w2"> </span>dif-</div><div class="l f2 s4 t0" style="bottom:351.438px;left:317.014px;" data-x="317.014" data-y="353.375" hs="1">ficult,<span class="w w2"> </span>and<span class="w w1"> </span>recording<span class="w w1"> </span>simple<span class="w w2"> </span>bytecodes<span class="w w1"> </span>is<span class="w w2"> </span>much<span class="w w1"> </span>easier.<span class="w w2"> </span>This<span class="w w1"> </span>enables</div><div class="l f2 s4 t0" style="bottom:341.475px;left:317.014px;" data-x="317.014" data-y="343.412" hs="1">us<span class="w w2"> </span>to<span class="w w1"> </span>retain<span class="w w2"> </span>the<span class="w w1"> </span>advantages<span class="w w2"> </span>of<span class="w w1"> </span>fat<span class="w w2"> </span>bytecodes<span class="w w1"> </span>while<span class="w w2"> </span>avoiding<span class="w w1"> </span>some<span class="w w2"> </span>of</div><div class="l f2 s4 t0" style="bottom:331.513px;left:317.014px;" data-x="317.014" data-y="333.45" hs="1">their<span class="w w2"> </span>problems<span class="w w1"> </span>for<span class="w w1"> </span>trace<span class="w w2"> </span>recording.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w2"> </span>particularly<span class="w w1"> </span>effective<span class="w w2"> </span>for</div><div class="l f2 s4 t0" style="bottom:321.55px;left:317.014px;" data-x="317.014" data-y="323.487" hs="1">fat<span class="w w1"> </span>bytecodes<span class="w w2"> </span>that<span class="w w1"> </span>recurse<span class="w w1"> </span>back<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>interpreter,<span class="w w2"> </span>for<span class="w w1"> </span>example<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:311.588px;left:317.014px;" data-x="317.014" data-y="313.524" hs="1">convert<span class="w w2"> </span>an<span class="w w1"> </span>object<span class="w w1"> </span>into<span class="w w1"> </span>a<span class="w w1"> </span>primitive<span class="w w2"> </span>value<span class="w w1"> </span>by<span class="w w1"> </span>invoking<span class="w w2"> </span>a<span class="w w1"> </span>well-known</div><div class="l f2 s4 t0" style="bottom:301.625px;left:317.014px;" data-x="317.014" data-y="303.562" hs="1">method<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>object,<span class="w w2"> </span>since<span class="w w1"> </span>it<span class="w w1"> </span>lets<span class="w w2"> </span>us<span class="w w1"> </span>inline<span class="w w2"> </span>this<span class="w w1"> </span>function<span class="w w1"> </span>call.</div><div class="l f2 s4 t0" style="bottom:291.662px;left:328.969px;" data-x="328.969" data-y="293.599" hs="1">It<span class="w w1"> </span>is<span class="w w2"> </span>important<span class="w w1"> </span>to<span class="w w1"> </span>note<span class="w w1"> </span>that<span class="w w2"> </span>we<span class="w w1"> </span>split<span class="w w1"> </span>fat<span class="w w1"> </span>opcodes<span class="w w2"> </span>into<span class="w w1"> </span>thinner<span class="w w1"> </span>op-</div><div class="l f2 s4 t0" style="bottom:281.7px;left:317.014px;" data-x="317.014" data-y="283.636" hs="1">codes<span class="w w2"> </span>only<span class="w w1"> </span>during<span class="w w1"> </span>recording.<span class="w w2"> </span>When<span class="w w1"> </span>running<span class="w w1"> </span>purely<span class="w w2"> </span>interpretatively</div><div class="l f2 s4 t0" style="bottom:271.737px;left:317.014px;" data-x="317.014" data-y="273.674" hs="1">(i.e.<span class="w w2"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>has<span class="w w1"> </span>been<span class="w w2"> </span>blacklisted),<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>directly<span class="w w1"> </span>and<span class="w w1"> </span>ef-</div><div class="l f2 s4 t0" style="bottom:261.774px;left:317.014px;" data-x="317.014" data-y="263.711" hs="1">ficiently<span class="w w2"> </span>executes<span class="w w1"> </span>the<span class="w w2"> </span>fat<span class="w w1"> </span>opcodes.</div><div class="l f1 s4 t0" style="bottom:229.957px;left:317.014px;" data-x="317.014" data-y="231.831" hs="1">6.4<span class="w w10"> </span>Preemption</div><div class="l f2 s4 t0" style="bottom:215.946px;left:317.014px;" data-x="317.014" data-y="217.883" hs="1">SpiderMonkey,<span class="w w2"> </span>like<span class="w w2"> </span>many<span class="w w2"> </span>VMs,<span class="w w1"> </span>needs<span class="w w2"> </span>to<span class="w w1"> </span>preempt<span class="w w2"> </span>the<span class="w w1"> </span>user<span class="w w2"> </span>program</div><div class="l f2 s4 t0" style="bottom:205.984px;left:317.014px;" data-x="317.014" data-y="207.92" hs="1">periodically.<span class="w w1"> </span>The<span class="w w0"> </span>main<span class="w w0"> </span>reasons<span class="w w1"> </span>are<span class="w w0"> </span>to<span class="w w0"> </span>prevent<span class="w w1"> </span>infinitely<span class="w w0"> </span>looping</div><div class="l f2 s4 t0" style="bottom:196.021px;left:317.014px;" data-x="317.014" data-y="197.958" hs="1">scripts<span class="w w2"> </span>from<span class="w w1"> </span>locking<span class="w w1"> </span>up<span class="w w2"> </span>the<span class="w w1"> </span>host<span class="w w1"> </span>system<span class="w w2"> </span>and<span class="w w1"> </span>to<span class="w w2"> </span>schedule<span class="w w1"> </span>GC.</div><div class="l f2 s4 t0" style="bottom:186.058px;left:328.969px;" data-x="328.969" data-y="187.995" hs="1">In<span class="w w1"> </span>the<span class="w w2"> </span>interpreter,<span class="w w1"> </span>this<span class="w w1"> </span>had<span class="w w2"> </span>been<span class="w w1"> </span>implemented<span class="w w1"> </span>by<span class="w w1"> </span>setting<span class="w w1"> </span>a<span class="w w2"> </span>“pre-</div><div class="l f2 s4 t0" style="bottom:176.096px;left:317.014px;" data-x="317.014" data-y="178.032" hs="1">empt<span class="w w1"> </span>now”<span class="w w1"> </span>flag<span class="w w0"> </span>that<span class="w w1"> </span>was<span class="w w1"> </span>checked<span class="w w1"> </span>on<span class="w w0"> </span>ev</div><div class="l f2 s4 t0" style="bottom:176.096px;left:463.677px;" data-x="463.677" data-y="178.032" hs="1">ery<span class="w w1"> </span>backward<span class="w w1"> </span>jump.<span class="w w0"> </span>This</div><div class="l f2 s4 t0" style="bottom:166.133px;left:317.014px;" data-x="317.014" data-y="168.07" hs="1">strategy<span class="w w2"> </span>carried<span class="w w1"> </span>over<span class="w w2"> </span>into<span class="w w1"> </span>TraceMonkey:<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>inserts<span class="w w1"> </span>a<span class="w w2"> </span>guard<span class="w w1"> </span>on</div><div class="l f2 s4 t0" style="bottom:156.17px;left:317.014px;" data-x="317.014" data-y="158.107" hs="1">the<span class="w w1"> </span>preemption<span class="w w1"> </span>flag<span class="w w1"> </span>at<span class="w w0"> </span>every<span class="w w2"> </span>loop<span class="w w0"> </span>edge.<span class="w w1"> </span>We<span class="w w2"> </span>measured<span class="w w0"> </span>less<span class="w w1"> </span>than<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.145" hs="1">1%<span class="w w1"> </span>increase<span class="w w1"> </span>in<span class="w w1"> </span>runtime<span class="w w1"> </span>on<span class="w w1"> </span>most<span class="w w0"> </span>benchmarks<span class="w w2"> </span>for<span class="w w0"> </span>this<span class="w w2"> </span>extra<span class="w w0"> </span>guard.</div><div class="l f2 s4 t0" style="bottom:136.245px;left:317.014px;" data-x="317.014" data-y="138.182" hs="1">In<span class="w w2"> </span>practice,<span class="w w1"> </span>the<span class="w w2"> </span>cost<span class="w w1"> </span>is<span class="w w2"> </span>detectable<span class="w w1"> </span>only<span class="w w1"> </span>for<span class="w w2"> </span>programs<span class="w w1"> </span>with<span class="w w2"> </span>very<span class="w w1"> </span>short</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">loops.</div><div class="l f2 s4 t0" style="bottom:116.32px;left:328.969px;" data-x="328.969" data-y="118.257" hs="1">We<span class="w w1"> </span>tested<span class="w w1"> </span>and<span class="w w0"> </span>rejected<span class="w w1"> </span>a<span class="w w0"> </span>solution<span class="w w1"> </span>that<span class="w w0"> </span>avoided<span class="w w1"> </span>the<span class="w w1"> </span>guards<span class="w w0"> </span>by</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">compiling<span class="w w1"> </span>the<span class="w w0"> </span>loop<span class="w w1"> </span>edge<span class="w w1"> </span>as<span class="w w1"> </span>an<span class="w w0"> </span>unconditional<span class="w w1"> </span>jump,<span class="w w1"> </span>and<span class="w w0"> </span>patching</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:317.014px;" data-x="317.014" data-y="98.3313" hs="1">the<span class="w w1"> </span>jump<span class="w w0"> </span>target<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w0"> </span>exit<span class="w w1"> </span>routine<span class="w w0"> </span>when<span class="w w1"> </span>preemption<span class="w w0"> </span>is<span class="w w1"> </span>required.</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">This<span class="w w1"> </span>solution<span class="w w0"> </span>can<span class="w w1"> </span>make<span class="w w0"> </span>the<span class="w w1"> </span>normal<span class="w w0"> </span>case<span class="w w1"> </span>slightly<span class="w w0"> </span>faster</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:520.085px;" data-x="520.085" data-y="88.3686" hs="1">,<span class="w w1"> </span>but<span class="w w0"> </span>then</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">preemption<span class="w w2"> </span>becomes<span class="w w1"> </span>very<span class="w w1"> </span>slow.<span class="w w2"> </span>The<span class="w w2"> </span>implementation<span class="w w1"> </span>was<span class="w w1"> </span>also<span class="w w2"> </span>very</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">complex,<span class="w w2"> </span>especially<span class="w w2"> </span>trying<span class="w w1"> </span>to<span class="w w2"> </span>restart<span class="w w2"> </span>execution<span class="w w2"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>preemption.</div></div></div><div id="page-10" class="p" style="width:612px;height:792px;background-image:url(p10.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f1 s4 t0" style="bottom:710.156px;left:54px;" data-x="54" data-y="712.03" hs="1">6.5<span class="w w10"> </span>Calling<span class="w w2"> </span>External<span class="w w1"> </span>Functions</div><div class="l f2 s4 t0" style="bottom:696.145px;left:54px;" data-x="54" data-y="698.082" hs="1">Like<span class="w w2"> </span>most<span class="w w1"> </span>interpreters,<span class="w w1"> </span>SpiderMonkey<span class="w w2"> </span>has<span class="w w1"> </span>a<span class="w w2"> </span>foreign<span class="w w1"> </span>function<span class="w w1"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:686.183px;left:54px;" data-x="54" data-y="688.12" hs="1">face<span class="w w2"> </span>(FFI)<span class="w w1"> </span>that<span class="w w2"> </span>allows<span class="w w1"> </span>it<span class="w w2"> </span>to<span class="w w1"> </span>call<span class="w w2"> </span>C<span class="w w1"> </span>builtins<span class="w w2"> </span>and<span class="w w2"> </span>host<span class="w w1"> </span>system<span class="w w1"> </span>functions</div><div class="l f2 s4 t0" style="bottom:676.22px;left:54px;" data-x="54" data-y="678.157" hs="1">(e.g.,<span class="w w1"> </span>web<span class="w w1"> </span>browser<span class="w w1"> </span>control<span class="w w2"> </span>and<span class="w w1"> </span>DOM<span class="w w1"> </span>access).<span class="w w1"> </span>The<span class="w w1"> </span>FFI<span class="w w1"> </span>has<span class="w w1"> </span>a<span class="w w1"> </span>stan-</div><div class="l f2 s4 t0" style="bottom:666.258px;left:54px;" data-x="54" data-y="668.194" hs="1">dard<span class="w w2"> </span>signature<span class="w w1"> </span>for<span class="w w2"> </span>JS-callable<span class="w w1"> </span>functions,<span class="w w2"> </span>the<span class="w w1"> </span>key<span class="w w2"> </span>argument<span class="w w2"> </span>of<span class="w w1"> </span>which</div><div class="l f2 s4 t0" style="bottom:656.295px;left:54px;" data-x="54" data-y="658.232" hs="1">is<span class="w w1"> </span>an<span class="w w1"> </span>array<span class="w w1"> </span>of<span class="w w1"> </span>boxed<span class="w w1"> </span>values.<span class="w w1"> </span>External<span class="w w1"> </span>functions<span class="w w1"> </span>called<span class="w w1"> </span>through<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:646.332px;left:54px;" data-x="54" data-y="648.269" hs="1">FFI<span class="w w2"> </span>interact<span class="w w1"> </span>with<span class="w w2"> </span>the<span class="w w2"> </span>program<span class="w w1"> </span>state<span class="w w2"> </span>through<span class="w w1"> </span>an<span class="w w2"> </span>interpreter<span class="w w2"> </span>API<span class="w w1"> </span>(e.g.,</div><div class="l f2 s4 t0" style="bottom:636.37px;left:54px;" data-x="54" data-y="638.306" hs="1">to<span class="w w1"> </span>read<span class="w w2"> </span>a<span class="w w1"> </span>property<span class="w w1"> </span>from<span class="w w1"> </span>an<span class="w w1"> </span>argument).<span class="w w2"> </span>There<span class="w w1"> </span>are<span class="w w1"> </span>also<span class="w w1"> </span>certain<span class="w w1"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:626.407px;left:54px;" data-x="54" data-y="628.344" hs="1">preter<span class="w w2"> </span>builtins<span class="w w1"> </span>that<span class="w w2"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>use<span class="w w2"> </span>the<span class="w w1"> </span>FFI,<span class="w w2"> </span>but<span class="w w1"> </span>interact<span class="w w2"> </span>with<span class="w w1"> </span>the<span class="w w2"> </span>program</div><div class="l f2 s4 t0" style="bottom:616.444px;left:54px;" data-x="54" data-y="618.381" hs="1">state<span class="w w1"> </span>in<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>way,<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w0"> </span>the</div><div class="l f7 s4 t0" style="bottom:616.391px;left:184.597px;" data-x="184.597" data-y="618.381" hs="1">CallIteratorNext</div><div class="l f2 s4 t0" style="bottom:616.444px;left:263.219px;" data-x="263.219" data-y="618.381" hs="1">function</div><div class="l f2 s4 t0" style="bottom:606.482px;left:54px;" data-x="54" data-y="608.418" hs="1">used<span class="w w1"> </span>with<span class="w w1"> </span>iterator<span class="w w1"> </span>objects.<span class="w w1"> </span>TraceMonkey<span class="w w1"> </span>must<span class="w w1"> </span>support<span class="w w1"> </span>this<span class="w w1"> </span>FFI<span class="w w0"> </span>in</div><div class="l f2 s4 t0" style="bottom:596.519px;left:54px;" data-x="54" data-y="598.456" hs="1">order<span class="w w2"> </span>to<span class="w w1"> </span>speed<span class="w w2"> </span>up<span class="w w2"> </span>code<span class="w w1"> </span>that<span class="w w2"> </span>interacts<span class="w w1"> </span>with<span class="w w2"> </span>the<span class="w w1"> </span>host<span class="w w2"> </span>system<span class="w w2"> </span>inside<span class="w w1"> </span>hot</div><div class="l f2 s4 t0" style="bottom:586.556px;left:54px;" data-x="54" data-y="588.493" hs="1">loops.</div><div class="l f2 s4 t0" style="bottom:576.594px;left:65.9552px;" data-x="65.9552" data-y="578.531" hs="1">Calling<span class="w w2"> </span>external<span class="w w1"> </span>functions<span class="w w2"> </span>from<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>is<span class="w w2"> </span>potentially<span class="w w1"> </span>dif-</div><div class="l f2 s4 t0" style="bottom:566.631px;left:54px;" data-x="54" data-y="568.568" hs="1">ficult<span class="w w1"> </span>because<span class="w w1"> </span>traces<span class="w w1"> </span>do<span class="w w1"> </span>not<span class="w w0"> </span>update<span class="w w2"> </span>the<span class="w w0"> </span>interpreter<span class="w w2"> </span>state<span class="w w0"> </span>until<span class="w w1"> </span>exit-</div><div class="l f2 s4 t0" style="bottom:556.668px;left:54px;" data-x="54" data-y="558.605" hs="1">ing.<span class="w w1"> </span>In<span class="w w2"> </span>particular,<span class="w w1"> </span>external<span class="w w2"> </span>functions<span class="w w1"> </span>may<span class="w w1"> </span>need<span class="w w1"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>or<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:546.706px;left:54px;" data-x="54" data-y="548.643" hs="1">global<span class="w w2"> </span>variables,<span class="w w1"> </span>but<span class="w w2"> </span>they<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w2"> </span>out<span class="w w1"> </span>of<span class="w w2"> </span>date.</div><div class="l f2 s4 t0" style="bottom:536.743px;left:65.9552px;" data-x="65.9552" data-y="538.68" hs="1">For<span class="w w1"> </span>the<span class="w w1"> </span>out-of-date<span class="w w1"> </span>call<span class="w w0"> </span>stack<span class="w w1"> </span>problem,<span class="w w1"> </span>we<span class="w w1"> </span>refactored<span class="w w1"> </span>some<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:526.781px;left:54px;" data-x="54" data-y="528.717" hs="1">the<span class="w w1"> </span>interpreter<span class="w w1"> </span>API<span class="w w1"> </span>implementation<span class="w w1"> </span>functions<span class="w w1"> </span>to<span class="w w1"> </span>re-materialize<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:516.818px;left:54px;" data-x="54" data-y="518.755" hs="1">interpreter<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>on<span class="w w2"> </span>demand.</div><div class="l f2 s4 t0" style="bottom:506.855px;left:65.9552px;" data-x="65.9552" data-y="508.792" hs="1">We<span class="w w2"> </span>developed<span class="w w1"> </span>a<span class="w w1"> </span>C++<span class="w w1"> </span>static<span class="w w1"> </span>analysis<span class="w w1"> </span>and<span class="w w1"> </span>annotated<span class="w w1"> </span>some<span class="w w1"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:496.893px;left:54px;" data-x="54" data-y="498.829" hs="1">preter<span class="w w1"> </span>functions<span class="w w1"> </span>in<span class="w w0"> </span>order<span class="w w1"> </span>to<span class="w w1"> </span>verify<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>call<span class="w w1"> </span>stack<span class="w w0"> </span>is<span class="w w1"> </span>refreshed</div><div class="l f2 s4 t0" style="bottom:486.93px;left:54px;" data-x="54" data-y="488.867" hs="1">at<span class="w w1"> </span>any<span class="w w1"> </span>point<span class="w w1"> </span>it<span class="w w1"> </span>needs<span class="w w1"> </span>to<span class="w w0"> </span>be<span class="w w2"> </span>used.<span class="w w0"> </span>In<span class="w w2"> </span>order<span class="w w1"> </span>to<span class="w w0"> </span>access<span class="w w2"> </span>the<span class="w w0"> </span>call<span class="w w2"> </span>stack,</div><div class="l f2 s4 t0" style="bottom:476.967px;left:54px;" data-x="54" data-y="478.904" hs="1">a<span class="w w0"> </span>function<span class="w w0"> </span>must<span class="w w1"> </span>be<span class="w w0"> </span>annotated<span class="w w0"> </span>as<span class="w w0"> </span>either<span class="w w0"> </span>F</div><div class="l f2 s8 t0" style="bottom:477.355px;left:211.644px;" data-x="211.644" data-y="478.904" hs="1">ORC<span class="w w2"> </span>ES</div><div class="l f2 s4 t0" style="bottom:476.967px;left:236.974px;" data-x="236.974" data-y="478.904" hs="1">S</div><div class="l f2 s8 t0" style="bottom:477.355px;left:242.407px;" data-x="242.407" data-y="478.904" hs="1">TACK</div><div class="l f2 s4 t0" style="bottom:476.967px;left:266.738px;" data-x="266.738" data-y="478.904" hs="1">or<span class="w w0"> </span>R</div><div class="l f2 s8 t0" style="bottom:477.355px;left:285.07px;" data-x="285.07" data-y="478.904" hs="1">E</div><div class="l f2 s4 t0" style="bottom:476.967px;left:289.893px;" data-x="289.893" data-y="478.904" hs="1">-</div><div class="l f2 s8 t0" style="bottom:467.392px;left:54.2241px;" data-x="54.2241" data-y="468.942" hs="1">QUI<span class="w w2"> </span>RES</div><div class="l f2 s4 t0" style="bottom:467.005px;left:82.7098px;" data-x="82.7098" data-y="468.942" hs="1">S</div><div class="l f2 s8 t0" style="bottom:467.392px;left:88.1434px;" data-x="88.1434" data-y="468.942" hs="1">TACK</div><div class="l f2 s4 t0" style="bottom:467.005px;left:108.264px;" data-x="108.264" data-y="468.942" hs="1">.<span class="w w2"> </span>These<span class="w w1"> </span>annotations<span class="w w2"> </span>are<span class="w w1"> </span>also<span class="w w2"> </span>required<span class="w w1"> </span>in<span class="w w2"> </span>order<span class="w w1"> </span>to<span class="w w2"> </span>call</div><div class="l f2 s4 t0" style="bottom:457.042px;left:54.2241px;" data-x="54.2241" data-y="458.979" hs="1">R</div><div class="l f2 s8 t0" style="bottom:457.429px;left:60.6529px;" data-x="60.6529" data-y="458.979" hs="1">EQU<span class="w w2"> </span>IRE<span class="w w2"> </span>S</div><div class="l f2 s4 t0" style="bottom:457.042px;left:93.9624px;" data-x="93.9624" data-y="458.979" hs="1">S</div><div class="l f2 s8 t0" style="bottom:457.429px;left:99.396px;" data-x="99.396" data-y="458.979" hs="1">TACK</div><div class="l f2 s4 t0" style="bottom:457.042px;left:121.575px;" data-x="121.575" data-y="458.979" hs="1">functions,<span class="w w2"> </span>which<span class="w w1"> </span>are<span class="w w2"> </span>presumed<span class="w w1"> </span>to<span class="w w2"> </span>access<span class="w w1"> </span>the<span class="w w2"> </span>call</div><div class="l f2 s4 t0" style="bottom:447.079px;left:54px;" data-x="54" data-y="449.016" hs="1">stack<span class="w w1"> </span>transitively.<span class="w w1"> </span>F</div><div class="l f2 s8 t0" style="bottom:447.467px;left:125.911px;" data-x="125.911" data-y="449.016" hs="1">ORC<span class="w w2"> </span>ES</div><div class="l f2 s4 t0" style="bottom:447.079px;left:151.24px;" data-x="151.24" data-y="449.016" hs="1">S</div><div class="l f2 s8 t0" style="bottom:447.467px;left:156.674px;" data-x="156.674" data-y="449.016" hs="1">TACK</div><div class="l f2 s4 t0" style="bottom:447.079px;left:179.884px;" data-x="179.884" data-y="449.016" hs="1">is<span class="w w1"> </span>a<span class="w w1"> </span>trusted<span class="w w0"> </span>annotation,<span class="w w1"> </span>applied</div><div class="l f2 s4 t0" style="bottom:437.117px;left:54px;" data-x="54" data-y="439.054" hs="1">to<span class="w w2"> </span>only<span class="w w1"> </span>5<span class="w w2"> </span>functions,<span class="w w1"> </span>that<span class="w w2"> </span>means<span class="w w2"> </span>the<span class="w w1"> </span>function<span class="w w2"> </span>refreshes<span class="w w1"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>stack.</div><div class="l f2 s4 t0" style="bottom:427.154px;left:54.2241px;" data-x="54.2241" data-y="429.091" hs="1">R</div><div class="l f2 s8 t0" style="bottom:427.542px;left:60.6529px;" data-x="60.6529" data-y="429.091" hs="1">EQU<span class="w w2"> </span>IRE<span class="w w2"> </span>S</div><div class="l f2 s4 t0" style="bottom:427.154px;left:93.9625px;" data-x="93.9625" data-y="429.091" hs="1">S</div><div class="l f2 s8 t0" style="bottom:427.542px;left:99.396px;" data-x="99.396" data-y="429.091" hs="1">TACK</div><div class="l f2 s4 t0" style="bottom:427.154px;left:122.226px;" data-x="122.226" data-y="429.091" hs="1">is<span class="w w1"> </span>an<span class="w w1"> </span>untrusted<span class="w w1"> </span>annotation<span class="w w1"> </span>that<span class="w w1"> </span>means<span class="w w1"> </span>the<span class="w w1"> </span>func-</div><div class="l f2 s4 t0" style="bottom:417.192px;left:54px;" data-x="54" data-y="419.128" hs="1">tion<span class="w w2"> </span>may<span class="w w1"> </span>only<span class="w w2"> </span>be<span class="w w1"> </span>called<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>has<span class="w w2"> </span>already<span class="w w1"> </span>been<span class="w w2"> </span>refreshed.</div><div class="l f2 s4 t0" style="bottom:407.229px;left:65.9551px;" data-x="65.9551" data-y="409.166" hs="1">Similarly,<span class="w w1"> </span>we<span class="w w0"> </span>detect<span class="w w0"> </span>when<span class="w w1"> </span>host<span class="w w0"> </span>functions<span class="w w0"> </span>attempt<span class="w w1"> </span>to<span class="w w0"> </span>directly</div><div class="l f2 s4 t0" style="bottom:397.266px;left:54px;" data-x="54" data-y="399.203" hs="1">read<span class="w w2"> </span>or<span class="w w1"> </span>write<span class="w w2"> </span>global<span class="w w1"> </span>variables,<span class="w w2"> </span>and<span class="w w1"> </span>force<span class="w w2"> </span>the<span class="w w1"> </span>currently<span class="w w2"> </span>running<span class="w w1"> </span>trace</div><div class="l f2 s4 t0" style="bottom:387.304px;left:54px;" data-x="54" data-y="389.24" hs="1">to<span class="w w1"> </span>side<span class="w w0"> </span>exit.<span class="w w1"> </span>This<span class="w w0"> </span>is<span class="w w1"> </span>necessary<span class="w w1"> </span>since<span class="w w0"> </span>we<span class="w w1"> </span>cache<span class="w w0"> </span>and<span class="w w1"> </span>unbox<span class="w w0"> </span>global</div><div class="l f2 s4 t0" style="bottom:377.341px;left:54px;" data-x="54" data-y="379.278" hs="1">variables<span class="w w2"> </span>into<span class="w w1"> </span>the<span class="w w2"> </span>activation<span class="w w1"> </span>record<span class="w w2"> </span>during<span class="w w1"> </span>trace<span class="w w1"> </span>execution.</div><div class="l f2 s4 t0" style="bottom:367.378px;left:65.9551px;" data-x="65.9551" data-y="369.315" hs="1">Since<span class="w w0"> </span>both<span class="w w0"> </span>call-stack<span class="w w0"> </span>access<span class="w w0"> </span>and<span class="w w0"> </span>global<span class="w w0"> </span>variable<span class="w w0"> </span>access<span class="w w0"> </span>are</div><div class="l f2 s4 t0" style="bottom:357.416px;left:54px;" data-x="54" data-y="359.352" hs="1">rarely<span class="w w2"> </span>performed<span class="w w2"> </span>by<span class="w w1"> </span>host<span class="w w2"> </span>functions,<span class="w w2"> </span>performance<span class="w w1"> </span>is<span class="w w2"> </span>not<span class="w w2"> </span>significantly</div><div class="l f2 s4 t0" style="bottom:347.453px;left:54px;" data-x="54" data-y="349.39" hs="1">affected<span class="w w2"> </span>by<span class="w w1"> </span>these<span class="w w2"> </span>safety<span class="w w1"> </span>mechanisms.</div><div class="l f2 s4 t0" style="bottom:337.49px;left:65.9551px;" data-x="65.9551" data-y="339.427" hs="1">Another<span class="w w2"> </span>problem<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w1"> </span>external<span class="w w2"> </span>functions<span class="w w1"> </span>can<span class="w w2"> </span>reenter<span class="w w1"> </span>the<span class="w w2"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:327.528px;left:54px;" data-x="54" data-y="329.465" hs="1">preter<span class="w w1"> </span>by<span class="w w1"> </span>calling<span class="w w2"> </span>scripts,<span class="w w1"> </span>which<span class="w w1"> </span>in<span class="w w1"> </span>turn<span class="w w1"> </span>again<span class="w w1"> </span>might<span class="w w1"> </span>want<span class="w w2"> </span>to<span class="w w1"> </span>access</div><div class="l f2 s4 t0" style="bottom:317.565px;left:54px;" data-x="54" data-y="319.502" hs="1">the<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w2"> </span>or<span class="w w2"> </span>global<span class="w w1"> </span>variables.<span class="w w2"> </span>To<span class="w w2"> </span>address<span class="w w2"> </span>this<span class="w w1"> </span>problem,<span class="w w2"> </span>we<span class="w w1"> </span>made</div><div class="l f2 s4 t0" style="bottom:307.602px;left:54px;" data-x="54" data-y="309.539" hs="1">the<span class="w w2"> </span>VM<span class="w w2"> </span>set<span class="w w1"> </span>a<span class="w w2"> </span>flag<span class="w w2"> </span>whenever<span class="w w2"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>is<span class="w w2"> </span>reentered<span class="w w1"> </span>while<span class="w w2"> </span>a<span class="w w2"> </span>com-</div><div class="l f2 s4 t0" style="bottom:297.64px;left:54px;" data-x="54" data-y="299.577" hs="1">piled<span class="w w2"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>running.</div><div class="l f2 s4 t0" style="bottom:287.677px;left:65.9551px;" data-x="65.9551" data-y="289.614" hs="1">Every<span class="w w2"> </span>call<span class="w w1"> </span>to<span class="w w2"> </span>an<span class="w w1"> </span>external<span class="w w2"> </span>function<span class="w w1"> </span>then<span class="w w2"> </span>checks<span class="w w1"> </span>this<span class="w w2"> </span>flag<span class="w w1"> </span>and<span class="w w2"> </span>exits</div><div class="l f2 s4 t0" style="bottom:277.715px;left:54px;" data-x="54" data-y="279.651" hs="1">the<span class="w w2"> </span>trace<span class="w w2"> </span>immediately<span class="w w1"> </span>after<span class="w w2"> </span>returning<span class="w w2"> </span>from<span class="w w1"> </span>the<span class="w w2"> </span>external<span class="w w2"> </span>function<span class="w w1"> </span>call</div><div class="l f2 s4 t0" style="bottom:267.752px;left:54px;" data-x="54" data-y="269.689" hs="1">if<span class="w w1"> </span>it<span class="w w2"> </span>is<span class="w w1"> </span>set.<span class="w w1"> </span>There<span class="w w1"> </span>are<span class="w w1"> </span>many<span class="w w1"> </span>external<span class="w w2"> </span>functions<span class="w w1"> </span>that<span class="w w1"> </span>seldom<span class="w w1"> </span>or<span class="w w1"> </span>never</div><div class="l f2 s4 t0" style="bottom:257.789px;left:54px;" data-x="54" data-y="259.726" hs="1">reenter,<span class="w w1"> </span>and<span class="w w0"> </span>they<span class="w w1"> </span>can<span class="w w1"> </span>be<span class="w w0"> </span>called<span class="w w1"> </span>without<span class="w w0"> </span>problem,<span class="w w1"> </span>and<span class="w w0"> </span>will<span class="w w1"> </span>cause</div><div class="l f2 s4 t0" style="bottom:247.827px;left:54px;" data-x="54" data-y="249.763" hs="1">trace<span class="w w2"> </span>exit<span class="w w1"> </span>only<span class="w w1"> </span>if<span class="w w2"> </span>necessary.</div><div class="l f2 s4 t0" style="bottom:237.864px;left:65.9551px;" data-x="65.9551" data-y="239.801" hs="1">The<span class="w w0"> </span>FFI’</div><div class="l f2 s4 t0" style="bottom:237.864px;left:99.1397px;" data-x="99.1397" data-y="239.801" hs="1">s<span class="w w0"> </span>boxed<span class="w w1"> </span>value<span class="w w0"> </span>array<span class="w w1"> </span>requirement<span class="w w0"> </span>has<span class="w w1"> </span>a<span class="w w0"> </span>performance</div><div class="l f2 s4 t0" style="bottom:227.901px;left:54px;" data-x="54" data-y="229.838" hs="1">cost,<span class="w w1"> </span>so<span class="w w0"> </span>we<span class="w w1"> </span>defined<span class="w w1"> </span>a<span class="w w0"> </span>new<span class="w w1"> </span>FFI<span class="w w1"> </span>that<span class="w w1"> </span>allows<span class="w w0"> </span>C<span class="w w1"> </span>functions<span class="w w1"> </span>to<span class="w w0"> </span>be<span class="w w1"> </span>an-</div><div class="l f2 s4 t0" style="bottom:217.939px;left:54px;" data-x="54" data-y="219.876" hs="1">notated<span class="w w1"> </span>with<span class="w w1"> </span>their<span class="w w1"> </span>argument<span class="w w1"> </span>types<span class="w w1"> </span>so<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>tracer<span class="w w0"> </span>can<span class="w w2"> </span>call<span class="w w1"> </span>them</div><div class="l f2 s4 t0" style="bottom:207.976px;left:54px;" data-x="54" data-y="209.913" hs="1">directly,<span class="w w2"> </span>without<span class="w w1"> </span>unnecessary<span class="w w2"> </span>argument<span class="w w1"> </span>conversions.</div><div class="l f2 s4 t0" style="bottom:198.013px;left:65.9551px;" data-x="65.9551" data-y="199.95" hs="1">Currently,<span class="w w2"> </span>we<span class="w w1"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>support<span class="w w1"> </span>calling<span class="w w2"> </span>native<span class="w w1"> </span>property<span class="w w1"> </span>get<span class="w w2"> </span>and<span class="w w1"> </span>set</div><div class="l f2 s4 t0" style="bottom:188.051px;left:54px;" data-x="54" data-y="189.988" hs="1">override<span class="w w1"> </span>functions<span class="w w2"> </span>or<span class="w w1"> </span>DOM<span class="w w1"> </span>functions<span class="w w1"> </span>directly<span class="w w1"> </span>from<span class="w w1"> </span>trace.<span class="w w1"> </span>Support</div><div class="l f2 s4 t0" style="bottom:178.088px;left:54px;" data-x="54" data-y="180.025" hs="1">is<span class="w w2"> </span>planned<span class="w w1"> </span>future<span class="w w1"> </span>work.</div><div class="l f1 s4 t0" style="bottom:160.218px;left:54px;" data-x="54" data-y="162.092" hs="1">6.6<span class="w w10"> </span>Correctness</div><div class="l f2 s4 t0" style="bottom:146.208px;left:54px;" data-x="54" data-y="148.145" hs="1">During<span class="w w0"> </span>development,<span class="w w0"> </span>we<span class="w w1"> </span>had<span class="w w0"> </span>access<span class="w w0"> </span>to<span class="w w0"> </span>existing<span class="w w0"> </span>JavaScript<span class="w w0"> </span>test</div><div class="l f2 s4 t0" style="bottom:136.245px;left:54px;" data-x="54" data-y="138.182" hs="1">suites,<span class="w w1"> </span>but<span class="w w1"> </span>most<span class="w w0"> </span>of<span class="w w1"> </span>them<span class="w w1"> </span>were<span class="w w0"> </span>not<span class="w w1"> </span>designed<span class="w w1"> </span>with<span class="w w1"> </span>tracing<span class="w w0"> </span>VMs<span class="w w1"> </span>in</div><div class="l f2 s4 t0" style="bottom:126.282px;left:54px;" data-x="54" data-y="128.219" hs="1">mind<span class="w w2"> </span>and<span class="w w1"> </span>contained<span class="w w1"> </span>few<span class="w w2"> </span>loops.</div><div class="l f2 s4 t0" style="bottom:116.32px;left:65.9551px;" data-x="65.9551" data-y="118.257" hs="1">One<span class="w w1"> </span>tool<span class="w w1"> </span>that<span class="w w0"> </span>helped<span class="w w1"> </span>us<span class="w w1"> </span>greatly<span class="w w1"> </span>was<span class="w w1"> </span>Mozilla’s<span class="w w1"> </span>JavaScript<span class="w w1"> </span>fuzz</div><div class="l f2 s4 t0" style="bottom:106.357px;left:54px;" data-x="54" data-y="108.294" hs="1">tester,</div><div class="l f2 s8 t0" style="bottom:106.745px;left:78.6182px;" data-x="78.6182" data-y="108.294" hs="1">JSF<span class="w w2"> </span>UNF<span class="w w2"> </span>UZZ</div><div class="l f2 s4 t0" style="bottom:106.357px;left:121.432px;" data-x="121.432" data-y="108.294" hs="1">,<span class="w w1"> </span>which<span class="w w1"> </span>generates<span class="w w0"> </span>random<span class="w w1"> </span>JavaScript<span class="w w2"> </span>programs</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:54px;" data-x="54" data-y="98.3313" hs="1">by<span class="w w1"> </span>nesting<span class="w w0"> </span>random<span class="w w1"> </span>language<span class="w w1"> </span>elements.<span class="w w0"> </span>We<span class="w w1"> </span>modified</div><div class="l f2 s8 t0" style="bottom:96.7819px;left:250.29px;" data-x="250.29" data-y="98.3313" hs="1">JSF<span class="w w2"> </span>UNF<span class="w w2"> </span>UZZ</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:54px;" data-x="54" data-y="88.3686" hs="1">to<span class="w w1"> </span>generate<span class="w w1"> </span>loops,<span class="w w1"> </span>and<span class="w w1"> </span>also<span class="w w1"> </span>to<span class="w w1"> </span>test<span class="w w1"> </span>more<span class="w w1"> </span>heavily<span class="w w1"> </span>certain<span class="w w1"> </span>constructs</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:54px;" data-x="54" data-y="78.406" hs="1">we<span class="w w2"> </span>suspected<span class="w w1"> </span>would<span class="w w2"> </span>reveal<span class="w w1"> </span>flaws<span class="w w2"> </span>in<span class="w w1"> </span>our<span class="w w2"> </span>implementation.<span class="w w1"> </span>For<span class="w w2"> </span>exam-</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:54px;" data-x="54" data-y="68.4434" hs="1">ple,<span class="w w2"> </span>we<span class="w w2"> </span>suspected<span class="w w1"> </span>bugs<span class="w w2"> </span>in<span class="w w2"> </span>TraceMonkey’shandling<span class="w w1"> </span>of<span class="w w2"> </span>type-unstable</div></div><div class="t t5d"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="377.215" data-y="532.302" hs="1">!&quot;#</div></div><div class="t t5f"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="393.004" data-y="532.302" hs="1">$!&quot;#</div></div><div class="t t60"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="410.187" data-y="532.302" hs="1">%!&quot;#</div></div><div class="t t61"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="427.37" data-y="532.302" hs="1">&amp;!&quot;#</div></div><div class="t t62"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="444.554" data-y="532.302" hs="1">&apos;!&quot;#</div></div><div class="t t63"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="461.737" data-y="532.302" hs="1">(!&quot;#</div></div><div class="t t64"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="478.92" data-y="532.302" hs="1">)!&quot;#</div></div><div class="t t65"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="496.103" data-y="532.302" hs="1">*!&quot;#</div></div><div class="t t66"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="513.286" data-y="532.302" hs="1">+!&quot;#</div></div><div class="t t67"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="530.469" data-y="532.302" hs="1">,!&quot;#</div></div><div class="t t68"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="546.258" data-y="532.302" hs="1">$!!&quot;#</div></div><div class="t t69"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:80.5461px;" data-x="350.177" data-y="544.441" hs="1">&amp;-./012#3%4%56#</div></div><div class="t t6b"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:77.5285px;" data-x="346.857" data-y="551.035" hs="1">&amp;-.789:;#3%4,56#</div></div><div class="t t6c"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:75.1965px;" data-x="344.292" data-y="557.628" hs="1">&amp;-.9&lt;=&gt;9&lt;/2#3$4%56#</div></div><div class="t t6d"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:62.5168px;" data-x="330.344" data-y="564.222" hs="1">&lt;//2??.1@A&lt;9=.&gt;922?#3!4,56#</div></div><div class="t t6e"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:67.2531px;" data-x="335.554" data-y="570.816" hs="1">&lt;//2??.B&lt;AAC0/;#3%4%56#</div></div><div class="t t6f"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:71.9172px;" data-x="340.685" data-y="577.409" hs="1">&lt;//2??.A18-=#3&apos;4%56#</div></div><div class="t t70"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:71.8293px;" data-x="340.584" data-y="584.003" hs="1">&lt;//2??.A?@2D2#3&amp;4!56#</div></div><div class="t t71"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:54.3761px;" data-x="321.39" data-y="590.597" hs="1">1@&gt;8:?.&amp;1@&gt;.1@&gt;?.@A.1=&gt;2#3%(4(56#</div></div><div class="t t72"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:63.8918px;" data-x="331.819" data-y="597.19" hs="1">1@&gt;8:?.1@&gt;?.@A.1=&gt;2#3+4*56#</div></div><div class="t t73"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:61.4211px;" data-x="329.139" data-y="603.784" hs="1">1@&gt;8:?.1@&gt;E@?2.&lt;A-#3%(4%56#</div></div><div class="t t74"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:65.0226px;" data-x="333.101" data-y="610.378" hs="1">1@&gt;8:?.A?@2D2.1@&gt;?#3%4*56#</div></div><div class="t t75"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:59.3527px;" data-x="326.864" data-y="616.971" hs="1">/8A&gt;98FG8E.92/09?@D2#3$4!56#</div></div><div class="t t76"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:76.6789px;" data-x="345.923" data-y="623.565" hs="1">/9=:&gt;8.&lt;2?#3$4)56#</div></div><div class="t t77"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:74.8254px;" data-x="343.882" data-y="630.159" hs="1">/9=:&gt;8.7-(#3%4&amp;56#</div></div><div class="t t78"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:74.5402px;" data-x="343.57" data-y="636.752" hs="1">/9=:&gt;8.?;&lt;$#3(4,56#</div></div><div class="t t79"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:65.3078px;" data-x="333.415" data-y="643.346" hs="1">-&lt;&gt;2.B897&lt;&gt;.&gt;8H2#3$4$56#</div></div><div class="t t7a"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:63.9992px;" data-x="331.975" data-y="649.94" hs="1">-&lt;&gt;2.B897&lt;&gt;.5:&lt;91#3$4!56#</div></div><div class="t t7b"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:74.2257px;" data-x="343.224" data-y="656.533" hs="1">7&lt;&gt;;./89-@/#3&apos;4,56#</div></div><div class="t t7c"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:63.9191px;" data-x="331.887" data-y="663.127" hs="1">7&lt;&gt;;.:&lt;9I&lt;F.?07?#3(4,56#</div></div><div class="t t7d"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:61.1847px;" data-x="328.879" data-y="669.721" hs="1">7&lt;&gt;;.?:2/&gt;9&lt;F.A897#3*4$56#</div></div><div class="t t7e"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:75.4953px;" data-x="344.621" data-y="676.314" hs="1">92J25:.-A&lt;#3&apos;4%56#</div></div><div class="t t7f"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:71.7765px;" data-x="340.53" data-y="682.908" hs="1">?&gt;9@AJ.1&lt;?2)&apos;#3%4(56#</div></div><div class="t t80"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:75.6535px;" data-x="344.795" data-y="689.502" hs="1">?&gt;9@AJ.B&lt;?&gt;&lt;#3$4(56#</div></div><div class="t t81"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:69.4152px;" data-x="337.933" data-y="696.095" hs="1">?&gt;9@AJ.&gt;&lt;J/F80-#3$4$56#</div></div><div class="t t82"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:62.7394px;" data-x="330.589" data-y="702.689" hs="1">?&gt;9@AJ.0A:&lt;/C./8-2#3$4%56#</div></div><div class="t t83"><div class="l f16 s7 t6a" style="bottom:-8.269px;left:60.884px;" data-x="328.515" data-y="709.282" hs="1">?&gt;9@AJ.D&lt;F@-&lt;&gt;2.@A:0&gt;#3$4,56#</div></div><div class="t t84"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="411.5" data-y="515.326" hs="1">KA&gt;29:92&gt;#</div></div><div class="t t85"><div class="l f16 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="459.26" data-y="515.326" hs="1">L&lt;ID2#</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:482.857px;left:317.014px;" data-x="317.014" data-y="484.731" hs="1">Figure<span class="w w1"> </span>11.<span class="w w0"> </span>Fraction<span class="w w0"> </span>of<span class="w w1"> </span>dynamic<span class="w w1"> </span>bytecodes<span class="w w0"> </span>executed<span class="w w1"> </span>by<span class="w w1"> </span>inter-</div><div class="l f1 s4 t0" style="bottom:472.894px;left:317.014px;" data-x="317.014" data-y="474.768" hs="1">preter<span class="w w2"> </span>and<span class="w w1"> </span>on<span class="w w1"> </span>native<span class="w w2"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:472.832px;left:424.555px;" data-x="424.555" data-y="474.768" hs="1">The<span class="w w2"> </span>speedup<span class="w w1"> </span>vs.<span class="w w1"> </span>interpreter<span class="w w2"> </span>is<span class="w w1"> </span>shown</div><div class="l f2 s4 t0" style="bottom:462.869px;left:317.014px;" data-x="317.014" data-y="464.806" hs="1">in<span class="w w1"> </span>parentheses<span class="w w0"> </span>next<span class="w w1"> </span>to<span class="w w0"> </span>each<span class="w w1"> </span>test.<span class="w w0"> </span>The<span class="w w0"> </span>fraction<span class="w w1"> </span>of<span class="w w0"> </span>bytecodes<span class="w w1"> </span>exe-</div><div class="l f2 s4 t0" style="bottom:452.906px;left:317.014px;" data-x="317.014" data-y="454.843" hs="1">cuted<span class="w w0"> </span>while<span class="w w1"> </span>recording<span class="w w0"> </span>is<span class="w w0"> </span>too<span class="w w1"> </span>small<span class="w w0"> </span>to<span class="w w0"> </span>see<span class="w w0"> </span>in<span class="w w1"> </span>this<span class="w w0"> </span>figure,<span class="w w0"> </span>except</div><div class="l f2 s4 t0" style="bottom:442.944px;left:317.014px;" data-x="317.014" data-y="444.88" hs="1">for</div><div class="l f7 s4 t0" style="bottom:442.89px;left:329.996px;" data-x="329.996" data-y="444.88" hs="1">crypto-md5</div><div class="l f2 s4 t0" style="bottom:442.944px;left:377.069px;" data-x="377.069" data-y="444.88" hs="1">,<span class="w w1"> </span>where<span class="w w2"> </span>fully<span class="w w1"> </span>3%<span class="w w1"> </span>of<span class="w w1"> </span>bytecodes<span class="w w1"> </span>are<span class="w w1"> </span>executed<span class="w w2"> </span>while</div><div class="l f2 s4 t0" style="bottom:432.981px;left:317.014px;" data-x="317.014" data-y="434.918" hs="1">recording.<span class="w w1"> </span>In<span class="w w1"> </span>most<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>tests,<span class="w w0"> </span>almost<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>bytecodes<span class="w w0"> </span>are<span class="w w1"> </span>exe-</div><div class="l f2 s4 t0" style="bottom:423.018px;left:317.014px;" data-x="317.014" data-y="424.955" hs="1">cuted<span class="w w1"> </span>by<span class="w w1"> </span>compiled<span class="w w1"> </span>traces.<span class="w w1"> </span>Three<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>benchmarks<span class="w w1"> </span>are<span class="w w1"> </span>not<span class="w w1"> </span>traced</div><div class="l f2 s4 t0" style="bottom:413.056px;left:317.014px;" data-x="317.014" data-y="414.992" hs="1">at<span class="w w2"> </span>all<span class="w w1"> </span>and<span class="w w1"> </span>run<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>interpreter.</div><div class="l f2 s4 t0" style="bottom:383.561px;left:317.014px;" data-x="317.014" data-y="385.497" hs="1">loops<span class="w w1"> </span>and<span class="w w2"> </span>heavily<span class="w w1"> </span>branching<span class="w w1"> </span>code,<span class="w w2"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>specialized<span class="w w1"> </span>fuzz<span class="w w2"> </span>tester<span class="w w1"> </span>in-</div><div class="l f2 s4 t0" style="bottom:373.598px;left:317.014px;" data-x="317.014" data-y="375.535" hs="1">deed<span class="w w2"> </span>revealed<span class="w w2"> </span>several<span class="w w2"> </span>regressions<span class="w w2"> </span>which<span class="w w2"> </span>we<span class="w w1"> </span>subsequently<span class="w w2"> </span>corrected.</div><div class="l f1 s2 t0" style="bottom:349.092px;left:317.014px;" data-x="317.014" data-y="351.382" hs="1">7.<span class="w w3"> </span>Evaluation</div><div class="l f2 s4 t0" style="bottom:335.498px;left:317.014px;" data-x="317.014" data-y="337.435" hs="1">We<span class="w w1"> </span>evaluated<span class="w w0"> </span>our<span class="w w1"> </span>JavaScript<span class="w w0"> </span>tracing<span class="w w1"> </span>implementation<span class="w w0"> </span>using<span class="w w0"> </span>Sun-</div><div class="l f2 s4 t0" style="bottom:325.535px;left:317.014px;" data-x="317.014" data-y="327.472" hs="1">Spider,<span class="w w2"> </span>the<span class="w w1"> </span>industry<span class="w w1"> </span>standard<span class="w w1"> </span>JavaScript<span class="w w1"> </span>benchmark<span class="w w1"> </span>suite.<span class="w w2"> </span>SunSpi-</div><div class="l f2 s4 t0" style="bottom:315.573px;left:317.014px;" data-x="317.014" data-y="317.509" hs="1">der<span class="w w1"> </span>consists<span class="w w1"> </span>of<span class="w w1"> </span>26<span class="w w1"> </span>short-running<span class="w w1"> </span>(less<span class="w w1"> </span>than<span class="w w0"> </span>250ms,<span class="w w2"> </span>average<span class="w w1"> </span>26ms)</div><div class="l f2 s4 t0" style="bottom:305.61px;left:317.014px;" data-x="317.014" data-y="307.547" hs="1">JavaScript<span class="w w2"> </span>programs.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w1"> </span>in<span class="w w1"> </span>stark<span class="w w1"> </span>contrast<span class="w w1"> </span>to<span class="w w1"> </span>benchmark<span class="w w1"> </span>suites</div><div class="l f2 s4 t0" style="bottom:295.647px;left:317.014px;" data-x="317.014" data-y="297.584" hs="1">such<span class="w w1"> </span>as<span class="w w1"> </span>SpecJVM98<span class="w w1"> </span>(3)<span class="w w1"> </span>used<span class="w w0"> </span>to<span class="w w2"> </span>evaluate<span class="w w1"> </span>desktop<span class="w w1"> </span>and<span class="w w1"> </span>server<span class="w w0"> </span>Jav</div><div class="l f2 s4 t0" style="bottom:295.647px;left:552.14px;" data-x="552.14" data-y="297.584" hs="1">a</div><div class="l f2 s4 t0" style="bottom:285.685px;left:317.014px;" data-x="317.014" data-y="287.621" hs="1">VMs.<span class="w w1"> </span>Many<span class="w w2"> </span>programs<span class="w w1"> </span>in<span class="w w1"> </span>those<span class="w w2"> </span>benchmarks<span class="w w1"> </span>use<span class="w w1"> </span>large<span class="w w1"> </span>data<span class="w w2"> </span>sets<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:275.722px;left:317.014px;" data-x="317.014" data-y="277.659" hs="1">execute<span class="w w2"> </span>for<span class="w w2"> </span>minutes.<span class="w w1"> </span>The<span class="w w2"> </span>SunSpider<span class="w w1"> </span>programs<span class="w w2"> </span>carry<span class="w w1"> </span>out<span class="w w2"> </span>a<span class="w w2"> </span>variety<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:265.759px;left:317.014px;" data-x="317.014" data-y="267.696" hs="1">tasks,<span class="w w2"> </span>primarily<span class="w w1"> </span>3d<span class="w w2"> </span>rendering,<span class="w w1"> </span>bit-bashing,<span class="w w2"> </span>cryptographic<span class="w w1"> </span>encoding,</div><div class="l f2 s4 t0" style="bottom:255.797px;left:317.014px;" data-x="317.014" data-y="257.733" hs="1">math<span class="w w2"> </span>kernels,<span class="w w1"> </span>and<span class="w w1"> </span>string<span class="w w2"> </span>processing.</div><div class="l f2 s4 t0" style="bottom:245.834px;left:328.969px;" data-x="328.969" data-y="247.771" hs="1">All<span class="w w1"> </span>experiments<span class="w w1"> </span>were<span class="w w0"> </span>performed<span class="w w1"> </span>on<span class="w w1"> </span>a<span class="w w0"> </span>MacBook<span class="w w1"> </span>Pro<span class="w w1"> </span>with<span class="w w0"> </span>2.2</div><div class="l f2 s4 t0" style="bottom:235.871px;left:317.014px;" data-x="317.014" data-y="237.808" hs="1">GHz<span class="w w2"> </span>Core<span class="w w1"> </span>2<span class="w w1"> </span>processor<span class="w w2"> </span>and<span class="w w1"> </span>2<span class="w w1"> </span>GB<span class="w w2"> </span>RAM<span class="w w1"> </span>running<span class="w w2"> </span>MacOS<span class="w w1"> </span>10.5.</div><div class="l f1 s4 t0" style="bottom:225.972px;left:328.969px;" data-x="328.969" data-y="227.846" hs="1">Benchmark<span class="w w1"> </span>results.</div><div class="l f2 s4 t0" style="bottom:225.909px;left:408.095px;" data-x="408.095" data-y="227.846" hs="1">The<span class="w w1"> </span>main<span class="w w0"> </span>question<span class="w w1"> </span>is<span class="w w1"> </span>whether<span class="w w0"> </span>programs</div><div class="l f2 s4 t0" style="bottom:215.946px;left:317.014px;" data-x="317.014" data-y="217.883" hs="1">run<span class="w w2"> </span>faster<span class="w w1"> </span>with<span class="w w2"> </span>tracing.<span class="w w1"> </span>For<span class="w w2"> </span>this,<span class="w w1"> </span>we<span class="w w1"> </span>ran<span class="w w2"> </span>the<span class="w w1"> </span>standard<span class="w w2"> </span>SunSpider<span class="w w1"> </span>test</div><div class="l f2 s4 t0" style="bottom:205.984px;left:317.014px;" data-x="317.014" data-y="207.92" hs="1">driver,<span class="w w1"> </span>which<span class="w w1"> </span>starts<span class="w w0"> </span>a<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter,<span class="w w0"> </span>loads<span class="w w1"> </span>and<span class="w w0"> </span>runs<span class="w w1"> </span>each</div><div class="l f2 s4 t0" style="bottom:196.021px;left:317.014px;" data-x="317.014" data-y="197.958" hs="1">program<span class="w w1"> </span>once<span class="w w1"> </span>for<span class="w w0"> </span>warmup,<span class="w w1"> </span>then<span class="w w1"> </span>loads<span class="w w1"> </span>and<span class="w w1"> </span>runs<span class="w w0"> </span>each<span class="w w1"> </span>program<span class="w w1"> </span>10</div><div class="l f2 s4 t0" style="bottom:186.058px;left:317.014px;" data-x="317.014" data-y="187.995" hs="1">times<span class="w w1"> </span>and<span class="w w2"> </span>reports<span class="w w1"> </span>the<span class="w w1"> </span>average<span class="w w1"> </span>time<span class="w w1"> </span>taken<span class="w w2"> </span>by<span class="w w1"> </span>each.<span class="w w1"> </span>We<span class="w w2"> </span>ran<span class="w w1"> </span>4<span class="w w1"> </span>differ-</div><div class="l f2 s4 t0" style="bottom:176.096px;left:317.014px;" data-x="317.014" data-y="178.032" hs="1">ent<span class="w w1"> </span>configurations<span class="w w2"> </span>for<span class="w w1"> </span>comparison:<span class="w w1"> </span>(a)<span class="w w1"> </span>SpiderMonkey,<span class="w w2"> </span>the<span class="w w1"> </span>baseline</div><div class="l f2 s4 t0" style="bottom:166.133px;left:317.014px;" data-x="317.014" data-y="168.07" hs="1">interpreter,<span class="w w2"> </span>(b)<span class="w w1"> </span>TraceMonkey,<span class="w w2"> </span>(d)<span class="w w1"> </span>SquirrelFish<span class="w w1"> </span>Extreme<span class="w w2"> </span>(SFX),<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:156.17px;left:317.014px;" data-x="317.014" data-y="158.107" hs="1">call-threaded<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter<span class="w w0"> </span>used<span class="w w1"> </span>in<span class="w w0"> </span>Apple’</div><div class="l f2 s4 t0" style="bottom:156.17px;left:502.959px;" data-x="502.959" data-y="158.107" hs="1">s<span class="w w1"> </span>WebKit,<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.144" hs="1">(e)<span class="w w2"> </span>V8,<span class="w w1"> </span>the<span class="w w1"> </span>method-compiling<span class="w w2"> </span>JavaScript<span class="w w1"> </span>VM<span class="w w2"> </span>from<span class="w w1"> </span>Google.</div><div class="l f2 s4 t0" style="bottom:136.245px;left:328.969px;" data-x="328.969" data-y="138.182" hs="1">Figure<span class="w w2"> </span>10<span class="w w2"> </span>shows<span class="w w2"> </span>the<span class="w w1"> </span>relative<span class="w w2"> </span>speedups<span class="w w2"> </span>achieved<span class="w w2"> </span>by<span class="w w2"> </span>tracing,<span class="w w1"> </span>SFX,</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">and<span class="w w1"> </span>V8<span class="w w2"> </span>against<span class="w w1"> </span>the<span class="w w1"> </span>baseline<span class="w w2"> </span>(SpiderMonkey).<span class="w w1"> </span>Tracing<span class="w w1"> </span>achieves<span class="w w2"> </span>the</div><div class="l f2 s4 t0" style="bottom:116.32px;left:317.014px;" data-x="317.014" data-y="118.256" hs="1">best<span class="w w2"> </span>speedups<span class="w w1"> </span>in<span class="w w1"> </span>integer-heavy<span class="w w2"> </span>benchmarks,<span class="w w1"> </span>up<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>25x<span class="w w2"> </span>speedup</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">on</div><div class="l f7 s4 t0" style="bottom:106.303px;left:328.222px;" data-x="328.222" data-y="108.294" hs="1">bitops-bitwise-and</div><div class="l f2 s4 t0" style="bottom:106.357px;left:412.953px;" data-x="412.953" data-y="108.294" hs="1">.</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:328.969px;" data-x="328.969" data-y="98.3312" hs="1">TraceMonkey<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w0"> </span>fastest<span class="w w1"> </span>VM<span class="w w0"> </span>on<span class="w w0"> </span>9<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w0"> </span>26<span class="w w1"> </span>benchmarks</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">(</div><div class="l f7 s4 t0" style="bottom:86.3781px;left:319.999px;" data-x="319.999" data-y="88.3686" hs="1">3d-morph</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:357.658px;" data-x="357.658" data-y="88.3686" hs="1">,</div><div class="l f7 s4 t0" style="bottom:86.3781px;left:365.095px;" data-x="365.095" data-y="88.3686" hs="1">bitops-3bit-bits-in-byte</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:478.07px;" data-x="478.07" data-y="88.3686" hs="1">,</div><div class="l f7 s4 t0" style="bottom:86.3781px;left:485.508px;" data-x="485.508" data-y="88.3686" hs="1">bitops-bitwise-</div><div class="l f7 s4 t0" style="bottom:76.4155px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">and</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:331.136px;" data-x="331.136" data-y="78.406" hs="1">,</div><div class="l f7 s4 t0" style="bottom:76.4155px;left:335.601px;" data-x="335.601" data-y="78.406" hs="1">crypto-sha1</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:387.381px;" data-x="387.381" data-y="78.406" hs="1">,</div><div class="l f7 s4 t0" style="bottom:76.4155px;left:391.846px;" data-x="391.846" data-y="78.406" hs="1">math-cordic</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:443.626px;" data-x="443.626" data-y="78.406" hs="1">,</div><div class="l f7 s4 t0" style="bottom:76.4155px;left:448.091px;" data-x="448.091" data-y="78.406" hs="1">math-partial-sums</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:528.115px;" data-x="528.115" data-y="78.406" hs="1">,</div><div class="l f7 s4 t0" style="bottom:76.4155px;left:532.581px;" data-x="532.581" data-y="78.406" hs="1">math-</div><div class="l f7 s4 t0" style="bottom:66.4528px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">spectral-norm</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:378.208px;" data-x="378.208" data-y="68.4433" hs="1">,</div><div class="l f7 s4 t0" style="bottom:66.4528px;left:384.525px;" data-x="384.525" data-y="68.4433" hs="1">string-base64</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:445.72px;" data-x="445.72" data-y="68.4433" hs="1">,</div><div class="l f7 s4 t0" style="bottom:66.4528px;left:452.036px;" data-x="452.036" data-y="68.4433" hs="1">string-validate-input</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:550.89px;" data-x="550.89" data-y="68.4433" hs="1">).</div></div></div><div id="page-11" class="p" style="width:612px;height:792px;background-image:url(p11.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"></div><div class="t t86"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="66.5497" data-y="546.539" hs="1">!&quot;</div></div><div class="t t87"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="66.5497" data-y="579.201" hs="1">#&quot;</div></div><div class="t t88"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="61.6334" data-y="611.862" hs="1">$!&quot;</div></div><div class="t t89"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="61.6334" data-y="644.524" hs="1">$#&quot;</div></div><div class="t t8a"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="61.6334" data-y="677.185" hs="1">%!&quot;</div></div><div class="t t8b"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="61.6334" data-y="709.847" hs="1">%#&quot;</div></div><div class="t t8c"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="488.109" data-y="692.153" hs="1">&amp;&apos;()*+,&quot;</div></div><div class="t t8d"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="488.109" data-y="674.666" hs="1">-./&quot;</div></div><div class="t t8e"><div class="l f17 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="488.109" data-y="657.178" hs="1">01&quot;</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:429.444px;left:54px;" data-x="54" data-y="431.318" hs="1">Figure<span class="w w1"> </span>10.</div><div class="l f2 s4 t0" style="bottom:429.381px;left:97.7208px;" data-x="97.7208" data-y="431.318" hs="1">Speedup<span class="w w1"> </span>vs.<span class="w w1"> </span>a<span class="w w1"> </span>baseline<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter<span class="w w1"> </span>(SpiderMonkey)<span class="w w1"> </span>for<span class="w w1"> </span>our<span class="w w1"> </span>trace-based<span class="w w1"> </span>JIT<span class="w w1"> </span>compiler,<span class="w w2"> </span>Apple’s<span class="w w1"> </span>SquirrelFish<span class="w w1"> </span>Extreme</div><div class="l f2 s4 t0" style="bottom:419.418px;left:54px;" data-x="54" data-y="421.355" hs="1">inline<span class="w w2"> </span>threading<span class="w w2"> </span>interpreter<span class="w w1"> </span>and<span class="w w2"> </span>Google’s<span class="w w2"> </span>V8<span class="w w2"> </span>JS<span class="w w1"> </span>compiler.<span class="w w2"> </span>Our<span class="w w2"> </span>system<span class="w w2"> </span>generates<span class="w w1"> </span>particularly<span class="w w2"> </span>efficient<span class="w w2"> </span>code<span class="w w1"> </span>for<span class="w w2"> </span>programs<span class="w w2"> </span>that<span class="w w1"> </span>benefit<span class="w w2"> </span>most<span class="w w2"> </span>from</div><div class="l f2 s4 t0" style="bottom:409.456px;left:54px;" data-x="54" data-y="411.393" hs="1">type<span class="w w1"> </span>specialization,<span class="w w2"> </span>which<span class="w w1"> </span>includes<span class="w w1"> </span>SunSpider<span class="w w1"> </span>Benchmark<span class="w w2"> </span>programs<span class="w w1"> </span>that<span class="w w1"> </span>perform<span class="w w1"> </span>bit<span class="w w2"> </span>manipulation.<span class="w w1"> </span>We<span class="w w2"> </span>type-specialize<span class="w w1"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>in<span class="w w2"> </span>question</div><div class="l f2 s4 t0" style="bottom:399.493px;left:54px;" data-x="54" data-y="401.43" hs="1">to<span class="w w1"> </span>use<span class="w w1"> </span>integer<span class="w w1"> </span>arithmetic,<span class="w w1"> </span>which<span class="w w1"> </span>substantially<span class="w w1"> </span>improves<span class="w w1"> </span>performance.<span class="w w1"> </span>For<span class="w w1"> </span>one<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>benchmark<span class="w w1"> </span>programs<span class="w w1"> </span>we<span class="w w1"> </span>execute<span class="w w1"> </span>25<span class="w w1"> </span>times<span class="w w1"> </span>faster<span class="w w1"> </span>than</div><div class="l f2 s4 t0" style="bottom:389.531px;left:54px;" data-x="54" data-y="391.467" hs="1">the<span class="w w2"> </span>SpiderMonkey<span class="w w1"> </span>interpreter,<span class="w w2"> </span>and<span class="w w1"> </span>almost<span class="w w1"> </span>5<span class="w w2"> </span>times<span class="w w1"> </span>faster<span class="w w2"> </span>than<span class="w w1"> </span>V8<span class="w w1"> </span>and<span class="w w2"> </span>SFX.<span class="w w1"> </span>For<span class="w w2"> </span>a<span class="w w1"> </span>large<span class="w w1"> </span>number<span class="w w2"> </span>of<span class="w w1"> </span>benchmarks<span class="w w2"> </span>all<span class="w w1"> </span>three<span class="w w1"> </span>VMs<span class="w w2"> </span>produce<span class="w w1"> </span>similar</div><div class="l f2 s4 t0" style="bottom:379.568px;left:54px;" data-x="54" data-y="381.505" hs="1">results.<span class="w w2"> </span>We<span class="w w2"> </span>perform<span class="w w1"> </span>worst<span class="w w1"> </span>on<span class="w w2"> </span>benchmark<span class="w w1"> </span>programs<span class="w w1"> </span>that<span class="w w2"> </span>we<span class="w w1"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>trace<span class="w w1"> </span>and<span class="w w2"> </span>instead<span class="w w1"> </span>fall<span class="w w1"> </span>back<span class="w w2"> </span>onto<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.<span class="w w1"> </span>This<span class="w w2"> </span>includes<span class="w w1"> </span>the<span class="w w1"> </span>recursive</div><div class="l f2 s4 t0" style="bottom:369.605px;left:54px;" data-x="54" data-y="371.542" hs="1">benchmarks</div><div class="l f7 s4 t0" style="bottom:369.551px;left:99.5667px;" data-x="99.5667" data-y="371.542" hs="1">access-binary-trees</div><div class="l f2 s4 t0" style="bottom:369.605px;left:191.247px;" data-x="191.247" data-y="371.542" hs="1">and</div><div class="l f7 s4 t0" style="bottom:369.551px;left:206.436px;" data-x="206.436" data-y="371.542" hs="1">control-flow-recursive</div><div class="l f2 s4 t0" style="bottom:369.605px;left:309.996px;" data-x="309.996" data-y="371.542" hs="1">,<span class="w w2"> </span>for<span class="w w1"> </span>which<span class="w w1"> </span>we<span class="w w2"> </span>currently<span class="w w1"> </span>don’t<span class="w w2"> </span>generate<span class="w w1"> </span>any<span class="w w1"> </span>native<span class="w w2"> </span>code.</div><div class="l f2 s4 t0" style="bottom:339.717px;left:54px;" data-x="54" data-y="341.654" hs="1">In<span class="w w1"> </span>particular,<span class="w w2"> </span>the</div><div class="l f7 s4 t0" style="bottom:339.664px;left:116.139px;" data-x="116.139" data-y="341.654" hs="1">bitops</div><div class="l f2 s4 t0" style="bottom:339.717px;left:146.873px;" data-x="146.873" data-y="341.654" hs="1">benchmarks<span class="w w1"> </span>are<span class="w w2"> </span>short<span class="w w1"> </span>programs<span class="w w1"> </span>that<span class="w w1"> </span>per-</div><div class="l f2 s4 t0" style="bottom:329.755px;left:54px;" data-x="54" data-y="331.692" hs="1">form<span class="w w1"> </span>many<span class="w w1"> </span>bitwise<span class="w w1"> </span>operations,<span class="w w1"> </span>so<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>can<span class="w w1"> </span>cover<span class="w w1"> </span>the<span class="w w1"> </span>en-</div><div class="l f2 s4 t0" style="bottom:319.792px;left:54px;" data-x="54" data-y="321.729" hs="1">tire<span class="w w2"> </span>program<span class="w w1"> </span>with<span class="w w1"> </span>1<span class="w w2"> </span>or<span class="w w1"> </span>2<span class="w w2"> </span>traces<span class="w w1"> </span>that<span class="w w1"> </span>operate<span class="w w2"> </span>on<span class="w w1"> </span>integers.<span class="w w2"> </span>TraceMon-</div><div class="l f2 s4 t0" style="bottom:309.829px;left:54px;" data-x="54" data-y="311.766" hs="1">key<span class="w w2"> </span>runs<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>other<span class="w w2"> </span>programs<span class="w w1"> </span>in<span class="w w1"> </span>this<span class="w w2"> </span>set<span class="w w1"> </span>almost<span class="w w1"> </span>entirely<span class="w w1"> </span>as<span class="w w2"> </span>native</div><div class="l f2 s4 t0" style="bottom:299.867px;left:54px;" data-x="54" data-y="301.804" hs="1">code.</div><div class="l f7 s4 t0" style="bottom:289.85px;left:65.9552px;" data-x="65.9552" data-y="291.841" hs="1">regexp-dna</div><div class="l f2 s4 t0" style="bottom:289.904px;left:117.726px;" data-x="117.726" data-y="291.841" hs="1">is<span class="w w0"> </span>dominated<span class="w w0"> </span>by<span class="w w0"> </span>regular<span class="w w0"> </span>expression<span class="w w0"> </span>matching,</div><div class="l f2 s4 t0" style="bottom:279.942px;left:54px;" data-x="54" data-y="281.878" hs="1">which<span class="w w2"> </span>is<span class="w w1"> </span>implemented<span class="w w1"> </span>in<span class="w w2"> </span>all<span class="w w1"> </span>3<span class="w w1"> </span>VMs<span class="w w2"> </span>by<span class="w w1"> </span>a<span class="w w2"> </span>special<span class="w w1"> </span>regular<span class="w w1"> </span>expression</div><div class="l f2 s4 t0" style="bottom:269.979px;left:54px;" data-x="54" data-y="271.916" hs="1">compiler.<span class="w w2"> </span>Thus,<span class="w w1"> </span>performance<span class="w w0"> </span>on<span class="w w2"> </span>this<span class="w w1"> </span>benchmark<span class="w w1"> </span>has<span class="w w1"> </span>little<span class="w w0"> </span>relation</div><div class="l f2 s4 t0" style="bottom:260.016px;left:54px;" data-x="54" data-y="261.953" hs="1">to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>compilation<span class="w w2"> </span>approach<span class="w w1"> </span>discussed<span class="w w1"> </span>in<span class="w w2"> </span>this<span class="w w1"> </span>paper.</div><div class="l f2 s4 t0" style="bottom:250.054px;left:65.9552px;" data-x="65.9552" data-y="251.99" hs="1">TraceMonkey’</div><div class="l f2 s4 t0" style="bottom:250.054px;left:118.202px;" data-x="118.202" data-y="251.99" hs="1">s<span class="w w1"> </span>smaller<span class="w w1"> </span>speedups<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>other<span class="w w1"> </span>benchmarks<span class="w w1"> </span>can</div><div class="l f2 s4 t0" style="bottom:240.091px;left:54px;" data-x="54" data-y="242.028" hs="1">be<span class="w w2"> </span>attributed<span class="w w1"> </span>to<span class="w w1"> </span>a<span class="w w2"> </span>few<span class="w w1"> </span>specific<span class="w w2"> </span>causes:</div><div class="l f3 s3 t0" style="bottom:215.242px;left:59.2303px;" data-x="59.2303" data-y="216.789" hs="1">•</div><div class="l f2 s4 t0" style="bottom:213.954px;left:66.9514px;" data-x="66.9514" data-y="215.89" hs="1">The<span class="w w0"> </span>implementation<span class="w w0"> </span>does<span class="w w4"> </span>not<span class="w w0"> </span>currently<span class="w w4"> </span>trace<span class="w w0"> </span>recursion,<span class="w w4"> </span>so</div><div class="l f2 s4 t0" style="bottom:203.991px;left:66.9514px;" data-x="66.9514" data-y="205.928" hs="1">TraceMonkey<span class="w w0"> </span>achieves<span class="w w0"> </span>a<span class="w w0"> </span>small<span class="w w0"> </span>speedup<span class="w w0"> </span>or<span class="w w0"> </span>no<span class="w w4"> </span>speedup<span class="w w0"> </span>on</div><div class="l f2 s4 t0" style="bottom:194.028px;left:66.9514px;" data-x="66.9514" data-y="195.965" hs="1">benchmarks<span class="w w0"> </span>that<span class="w w4"> </span>use<span class="w w4"> </span>recursion<span class="w w4"> </span>extensively:</div><div class="l f7 s4 t0" style="bottom:193.975px;left:238.471px;" data-x="238.471" data-y="195.965" hs="1">3d-cube</div><div class="l f2 s4 t0" style="bottom:194.028px;left:271.422px;" data-x="271.422" data-y="195.965" hs="1">,</div><div class="l f7 s4 t0" style="bottom:193.975px;left:278.981px;" data-x="278.981" data-y="195.965" hs="1">3d-</div><div class="l f7 s4 t0" style="bottom:184.012px;left:66.9514px;" data-x="66.9514" data-y="186.003" hs="1">raytrace</div><div class="l f2 s4 t0" style="bottom:184.066px;left:104.61px;" data-x="104.61" data-y="186.003" hs="1">,</div><div class="l f7 s4 t0" style="bottom:184.012px;left:109.776px;" data-x="109.776" data-y="186.003" hs="1">access-binary-trees</div><div class="l f2 s4 t0" style="bottom:184.066px;left:199.214px;" data-x="199.214" data-y="186.003" hs="1">,</div><div class="l f7 s4 t0" style="bottom:184.012px;left:204.38px;" data-x="204.38" data-y="186.003" hs="1">string-tagcloud</div><div class="l f2 s4 t0" style="bottom:184.066px;left:274.99px;" data-x="274.99" data-y="186.003" hs="1">,<span class="w w1"> </span>and</div><div class="l f7 s4 t0" style="bottom:174.049px;left:66.9514px;" data-x="66.9514" data-y="176.04" hs="1">controlflow-recursive</div><div class="l f2 s4 t0" style="bottom:174.103px;left:165.805px;" data-x="165.805" data-y="176.04" hs="1">.</div><div class="l f3 s3 t0" style="bottom:161.444px;left:59.2303px;" data-x="59.2303" data-y="162.99" hs="1">•</div><div class="l f2 s4 t0" style="bottom:160.155px;left:66.9514px;" data-x="66.9514" data-y="162.092" hs="1">The<span class="w w1"> </span>implementation<span class="w w0"> </span>does<span class="w w1"> </span>not<span class="w w0"> </span>currently<span class="w w1"> </span>trace</div><div class="l f7 s4 t0" style="bottom:160.102px;left:235.516px;" data-x="235.516" data-y="162.092" hs="1">eval</div><div class="l f2 s4 t0" style="bottom:160.155px;left:257.787px;" data-x="257.787" data-y="162.092" hs="1">and<span class="w w1"> </span>some</div><div class="l f2 s4 t0" style="bottom:150.193px;left:66.9514px;" data-x="66.9514" data-y="152.13" hs="1">other<span class="w w0"> </span>functions<span class="w w0"> </span>implemented<span class="w w0"> </span>in<span class="w w0"> </span>C.<span class="w w1"> </span>Because</div><div class="l f7 s4 t0" style="bottom:150.139px;left:236.616px;" data-x="236.616" data-y="152.13" hs="1">date-format-</div><div class="l f7 s4 t0" style="bottom:140.176px;left:66.9514px;" data-x="66.9514" data-y="142.167" hs="1">tofte</div><div class="l f2 s4 t0" style="bottom:140.23px;left:93.9841px;" data-x="93.9841" data-y="142.167" hs="1">and</div><div class="l f7 s4 t0" style="bottom:140.176px;left:110.428px;" data-x="110.428" data-y="142.167" hs="1">date-format-xparb</div><div class="l f2 s4 t0" style="bottom:140.23px;left:193.948px;" data-x="193.948" data-y="142.167" hs="1">use<span class="w w1"> </span>such<span class="w w0"> </span>functions<span class="w w1"> </span>in<span class="w w0"> </span>their</div><div class="l f2 s4 t0" style="bottom:130.267px;left:66.9514px;" data-x="66.9514" data-y="132.204" hs="1">main<span class="w w2"> </span>loops,<span class="w w1"> </span>we<span class="w w1"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>trace<span class="w w1"> </span>them.</div><div class="l f3 s3 t0" style="bottom:117.609px;left:59.2303px;" data-x="59.2303" data-y="119.155" hs="1">•</div><div class="l f2 s4 t0" style="bottom:116.32px;left:66.9514px;" data-x="66.9514" data-y="118.256" hs="1">The<span class="w w1"> </span>implementation<span class="w w0"> </span>does<span class="w w1"> </span>not<span class="w w0"> </span>currently<span class="w w1"> </span>trace<span class="w w0"> </span>through<span class="w w1"> </span>regular</div><div class="l f2 s4 t0" style="bottom:106.357px;left:66.9514px;" data-x="66.9514" data-y="108.294" hs="1">expression</div><div class="l f7 s4 t0" style="bottom:106.303px;left:108.704px;" data-x="108.704" data-y="108.294" hs="1">replace</div><div class="l f2 s4 t0" style="bottom:106.357px;left:145.194px;" data-x="145.194" data-y="108.294" hs="1">operations.<span class="w w1"> </span>The<span class="w w0"> </span>replace<span class="w w1"> </span>function<span class="w w0"> </span>can<span class="w w1"> </span>be</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:66.9514px;" data-x="66.9514" data-y="98.3312" hs="1">passed<span class="w w1"> </span>a<span class="w w2"> </span>function<span class="w w1"> </span>object<span class="w w1"> </span>used<span class="w w1"> </span>to<span class="w w2"> </span>compute<span class="w w1"> </span>the<span class="w w1"> </span>replacement<span class="w w1"> </span>text.</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:66.9514px;" data-x="66.9514" data-y="88.3686" hs="1">Our<span class="w w1"> </span>implementation<span class="w w0"> </span>currently<span class="w w1"> </span>does<span class="w w1"> </span>not<span class="w w0"> </span>trace<span class="w w1"> </span>functions<span class="w w1"> </span>called</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:66.9514px;" data-x="66.9514" data-y="78.406" hs="1">as<span class="w w2"> </span>replace<span class="w w1"> </span>functions.<span class="w w2"> </span>The<span class="w w1"> </span>run<span class="w w1"> </span>time<span class="w w2"> </span>of</div><div class="l f7 s4 t0" style="bottom:76.4155px;left:200.246px;" data-x="200.246" data-y="78.406" hs="1">string-unpack-code</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:287.123px;" data-x="287.123" data-y="78.406" hs="1">is</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:66.9514px;" data-x="66.9514" data-y="68.4433" hs="1">dominated<span class="w w2"> </span>by<span class="w w1"> </span>such<span class="w w1"> </span>a</div><div class="l f7 s4 t0" style="bottom:66.4528px;left:143.156px;" data-x="143.156" data-y="68.4433" hs="1">replace</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:178.349px;" data-x="178.349" data-y="68.4433" hs="1">call.</div><div class="l f3 s3 t0" style="bottom:341.006px;left:322.244px;" data-x="322.244" data-y="342.552" hs="1">•</div><div class="l f2 s4 t0" style="bottom:339.717px;left:329.965px;" data-x="329.965" data-y="341.654" hs="1">Two<span class="w w1"> </span>programs<span class="w w1"> </span>trace<span class="w w0"> </span>well,<span class="w w0"> </span>but<span class="w w1"> </span>have<span class="w w1"> </span>a<span class="w w0"> </span>long<span class="w w1"> </span>compilation<span class="w w0"> </span>time.</div><div class="l f7 s4 t0" style="bottom:329.701px;left:329.965px;" data-x="329.965" data-y="331.692" hs="1">access-nbody</div><div class="l f2 s4 t0" style="bottom:329.755px;left:388.156px;" data-x="388.156" data-y="331.692" hs="1">forms<span class="w w2"> </span>a<span class="w w2"> </span>large<span class="w w2"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>traces<span class="w w2"> </span>(81).</div><div class="l f7 s4 t0" style="bottom:329.701px;left:515.693px;" data-x="515.693" data-y="331.692" hs="1">crypto-md5</div><div class="l f2 s4 t0" style="bottom:319.792px;left:329.965px;" data-x="329.965" data-y="321.729" hs="1">forms<span class="w w1"> </span>one<span class="w w1"> </span>very<span class="w w2"> </span>long<span class="w w1"> </span>trace.<span class="w w1"> </span>We<span class="w w1"> </span>expect<span class="w w1"> </span>to<span class="w w1"> </span>improve<span class="w w2"> </span>performance</div><div class="l f2 s4 t0" style="bottom:309.829px;left:329.965px;" data-x="329.965" data-y="311.766" hs="1">on<span class="w w1"> </span>this<span class="w w2"> </span>programs<span class="w w1"> </span>by<span class="w w1"> </span>improving<span class="w w1"> </span>the<span class="w w2"> </span>compilation<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w1"> </span>nano-</div><div class="l f2 s4 t0" style="bottom:299.867px;left:329.965px;" data-x="329.965" data-y="301.804" hs="1">jit.</div><div class="l f3 s3 t0" style="bottom:287.208px;left:322.244px;" data-x="322.244" data-y="288.754" hs="1">•</div><div class="l f2 s4 t0" style="bottom:285.919px;left:329.965px;" data-x="329.965" data-y="287.856" hs="1">Some<span class="w w0"> </span>programs<span class="w w1"> </span>trace<span class="w w0"> </span>very<span class="w w0"> </span>well,<span class="w w0"> </span>and<span class="w w1"> </span>speed<span class="w w0"> </span>up<span class="w w0"> </span>compared<span class="w w0"> </span>to</div><div class="l f2 s4 t0" style="bottom:275.957px;left:329.965px;" data-x="329.965" data-y="277.893" hs="1">the<span class="w w1"> </span>interpreter,<span class="w w1"> </span>but<span class="w w1"> </span>are<span class="w w0"> </span>not<span class="w w1"> </span>as<span class="w w1"> </span>fast<span class="w w0"> </span>as<span class="w w1"> </span>SFX<span class="w w1"> </span>and/or<span class="w w1"> </span>V8,<span class="w w0"> </span>namely</div><div class="l f7 s4 t0" style="bottom:265.94px;left:329.965px;" data-x="329.965" data-y="267.931" hs="1">bitops-bits-in-byte</div><div class="l f2 s4 t0" style="bottom:265.994px;left:419.404px;" data-x="419.404" data-y="267.931" hs="1">,</div><div class="l f7 s4 t0" style="bottom:265.94px;left:428.919px;" data-x="428.919" data-y="267.931" hs="1">bitops-nsieve-bits</div><div class="l f2 s4 t0" style="bottom:265.994px;left:513.65px;" data-x="513.65" data-y="267.931" hs="1">,</div><div class="l f7 s4 t0" style="bottom:265.94px;left:523.166px;" data-x="523.166" data-y="267.931" hs="1">access-</div><div class="l f7 s4 t0" style="bottom:255.977px;left:329.965px;" data-x="329.965" data-y="257.968" hs="1">fannkuch</div><div class="l f2 s4 t0" style="bottom:256.031px;left:367.623px;" data-x="367.623" data-y="257.968" hs="1">,</div><div class="l f7 s4 t0" style="bottom:255.977px;left:372.736px;" data-x="372.736" data-y="257.968" hs="1">access-nsieve</div><div class="l f2 s4 t0" style="bottom:256.031px;left:433.931px;" data-x="433.931" data-y="257.968" hs="1">,<span class="w w1"> </span>and</div><div class="l f7 s4 t0" style="bottom:255.977px;left:454.863px;" data-x="454.863" data-y="257.968" hs="1">crypto-aes</div><div class="l f2 s4 t0" style="bottom:256.031px;left:501.936px;" data-x="501.936" data-y="257.968" hs="1">.<span class="w w1"> </span>The<span class="w w1"> </span>reason<span class="w w1"> </span>is</div><div class="l f2 s4 t0" style="bottom:246.069px;left:329.965px;" data-x="329.965" data-y="248.005" hs="1">not<span class="w w0"> </span>clear,<span class="w w1"> </span>but<span class="w w0"> </span>all<span class="w w0"> </span>of<span class="w w1"> </span>these<span class="w w0"> </span>programs<span class="w w0"> </span>have<span class="w w1"> </span>nested<span class="w w0"> </span>loops<span class="w w0"> </span>with</div><div class="l f2 s4 t0" style="bottom:236.106px;left:329.965px;" data-x="329.965" data-y="238.043" hs="1">small<span class="w w2"> </span>bodies,<span class="w w1"> </span>so<span class="w w1"> </span>we<span class="w w1"> </span>suspect<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>implementation<span class="w w2"> </span>has<span class="w w1"> </span>a<span class="w w1"> </span>rela-</div><div class="l f2 s4 t0" style="bottom:226.143px;left:329.965px;" data-x="329.965" data-y="228.08" hs="1">tively<span class="w w2"> </span>high<span class="w w1"> </span>cost<span class="w w2"> </span>for<span class="w w1"> </span>calling<span class="w w2"> </span>nested<span class="w w1"> </span>traces.</div><div class="l f7 s4 t0" style="bottom:226.09px;left:476.548px;" data-x="476.548" data-y="228.08" hs="1">string-fasta</div><div class="l f2 s4 t0" style="bottom:226.143px;left:535.208px;" data-x="535.208" data-y="228.08" hs="1">traces</div><div class="l f2 s4 t0" style="bottom:216.181px;left:329.965px;" data-x="329.965" data-y="218.117" hs="1">well,<span class="w w2"> </span>but<span class="w w1"> </span>its<span class="w w2"> </span>run<span class="w w1"> </span>time<span class="w w2"> </span>is<span class="w w2"> </span>dominated<span class="w w1"> </span>by<span class="w w2"> </span>string<span class="w w1"> </span>processing<span class="w w2"> </span>builtins,</div><div class="l f2 s4 t0" style="bottom:206.218px;left:329.965px;" data-x="329.965" data-y="208.155" hs="1">which<span class="w w2"> </span>are<span class="w w1"> </span>unaffected<span class="w w1"> </span>by<span class="w w2"> </span>tracing<span class="w w1"> </span>and<span class="w w1"> </span>seem<span class="w w2"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>less<span class="w w2"> </span>efficient<span class="w w1"> </span>in</div><div class="l f2 s4 t0" style="bottom:196.255px;left:329.965px;" data-x="329.965" data-y="198.192" hs="1">SpiderMonkey<span class="w w2"> </span>than<span class="w w1"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>two<span class="w w1"> </span>other<span class="w w2"> </span>VMs.</div><div class="l f1 s4 t0" style="bottom:176.158px;left:328.969px;" data-x="328.969" data-y="178.032" hs="1">Detailed<span class="w w2"> </span>performance<span class="w w1"> </span>metrics.</div><div class="l f2 s4 t0" style="bottom:176.096px;left:446.769px;" data-x="446.769" data-y="178.032" hs="1">In<span class="w w2"> </span>Figure<span class="w w1"> </span>11<span class="w w2"> </span>we<span class="w w1"> </span>show<span class="w w2"> </span>the<span class="w w1"> </span>frac-</div><div class="l f2 s4 t0" style="bottom:166.133px;left:317.014px;" data-x="317.014" data-y="168.07" hs="1">tion<span class="w w2"> </span>of<span class="w w1"> </span>instructions<span class="w w1"> </span>interpreted<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>fraction<span class="w w1"> </span>of<span class="w w2"> </span>instructions<span class="w w1"> </span>exe-</div><div class="l f2 s4 t0" style="bottom:156.17px;left:317.014px;" data-x="317.014" data-y="158.107" hs="1">cuted<span class="w w2"> </span>as<span class="w w1"> </span>native<span class="w w2"> </span>code.<span class="w w2"> </span>This<span class="w w1"> </span>figure<span class="w w2"> </span>shows<span class="w w1"> </span>that<span class="w w2"> </span>for<span class="w w1"> </span>many<span class="w w2"> </span>programs,<span class="w w2"> </span>we</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.144" hs="1">are<span class="w w2"> </span>able<span class="w w1"> </span>to<span class="w w1"> </span>execute<span class="w w2"> </span>almost<span class="w w1"> </span>all<span class="w w2"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>natively</div><div class="l f2 s4 t0" style="bottom:146.208px;left:483.636px;" data-x="483.636" data-y="148.144" hs="1">.</div><div class="l f2 s4 t0" style="bottom:136.245px;left:328.969px;" data-x="328.969" data-y="138.182" hs="1">Figure<span class="w w1"> </span>12<span class="w w2"> </span>breaks<span class="w w1"> </span>down<span class="w w1"> </span>the<span class="w w1"> </span>total<span class="w w1"> </span>execution<span class="w w2"> </span>time<span class="w w1"> </span>into<span class="w w1"> </span>four<span class="w w1"> </span>activ-</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">ities:<span class="w w1"> </span>interpreting<span class="w w1"> </span>bytecodes<span class="w w1"> </span>while<span class="w w1"> </span>not<span class="w w0"> </span>recording,<span class="w w2"> </span>recording<span class="w w0"> </span>traces</div><div class="l f2 s4 t0" style="bottom:116.32px;left:317.014px;" data-x="317.014" data-y="118.257" hs="1">(including<span class="w w1"> </span>time<span class="w w0"> </span>taken<span class="w w1"> </span>to<span class="w w0"> </span>interpret<span class="w w1"> </span>the<span class="w w0"> </span>recorded<span class="w w1"> </span>trace),<span class="w w0"> </span>compiling</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">traces<span class="w w2"> </span>to<span class="w w1"> </span>native<span class="w w2"> </span>code,<span class="w w1"> </span>and<span class="w w1"> </span>executing<span class="w w2"> </span>native<span class="w w2"> </span>code<span class="w w1"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:96.3946px;left:328.969px;" data-x="328.969" data-y="98.3313" hs="1">These<span class="w w1"> </span>detailed<span class="w w0"> </span>metrics<span class="w w1"> </span>allow<span class="w w0"> </span>us<span class="w w1"> </span>to<span class="w w0"> </span>estimate<span class="w w1"> </span>parameters<span class="w w0"> </span>for<span class="w w1"> </span>a</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">simple<span class="w w1"> </span>model<span class="w w1"> </span>of<span class="w w0"> </span>tracing<span class="w w1"> </span>performance.<span class="w w1"> </span>These<span class="w w0"> </span>estimates<span class="w w1"> </span>should<span class="w w1"> </span>be</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">considered<span class="w w1"> </span>very<span class="w w0"> </span>rough,<span class="w w1"> </span>as<span class="w w0"> </span>the<span class="w w1"> </span>values<span class="w w1"> </span>observed<span class="w w0"> </span>on<span class="w w1"> </span>the<span class="w w0"> </span>individual</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:317.014px;" data-x="317.014" data-y="68.4434" hs="1">benchmarks<span class="w w0"> </span>hav</div><div class="l f2 s4 t0" style="bottom:66.5067px;left:376.766px;" data-x="376.766" data-y="68.4434" hs="1">e<span class="w w0"> </span>large<span class="w w1"> </span>standard<span class="w w0"> </span>deviations<span class="w w1"> </span>(on<span class="w w0"> </span>the<span class="w w1"> </span>order<span class="w w0"> </span>of<span class="w w0"> </span>the</div></div></div><div id="page-12" class="p" style="width:612px;height:792px;background-image:url(p12.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f2 s4 t0" style="bottom:711.089px;left:166.563px;" data-x="166.563" data-y="713.026" hs="1">Loops<span class="w w3"> </span>Trees<span class="w w11"> </span>Traces<span class="w w3"> </span>Aborts<span class="w w11"> </span>Flushes<span class="w w3"> </span>Trees/Loop<span class="w w11"> </span>Traces/Tree<span class="w w3"> </span>Traces/Loop<span class="w w11"> </span>Speedup</div><div class="l f2 s4 t0" style="bottom:700.728px;left:71.4192px;" data-x="71.4192" data-y="702.665" hs="1">3d-cube<span class="w w12"> </span>25<span class="w w6"> </span>27<span class="w w13"> </span>29<span class="w w14"> </span>3<span class="w w15"> </span>0<span class="w w16"> </span>1.1<span class="w wc"> </span>1.1<span class="w w17"> </span>1.2<span class="w w6"> </span>2.20x</div><div class="l f2 s4 t0" style="bottom:690.766px;left:71.4192px;" data-x="71.4192" data-y="692.702" hs="1">3d-morph<span class="w w18"> </span>5<span class="w w19"> </span>8<span class="w w14"> </span>8<span class="w w14"> </span>2<span class="w wf"> </span>0<span class="w w16"> </span>1.6<span class="w wc"> </span>1.0<span class="w w17"> </span>1.6<span class="w w6"> </span>2.86x</div><div class="l f2 s4 t0" style="bottom:680.803px;left:71.4192px;" data-x="71.4192" data-y="682.74" hs="1">3d-raytrace<span class="w w1a"> </span>10<span class="w w6"> </span>25<span class="w w1b"> </span>100<span class="w w19"> </span>10<span class="w w15"> </span>1<span class="w w16"> </span>2.5<span class="w wc"> </span>4.0<span class="w w16"> </span>10.0<span class="w w6"> </span>1.18x</div><div class="l f2 s4 t0" style="bottom:670.84px;left:71.4192px;" data-x="71.4192" data-y="672.777" hs="1">access-binary-trees<span class="w w1c"> </span>0<span class="w w19"> </span>0<span class="w w14"> </span>0<span class="w w14"> </span>5<span class="w wf"> </span>0<span class="w w1d"> </span>-<span class="w w1d"> </span>-<span class="w w1e"> </span>-<span class="w w6"> </span>0.93x</div><div class="l f2 s4 t0" style="bottom:660.878px;left:71.4192px;" data-x="71.4192" data-y="662.815" hs="1">access-fannkuch<span class="w w1f"> </span>10<span class="w w6"> </span>34<span class="w w13"> </span>57<span class="w w19"> </span>24<span class="w w15"> </span>0<span class="w w16"> </span>3.4<span class="w wc"> </span>1.7<span class="w w17"> </span>5.7<span class="w w6"> </span>2.20x</div><div class="l f2 s4 t0" style="bottom:650.915px;left:71.4192px;" data-x="71.4192" data-y="652.852" hs="1">access-nbody<span class="w w20"> </span>8<span class="w w6"> </span>16<span class="w w13"> </span>18<span class="w w14"> </span>5<span class="w w15"> </span>0<span class="w w16"> </span>2.0<span class="w wc"> </span>1.1<span class="w w17"> </span>2.3<span class="w w6"> </span>4.19x</div><div class="l f2 s4 t0" style="bottom:640.952px;left:71.4192px;" data-x="71.4192" data-y="642.889" hs="1">access-nsieve<span class="w w20"> </span>3<span class="w w13"> </span>6<span class="w w14"> </span>8<span class="w w14"> </span>3<span class="w w15"> </span>0<span class="w w16"> </span>2.0<span class="w wc"> </span>1.3<span class="w w17"> </span>2.7<span class="w w6"> </span>3.05x</div><div class="l f2 s4 t0" style="bottom:630.99px;left:71.4192px;" data-x="71.4192" data-y="632.927" hs="1">bitops-3bit-bits-in-byte<span class="w w21"> </span>2<span class="w w19"> </span>2<span class="w w14"> </span>2<span class="w w14"> </span>0<span class="w wf"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>1.0<span class="w w17"> </span>1.0<span class="w w22"> </span>25.47x</div><div class="l f2 s4 t0" style="bottom:621.027px;left:71.4192px;" data-x="71.4192" data-y="622.964" hs="1">bitops-bits-in-byte<span class="w w17"> </span>3<span class="w w19"> </span>3<span class="w w14"> </span>4<span class="w w14"> </span>1<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>1.3<span class="w w17"> </span>1.3<span class="w w6"> </span>8.67x</div><div class="l f2 s4 t0" style="bottom:611.065px;left:71.4192px;" data-x="71.4192" data-y="613.001" hs="1">bitops-bitwise-and<span class="w w17"> </span>1<span class="w w19"> </span>1<span class="w w14"> </span>1<span class="w w14"> </span>0<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w w16"> </span>1.0<span class="w w17"> </span>1.0<span class="w w22"> </span>25.20x</div><div class="l f2 s4 t0" style="bottom:601.102px;left:71.4192px;" data-x="71.4192" data-y="603.039" hs="1">bitops-nsieve-bits<span class="w w1f"> </span>3<span class="w w19"> </span>3<span class="w w14"> </span>5<span class="w w14"> </span>0<span class="w wf"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>1.7<span class="w w17"> </span>1.7<span class="w w6"> </span>2.75x</div><div class="l f2 s4 t0" style="bottom:591.139px;left:71.4192px;" data-x="71.4192" data-y="593.076" hs="1">controlflow-recursive<span class="w w23"> </span>0<span class="w w19"> </span>0<span class="w w14"> </span>0<span class="w w14"> </span>1<span class="w wf"> </span>0<span class="w w1d"> </span>-<span class="w w1d"> </span>-<span class="w w1e"> </span>-<span class="w w6"> </span>0.98x</div><div class="l f2 s4 t0" style="bottom:581.177px;left:71.4192px;" data-x="71.4192" data-y="583.113" hs="1">crypto-aes<span class="w we"> </span>50<span class="w w6"> </span>72<span class="w w13"> </span>78<span class="w w19"> </span>19<span class="w w15"> </span>0<span class="w w16"> </span>1.4<span class="w wc"> </span>1.1<span class="w w17"> </span>1.6<span class="w w6"> </span>1.64x</div><div class="l f2 s4 t0" style="bottom:571.214px;left:71.4192px;" data-x="71.4192" data-y="573.151" hs="1">crypto-md5<span class="w we"> </span>4<span class="w w19"> </span>4<span class="w w14"> </span>5<span class="w w14"> </span>0<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w w16"> </span>1.3<span class="w w17"> </span>1.3<span class="w w6"> </span>2.30x</div><div class="l f2 s4 t0" style="bottom:561.251px;left:71.4192px;" data-x="71.4192" data-y="563.188" hs="1">crypto-sha1<span class="w we"> </span>5<span class="w w19"> </span>5<span class="w w13"> </span>10<span class="w w14"> </span>0<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>2.0<span class="w w17"> </span>2.0<span class="w w6"> </span>5.95x</div><div class="l f2 s4 t0" style="bottom:551.289px;left:71.4192px;" data-x="71.4192" data-y="553.225" hs="1">date-format-tofte<span class="w w8"> </span>3<span class="w w19"> </span>3<span class="w w21"> </span>4<span class="w w14"> </span>7<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>1.3<span class="w w17"> </span>1.3<span class="w w6"> </span>1.07x</div><div class="l f2 s4 t0" style="bottom:541.326px;left:71.4192px;" data-x="71.4192" data-y="543.263" hs="1">date-format-xparb<span class="w w9"> </span>3<span class="w w19"> </span>3<span class="w w19"> </span>11<span class="w w14"> </span>3<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w w16"> </span>3.7<span class="w w17"> </span>3.7<span class="w w6"> </span>0.98x</div><div class="l f2 s4 t0" style="bottom:531.363px;left:71.4192px;" data-x="71.4192" data-y="533.3" hs="1">math-cordic<span class="w w24"> </span>2<span class="w w19"> </span>4<span class="w w14"> </span>5<span class="w w14"> </span>1<span class="w wf"> </span>0<span class="w w16"> </span>2.0<span class="w wc"> </span>1.3<span class="w w17"> </span>2.5<span class="w w6"> </span>4.92x</div><div class="l f2 s4 t0" style="bottom:521.401px;left:71.4192px;" data-x="71.4192" data-y="523.338" hs="1">math-partial-sums<span class="w w9"> </span>2<span class="w w19"> </span>4<span class="w w14"> </span>4<span class="w w14"> </span>1<span class="w wf"> </span>0<span class="w w16"> </span>2.0<span class="w wc"> </span>1.0<span class="w w17"> </span>2.0<span class="w w6"> </span>5.90x</div><div class="l f2 s4 t0" style="bottom:511.438px;left:71.4192px;" data-x="71.4192" data-y="513.375" hs="1">math-spectral-norm<span class="w wa"> </span>15<span class="w w1b"> </span>20<span class="w w19"> </span>20<span class="w w14"> </span>0<span class="w w15"> </span>0<span class="w w16"> </span>1.3<span class="w wc"> </span>1.0<span class="w w17"> </span>1.3<span class="w w6"> </span>7.12x</div><div class="l f2 s4 t0" style="bottom:501.475px;left:71.4192px;" data-x="71.4192" data-y="503.412" hs="1">regexp-dna<span class="w w25"> </span>2<span class="w w19"> </span>2<span class="w w14"> </span>2<span class="w w14"> </span>0<span class="w wf"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>1.0<span class="w w17"> </span>1.0<span class="w w6"> </span>4.21x</div><div class="l f2 s4 t0" style="bottom:491.513px;left:71.4192px;" data-x="71.4192" data-y="493.45" hs="1">string-base64<span class="w w20"> </span>3<span class="w w19"> </span>5<span class="w w14"> </span>7<span class="w w14"> </span>0<span class="w wf"> </span>0<span class="w w16"> </span>1.7<span class="w wc"> </span>1.4<span class="w w17"> </span>2.3<span class="w w6"> </span>2.53x</div><div class="l f2 s4 t0" style="bottom:481.55px;left:71.4192px;" data-x="71.4192" data-y="483.487" hs="1">string-fasta<span class="w w25"> </span>5<span class="w w6"> </span>11<span class="w w13"> </span>15<span class="w w14"> </span>6<span class="w w15"> </span>0<span class="w w16"> </span>2.2<span class="w wc"> </span>1.4<span class="w w17"> </span>3.0<span class="w w6"> </span>1.49x</div><div class="l f2 s4 t0" style="bottom:471.588px;left:71.4192px;" data-x="71.4192" data-y="473.524" hs="1">string-tagcloud<span class="w w26"> </span>3<span class="w w19"> </span>6<span class="w w14"> </span>6<span class="w w14"> </span>5<span class="w wf"> </span>0<span class="w w16"> </span>2.0<span class="w wc"> </span>1.0<span class="w w17"> </span>2.0<span class="w w6"> </span>1.09x</div><div class="l f2 s4 t0" style="bottom:461.625px;left:71.4192px;" data-x="71.4192" data-y="463.562" hs="1">string-unpack-code<span class="w w1c"> </span>4<span class="w w13"> </span>4<span class="w w19"> </span>37<span class="w w14"> </span>0<span class="w w15"> </span>0<span class="w w16"> </span>1.0<span class="w wc"> </span>9.3<span class="w w17"> </span>9.3<span class="w w6"> </span>1.20x</div><div class="l f2 s4 t0" style="bottom:451.662px;left:71.4192px;" data-x="71.4192" data-y="453.599" hs="1">string-validate-input<span class="w w27"> </span>6<span class="w w6"> </span>10<span class="w w13"> </span>13<span class="w w14"> </span>1<span class="w w15"> </span>0<span class="w w16"> </span>1.7<span class="w wc"> </span>1.3<span class="w w17"> </span>2.2<span class="w w6"> </span>1.86x</div><div class="l f1 s4 t0" style="bottom:427.286px;left:161.455px;" data-x="161.455" data-y="429.16" hs="1">Figure<span class="w w2"> </span>13.</div><div class="l f2 s4 t0" style="bottom:427.223px;left:204.628px;" data-x="204.628" data-y="429.16" hs="1">Detailed<span class="w w2"> </span>trace<span class="w w1"> </span>recording<span class="w w1"> </span>statistics<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>SunSpider<span class="w w2"> </span>benchmark<span class="w w1"> </span>set.</div><div class="l f2 s4 t0" style="bottom:397.386px;left:54px;" data-x="54" data-y="399.323" hs="1">mean).<span class="w w1"> </span>We<span class="w w2"> </span>exclude</div><div class="l f7 s4 t0" style="bottom:397.333px;left:126.612px;" data-x="126.612" data-y="399.323" hs="1">regexp-dna</div><div class="l f2 s4 t0" style="bottom:397.386px;left:176.513px;" data-x="176.513" data-y="399.323" hs="1">from<span class="w w1"> </span>the<span class="w w1"> </span>following<span class="w w1"> </span>calculations,</div><div class="l f2 s4 t0" style="bottom:387.424px;left:54px;" data-x="54" data-y="389.361" hs="1">because<span class="w w2"> </span>most<span class="w w1"> </span>of<span class="w w1"> </span>its<span class="w w2"> </span>time<span class="w w1"> </span>is<span class="w w2"> </span>spent<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>regular<span class="w w1"> </span>expression<span class="w w2"> </span>matcher,</div><div class="l f2 s4 t0" style="bottom:377.461px;left:54px;" data-x="54" data-y="379.398" hs="1">which<span class="w w0"> </span>has<span class="w w0"> </span>much<span class="w w0"> </span>different<span class="w w1"> </span>performance<span class="w w0"> </span>characteristics<span class="w w0"> </span>from<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:367.498px;left:54px;" data-x="54" data-y="369.435" hs="1">other<span class="w w1"> </span>programs.<span class="w w1"> </span>(Note<span class="w w0"> </span>that<span class="w w1"> </span>this<span class="w w1"> </span>only<span class="w w1"> </span>makes<span class="w w0"> </span>a<span class="w w1"> </span>difference<span class="w w1"> </span>of<span class="w w1"> </span>about</div><div class="l f2 s4 t0" style="bottom:357.536px;left:54px;" data-x="54" data-y="359.473" hs="1">10%<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>results.)<span class="w w1"> </span>Dividing<span class="w w1"> </span>the<span class="w w1"> </span>total<span class="w w1"> </span>execution<span class="w w2"> </span>time<span class="w w1"> </span>in<span class="w w1"> </span>processor</div><div class="l f2 s4 t0" style="bottom:347.573px;left:54px;" data-x="54" data-y="349.51" hs="1">clock<span class="w w0"> </span>cycles<span class="w w1"> </span>by<span class="w w0"> </span>the<span class="w w0"> </span>number<span class="w w0"> </span>of<span class="w w0"> </span>bytecodes<span class="w w1"> </span>executed<span class="w w0"> </span>in<span class="w w0"> </span>the<span class="w w0"> </span>base</div><div class="l f2 s4 t0" style="bottom:337.611px;left:54px;" data-x="54" data-y="339.547" hs="1">interpreter<span class="w w1"> </span>shows<span class="w w0"> </span>that<span class="w w1"> </span>on<span class="w w0"> </span>average,<span class="w w1"> </span>a<span class="w w0"> </span>bytecode<span class="w w0"> </span>executes<span class="w w1"> </span>in<span class="w w0"> </span>about</div><div class="l f2 s4 t0" style="bottom:327.648px;left:54px;" data-x="54" data-y="329.585" hs="1">35<span class="w w1"> </span>cycles.<span class="w w1"> </span>Native<span class="w w1"> </span>traces<span class="w w1"> </span>take<span class="w w0"> </span>about<span class="w w1"> </span>9<span class="w w1"> </span>cycles<span class="w w1"> </span>per<span class="w w1"> </span>bytecode,<span class="w w1"> </span>a<span class="w w0"> </span>3.9x</div><div class="l f2 s4 t0" style="bottom:317.685px;left:54px;" data-x="54" data-y="319.622" hs="1">speedup<span class="w w2"> </span>over<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.</div><div class="l f2 s4 t0" style="bottom:307.723px;left:65.9552px;" data-x="65.9552" data-y="309.659" hs="1">Using<span class="w w1"> </span>similar<span class="w w1"> </span>computations,<span class="w w1"> </span>we<span class="w w1"> </span>find<span class="w w1"> </span>that<span class="w w1"> </span>trace<span class="w w1"> </span>recording<span class="w w1"> </span>takes</div><div class="l f2 s4 t0" style="bottom:297.76px;left:54px;" data-x="54" data-y="299.697" hs="1">about<span class="w w1"> </span>3800<span class="w w1"> </span>cycles<span class="w w1"> </span>per<span class="w w1"> </span>bytecode,<span class="w w1"> </span>and<span class="w w1"> </span>compilation<span class="w w1"> </span>3150<span class="w w1"> </span>cycles<span class="w w1"> </span>per</div><div class="l f2 s4 t0" style="bottom:287.797px;left:54px;" data-x="54" data-y="289.734" hs="1">bytecode.<span class="w w1"> </span>Hence,<span class="w w1"> </span>during<span class="w w1"> </span>recording<span class="w w1"> </span>and<span class="w w1"> </span>compiling<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w1"> </span>runs<span class="w w1"> </span>at</div><div class="l f2 s4 t0" style="bottom:277.835px;left:54px;" data-x="54" data-y="279.772" hs="1">1/200<span class="w w1"> </span>the<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>interpreter.<span class="w w2"> </span>Because<span class="w w1"> </span>it<span class="w w1"> </span>costs<span class="w w1"> </span>6950<span class="w w1"> </span>cycles<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:267.872px;left:54px;" data-x="54" data-y="269.809" hs="1">compile<span class="w w1"> </span>a<span class="w w1"> </span>bytecode,<span class="w w1"> </span>and<span class="w w1"> </span>we<span class="w w1"> </span>save<span class="w w2"> </span>26<span class="w w1"> </span>cycles<span class="w w1"> </span>each<span class="w w1"> </span>time<span class="w w1"> </span>that<span class="w w1"> </span>code<span class="w w1"> </span>is</div><div class="l f2 s4 t0" style="bottom:257.909px;left:54px;" data-x="54" data-y="259.846" hs="1">run<span class="w w2"> </span>natively,<span class="w w2"> </span>we<span class="w w1"> </span>break<span class="w w1"> </span>even<span class="w w2"> </span>after<span class="w w1"> </span>running<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w2"> </span>270<span class="w w1"> </span>times.</div><div class="l f2 s4 t0" style="bottom:247.947px;left:65.9552px;" data-x="65.9552" data-y="249.884" hs="1">The<span class="w w1"> </span>other<span class="w w1"> </span>VMs<span class="w w1"> </span>we<span class="w w1"> </span>compared<span class="w w1"> </span>with<span class="w w1"> </span>achieve<span class="w w1"> </span>an<span class="w w1"> </span>overall<span class="w w1"> </span>speedup</div><div class="l f2 s4 t0" style="bottom:237.984px;left:54px;" data-x="54" data-y="239.921" hs="1">of<span class="w w1"> </span>3.0x<span class="w w0"> </span>relative<span class="w w1"> </span>to<span class="w w0"> </span>our<span class="w w1"> </span>baseline<span class="w w0"> </span>interpreter</div><div class="l f2 s4 t0" style="bottom:237.984px;left:210.284px;" data-x="210.284" data-y="239.921" hs="1">.<span class="w w1"> </span>Our<span class="w w0"> </span>estimated<span class="w w1"> </span>native</div><div class="l f2 s4 t0" style="bottom:228.022px;left:54px;" data-x="54" data-y="229.958" hs="1">code<span class="w w0"> </span>speedup<span class="w w0"> </span>of<span class="w w1"> </span>3.9x<span class="w w0"> </span>is<span class="w w0"> </span>significantly<span class="w w0"> </span>better.<span class="w w1"> </span>This<span class="w w0"> </span>suggests<span class="w w0"> </span>that</div><div class="l f2 s4 t0" style="bottom:218.059px;left:54px;" data-x="54" data-y="219.996" hs="1">our<span class="w w2"> </span>compilation<span class="w w1"> </span>techniques<span class="w w2"> </span>can<span class="w w1"> </span>generate<span class="w w1"> </span>more<span class="w w2"> </span>efficient<span class="w w2"> </span>native<span class="w w1"> </span>code</div><div class="l f2 s4 t0" style="bottom:208.096px;left:54px;" data-x="54" data-y="210.033" hs="1">than<span class="w w2"> </span>any<span class="w w1"> </span>other<span class="w w1"> </span>current<span class="w w2"> </span>JavaScript<span class="w w1"> </span>VM.</div><div class="l f2 s4 t0" style="bottom:198.134px;left:65.9552px;" data-x="65.9552" data-y="200.07" hs="1">These<span class="w w2"> </span>estimates<span class="w w2"> </span>also<span class="w w1"> </span>indicate<span class="w w2"> </span>that<span class="w w2"> </span>our<span class="w w1"> </span>startup<span class="w w2"> </span>performance<span class="w w2"> </span>could</div><div class="l f2 s4 t0" style="bottom:188.171px;left:54px;" data-x="54" data-y="190.108" hs="1">be<span class="w w1"> </span>substantially<span class="w w2"> </span>better<span class="w w1"> </span>if<span class="w w1"> </span>we<span class="w w1"> </span>improved<span class="w w2"> </span>the<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w2"> </span>trace<span class="w w1"> </span>recording</div><div class="l f2 s4 t0" style="bottom:178.208px;left:54px;" data-x="54" data-y="180.145" hs="1">and<span class="w w1"> </span>compilation.<span class="w w1"> </span>The<span class="w w2"> </span>estimated<span class="w w1"> </span>200x<span class="w w1"> </span>slowdown<span class="w w1"> </span>for<span class="w w1"> </span>recording<span class="w w1"> </span>and</div><div class="l f2 s4 t0" style="bottom:168.246px;left:54px;" data-x="54" data-y="170.182" hs="1">compilation<span class="w w2"> </span>is<span class="w w1"> </span>very<span class="w w2"> </span>rough,<span class="w w2"> </span>and<span class="w w1"> </span>may<span class="w w2"> </span>be<span class="w w1"> </span>influenced<span class="w w2"> </span>by<span class="w w2"> </span>startup<span class="w w1"> </span>factors</div><div class="l f2 s4 t0" style="bottom:158.283px;left:54px;" data-x="54" data-y="160.22" hs="1">in<span class="w w1"> </span>the<span class="w w2"> </span>interpreter<span class="w w1"> </span>(e.g.,<span class="w w1"> </span>caches<span class="w w1"> </span>that<span class="w w1"> </span>have<span class="w w1"> </span>not<span class="w w2"> </span>warmed<span class="w w1"> </span>up<span class="w w1"> </span>yet<span class="w w1"> </span>during</div><div class="l f2 s4 t0" style="bottom:148.32px;left:54px;" data-x="54" data-y="150.257" hs="1">recording).<span class="w w1"> </span>One<span class="w w0"> </span>observation<span class="w w1"> </span>supporting<span class="w w0"> </span>this<span class="w w1"> </span>conjecture<span class="w w1"> </span>is<span class="w w0"> </span>that<span class="w w1"> </span>in</div><div class="l f2 s4 t0" style="bottom:138.358px;left:54px;" data-x="54" data-y="140.294" hs="1">the<span class="w w2"> </span>tracer,<span class="w w1"> </span>interpreted<span class="w w2"> </span>bytecodes<span class="w w1"> </span>take<span class="w w1"> </span>about<span class="w w2"> </span>180<span class="w w1"> </span>cycles<span class="w w2"> </span>to<span class="w w1"> </span>run.<span class="w w1"> </span>Still,</div><div class="l f2 s4 t0" style="bottom:128.395px;left:54px;" data-x="54" data-y="130.332" hs="1">recording<span class="w w1"> </span>and<span class="w w2"> </span>compilation<span class="w w1"> </span>are<span class="w w1"> </span>clearly<span class="w w1"> </span>both<span class="w w1"> </span>expensive,<span class="w w2"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>better</div><div class="l f2 s4 t0" style="bottom:118.432px;left:54px;" data-x="54" data-y="120.369" hs="1">implementation,<span class="w w1"> </span>possibly<span class="w w0"> </span>including<span class="w w0"> </span>redesign<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>LIR<span class="w w0"> </span>abstract</div><div class="l f2 s4 t0" style="bottom:108.47px;left:54px;" data-x="54" data-y="110.407" hs="1">syntax<span class="w w2"> </span>or<span class="w w1"> </span>encoding,<span class="w w1"> </span>would<span class="w w2"> </span>improve<span class="w w1"> </span>startup<span class="w w2"> </span>performance.</div><div class="l f2 s4 t0" style="bottom:98.5072px;left:65.9552px;" data-x="65.9552" data-y="100.444" hs="1">Our<span class="w w1"> </span>performance<span class="w w1"> </span>results<span class="w w1"> </span>confirm<span class="w w1"> </span>that<span class="w w1"> </span>type<span class="w w1"> </span>specialization<span class="w w1"> </span>using</div><div class="l f2 s4 t0" style="bottom:88.5446px;left:54px;" data-x="54" data-y="90.4813" hs="1">trace<span class="w w0"> </span>trees<span class="w w0"> </span>substantially<span class="w w0"> </span>improves<span class="w w1"> </span>performance.<span class="w w0"> </span>We<span class="w w0"> </span>are<span class="w w0"> </span>able<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:78.582px;left:54px;" data-x="54" data-y="80.5187" hs="1">outperform<span class="w w1"> </span>the<span class="w w1"> </span>fastest<span class="w w1"> </span>available<span class="w w1"> </span>JavaScript<span class="w w1"> </span>compiler<span class="w w1"> </span>(V8)<span class="w w1"> </span>and<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:397.386px;left:317.014px;" data-x="317.014" data-y="399.323" hs="1">fastest<span class="w w1"> </span>available<span class="w w1"> </span>JavaScript<span class="w w2"> </span>inline<span class="w w1"> </span>threaded<span class="w w0"> </span>interpreter<span class="w w2"> </span>(SFX)<span class="w w1"> </span>on<span class="w w0"> </span>9</div><div class="l f2 s4 t0" style="bottom:387.424px;left:317.014px;" data-x="317.014" data-y="389.36" hs="1">of<span class="w w2"> </span>26<span class="w w1"> </span>benchmarks.</div><div class="l f1 s2 t0" style="bottom:349.092px;left:317.014px;" data-x="317.014" data-y="351.382" hs="1">8.<span class="w w3"> </span>Related<span class="w w1"> </span>Work</div><div class="l f1 s4 t0" style="bottom:335.561px;left:317.014px;" data-x="317.014" data-y="337.435" hs="1">Trace<span class="w w2"> </span>optimization<span class="w w0"> </span>for<span class="w w2"> </span>dynamic<span class="w w0"> </span>languages.</div><div class="l f2 s4 t0" style="bottom:335.498px;left:486.339px;" data-x="486.339" data-y="337.435" hs="1">The<span class="w w1"> </span>closest<span class="w w1"> </span>area<span class="w w1"> </span>of</div><div class="l f2 s4 t0" style="bottom:325.535px;left:317.014px;" data-x="317.014" data-y="327.472" hs="1">related<span class="w w1"> </span>work<span class="w w0"> </span>is<span class="w w1"> </span>on<span class="w w1"> </span>applying<span class="w w0"> </span>trace<span class="w w1"> </span>optimization<span class="w w1"> </span>to<span class="w w0"> </span>type-specialize</div><div class="l f2 s4 t0" style="bottom:315.573px;left:317.014px;" data-x="317.014" data-y="317.509" hs="1">dynamic<span class="w w1"> </span>languages.<span class="w w0"> </span>Existing<span class="w w1"> </span>work<span class="w w0"> </span>shares<span class="w w1"> </span>the<span class="w w0"> </span>idea<span class="w w1"> </span>of<span class="w w0"> </span>generating</div><div class="l f2 s4 t0" style="bottom:305.61px;left:317.014px;" data-x="317.014" data-y="307.547" hs="1">type-specialized<span class="w w1"> </span>code<span class="w w0"> </span>speculatively<span class="w w2"> </span>with<span class="w w0"> </span>guards<span class="w w1"> </span>along<span class="w w1"> </span>interpreter</div><div class="l f2 s4 t0" style="bottom:295.647px;left:317.014px;" data-x="317.014" data-y="297.584" hs="1">traces.</div><div class="l f2 s4 t0" style="bottom:285.685px;left:328.969px;" data-x="328.969" data-y="287.621" hs="1">To<span class="w w1"> </span>our<span class="w w0"> </span>knowledge,<span class="w w0"> </span>Rigo’s<span class="w w1"> </span>Psyco<span class="w w0"> </span>(16)<span class="w w0"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>only<span class="w w0"> </span>published</div><div class="l f2 s4 t0" style="bottom:275.722px;left:317.014px;" data-x="317.014" data-y="277.659" hs="1">type-specializing<span class="w w1"> </span>trace<span class="w w2"> </span>compiler<span class="w w1"> </span>for<span class="w w1"> </span>a<span class="w w1"> </span>dynamic<span class="w w1"> </span>language<span class="w w2"> </span>(Python).</div><div class="l f2 s4 t0" style="bottom:265.759px;left:317.014px;" data-x="317.014" data-y="267.696" hs="1">Psyco<span class="w w2"> </span>does<span class="w w2"> </span>not<span class="w w1"> </span>attempt<span class="w w2"> </span>to<span class="w w1"> </span>identify<span class="w w2"> </span>hot<span class="w w2"> </span>loops<span class="w w1"> </span>or<span class="w w2"> </span>inline<span class="w w2"> </span>function<span class="w w1"> </span>calls.</div><div class="l f2 s4 t0" style="bottom:255.797px;left:317.014px;" data-x="317.014" data-y="257.733" hs="1">Instead,<span class="w w2"> </span>Psyco<span class="w w1"> </span>transforms<span class="w w2"> </span>loops<span class="w w2"> </span>to<span class="w w1"> </span>mutual<span class="w w2"> </span>recursion<span class="w w1"> </span>before<span class="w w2"> </span>running</div><div class="l f2 s4 t0" style="bottom:245.834px;left:317.014px;" data-x="317.014" data-y="247.771" hs="1">and<span class="w w2"> </span>traces<span class="w w1"> </span>all<span class="w w1"> </span>operations.</div><div class="l f2 s4 t0" style="bottom:235.871px;left:328.969px;" data-x="328.969" data-y="237.808" hs="1">Pall’s<span class="w w2"> </span>LuaJIT<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>Lua<span class="w w1"> </span>VM<span class="w w2"> </span>in<span class="w w1"> </span>development<span class="w w1"> </span>that<span class="w w2"> </span>uses<span class="w w1"> </span>trace<span class="w w1"> </span>com-</div><div class="l f2 s4 t0" style="bottom:225.909px;left:317.014px;" data-x="317.014" data-y="227.846" hs="1">pilation<span class="w w2"> </span>ideas.<span class="w w1"> </span>(1).<span class="w w2"> </span>There<span class="w w1"> </span>are<span class="w w2"> </span>no<span class="w w1"> </span>publications<span class="w w2"> </span>on<span class="w w1"> </span>LuaJIT<span class="w w2"> </span>but<span class="w w1"> </span>the<span class="w w2"> </span>cre-</div><div class="l f2 s4 t0" style="bottom:215.946px;left:317.014px;" data-x="317.014" data-y="217.883" hs="1">ator<span class="w w2"> </span>has<span class="w w1"> </span>told<span class="w w1"> </span>us<span class="w w1"> </span>that<span class="w w2"> </span>LuaJIT<span class="w w1"> </span>has<span class="w w1"> </span>a<span class="w w2"> </span>similar<span class="w w1"> </span>design<span class="w w1"> </span>to<span class="w w2"> </span>our<span class="w w1"> </span>system,<span class="w w1"> </span>but</div><div class="l f2 s4 t0" style="bottom:205.984px;left:317.014px;" data-x="317.014" data-y="207.92" hs="1">will<span class="w w1"> </span>use<span class="w w1"> </span>a<span class="w w1"> </span>less<span class="w w0"> </span>aggressiv</div><div class="l f2 s4 t0" style="bottom:205.984px;left:405.862px;" data-x="405.862" data-y="207.92" hs="1">e<span class="w w1"> </span>type<span class="w w1"> </span>speculation<span class="w w1"> </span>(e.g.,<span class="w w0"> </span>using<span class="w w2"> </span>a<span class="w w0"> </span>floating-</div><div class="l f2 s4 t0" style="bottom:196.021px;left:317.014px;" data-x="317.014" data-y="197.958" hs="1">point<span class="w w1"> </span>representation<span class="w w1"> </span>for<span class="w w1"> </span>all<span class="w w1"> </span>number<span class="w w1"> </span>values)<span class="w w1"> </span>and<span class="w w1"> </span>does<span class="w w0"> </span>not<span class="w w2"> </span>generate</div><div class="l f2 s4 t0" style="bottom:186.058px;left:317.014px;" data-x="317.014" data-y="187.995" hs="1">nested<span class="w w2"> </span>traces<span class="w w1"> </span>for<span class="w w1"> </span>nested<span class="w w2"> </span>loops.</div><div class="l f1 s4 t0" style="bottom:176.158px;left:328.969px;" data-x="328.969" data-y="178.032" hs="1">General<span class="w w0"> </span>trace<span class="w w1"> </span>optimization.</div><div class="l f2 s4 t0" style="bottom:176.096px;left:441.427px;" data-x="441.427" data-y="178.032" hs="1">General<span class="w w0"> </span>trace<span class="w w1"> </span>optimization<span class="w w0"> </span>has</div><div class="l f2 s4 t0" style="bottom:166.133px;left:317.014px;" data-x="317.014" data-y="168.07" hs="1">a<span class="w w0"> </span>longer<span class="w w0"> </span>history<span class="w w1"> </span>that<span class="w w0"> </span>has<span class="w w0"> </span>treated<span class="w w0"> </span>mostly<span class="w w0"> </span>native<span class="w w1"> </span>code<span class="w w0"> </span>and<span class="w w0"> </span>typed</div><div class="l f2 s4 t0" style="bottom:156.17px;left:317.014px;" data-x="317.014" data-y="158.107" hs="1">languages<span class="w w2"> </span>like<span class="w w1"> </span>Java.<span class="w w2"> </span>Thus,<span class="w w1"> </span>these<span class="w w1"> </span>systems<span class="w w2"> </span>have<span class="w w1"> </span>focused<span class="w w2"> </span>less<span class="w w1"> </span>on<span class="w w1"> </span>type</div><div class="l f2 s4 t0" style="bottom:146.208px;left:317.014px;" data-x="317.014" data-y="148.144" hs="1">specialization<span class="w w2"> </span>and<span class="w w1"> </span>more<span class="w w1"> </span>on<span class="w w2"> </span>other<span class="w w1"> </span>optimizations.</div><div class="l f2 s4 t0" style="bottom:136.245px;left:328.969px;" data-x="328.969" data-y="138.182" hs="1">Dynamo<span class="w w1"> </span>(7)<span class="w w1"> </span>by<span class="w w1"> </span>Bala<span class="w w1"> </span>et<span class="w w1"> </span>al,<span class="w w0"> </span>introduced<span class="w w2"> </span>native<span class="w w1"> </span>code<span class="w w1"> </span>tracing<span class="w w1"> </span>as<span class="w w0"> </span>a</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">replacement<span class="w w1"> </span>for<span class="w w1"> </span>profile-guided<span class="w w1"> </span>optimization<span class="w w1"> </span>(PGO).<span class="w w1"> </span>A<span class="w w1"> </span>major<span class="w w1"> </span>goal</div><div class="l f2 s4 t0" style="bottom:116.32px;left:317.014px;" data-x="317.014" data-y="118.256" hs="1">was<span class="w w0"> </span>to<span class="w w1"> </span>perform<span class="w w0"> </span>PGO<span class="w w0"> </span>online<span class="w w0"> </span>so<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>profile<span class="w w0"> </span>was<span class="w w0"> </span>specific<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">the<span class="w w1"> </span>current<span class="w w2"> </span>execution.<span class="w w1"> </span>Dynamo<span class="w w1"> </span>used<span class="w w2"> </span>loop<span class="w w1"> </span>headers<span class="w w1"> </span>as<span class="w w1"> </span>candidate<span class="w w1"> </span>hot</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:317.014px;" data-x="317.014" data-y="98.3312" hs="1">traces,<span class="w w2"> </span>but<span class="w w1"> </span>did<span class="w w1"> </span>not<span class="w w2"> </span>try<span class="w w1"> </span>to<span class="w w2"> </span>create<span class="w w1"> </span>loop<span class="w w1"> </span>traces<span class="w w2"> </span>specifically.</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:328.969px;" data-x="328.969" data-y="88.3686" hs="1">Trace<span class="w w1"> </span>trees<span class="w w1"> </span>were<span class="w w0"> </span>originally<span class="w w1"> </span>proposed<span class="w w1"> </span>by<span class="w w1"> </span>Gal<span class="w w0"> </span>et<span class="w w1"> </span>al.<span class="w w1"> </span>(11)<span class="w w1"> </span>in<span class="w w0"> </span>the</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">context<span class="w w1"> </span>of<span class="w w1"> </span>Java,<span class="w w1"> </span>a<span class="w w0"> </span>statically<span class="w w1"> </span>typed<span class="w w1"> </span>language.<span class="w w1"> </span>Their<span class="w w0"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>ac-</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">tually<span class="w w1"> </span>inlined<span class="w w1"> </span>parts<span class="w w1"> </span>of<span class="w w1"> </span>outer<span class="w w1"> </span>loops<span class="w w1"> </span>within<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loops<span class="w w1"> </span>(because</div></div></div><div id="page-13" class="p" style="width:612px;height:792px;background-image:url(p13.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"></div><div class="t t8f"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="115.399" data-y="532.339" hs="1">!&quot;#</div></div><div class="t t90"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="148.039" data-y="532.339" hs="1">$!&quot;#</div></div><div class="t t91"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="182.073" data-y="532.339" hs="1">%!&quot;#</div></div><div class="t t92"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="216.107" data-y="532.339" hs="1">&amp;!&quot;#</div></div><div class="t t93"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="250.141" data-y="532.339" hs="1">&apos;!&quot;#</div></div><div class="t t94"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="282.781" data-y="532.339" hs="1">(!!&quot;#</div></div><div class="t t95"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:28.566px;" data-x="88.3613" data-y="544.453" hs="1">)*+,-./#0$1$23#</div></div><div class="t t96"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:25.5484px;" data-x="85.0419" data-y="551" hs="1">)*+45678#0$1923#</div></div><div class="t t97"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:23.2164px;" data-x="82.4767" data-y="557.546" hs="1">)*+6:;&lt;6:,/#0(1$23#</div></div><div class="t t98"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:10.5367px;" data-x="68.529" data-y="564.093" hs="1">:,,/==+.&gt;?:6;+&lt;6//=#0!1923#</div></div><div class="t t99"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:15.2731px;" data-x="73.739" data-y="570.639" hs="1">:,,/==+@:??A-,8#0$1$23#</div></div><div class="t t9a"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:19.9371px;" data-x="78.8694" data-y="577.185" hs="1">:,,/==+?.5*;#0%1$23#</div></div><div class="t t9b"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:19.8492px;" data-x="78.7728" data-y="583.732" hs="1">:,,/==+?=&gt;/B/#0)1!23#</div></div><div class="t t9c"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:2.3961px;" data-x="59.5743" data-y="590.278" hs="1">.&gt;&lt;57=+).&gt;&lt;+.&gt;&lt;=+&gt;?+.;&lt;/#0$C1C23#</div></div><div class="t t9d"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:11.9117px;" data-x="70.0145" data-y="596.824" hs="1">.&gt;&lt;57=+.&gt;&lt;=+&gt;?+.;&lt;/#0&apos;1D23#</div></div><div class="t t9e"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:9.44102px;" data-x="67.3237" data-y="603.371" hs="1">.&gt;&lt;57=+.&gt;&lt;E&gt;=/+:?*#0$C1$23#</div></div><div class="t t9f"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:13.0426px;" data-x="71.2855" data-y="609.917" hs="1">.&gt;&lt;57=+?=&gt;/B/+.&gt;&lt;=#0$1D23#</div></div><div class="t ta0"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:7.37267px;" data-x="65.0486" data-y="616.463" hs="1">,5?&lt;65FG5E+6/,-6=&gt;B/#0(1!23#</div></div><div class="t ta1"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:24.6988px;" data-x="84.1074" data-y="623.01" hs="1">,6;7&lt;5+:/=#0(1&amp;23#</div></div><div class="t ta2"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:22.8453px;" data-x="82.0685" data-y="629.556" hs="1">,6;7&lt;5+4*C#0$1)23#</div></div><div class="t ta3"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:22.5602px;" data-x="81.7548" data-y="636.102" hs="1">,6;7&lt;5+=8:(#0C1923#</div></div><div class="t ta4"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:13.3277px;" data-x="71.5991" data-y="642.649" hs="1">*:&lt;/+@564:&lt;+&lt;5H/#0(1(23#</div></div><div class="t ta5"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:12.0191px;" data-x="70.1597" data-y="649.195" hs="1">*:&lt;/+@564:&lt;+27:6.#0(1!23#</div></div><div class="t ta6"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:22.2457px;" data-x="81.4089" data-y="655.741" hs="1">4:&lt;8+,56*&gt;,#0%1923#</div></div><div class="t ta7"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:11.9391px;" data-x="70.0716" data-y="662.288" hs="1">4:&lt;8+7:6I:F+=-4=#0C1923#</div></div><div class="t ta8"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:9.2047px;" data-x="67.0638" data-y="668.834" hs="1">4:&lt;8+=7/,&lt;6:F+?564#0D1(23#</div></div><div class="t ta9"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:23.5152px;" data-x="82.8054" data-y="675.381" hs="1">6/J/27+*?:#0%1$23#</div></div><div class="t taa"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:19.7965px;" data-x="78.7148" data-y="681.927" hs="1">=&lt;6&gt;?J+.:=/&amp;%#0$1C23#</div></div><div class="t tab"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:23.6735px;" data-x="82.9794" data-y="688.473" hs="1">=&lt;6&gt;?J+@:=&lt;:#0(1C23#</div></div><div class="t tac"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:17.4352px;" data-x="76.1173" data-y="695.02" hs="1">=&lt;6&gt;?J+&lt;:J,F5-*#0(1(23#</div></div><div class="t tad"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:10.7594px;" data-x="68.7739" data-y="701.566" hs="1">=&lt;6&gt;?J+-?7:,A+,5*/#0(1$23#</div></div><div class="t tae"><div class="l f18 s7 t6a" style="bottom:-8.269px;left:8.90391px;" data-x="66.7102" data-y="708.112" hs="1">=&lt;6&gt;?J+B:F&gt;*:&lt;/+&gt;?7-&lt;#0(1923#</div></div><div class="t taf"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="88.6002" data-y="516.526" hs="1">K?&lt;/676/&lt;#</div></div><div class="t tb0"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="122.244" data-y="516.526" hs="1">L5?&gt;&lt;56#</div></div><div class="t tb1"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="154.642" data-y="516.526" hs="1">M/,56*#</div></div><div class="t tb2"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="183.879" data-y="516.526" hs="1">N547&gt;F/#</div></div><div class="t tb3"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="215.955" data-y="516.526" hs="1">N:FF#O6:,/#</div></div><div class="t tb4"><div class="l f18 s7 t5e" style="bottom:-10.269px;left:0px;" data-x="250.829" data-y="516.526" hs="1">M-?#O6:,/#</div></div><div class="t t0"><div class="l f1 s4 t0" style="bottom:482.435px;left:54px;" data-x="54" data-y="484.309" hs="1">Figure<span class="w w2"> </span>12.<span class="w w0"> </span>Fraction<span class="w w1"> </span>of<span class="w w1"> </span>time<span class="w w1"> </span>spent<span class="w w1"> </span>on<span class="w w1"> </span>major<span class="w w1"> </span>VM<span class="w w2"> </span>activities.</div><div class="l f2 s4 t0" style="bottom:482.372px;left:279.161px;" data-x="279.161" data-y="484.309" hs="1">The</div><div class="l f2 s4 t0" style="bottom:472.409px;left:54px;" data-x="54" data-y="474.346" hs="1">speedup<span class="w w1"> </span>vs.<span class="w w1"> </span>interpreter<span class="w w0"> </span>is<span class="w w2"> </span>shown<span class="w w0"> </span>in<span class="w w1"> </span>parentheses<span class="w w1"> </span>next<span class="w w1"> </span>to<span class="w w1"> </span>each<span class="w w1"> </span>test.</div><div class="l f2 s4 t0" style="bottom:462.447px;left:54px;" data-x="54" data-y="464.384" hs="1">Most<span class="w w1"> </span>programs<span class="w w2"> </span>where<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w1"> </span>spends<span class="w w2"> </span>the<span class="w w1"> </span>majority<span class="w w1"> </span>of<span class="w w1"> </span>its<span class="w w1"> </span>time<span class="w w2"> </span>run-</div><div class="l f2 s4 t0" style="bottom:452.484px;left:54px;" data-x="54" data-y="454.421" hs="1">ning<span class="w w2"> </span>native<span class="w w1"> </span>code<span class="w w1"> </span>have<span class="w w2"> </span>a<span class="w w1"> </span>good<span class="w w1"> </span>speedup.<span class="w w2"> </span>Recording<span class="w w1"> </span>and<span class="w w1"> </span>compilation</div><div class="l f2 s4 t0" style="bottom:442.521px;left:54px;" data-x="54" data-y="444.458" hs="1">costs<span class="w w1"> </span>can<span class="w w2"> </span>be<span class="w w1"> </span>substantial;<span class="w w1"> </span>speeding<span class="w w1"> </span>up<span class="w w1"> </span>those<span class="w w2"> </span>parts<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>implemen-</div><div class="l f2 s4 t0" style="bottom:432.559px;left:54px;" data-x="54" data-y="434.496" hs="1">tation<span class="w w2"> </span>would<span class="w w1"> </span>improve<span class="w w2"> </span>SunSpider<span class="w w1"> </span>performance.</div><div class="l f2 s4 t0" style="bottom:385.311px;left:54px;" data-x="54" data-y="387.248" hs="1">inner<span class="w w2"> </span>loops<span class="w w1"> </span>become<span class="w w1"> </span>hot<span class="w w1"> </span>first),<span class="w w2"> </span>leading<span class="w w1"> </span>to<span class="w w1"> </span>much<span class="w w1"> </span>greater<span class="w w2"> </span>tail<span class="w w1"> </span>duplica-</div><div class="l f2 s4 t0" style="bottom:375.348px;left:54px;" data-x="54" data-y="377.285" hs="1">tion.</div><div class="l f2 s4 t0" style="bottom:365.386px;left:65.9552px;" data-x="65.9552" data-y="367.323" hs="1">YETI,<span class="w w1"> </span>from<span class="w w0"> </span>Zaleski<span class="w w1"> </span>et<span class="w w0"> </span>al.<span class="w w1"> </span>(19)<span class="w w0"> </span>applied<span class="w w1"> </span>Dynamo-style<span class="w w0"> </span>tracing</div><div class="l f2 s4 t0" style="bottom:355.423px;left:54px;" data-x="54" data-y="357.36" hs="1">to<span class="w w0"> </span>Java<span class="w w1"> </span>in<span class="w w0"> </span>order<span class="w w0"> </span>to<span class="w w0"> </span>achieve<span class="w w1"> </span>inlining,<span class="w w0"> </span>indirect<span class="w w0"> </span>jump<span class="w w0"> </span>elimination,</div><div class="l f2 s4 t0" style="bottom:345.46px;left:54px;" data-x="54" data-y="347.397" hs="1">and<span class="w w1"> </span>other<span class="w w1"> </span>optimizations.<span class="w w2"> </span>Their<span class="w w1"> </span>primary<span class="w w1"> </span>focus<span class="w w1"> </span>was<span class="w w1"> </span>on<span class="w w1"> </span>designing<span class="w w1"> </span>an</div><div class="l f2 s4 t0" style="bottom:335.498px;left:54px;" data-x="54" data-y="337.435" hs="1">interpreter<span class="w w2"> </span>that<span class="w w1"> </span>could<span class="w w2"> </span>easily<span class="w w1"> </span>be<span class="w w1"> </span>gradually<span class="w w2"> </span>re-engineered<span class="w w1"> </span>as<span class="w w2"> </span>a<span class="w w1"> </span>tracing</div><div class="l f2 s4 t0" style="bottom:325.535px;left:54px;" data-x="54" data-y="327.472" hs="1">VM.</div><div class="l f2 s4 t0" style="bottom:315.573px;left:65.9552px;" data-x="65.9552" data-y="317.509" hs="1">Suganuma<span class="w w2"> </span>et<span class="w w2"> </span>al.<span class="w w2"> </span>(18)<span class="w w1"> </span>described<span class="w w2"> </span>region-based<span class="w w2"> </span>compilation<span class="w w2"> </span>(RBC),</div><div class="l f2 s4 t0" style="bottom:305.61px;left:54px;" data-x="54" data-y="307.547" hs="1">a<span class="w w1"> </span>relative<span class="w w1"> </span>of<span class="w w1"> </span>tracing.<span class="w w1"> </span>A<span class="w w1"> </span>region<span class="w w1"> </span>is<span class="w w1"> </span>an<span class="w w1"> </span>subprogram<span class="w w1"> </span>worth<span class="w w1"> </span>optimizing</div><div class="l f2 s4 t0" style="bottom:295.647px;left:54px;" data-x="54" data-y="297.584" hs="1">that<span class="w w2"> </span>can<span class="w w1"> </span>include<span class="w w2"> </span>subsets<span class="w w1"> </span>of<span class="w w1"> </span>any<span class="w w2"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>methods.<span class="w w1"> </span>Thus,<span class="w w2"> </span>the<span class="w w1"> </span>com-</div><div class="l f2 s4 t0" style="bottom:285.685px;left:54px;" data-x="54" data-y="287.621" hs="1">piler<span class="w w1"> </span>has<span class="w w1"> </span>more<span class="w w1"> </span>flexibility<span class="w w2"> </span>and<span class="w w1"> </span>can<span class="w w1"> </span>potentially<span class="w w1"> </span>generate<span class="w w1"> </span>better<span class="w w1"> </span>code,</div><div class="l f2 s4 t0" style="bottom:275.722px;left:54px;" data-x="54" data-y="277.659" hs="1">but<span class="w w2"> </span>the<span class="w w2"> </span>profiling<span class="w w2"> </span>and<span class="w w1"> </span>compilation<span class="w w2"> </span>systems<span class="w w2"> </span>are<span class="w w1"> </span>correspondingly<span class="w w2"> </span>more</div><div class="l f2 s4 t0" style="bottom:265.759px;left:54px;" data-x="54" data-y="267.696" hs="1">complex.</div><div class="l f1 s4 t0" style="bottom:255.86px;left:65.9552px;" data-x="65.9552" data-y="257.734" hs="1">Type<span class="w w1"> </span>specialization<span class="w w0"> </span>for<span class="w w0"> </span>dynamic<span class="w w0"> </span>languages.</div><div class="l f2 s4 t0" style="bottom:255.797px;left:242.032px;" data-x="242.032" data-y="257.734" hs="1">Dynamic<span class="w w0"> </span>lan-</div><div class="l f2 s4 t0" style="bottom:245.834px;left:54px;" data-x="54" data-y="247.771" hs="1">guage<span class="w w1"> </span>implementors<span class="w w1"> </span>have<span class="w w1"> </span>long<span class="w w1"> </span>recognized<span class="w w1"> </span>the<span class="w w1"> </span>importance<span class="w w1"> </span>of<span class="w w1"> </span>type</div><div class="l f2 s4 t0" style="bottom:235.871px;left:54px;" data-x="54" data-y="237.808" hs="1">specialization<span class="w w2"> </span>for<span class="w w1"> </span>performance.<span class="w w2"> </span>Most<span class="w w2"> </span>previous<span class="w w1"> </span>work<span class="w w2"> </span>has<span class="w w2"> </span>focused<span class="w w1"> </span>on</div><div class="l f2 s4 t0" style="bottom:225.909px;left:54px;" data-x="54" data-y="227.846" hs="1">methods<span class="w w2"> </span>instead<span class="w w1"> </span>of<span class="w w1"> </span>traces.</div><div class="l f2 s4 t0" style="bottom:215.946px;left:65.9552px;" data-x="65.9552" data-y="217.883" hs="1">Chambers<span class="w w1"> </span>et.<span class="w w0"> </span>al<span class="w w1"> </span>(9)<span class="w w1"> </span>pioneered<span class="w w0"> </span>the<span class="w w1"> </span>idea<span class="w w1"> </span>of<span class="w w0"> </span>compiling<span class="w w1"> </span>multiple</div><div class="l f2 s4 t0" style="bottom:205.984px;left:54px;" data-x="54" data-y="207.92" hs="1">versions<span class="w w1"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>procedure<span class="w w1"> </span>specialized<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>input<span class="w w1"> </span>types<span class="w w0"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>lan-</div><div class="l f2 s4 t0" style="bottom:196.021px;left:54px;" data-x="54" data-y="197.958" hs="1">guage<span class="w w1"> </span>Self.<span class="w w0"> </span>In<span class="w w1"> </span>one<span class="w w0"> </span>implementation,<span class="w w1"> </span>they<span class="w w0"> </span>generated<span class="w w1"> </span>a<span class="w w1"> </span>specialized</div><div class="l f2 s4 t0" style="bottom:186.058px;left:54px;" data-x="54" data-y="187.995" hs="1">method<span class="w w2"> </span>online<span class="w w1"> </span>each<span class="w w2"> </span>time<span class="w w2"> </span>a<span class="w w1"> </span>method<span class="w w2"> </span>was<span class="w w2"> </span>called<span class="w w1"> </span>with<span class="w w2"> </span>new<span class="w w2"> </span>input<span class="w w1"> </span>types.</div><div class="l f2 s4 t0" style="bottom:176.096px;left:54px;" data-x="54" data-y="178.032" hs="1">In<span class="w w1"> </span>another,<span class="w w1"> </span>they<span class="w w0"> </span>used<span class="w w1"> </span>an<span class="w w1"> </span>offline<span class="w w1"> </span>whole-program<span class="w w0"> </span>static<span class="w w1"> </span>analysis<span class="w w1"> </span>to</div><div class="l f2 s4 t0" style="bottom:166.133px;left:54px;" data-x="54" data-y="168.07" hs="1">infer<span class="w w1"> </span>input<span class="w w1"> </span>types<span class="w w1"> </span>and<span class="w w1"> </span>constant<span class="w w1"> </span>receiver<span class="w w2"> </span>types<span class="w w1"> </span>at<span class="w w1"> </span>call<span class="w w1"> </span>sites.<span class="w w1"> </span>Interest-</div><div class="l f2 s4 t0" style="bottom:156.17px;left:54px;" data-x="54" data-y="158.107" hs="1">ingly,<span class="w w2"> </span>the<span class="w w1"> </span>two<span class="w w2"> </span>techniques<span class="w w1"> </span>produced<span class="w w2"> </span>nearly<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w2"> </span>performance.</div><div class="l f2 s4 t0" style="bottom:146.208px;left:65.9552px;" data-x="65.9552" data-y="148.144" hs="1">Salib<span class="w w2"> </span>(17)<span class="w w1"> </span>designed<span class="w w2"> </span>a<span class="w w1"> </span>type<span class="w w2"> </span>inference<span class="w w2"> </span>algorithm<span class="w w1"> </span>for<span class="w w2"> </span>Python<span class="w w1"> </span>based</div><div class="l f2 s4 t0" style="bottom:136.245px;left:54px;" data-x="54" data-y="138.182" hs="1">on<span class="w w2"> </span>the<span class="w w1"> </span>Cartesian<span class="w w2"> </span>Product<span class="w w1"> </span>Algorithm<span class="w w1"> </span>and<span class="w w2"> </span>used<span class="w w1"> </span>the<span class="w w2"> </span>results<span class="w w1"> </span>to<span class="w w2"> </span>special-</div><div class="l f2 s4 t0" style="bottom:126.282px;left:54px;" data-x="54" data-y="128.219" hs="1">ize<span class="w w2"> </span>on<span class="w w1"> </span>types<span class="w w1"> </span>and<span class="w w2"> </span>translate<span class="w w1"> </span>the<span class="w w1"> </span>program<span class="w w2"> </span>to<span class="w w1"> </span>C++.</div><div class="l f2 s4 t0" style="bottom:116.32px;left:65.9552px;" data-x="65.9552" data-y="118.256" hs="1">McCloskey<span class="w w1"> </span>(14)<span class="w w0"> </span>has<span class="w w0"> </span>work<span class="w w1"> </span>in<span class="w w0"> </span>progress<span class="w w0"> </span>based<span class="w w1"> </span>on<span class="w w0"> </span>a<span class="w w0"> </span>language-</div><div class="l f2 s4 t0" style="bottom:106.357px;left:54px;" data-x="54" data-y="108.294" hs="1">independent<span class="w w0"> </span>type<span class="w w0"> </span>inference<span class="w w0"> </span>that<span class="w w1"> </span>is<span class="w w0"> </span>used<span class="w w0"> </span>to<span class="w w0"> </span>generate<span class="w w0"> </span>efficient<span class="w w0"> </span>C</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:54px;" data-x="54" data-y="98.3312" hs="1">implementations<span class="w w2"> </span>of<span class="w w1"> </span>JavaScript<span class="w w2"> </span>and<span class="w w1"> </span>Python<span class="w w1"> </span>programs.</div><div class="l f1 s4 t0" style="bottom:86.4946px;left:65.9552px;" data-x="65.9552" data-y="88.3686" hs="1">Native<span class="w w2"> </span>code<span class="w w1"> </span>generation<span class="w w1"> </span>by<span class="w w1"> </span>interpreters.</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:218.246px;" data-x="218.246" data-y="88.3686" hs="1">The<span class="w w1"> </span>traditional<span class="w w2"> </span>inter-</div><div class="l f2 s4 t0" style="bottom:76.4692px;left:54px;" data-x="54" data-y="78.4059" hs="1">preter<span class="w w1"> </span>design<span class="w w1"> </span>is<span class="w w0"> </span>a<span class="w w1"> </span>virtual<span class="w w1"> </span>machine<span class="w w1"> </span>that<span class="w w0"> </span>directly<span class="w w1"> </span>executes<span class="w w1"> </span>ASTs<span class="w w1"> </span>or</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:54px;" data-x="54" data-y="68.4433" hs="1">machine-code-like<span class="w w2"> </span>bytecodes.<span class="w w2"> </span>Researchers<span class="w w1"> </span>have<span class="w w2"> </span>shown<span class="w w2"> </span>how<span class="w w2"> </span>to<span class="w w1"> </span>gen-</div><div class="l f2 s4 t0" style="bottom:710.093px;left:317.014px;" data-x="317.014" data-y="712.03" hs="1">erate<span class="w w1"> </span>native<span class="w w1"> </span>code<span class="w w1"> </span>with<span class="w w1"> </span>nearly<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>structure<span class="w w1"> </span>but<span class="w w1"> </span>better<span class="w w1"> </span>perfor-</div><div class="l f2 s4 t0" style="bottom:700.13px;left:317.014px;" data-x="317.014" data-y="702.067" hs="1">mance.</div><div class="l f2 s4 t0" style="bottom:690.168px;left:328.969px;" data-x="328.969" data-y="692.105" hs="1">Call<span class="w w1"> </span>threading,<span class="w w1"> </span>also<span class="w w0"> </span>known<span class="w w2"> </span>as<span class="w w0"> </span>context<span class="w w1"> </span>threading<span class="w w1"> </span>(8),<span class="w w1"> </span>compiles</div><div class="l f2 s4 t0" style="bottom:680.205px;left:317.014px;" data-x="317.014" data-y="682.142" hs="1">methods<span class="w w1"> </span>by<span class="w w0"> </span>generating<span class="w w1"> </span>a<span class="w w0"> </span>native<span class="w w1"> </span>call<span class="w w0"> </span>instruction<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w1"> </span>interpreter</div><div class="l f2 s4 t0" style="bottom:670.243px;left:317.014px;" data-x="317.014" data-y="672.179" hs="1">method<span class="w w1"> </span>for<span class="w w1"> </span>each<span class="w w1"> </span>interpreter<span class="w w1"> </span>bytecode.<span class="w w0"> </span>A<span class="w w2"> </span>call-return<span class="w w0"> </span>pair<span class="w w1"> </span>has<span class="w w1"> </span>been</div><div class="l f2 s4 t0" style="bottom:660.28px;left:317.014px;" data-x="317.014" data-y="662.217" hs="1">shown<span class="w w2"> </span>to<span class="w w1"> </span>be<span class="w w2"> </span>a<span class="w w1"> </span>potentially<span class="w w1"> </span>much<span class="w w2"> </span>more<span class="w w1"> </span>efficient<span class="w w2"> </span>dispatch<span class="w w1"> </span>mechanism</div><div class="l f2 s4 t0" style="bottom:650.317px;left:317.014px;" data-x="317.014" data-y="652.254" hs="1">than<span class="w w2"> </span>the<span class="w w1"> </span>indirect<span class="w w1"> </span>jumps<span class="w w2"> </span>used<span class="w w1"> </span>in<span class="w w1"> </span>standard<span class="w w2"> </span>bytecode<span class="w w1"> </span>interpreters.</div><div class="l f2 s4 t0" style="bottom:640.355px;left:328.969px;" data-x="328.969" data-y="642.291" hs="1">Inline<span class="w w1"> </span>threading<span class="w w1"> </span>(15)<span class="w w0"> </span>copies<span class="w w1"> </span>chunks<span class="w w1"> </span>of<span class="w w0"> </span>interpreter<span class="w w1"> </span>native<span class="w w1"> </span>code</div><div class="l f2 s4 t0" style="bottom:630.392px;left:317.014px;" data-x="317.014" data-y="632.329" hs="1">which<span class="w w1"> </span>implement<span class="w w1"> </span>the<span class="w w2"> </span>required<span class="w w1"> </span>bytecodes<span class="w w1"> </span>into<span class="w w1"> </span>a<span class="w w1"> </span>native<span class="w w2"> </span>code<span class="w w1"> </span>cache,</div><div class="l f2 s4 t0" style="bottom:620.429px;left:317.014px;" data-x="317.014" data-y="622.366" hs="1">thus<span class="w w2"> </span>acting<span class="w w1"> </span>as<span class="w w2"> </span>a<span class="w w1"> </span>simple<span class="w w2"> </span>per-method<span class="w w1"> </span>JIT<span class="w w2"> </span>compiler<span class="w w1"> </span>that<span class="w w2"> </span>eliminates<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:610.467px;left:317.014px;" data-x="317.014" data-y="612.403" hs="1">dispatch<span class="w w2"> </span>overhead.</div><div class="l f2 s4 t0" style="bottom:600.504px;left:328.969px;" data-x="328.969" data-y="602.441" hs="1">Neither<span class="w w2"> </span>call<span class="w w2"> </span>threading<span class="w w1"> </span>nor<span class="w w2"> </span>inline<span class="w w1"> </span>threading<span class="w w2"> </span>perform<span class="w w2"> </span>type<span class="w w1"> </span>special-</div><div class="l f2 s4 t0" style="bottom:590.541px;left:317.014px;" data-x="317.014" data-y="592.478" hs="1">ization.</div><div class="l f2 s4 t0" style="bottom:580.579px;left:328.969px;" data-x="328.969" data-y="582.515" hs="1">Apple’s<span class="w w1"> </span>SquirrelFish<span class="w w1"> </span>Extreme<span class="w w1"> </span>(5)<span class="w w0"> </span>is<span class="w w1"> </span>a<span class="w w1"> </span>JavaScript<span class="w w1"> </span>implementa-</div><div class="l f2 s4 t0" style="bottom:570.616px;left:317.014px;" data-x="317.014" data-y="572.553" hs="1">tion<span class="w w1"> </span>based<span class="w w1"> </span>on<span class="w w1"> </span>call<span class="w w1"> </span>threading<span class="w w1"> </span>with<span class="w w1"> </span>selective<span class="w w1"> </span>inline<span class="w w1"> </span>threading.<span class="w w1"> </span>Com-</div><div class="l f2 s4 t0" style="bottom:560.653px;left:317.014px;" data-x="317.014" data-y="562.59" hs="1">bined<span class="w w1"> </span>with<span class="w w1"> </span>efficient<span class="w w1"> </span>interpreter<span class="w w0"> </span>engineering,<span class="w w1"> </span>these<span class="w w1"> </span>threading<span class="w w1"> </span>tech-</div><div class="l f2 s4 t0" style="bottom:550.691px;left:317.014px;" data-x="317.014" data-y="552.628" hs="1">niques<span class="w w2"> </span>have<span class="w w2"> </span>given<span class="w w1"> </span>SFX<span class="w w2"> </span>excellent<span class="w w1"> </span>performance<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w2"> </span>standard<span class="w w2"> </span>Sun-</div><div class="l f2 s4 t0" style="bottom:540.728px;left:317.014px;" data-x="317.014" data-y="542.665" hs="1">Spider<span class="w w2"> </span>benchmarks.</div><div class="l f2 s4 t0" style="bottom:530.766px;left:328.969px;" data-x="328.969" data-y="532.702" hs="1">Google’s<span class="w w1"> </span>V8<span class="w w0"> </span>is<span class="w w0"> </span>a<span class="w w1"> </span>JavaScript<span class="w w0"> </span>implementation<span class="w w1"> </span>primarily<span class="w w0"> </span>based</div><div class="l f2 s4 t0" style="bottom:520.803px;left:317.014px;" data-x="317.014" data-y="522.74" hs="1">on<span class="w w0"> </span>inline<span class="w w0"> </span>threading,<span class="w w1"> </span>with<span class="w w0"> </span>call<span class="w w0"> </span>threading<span class="w w0"> </span>only<span class="w w0"> </span>for<span class="w w0"> </span>very<span class="w w1"> </span>complex</div><div class="l f2 s4 t0" style="bottom:510.84px;left:317.014px;" data-x="317.014" data-y="512.777" hs="1">operations.</div><div class="l f1 s2 t0" style="bottom:489.233px;left:317.014px;" data-x="317.014" data-y="491.523" hs="1">9.<span class="w w3"> </span>Conclusions</div><div class="l f2 s4 t0" style="bottom:475.639px;left:317.014px;" data-x="317.014" data-y="477.576" hs="1">This<span class="w w1"> </span>paper<span class="w w2"> </span>described<span class="w w1"> </span>how<span class="w w1"> </span>to<span class="w w1"> </span>run<span class="w w1"> </span>dynamic<span class="w w1"> </span>languages<span class="w w2"> </span>efficiently<span class="w w1"> </span>by</div><div class="l f2 s4 t0" style="bottom:465.676px;left:317.014px;" data-x="317.014" data-y="467.613" hs="1">recording<span class="w w1"> </span>hot<span class="w w1"> </span>traces<span class="w w0"> </span>and<span class="w w1"> </span>generating<span class="w w1"> </span>type-specialized<span class="w w0"> </span>native<span class="w w2"> </span>code.</div><div class="l f2 s4 t0" style="bottom:455.714px;left:317.014px;" data-x="317.014" data-y="457.65" hs="1">Our<span class="w w1"> </span>technique<span class="w w1"> </span>focuses<span class="w w2"> </span>on<span class="w w1"> </span>aggressively<span class="w w1"> </span>inlined<span class="w w1"> </span>loops,<span class="w w1"> </span>and<span class="w w1"> </span>for<span class="w w1"> </span>each</div><div class="l f2 s4 t0" style="bottom:445.751px;left:317.014px;" data-x="317.014" data-y="447.688" hs="1">loop,<span class="w w0"> </span>it<span class="w w0"> </span>generates<span class="w w0"> </span>a<span class="w w1"> </span>tree<span class="w w0"> </span>of<span class="w w0"> </span>native<span class="w w0"> </span>code<span class="w w0"> </span>traces<span class="w w0"> </span>representing<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:435.788px;left:317.014px;" data-x="317.014" data-y="437.725" hs="1">paths<span class="w w1"> </span>and<span class="w w1"> </span>value<span class="w w1"> </span>types<span class="w w0"> </span>through<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>observed<span class="w w1"> </span>at<span class="w w1"> </span>run<span class="w w0"> </span>time.<span class="w w1"> </span>We</div><div class="l f2 s4 t0" style="bottom:425.826px;left:317.014px;" data-x="317.014" data-y="427.763" hs="1">explained<span class="w w1"> </span>how<span class="w w1"> </span>to<span class="w w1"> </span>identify<span class="w w1"> </span>loop<span class="w w1"> </span>nesting<span class="w w1"> </span>relationships<span class="w w1"> </span>and<span class="w w0"> </span>generate</div><div class="l f2 s4 t0" style="bottom:415.863px;left:317.014px;" data-x="317.014" data-y="417.8" hs="1">nested<span class="w w0"> </span>traces<span class="w w0"> </span>in<span class="w w0"> </span>order<span class="w w0"> </span>to<span class="w w1"> </span>avoid<span class="w w0"> </span>excessive<span class="w w0"> </span>code<span class="w w0"> </span>duplication<span class="w w0"> </span>due</div><div class="l f2 s4 t0" style="bottom:405.9px;left:317.014px;" data-x="317.014" data-y="407.837" hs="1">to<span class="w w0"> </span>the<span class="w w1"> </span>many<span class="w w0"> </span>paths<span class="w w0"> </span>through<span class="w w0"> </span>a<span class="w w1"> </span>loop<span class="w w0"> </span>nest.<span class="w w0"> </span>We<span class="w w1"> </span>described<span class="w w0"> </span>our<span class="w w0"> </span>type</div><div class="l f2 s4 t0" style="bottom:395.938px;left:317.014px;" data-x="317.014" data-y="397.875" hs="1">specialization<span class="w w0"> </span>algorithm.<span class="w w0"> </span>W</div><div class="l f2 s4 t0" style="bottom:395.938px;left:419.473px;" data-x="419.473" data-y="397.875" hs="1">e<span class="w w0"> </span>also<span class="w w0"> </span>described<span class="w w1"> </span>our<span class="w w0"> </span>trace<span class="w w0"> </span>compiler,</div><div class="l f2 s4 t0" style="bottom:385.975px;left:317.014px;" data-x="317.014" data-y="387.912" hs="1">which<span class="w w0"> </span>translates<span class="w w0"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>from<span class="w w0"> </span>an<span class="w w0"> </span>intermediate<span class="w w0"> </span>representation<span class="w w0"> </span>to</div><div class="l f2 s4 t0" style="bottom:376.013px;left:317.014px;" data-x="317.014" data-y="377.949" hs="1">optimized<span class="w w2"> </span>native<span class="w w1"> </span>code<span class="w w2"> </span>in<span class="w w1"> </span>two<span class="w w1"> </span>linear<span class="w w2"> </span>passes.</div><div class="l f2 s4 t0" style="bottom:366.05px;left:328.969px;" data-x="328.969" data-y="367.987" hs="1">Our<span class="w w1"> </span>experimental<span class="w w1"> </span>results<span class="w w1"> </span>show<span class="w w0"> </span>that<span class="w w1"> </span>in<span class="w w1"> </span>practice<span class="w w1"> </span>loops<span class="w w1"> </span>typically</div><div class="l f2 s4 t0" style="bottom:356.087px;left:317.014px;" data-x="317.014" data-y="358.024" hs="1">are<span class="w w1"> </span>entered<span class="w w1"> </span>with<span class="w w1"> </span>only<span class="w w1"> </span>a<span class="w w1"> </span>few<span class="w w1"> </span>different<span class="w w1"> </span>combinations<span class="w w1"> </span>of<span class="w w1"> </span>value<span class="w w1"> </span>types</div><div class="l f2 s4 t0" style="bottom:346.125px;left:317.014px;" data-x="317.014" data-y="348.061" hs="1">of<span class="w w1"> </span>variables.<span class="w w1"> </span>Thus,<span class="w w1"> </span>a<span class="w w1"> </span>small<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w1"> </span>traces<span class="w w1"> </span>per<span class="w w1"> </span>loop<span class="w w1"> </span>is<span class="w w0"> </span>sufficient</div><div class="l f2 s4 t0" style="bottom:336.162px;left:317.014px;" data-x="317.014" data-y="338.099" hs="1">to<span class="w w1"> </span>run<span class="w w0"> </span>a<span class="w w1"> </span>program<span class="w w0"> </span>efficiently</div><div class="l f2 s4 t0" style="bottom:336.162px;left:419.778px;" data-x="419.778" data-y="338.099" hs="1">.<span class="w w1"> </span>Our<span class="w w0"> </span>experiments<span class="w w1"> </span>also<span class="w w0"> </span>show<span class="w w1"> </span>that<span class="w w1"> </span>on</div><div class="l f2 s4 t0" style="bottom:326.199px;left:317.014px;" data-x="317.014" data-y="328.136" hs="1">programs<span class="w w2"> </span>amenable<span class="w w1"> </span>to<span class="w w1"> </span>tracing,<span class="w w2"> </span>we<span class="w w1"> </span>achieve<span class="w w2"> </span>speedups<span class="w w1"> </span>of<span class="w w1"> </span>2x<span class="w w2"> </span>to<span class="w w1"> </span>20x.</div><div class="l f1 s2 t0" style="bottom:304.592px;left:317.014px;" data-x="317.014" data-y="306.883" hs="1">10.<span class="w w3"> </span>Future<span class="w w1"> </span>W</div><div class="l f1 s2 t0" style="bottom:304.592px;left:386.614px;" data-x="386.614" data-y="306.883" hs="1">ork</div><div class="l f2 s4 t0" style="bottom:290.998px;left:317.014px;" data-x="317.014" data-y="292.935" hs="1">Work<span class="w w1"> </span>is<span class="w w0"> </span>underway<span class="w w1"> </span>in<span class="w w0"> </span>a<span class="w w0"> </span>number<span class="w w1"> </span>of<span class="w w0"> </span>areas<span class="w w1"> </span>to<span class="w w0"> </span>further<span class="w w0"> </span>improve<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:281.035px;left:317.014px;" data-x="317.014" data-y="282.972" hs="1">performance<span class="w w1"> </span>of<span class="w w1"> </span>our<span class="w w1"> </span>trace-based<span class="w w1"> </span>JavaScript<span class="w w2"> </span>compiler.<span class="w w1"> </span>We<span class="w w2"> </span>currently</div><div class="l f2 s4 t0" style="bottom:271.073px;left:317.014px;" data-x="317.014" data-y="273.01" hs="1">do<span class="w w1"> </span>not<span class="w w0"> </span>trace<span class="w w1"> </span>across<span class="w w0"> </span>recursive<span class="w w1"> </span>function<span class="w w0"> </span>calls,<span class="w w1"> </span>but<span class="w w0"> </span>plan<span class="w w1"> </span>to<span class="w w0"> </span>add<span class="w w1"> </span>the</div><div class="l f2 s4 t0" style="bottom:261.11px;left:317.014px;" data-x="317.014" data-y="263.047" hs="1">support<span class="w w1"> </span>for<span class="w w1"> </span>this<span class="w w1"> </span>capability<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>near<span class="w w1"> </span>term.<span class="w w1"> </span>We<span class="w w2"> </span>are<span class="w w1"> </span>also<span class="w w1"> </span>exploring</div><div class="l f2 s4 t0" style="bottom:251.147px;left:317.014px;" data-x="317.014" data-y="253.084" hs="1">adoption<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>existing<span class="w w2"> </span>work<span class="w w1"> </span>on<span class="w w1"> </span>tree<span class="w w1"> </span>recompilation<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>context</div><div class="l f2 s4 t0" style="bottom:241.185px;left:317.014px;" data-x="317.014" data-y="243.122" hs="1">of<span class="w w1"> </span>the<span class="w w2"> </span>presented<span class="w w1"> </span>dynamic<span class="w w1"> </span>compiler<span class="w w1"> </span>in<span class="w w2"> </span>order<span class="w w1"> </span>to<span class="w w1"> </span>minimize<span class="w w1"> </span>JIT<span class="w w1"> </span>pause</div><div class="l f2 s4 t0" style="bottom:231.222px;left:317.014px;" data-x="317.014" data-y="233.159" hs="1">times<span class="w w1"> </span>and<span class="w w2"> </span>obtain<span class="w w1"> </span>the<span class="w w1"> </span>best<span class="w w1"> </span>of<span class="w w2"> </span>both<span class="w w1"> </span>worlds,<span class="w w1"> </span>fast<span class="w w2"> </span>tree<span class="w w1"> </span>stitching<span class="w w1"> </span>as<span class="w w1"> </span>well</div><div class="l f2 s4 t0" style="bottom:221.26px;left:317.014px;" data-x="317.014" data-y="223.196" hs="1">as<span class="w w2"> </span>the<span class="w w1"> </span>improved<span class="w w2"> </span>code<span class="w w1"> </span>quality<span class="w w1"> </span>due<span class="w w2"> </span>to<span class="w w1"> </span>tree<span class="w w1"> </span>recompilation.</div><div class="l f2 s4 t0" style="bottom:211.297px;left:328.969px;" data-x="328.969" data-y="213.234" hs="1">We<span class="w w2"> </span>also<span class="w w0"> </span>plan<span class="w w1"> </span>on<span class="w w1"> </span>adding<span class="w w1"> </span>support<span class="w w0"> </span>for<span class="w w2"> </span>tracing<span class="w w0"> </span>across<span class="w w1"> </span>regular<span class="w w1"> </span>ex-</div><div class="l f2 s4 t0" style="bottom:201.334px;left:317.014px;" data-x="317.014" data-y="203.271" hs="1">pression<span class="w w0"> </span>substitutions<span class="w w1"> </span>using<span class="w w0"> </span>lambda<span class="w w0"> </span>functions,<span class="w w1"> </span>function<span class="w w0"> </span>applica-</div><div class="l f2 s4 t0" style="bottom:191.372px;left:317.014px;" data-x="317.014" data-y="193.308" hs="1">tions<span class="w w0"> </span>and<span class="w w1"> </span>expression<span class="w w0"> </span>evaluation<span class="w w1"> </span>using</div><div class="l f7 s4 t0" style="bottom:191.318px;left:461.227px;" data-x="461.227" data-y="193.308" hs="1">eval</div><div class="l f2 s4 t0" style="bottom:191.372px;left:480.056px;" data-x="480.056" data-y="193.308" hs="1">.<span class="w w0"> </span>All<span class="w w1"> </span>these<span class="w w0"> </span>language</div><div class="l f2 s4 t0" style="bottom:181.409px;left:317.014px;" data-x="317.014" data-y="183.346" hs="1">constructs<span class="w w1"> </span>are<span class="w w0"> </span>currently<span class="w w1"> </span>executed<span class="w w1"> </span>via<span class="w w0"> </span>interpretation,<span class="w w1"> </span>which<span class="w w0"> </span>limits</div><div class="l f2 s4 t0" style="bottom:171.446px;left:317.014px;" data-x="317.014" data-y="173.383" hs="1">our<span class="w w2"> </span>performance<span class="w w1"> </span>for<span class="w w1"> </span>applications<span class="w w2"> </span>that<span class="w w1"> </span>use<span class="w w1"> </span>those<span class="w w2"> </span>features.</div><div class="l f1 s2 t0" style="bottom:149.839px;left:317.014px;" data-x="317.014" data-y="152.13" hs="1">Acknowledgments</div><div class="l f2 s4 t0" style="bottom:136.245px;left:317.014px;" data-x="317.014" data-y="138.182" hs="1">Parts<span class="w w1"> </span>of<span class="w w1"> </span>this<span class="w w0"> </span>effort<span class="w w1"> </span>have<span class="w w1"> </span>been<span class="w w1"> </span>sponsored<span class="w w0"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>National<span class="w w0"> </span>Science</div><div class="l f2 s4 t0" style="bottom:126.282px;left:317.014px;" data-x="317.014" data-y="128.219" hs="1">Foundation<span class="w w2"> </span>under<span class="w w1"> </span>grants<span class="w w2"> </span>CNS-0615443<span class="w w1"> </span>and<span class="w w2"> </span>CNS-0627747,<span class="w w1"> </span>as<span class="w w2"> </span>well</div><div class="l f2 s4 t0" style="bottom:116.32px;left:317.014px;" data-x="317.014" data-y="118.257" hs="1">as<span class="w w1"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>California<span class="w w1"> </span>MICRO<span class="w w1"> </span>Program<span class="w w0"> </span>and<span class="w w2"> </span>industrial<span class="w w0"> </span>sponsor<span class="w w2"> </span>Sun</div><div class="l f2 s4 t0" style="bottom:106.357px;left:317.014px;" data-x="317.014" data-y="108.294" hs="1">Microsystems<span class="w w2"> </span>under<span class="w w1"> </span>Project<span class="w w1"> </span>No.<span class="w w2"> </span>07-127.</div><div class="l f2 s4 t0" style="bottom:96.3945px;left:328.969px;" data-x="328.969" data-y="98.3312" hs="1">The<span class="w w1"> </span>U.S.<span class="w w2"> </span>Government<span class="w w1"> </span>is<span class="w w1"> </span>authorized<span class="w w2"> </span>to<span class="w w1"> </span>reproduce<span class="w w1"> </span>and<span class="w w1"> </span>distribute</div><div class="l f2 s4 t0" style="bottom:86.4319px;left:317.014px;" data-x="317.014" data-y="88.3686" hs="1">reprints<span class="w w2"> </span>for<span class="w w1"> </span>Governmental<span class="w w2"> </span>purposes<span class="w w1"> </span>notwithstanding<span class="w w1"> </span>any<span class="w w2"> </span>copyright</div><div class="l f2 s4 t0" style="bottom:76.4693px;left:317.014px;" data-x="317.014" data-y="78.406" hs="1">annotation<span class="w w2"> </span>thereon.<span class="w w1"> </span>Any<span class="w w2"> </span>opinions,<span class="w w2"> </span>findings,<span class="w w1"> </span>and<span class="w w2"> </span>conclusions<span class="w w1"> </span>or<span class="w w2"> </span>rec-</div><div class="l f2 s4 t0" style="bottom:66.5066px;left:317.014px;" data-x="317.014" data-y="68.4433" hs="1">ommendations<span class="w w1"> </span>expressed<span class="w w1"> </span>here<span class="w w1"> </span>are<span class="w w0"> </span>those<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>author<span class="w w1"> </span>and<span class="w w0"> </span>should</div></div></div><div id="page-14" class="p" style="width:612px;height:792px;background-image:url(p14.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;"><div class="t t0"><div class="l f2 s4 t0" style="bottom:710.093px;left:54px;" data-x="54" data-y="712.03" hs="1">not<span class="w w1"> </span>be<span class="w w0"> </span>interpreted<span class="w w0"> </span>as<span class="w w1"> </span>necessarily<span class="w w0"> </span>representing<span class="w w1"> </span>the<span class="w w0"> </span>official<span class="w w1"> </span>views,</div><div class="l f2 s4 t0" style="bottom:700.13px;left:54px;" data-x="54" data-y="702.067" hs="1">policies<span class="w w1"> </span>or<span class="w w1"> </span>endorsements,<span class="w w1"> </span>either<span class="w w0"> </span>expressed<span class="w w1"> </span>or<span class="w w1"> </span>implied,<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>Na-</div><div class="l f2 s4 t0" style="bottom:690.168px;left:54px;" data-x="54" data-y="692.105" hs="1">tional<span class="w w2"> </span>Science<span class="w w2"> </span>foundation<span class="w w1"> </span>(NSF),<span class="w w2"> </span>any<span class="w w2"> </span>other<span class="w w1"> </span>agency<span class="w w2"> </span>of<span class="w w2"> </span>the<span class="w w2"> </span>U.S.<span class="w w1"> </span>Gov-</div><div class="l f2 s4 t0" style="bottom:680.205px;left:54px;" data-x="54" data-y="682.142" hs="1">ernment,<span class="w w2"> </span>or<span class="w w1"> </span>any<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>companies<span class="w w2"> </span>mentioned<span class="w w1"> </span>above.</div><div class="l f1 s2 t0" style="bottom:658.93px;left:54px;" data-x="54" data-y="661.22" hs="1">References</div><div class="l f2 s3 t0" style="bottom:646.547px;left:57.9851px;" data-x="57.9851" data-y="648.269" hs="1">[1]<span class="w w1"> </span>LuaJIT<span class="w w3"> </span>roadmap<span class="w w10"> </span>2008<span class="w w3"> </span>-<span class="w w10"> </span>http://lua-users.org/lists/lua-l/2008-</div><div class="l f2 s3 t0" style="bottom:637.581px;left:70.7651px;" data-x="70.7651" data-y="639.303" hs="1">02/msg00051.html.</div><div class="l f2 s3 t0" style="bottom:625.875px;left:57.9851px;" data-x="57.9851" data-y="627.596" hs="1">[2]<span class="w w1"> </span>Mozilla<span class="w w0"> </span>—<span class="w w0"> </span>Firefox<span class="w w0"> </span>web<span class="w w0"> </span>browser<span class="w w1"> </span>and<span class="w w0"> </span>Thunderbird<span class="w w0"> </span>email<span class="w w0"> </span>client<span class="w w0"> </span>-</div><div class="l f2 s3 t0" style="bottom:616.909px;left:70.7651px;" data-x="70.7651" data-y="618.63" hs="1">http://www.mozilla.com.</div><div class="l f2 s3 t0" style="bottom:605.202px;left:57.9851px;" data-x="57.9851" data-y="606.924" hs="1">[3]<span class="w w1"> </span>SPECJVM98<span class="w w1"> </span>-<span class="w w2"> </span>http://www.spec.org/jvm98/.</div><div class="l f2 s3 t0" style="bottom:593.496px;left:57.9851px;" data-x="57.9851" data-y="595.218" hs="1">[4]<span class="w w1"> </span>SpiderMonkey<span class="w w15"> </span>(JavaScript-C)<span class="w w15"> </span>Engine<span class="w wf"> </span>-</div><div class="l f2 s3 t0" style="bottom:584.53px;left:70.7651px;" data-x="70.7651" data-y="586.251" hs="1">http://www.mozilla.org/js/spidermonkey/.</div><div class="l f2 s3 t0" style="bottom:572.824px;left:57.9851px;" data-x="57.9851" data-y="574.545" hs="1">[5]<span class="w w1"> </span>Surfin’<span class="w w1"> </span>Safari<span class="w w0"> </span>-<span class="w w2"> </span>Blog<span class="w w0"> </span>Archive<span class="w w2"> </span>-<span class="w w1"> </span>Announcing<span class="w w0"> </span>SquirrelFish<span class="w w2"> </span>Extreme<span class="w w0"> </span>-</div><div class="l f2 s3 t0" style="bottom:563.857px;left:70.7651px;" data-x="70.7651" data-y="565.579" hs="1">http://webkit.org/blog/214/introducing-squirrelfish-extreme/.</div><div class="l f2 s3 t0" style="bottom:552.151px;left:57.9851px;" data-x="57.9851" data-y="553.873" hs="1">[6]<span class="w w1"> </span>A.<span class="w w0"> </span>Aho,<span class="w w1"> </span>R.<span class="w w1"> </span>Sethi,<span class="w w1"> </span>J.<span class="w w0"> </span>Ullman,<span class="w w1"> </span>and<span class="w w1"> </span>M.<span class="w w0"> </span>Lam.<span class="w w4"> </span>Compilers:<span class="w w1"> </span>Principles,</div><div class="l f2 s3 t0" style="bottom:543.185px;left:70.7651px;" data-x="70.7651" data-y="544.906" hs="1">techniques,<span class="w w2"> </span>and<span class="w w1"> </span>tools,<span class="w w2"> </span>2006.</div><div class="l f2 s3 t0" style="bottom:531.479px;left:57.9851px;" data-x="57.9851" data-y="533.2" hs="1">[7]<span class="w w1"> </span>V.<span class="w w1"> </span>Bala,<span class="w w1"> </span>E.<span class="w w0"> </span>Duesterwald,<span class="w w1"> </span>and<span class="w w1"> </span>S.<span class="w w1"> </span>Banerjia.<span class="w w28"> </span>Dynamo:<span class="w w1"> </span>A<span class="w w1"> </span>transparent</div><div class="l f2 s3 t0" style="bottom:522.512px;left:70.7651px;" data-x="70.7651" data-y="524.234" hs="1">dynamic<span class="w w2"> </span>optimization<span class="w w1"> </span>system.<span class="w w0"> </span>In</div><div class="l fa s3 t0" style="bottom:522.696px;left:180.023px;" data-x="180.023" data-y="524.234" hs="1">Proceedings<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>ACM<span class="w w2"> </span>SIGPLAN</div><div class="l fa s3 t0" style="bottom:513.729px;left:70.7651px;" data-x="70.7651" data-y="515.268" hs="1">Conference<span class="w w2"> </span>on<span class="w w1"> </span>Programming<span class="w w1"> </span>Language<span class="w w1"> </span>Design<span class="w w2"> </span>and<span class="w w1"> </span>Implementation</div><div class="l f2 s3 t0" style="bottom:513.546px;left:291.111px;" data-x="291.111" data-y="515.268" hs="1">,</div><div class="l f2 s3 t0" style="bottom:504.58px;left:70.7651px;" data-x="70.7651" data-y="506.301" hs="1">pages<span class="w w2"> </span>1–12.<span class="w w1"> </span>ACM<span class="w w2"> </span>Press,<span class="w w2"> </span>2000.</div><div class="l f2 s3 t0" style="bottom:492.874px;left:57.9851px;" data-x="57.9851" data-y="494.595" hs="1">[8]<span class="w w1"> </span>M.<span class="w w1"> </span>Berndl,<span class="w w1"> </span>B.<span class="w w2"> </span>Vitale,<span class="w w1"> </span>M.<span class="w w2"> </span>Zaleski,<span class="w w1"> </span>and<span class="w w2"> </span>A.<span class="w w1"> </span>Brown.<span class="w w0"> </span>Context<span class="w w2"> </span>Threading:</div><div class="l f2 s3 t0" style="bottom:483.907px;left:70.7651px;" data-x="70.7651" data-y="485.629" hs="1">a<span class="w w1"> </span>Flexible<span class="w w1"> </span>and<span class="w w1"> </span>Efficient<span class="w w2"> </span>Dispatch<span class="w w1"> </span>Technique<span class="w w1"> </span>for<span class="w w1"> </span>Virtual<span class="w w2"> </span>Machine<span class="w w1"> </span>In-</div><div class="l f2 s3 t0" style="bottom:474.941px;left:70.7651px;" data-x="70.7651" data-y="476.662" hs="1">terpreters.<span class="w w0"> </span>In</div><div class="l fa s3 t0" style="bottom:475.124px;left:116.627px;" data-x="116.627" data-y="476.662" hs="1">Code<span class="w w1"> </span>Generation<span class="w w2"> </span>and<span class="w w1"> </span>Optimization,<span class="w w1"> </span>2005.<span class="w w1"> </span>CGO<span class="w w1"> </span>2005.</div><div class="l fa s3 t0" style="bottom:466.158px;left:70.7651px;" data-x="70.7651" data-y="467.696" hs="1">International<span class="w w2"> </span>Symposium<span class="w w1"> </span>on</div><div class="l f2 s3 t0" style="bottom:465.974px;left:161.09px;" data-x="161.09" data-y="467.696" hs="1">,<span class="w w2"> </span>pages<span class="w w1"> </span>15–26,<span class="w w2"> </span>2005.</div><div class="l f2 s3 t0" style="bottom:454.268px;left:57.9851px;" data-x="57.9851" data-y="455.99" hs="1">[9]<span class="w w1"> </span>C.<span class="w w0"> </span>Chambers<span class="w w1"> </span>and<span class="w w1"> </span>D.<span class="w w0"> </span>Ungar.<span class="w w4"> </span>Customization:<span class="w w0"> </span>Optimizing<span class="w w1"> </span>Compiler</div><div class="l f2 s3 t0" style="bottom:445.302px;left:70.7651px;" data-x="70.7651" data-y="447.023" hs="1">Technology<span class="w w1"> </span>for<span class="w w1"> </span>SELF,<span class="w w1"> </span>a<span class="w w1"> </span>Dynamically-Typed<span class="w w1"> </span>O<span class="w w0"> </span>bject-Oriented<span class="w w1"> </span>Pro-</div><div class="l f2 s3 t0" style="bottom:436.336px;left:70.7651px;" data-x="70.7651" data-y="438.057" hs="1">gramming<span class="w w1"> </span>Language.<span class="w w28"> </span>In</div><div class="l fa s3 t0" style="bottom:436.519px;left:157.004px;" data-x="157.004" data-y="438.057" hs="1">Proceedings<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>ACM<span class="w w1"> </span>SIGPLAN<span class="w w1"> </span>1989</div><div class="l fa s3 t0" style="bottom:427.553px;left:70.7651px;" data-x="70.7651" data-y="429.091" hs="1">Conference<span class="w w2"> </span>on<span class="w w1"> </span>Programming<span class="w w1"> </span>Language<span class="w w1"> </span>Design<span class="w w2"> </span>and<span class="w w1"> </span>Implementation</div><div class="l f2 s3 t0" style="bottom:427.369px;left:291.111px;" data-x="291.111" data-y="429.091" hs="1">,</div><div class="l f2 s3 t0" style="bottom:418.403px;left:70.7651px;" data-x="70.7651" data-y="420.124" hs="1">pages<span class="w w2"> </span>146–160.<span class="w w1"> </span>ACM<span class="w w2"> </span>New<span class="w w2"> </span>York,<span class="w w2"> </span>NY,<span class="w w2"> </span>USA,<span class="w w2"> </span>1989.</div><div class="l f2 s3 t0" style="bottom:710.308px;left:317.014px;" data-x="317.014" data-y="712.03" hs="1">[10]<span class="w w1"> </span>A.<span class="w w1"> </span>Gal.</div><div class="l fa s3 t0" style="bottom:710.491px;left:362.103px;" data-x="362.103" data-y="712.03" hs="1">Efficient<span class="w w2"> </span>Bytecode<span class="w w1"> </span>Verification<span class="w w1"> </span>and<span class="w w2"> </span>Compilation<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>Virtual</div><div class="l fa s3 t0" style="bottom:701.525px;left:333.779px;" data-x="333.779" data-y="703.063" hs="1">Machine<span class="w w1"> </span>Dissertation</div><div class="l f2 s3 t0" style="bottom:701.342px;left:403.706px;" data-x="403.706" data-y="703.063" hs="1">.<span class="w w0"> </span>PhD<span class="w w1"> </span>thesis,<span class="w w1"> </span>University<span class="w w1"> </span>Of<span class="w w1"> </span>California,<span class="w w1"> </span>Irvine,</div><div class="l f2 s3 t0" style="bottom:692.375px;left:333.779px;" data-x="333.779" data-y="694.097" hs="1">2006.</div><div class="l f2 s3 t0" style="bottom:680.42px;left:317.014px;" data-x="317.014" data-y="682.142" hs="1">[11]<span class="w w1"> </span>A.<span class="w w1"> </span>Gal,<span class="w w1"> </span>C.<span class="w w1"> </span>W.<span class="w w1"> </span>Probst,<span class="w w1"> </span>and<span class="w w1"> </span>M.<span class="w w1"> </span>Franz.<span class="w w4"> </span>HotpathVM:<span class="w w1"> </span>An<span class="w w1"> </span>effective<span class="w w1"> </span>JIT</div><div class="l f2 s3 t0" style="bottom:671.454px;left:333.779px;" data-x="333.779" data-y="673.175" hs="1">compiler<span class="w w1"> </span>for<span class="w w0"> </span>resource-constrained<span class="w w0"> </span>devices.<span class="w w28"> </span>In</div><div class="l fa s3 t0" style="bottom:671.637px;left:493.287px;" data-x="493.287" data-y="673.175" hs="1">Proceedings<span class="w w1"> </span>of<span class="w w0"> </span>the</div><div class="l fa s3 t0" style="bottom:662.671px;left:333.779px;" data-x="333.779" data-y="664.209" hs="1">International<span class="w w1"> </span>Conference<span class="w w1"> </span>on<span class="w w1"> </span>Virtual<span class="w w1"> </span>Execution<span class="w w1"> </span>Environments</div><div class="l f2 s3 t0" style="bottom:662.488px;left:532.935px;" data-x="532.935" data-y="664.209" hs="1">,<span class="w w1"> </span>pages</div><div class="l f2 s3 t0" style="bottom:653.521px;left:333.779px;" data-x="333.779" data-y="655.243" hs="1">144–153.<span class="w w2"> </span>ACM<span class="w w2"> </span>Press,<span class="w w1"> </span>2006.</div><div class="l f2 s3 t0" style="bottom:641.566px;left:317.014px;" data-x="317.014" data-y="643.287" hs="1">[12]<span class="w w1"> </span>C.<span class="w w1"> </span>Garrett,<span class="w w1"> </span>J.<span class="w w1"> </span>Dean,<span class="w w1"> </span>D.<span class="w w1"> </span>Grove,<span class="w w1"> </span>and<span class="w w1"> </span>C.<span class="w w1"> </span>Chambers.<span class="w w0"> </span>Measurement<span class="w w1"> </span>and</div><div class="l f2 s3 t0" style="bottom:632.6px;left:333.779px;" data-x="333.779" data-y="634.321" hs="1">Application<span class="w w2"> </span>of<span class="w w1"> </span>Dynamic<span class="w w2"> </span>Receiver<span class="w w2"> </span>Class<span class="w w1"> </span>Distributions.<span class="w w1"> </span>1994.</div><div class="l f2 s3 t0" style="bottom:620.644px;left:317.014px;" data-x="317.014" data-y="622.366" hs="1">[13]<span class="w w1"> </span>J.<span class="w w1"> </span>Ha,<span class="w w1"> </span>M.<span class="w w2"> </span>R.<span class="w w1"> </span>Haghighat,<span class="w w1"> </span>S.<span class="w w2"> </span>Cong,<span class="w w1"> </span>and<span class="w w1"> </span>K.<span class="w w1"> </span>S.<span class="w w2"> </span>McKinley.<span class="w w0"> </span>A<span class="w w2"> </span>concurrent</div><div class="l f2 s3 t0" style="bottom:611.678px;left:333.779px;" data-x="333.779" data-y="613.4" hs="1">trace-based<span class="w w1"> </span>just-in-time<span class="w w1"> </span>compiler<span class="w w0"> </span>for<span class="w w1"> </span>javascript.<span class="w w4"> </span>Dept.of<span class="w w0"> </span>Computer</div><div class="l f2 s3 t0" style="bottom:602.712px;left:333.779px;" data-x="333.779" data-y="604.433" hs="1">Sciences,<span class="w w2"> </span>The<span class="w w1"> </span>University<span class="w w2"> </span>of<span class="w w2"> </span>Texas<span class="w w2"> </span>at<span class="w w1"> </span>Austin,<span class="w w2"> </span>TR-09-06,<span class="w w1"> </span>2009.</div><div class="l f2 s3 t0" style="bottom:590.756px;left:317.014px;" data-x="317.014" data-y="592.478" hs="1">[14]<span class="w w1"> </span>B.<span class="w w1"> </span>McCloskey.<span class="w w2"> </span>Personal<span class="w w1"> </span>communication.</div><div class="l f2 s3 t0" style="bottom:578.801px;left:317.014px;" data-x="317.014" data-y="580.523" hs="1">[15]<span class="w w1"> </span>I.<span class="w w1"> </span>Piumarta<span class="w w2"> </span>and<span class="w w2"> </span>F.<span class="w w2"> </span>Riccardi.<span class="w w1"> </span>Optimizing<span class="w w2"> </span>direct<span class="w w1"> </span>threaded<span class="w w2"> </span>code<span class="w w2"> </span>by<span class="w w1"> </span>selec-</div><div class="l f2 s3 t0" style="bottom:569.835px;left:333.779px;" data-x="333.779" data-y="571.556" hs="1">tive<span class="w w2"> </span>inlining.<span class="w w0"> </span>In</div><div class="l fa s3 t0" style="bottom:570.018px;left:387.542px;" data-x="387.542" data-y="571.556" hs="1">Proceedings<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>ACM<span class="w w2"> </span>SIGPLAN<span class="w w1"> </span>1998<span class="w w1"> </span>conference</div><div class="l fa s3 t0" style="bottom:561.052px;left:333.779px;" data-x="333.779" data-y="562.59" hs="1">on<span class="w w1"> </span>Programming<span class="w w1"> </span>language<span class="w w1"> </span>design<span class="w w0"> </span>and<span class="w w1"> </span>implementation</div><div class="l f2 s3 t0" style="bottom:560.869px;left:513.675px;" data-x="513.675" data-y="562.59" hs="1">,<span class="w w1"> </span>pages<span class="w w1"> </span>291–</div><div class="l f2 s3 t0" style="bottom:551.902px;left:333.779px;" data-x="333.779" data-y="553.624" hs="1">300.<span class="w w2"> </span>ACM<span class="w w2"> </span>New<span class="w w1"> </span>York,<span class="w w2"> </span>NY</div><div class="l f2 s3 t0" style="bottom:551.902px;left:416.357px;" data-x="416.357" data-y="553.624" hs="1">,<span class="w w2"> </span>USA,<span class="w w1"> </span>1998.</div><div class="l f2 s3 t0" style="bottom:539.947px;left:317.014px;" data-x="317.014" data-y="541.669" hs="1">[16]<span class="w w1"> </span>A.<span class="w w0"> </span>Rigo.<span class="w w4"> </span>Representation-Based<span class="w w1"> </span>Just-In-time<span class="w w0"> </span>Specialization<span class="w w1"> </span>and<span class="w w1"> </span>the</div><div class="l f2 s3 t0" style="bottom:530.981px;left:333.779px;" data-x="333.779" data-y="532.702" hs="1">Psyco<span class="w w2"> </span>Prototype<span class="w w1"> </span>for<span class="w w2"> </span>Python.<span class="w w1"> </span>In</div><div class="l fa s3 t0" style="bottom:531.164px;left:435.166px;" data-x="435.166" data-y="532.702" hs="1">PEPM</div><div class="l f2 s3 t0" style="bottom:530.981px;left:456.414px;" data-x="456.414" data-y="532.702" hs="1">,<span class="w w2"> </span>2004.</div><div class="l f2 s3 t0" style="bottom:519.025px;left:317.014px;" data-x="317.014" data-y="520.747" hs="1">[17]<span class="w w1"> </span>M.<span class="w w0"> </span>Salib.<span class="w w10"> </span>Starkiller:<span class="w w1"> </span>A<span class="w w0"> </span>Static<span class="w w0"> </span>Type<span class="w w1"> </span>Inferencer<span class="w w0"> </span>and<span class="w w1"> </span>Compiler<span class="w w0"> </span>for</div><div class="l f2 s3 t0" style="bottom:510.059px;left:333.779px;" data-x="333.779" data-y="511.781" hs="1">Python.<span class="w w1"> </span>In</div><div class="l fa s3 t0" style="bottom:510.242px;left:369.859px;" data-x="369.859" data-y="511.781" hs="1">Master’s<span class="w w2"> </span>Thesis</div><div class="l f2 s3 t0" style="bottom:510.059px;left:420.238px;" data-x="420.238" data-y="511.781" hs="1">,<span class="w w2"> </span>2004.</div><div class="l f2 s3 t0" style="bottom:498.104px;left:317.014px;" data-x="317.014" data-y="499.825" hs="1">[18]<span class="w w1"> </span>T.<span class="w w1"> </span>Suganuma,<span class="w w2"> </span>T.<span class="w w1"> </span>Yasue,<span class="w w2"> </span>and<span class="w w1"> </span>T.<span class="w w2"> </span>Nakatani.<span class="w w0"> </span>A<span class="w w1"> </span>Region-Based<span class="w w2"> </span>Compila-</div><div class="l f2 s3 t0" style="bottom:489.138px;left:333.779px;" data-x="333.779" data-y="490.859" hs="1">tion<span class="w w1"> </span>Technique<span class="w w2"> </span>for<span class="w w1"> </span>Dynamic<span class="w w1"> </span>Compilers.</div><div class="l fa s3 t0" style="bottom:489.321px;left:468.368px;" data-x="468.368" data-y="490.859" hs="1">ACM<span class="w w2"> </span>Transactions<span class="w w1"> </span>on<span class="w w1"> </span>Pro-</div><div class="l fa s3 t0" style="bottom:480.354px;left:333.779px;" data-x="333.779" data-y="481.893" hs="1">gramming<span class="w w2"> </span>Languages<span class="w w2"> </span>and<span class="w w1"> </span>Systems<span class="w w2"> </span>(TOPLAS)</div><div class="l f2 s3 t0" style="bottom:480.171px;left:479.91px;" data-x="479.91" data-y="481.893" hs="1">,<span class="w w2"> </span>28(1):134–174,<span class="w w1"> </span>2006.</div><div class="l f2 s3 t0" style="bottom:468.216px;left:317.014px;" data-x="317.014" data-y="469.938" hs="1">[19]<span class="w w1"> </span>M.<span class="w w0"> </span>Zaleski,<span class="w w1"> </span>A.<span class="w w0"> </span>D.<span class="w w0"> </span>Brown,<span class="w w1"> </span>and<span class="w w0"> </span>K.<span class="w w1"> </span>Stoodley.<span class="w w28"> </span>YETI:<span class="w w0"> </span>A<span class="w w0"> </span>graduallY</div><div class="l f2 s3 t0" style="bottom:459.25px;left:333.779px;" data-x="333.779" data-y="460.971" hs="1">Extensible<span class="w w0"> </span>Trace<span class="w w1"> </span>Interpreter.<span class="w w10"> </span>In</div><div class="l fa s3 t0" style="bottom:459.433px;left:447.299px;" data-x="447.299" data-y="460.971" hs="1">Proceedings<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w0"> </span>International</div><div class="l fa s3 t0" style="bottom:450.467px;left:333.779px;" data-x="333.779" data-y="452.005" hs="1">Conference<span class="w w1"> </span>on<span class="w w1"> </span>Virtual<span class="w w1"> </span>Execution<span class="w w1"> </span>Environments</div><div class="l f2 s3 t0" style="bottom:450.283px;left:487.41px;" data-x="487.41" data-y="452.005" hs="1">,<span class="w w1"> </span>pages<span class="w w1"> </span>83–93.<span class="w w1"> </span>ACM</div><div class="l f2 s3 t0" style="bottom:441.317px;left:333.779px;" data-x="333.779" data-y="443.038" hs="1">Press,<span class="w w2"> </span>2007.</div></div></div></div></body></html>
<!DOCTYPE html>
<html><head><meta charset="utf-8"><style type="text/css">#pdf-main {  font-family: sans-serif;  position:absolute;  top:0;  left:0;  bottom:0;  right:0;  overflow:auto;  background-color:grey;}#pdf-main > .p {  position:relative;  margin:13px auto;  background-color:white;  overflow:hidden;  display:none;}.p  > .l {  position:absolute;   white-space:pre;}.l > .w {  display:inline-block;  visibility:hidden;}::selection{  background: rgba(168,209,255,0.5);}::-moz-selection{  background: rgba(168,209,255,0.5);}</style><link rel="stylesheet" type="text/css" href="all.css" /><script type="text/javascript">function show_pages(){ var pages = document.getElementById('pdf-main').childNodes; var idx = 0; var f = function(){  if (idx < pages.length) {   try{    pages[idx].style.display='block';   }catch(e){}   ++idx;   setTimeout(f,100);  } }; f();};</script></head><body onload="show_pages();"><div id="pdf-main">
<div id="page-1" class="p" style="width:612px;height:792px;background-image:url(p1.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f1 s1 c0" style="bottom:696.923px;top:78.9558px;left:80.5159px;">T</div>
<div class="l f1 s1 c0" style="bottom:696.923px;top:78.9558px;left:91.1501px;">race-based<span class="w w0"> </span>Just-in-Time<span class="w w0"> </span>T</div>
<div class="l f1 s1 c0" style="bottom:696.923px;top:78.9558px;left:291.459px;">ype<span class="w w0"> </span>Specialization<span class="w w0"> </span>for<span class="w w0"> </span>Dynamic</div>
<div class="l f1 s1 c0" style="bottom:676.997px;top:98.8811px;left:263.706px;">Languages</div>
<div class="l f2 s2 c0" style="bottom:642.513px;top:139.69px;left:120.322px;">Andreas<span class="w w1"> </span>Gal</div>
<div class="l f3 s3 c0" style="bottom:647.292px;top:137.184px;left:175.401px;">∗</div>
<div class="l f4 s3 c0" style="bottom:647.292px;top:137.63px;left:180.134px;">+</div>
<div class="l f2 s2 c0" style="bottom:642.513px;top:139.69px;left:187.218px;">,<span class="w w1"> </span>Brendan<span class="w w1"> </span>Eich</div>
<div class="l f3 s3 c0" style="bottom:647.292px;top:137.184px;left:252.653px;">∗</div>
<div class="l f2 s2 c0" style="bottom:642.513px;top:139.69px;left:257.386px;">,<span class="w w1"> </span>Mike<span class="w w1"> </span>Shaver</div>
<div class="l f3 s3 c0" style="bottom:647.292px;top:137.184px;left:318.678px;">∗</div>
<div class="l f2 s2 c0" style="bottom:642.513px;top:139.69px;left:323.411px;">,<span class="w w1"> </span>David<span class="w w1"> </span>Anderson</div>
<div class="l f3 s3 c0" style="bottom:647.292px;top:137.184px;left:400.802px;">∗</div>
<div class="l f2 s2 c0" style="bottom:642.513px;top:139.69px;left:405.534px;">,<span class="w w1"> </span>David<span class="w w1"> </span>Mandelin</div>
<div class="l f3 s3 c0" style="bottom:647.292px;top:137.184px;left:482.323px;">∗</div>
<div class="l f2 s2 c0" style="bottom:642.513px;top:139.69px;left:487.055px;">,</div>
<div class="l f2 s2 c0" style="bottom:629.561px;top:152.641px;left:93.5416px;">Mohammad<span class="w w1"> </span>R.<span class="w w1"> </span>Haghighat</div>
<div class="l f4 s3 c0" style="bottom:634.341px;top:150.582px;left:207.689px;">$</div>
<div class="l f2 s2 c0" style="bottom:629.561px;top:152.641px;left:212.421px;">,<span class="w w1"> </span>Blake<span class="w w1"> </span>Kaplan</div>
<div class="l f3 s3 c0" style="bottom:634.341px;top:150.135px;left:277.746px;">∗</div>
<div class="l f2 s2 c0" style="bottom:629.561px;top:152.641px;left:282.479px;">,<span class="w w1"> </span>Graydon<span class="w w1"> </span>Hoare</div>
<div class="l f3 s3 c0" style="bottom:634.341px;top:150.135px;left:355.815px;">∗</div>
<div class="l f2 s2 c0" style="bottom:629.561px;top:152.641px;left:360.548px;">,<span class="w w1"> </span>Boris<span class="w w1"> </span>Zbarsky</div>
<div class="l f3 s3 c0" style="bottom:634.341px;top:150.135px;left:428.262px;">∗</div>
<div class="l f2 s2 c0" style="bottom:629.561px;top:152.641px;left:432.994px;">,<span class="w w1"> </span>Jason<span class="w w1"> </span>Orendorff</div>
<div class="l f3 s3 c0" style="bottom:634.341px;top:150.135px;left:509.103px;">∗</div>
<div class="l f2 s2 c0" style="bottom:629.561px;top:152.641px;left:513.836px;">,</div>
<div class="l f2 s2 c0" style="bottom:616.61px;top:165.593px;left:68.2749px;">Jesse<span class="w w1"> </span>Ruderman</div>
<div class="l f3 s3 c0" style="bottom:621.39px;top:163.087px;left:139.189px;">∗</div>
<div class="l f2 s2 c0" style="bottom:616.61px;top:165.593px;left:143.921px;">,<span class="w w1"> </span>Edwin<span class="w w1"> </span>Smith</div>
<div class="l f4 s3 c0" style="bottom:621.39px;top:163.533px;left:206.946px;">#</div>
<div class="l f2 s2 c0" style="bottom:616.61px;top:165.593px;left:214.501px;">,<span class="w w1"> </span>Rick<span class="w w1"> </span>Reitmaier</div>
<div class="l f4 s3 c0" style="bottom:621.39px;top:163.533px;left:286.642px;">#</div>
<div class="l f2 s2 c0" style="bottom:616.61px;top:165.593px;left:294.197px;">,<span class="w w1"> </span>Michael<span class="w w1"> </span>Bebenita</div>
<div class="l f4 s3 c0" style="bottom:621.39px;top:163.533px;left:377.286px;">+</div>
<div class="l f2 s2 c0" style="bottom:616.61px;top:165.593px;left:384.371px;">,<span class="w w1"> </span>Mason<span class="w w1"> </span>Chang</div>
<div class="l f4 s3 c0" style="bottom:621.39px;top:163.533px;left:451.034px;">+#</div>
<div class="l f2 s2 c0" style="bottom:616.61px;top:165.593px;left:465.673px;">,<span class="w w1"> </span>Michael<span class="w w1"> </span>Franz</div>
<div class="l f4 s3 c0" style="bottom:621.39px;top:163.533px;left:534.758px;">+</div>
<div class="l f2 s4 c0" style="bottom:602.096px;top:181.888px;left:266.165px;">Mozilla<span class="w w1"> </span>Corporation</div>
<div class="l f5 s5 c0" style="bottom:606.682px;top:179.675px;left:339.635px;">∗</div>
<div class="l f6 s4 c0" style="bottom:592.331px;top:191.205px;left:90.9763px;">{</div>
<div class="l f7 s4 c0" style="bottom:592.08px;top:192.451px;left:95.584px;">gal,brendan,shaver,danderson,dmandelin,mrbkap,graydon,bz,jorendorff,jruderman</div>
<div class="l f6 s4 c0" style="bottom:592.331px;top:191.205px;left:458.045px;">}</div>
<div class="l f7 s4 c0" style="bottom:592.08px;top:192.451px;left:462.653px;">@mozilla.com</div>
<div class="l f2 s4 c0" style="bottom:575.954px;top:208.03px;left:267.081px;">Adobe<span class="w w1"> </span>Corporation</div>
<div class="l f8 s5 c0" style="bottom:580.54px;top:206.151px;left:336.561px;">#</div>
<div class="l f6 s4 c0" style="bottom:566.189px;top:217.347px;left:236.902px;">{</div>
<div class="l f7 s4 c0" style="bottom:565.938px;top:218.593px;left:241.51px;">edwsmith,rreitmai</div>
<div class="l f6 s4 c0" style="bottom:566.189px;top:217.347px;left:321.534px;">}</div>
<div class="l f7 s4 c0" style="bottom:565.938px;top:218.593px;left:326.142px;">@adobe.com</div>
<div class="l f2 s4 c0" style="bottom:549.48px;top:234.504px;left:271.978px;">Intel<span class="w w1"> </span>Corporation</div>
<div class="l f8 s5 c0" style="bottom:554.066px;top:232.625px;left:333.988px;">$</div>
<div class="l f6 s4 c0" style="bottom:539.715px;top:243.821px;left:229.841px;">{</div>
<div class="l f7 s4 c0" style="bottom:539.464px;top:245.067px;left:234.449px;">mohammad.r.haghighat</div>
<div class="l f6 s4 c0" style="bottom:539.715px;top:243.821px;left:328.595px;">}</div>
<div class="l f7 s4 c0" style="bottom:539.464px;top:245.067px;left:333.203px;">@intel.com</div>
<div class="l f2 s4 c0" style="bottom:523.671px;top:260.313px;left:246.163px;">University<span class="w w1"> </span>of<span class="w w2"> </span>California,<span class="w w2"> </span>Irvine</div>
<div class="l f8 s5 c0" style="bottom:528.257px;top:258.435px;left:357.865px;">+</div>
<div class="l f6 s4 c0" style="bottom:513.905px;top:269.631px;left:232.195px;">{</div>
<div class="l f7 s4 c0" style="bottom:513.654px;top:270.877px;left:236.803px;">mbebenit,changm,franz</div>
<div class="l f6 s4 c0" style="bottom:513.905px;top:269.631px;left:335.656px;">}</div>
<div class="l f7 s4 c0" style="bottom:513.654px;top:270.877px;left:340.264px;">@uci.edu</div>
<div class="l f1 s2 c0" style="bottom:445.608px;top:336.54px;left:54px;">Abstract</div>
<div class="l f2 s4 c0" style="bottom:432.014px;top:351.97px;left:54px;">Dynamic<span class="w w1"> </span>languages<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w1"> </span>JavaScript<span class="w w1"> </span>are<span class="w w1"> </span>more<span class="w w0"> </span>difficult<span class="w w2"> </span>to<span class="w w1"> </span>com-</div>
<div class="l f2 s4 c0" style="bottom:422.052px;top:361.932px;left:54px;">pile<span class="w w1"> </span>than<span class="w w2"> </span>statically<span class="w w1"> </span>typed<span class="w w1"> </span>ones.<span class="w w1"> </span>Since<span class="w w1"> </span>no<span class="w w2"> </span>concrete<span class="w w1"> </span>type<span class="w w1"> </span>information</div>
<div class="l f2 s4 c0" style="bottom:412.089px;top:371.895px;left:54px;">is<span class="w w2"> </span>available,<span class="w w2"> </span>traditional<span class="w w2"> </span>compilers<span class="w w1"> </span>need<span class="w w2"> </span>to<span class="w w2"> </span>emit<span class="w w2"> </span>generic<span class="w w1"> </span>code<span class="w w2"> </span>that<span class="w w2"> </span>can</div>
<div class="l f2 s4 c0" style="bottom:402.126px;top:381.858px;left:54px;">handle<span class="w w2"> </span>all<span class="w w1"> </span>possible<span class="w w2"> </span>type<span class="w w1"> </span>combinations<span class="w w2"> </span>at<span class="w w1"> </span>runtime.<span class="w w2"> </span>We<span class="w w2"> </span>present<span class="w w1"> </span>an<span class="w w2"> </span>al-</div>
<div class="l f2 s4 c0" style="bottom:392.164px;top:391.82px;left:54px;">ternative<span class="w w1"> </span>compilation<span class="w w1"> </span>technique<span class="w w0"> </span>for<span class="w w1"> </span>dynamically-typed<span class="w w0"> </span>languages</div>
<div class="l f2 s4 c0" style="bottom:382.201px;top:401.783px;left:54px;">that<span class="w w1"> </span>identifies<span class="w w2"> </span>frequently<span class="w w1"> </span>executed<span class="w w1"> </span>loop<span class="w w2"> </span>traces<span class="w w1"> </span>at<span class="w w1"> </span>run-time<span class="w w1"> </span>and<span class="w w2"> </span>then</div>
<div class="l f2 s4 c0" style="bottom:372.238px;top:411.746px;left:54px;">generates<span class="w w1"> </span>machine<span class="w w0"> </span>code<span class="w w1"> </span>on<span class="w w1"> </span>the<span class="w w0"> </span>fly<span class="w w1"> </span>that<span class="w w1"> </span>is<span class="w w0"> </span>specialized<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w0"> </span>ac-</div>
<div class="l f2 s4 c0" style="bottom:362.276px;top:421.708px;left:54px;">tual<span class="w w1"> </span>dynamic<span class="w w1"> </span>types<span class="w w1"> </span>occurring<span class="w w1"> </span>on<span class="w w0"> </span>each<span class="w w2"> </span>path<span class="w w0"> </span>through<span class="w w1"> </span>the<span class="w w1"> </span>loop.<span class="w w1"> </span>Our</div>
<div class="l f2 s4 c0" style="bottom:352.313px;top:431.671px;left:54px;">method<span class="w w2"> </span>provides<span class="w w1"> </span>cheap<span class="w w2"> </span>inter-procedural<span class="w w1"> </span>type<span class="w w2"> </span>specialization,<span class="w w1"> </span>and<span class="w w2"> </span>an</div>
<div class="l f2 s4 c0" style="bottom:342.351px;top:441.633px;left:54px;">elegant<span class="w w2"> </span>and<span class="w w1"> </span>efficient<span class="w w2"> </span>way<span class="w w1"> </span>of<span class="w w2"> </span>incrementally<span class="w w1"> </span>compiling<span class="w w2"> </span>lazily<span class="w w1"> </span>discov-</div>
<div class="l f2 s4 c0" style="bottom:332.388px;top:451.596px;left:54px;">ered<span class="w w1"> </span>alternative<span class="w w2"> </span>paths<span class="w w1"> </span>through<span class="w w1"> </span>nested<span class="w w2"> </span>loops.<span class="w w1"> </span>We<span class="w w2"> </span>have<span class="w w1"> </span>implemented</div>
<div class="l f2 s4 c0" style="bottom:322.425px;top:461.559px;left:54px;">a<span class="w w1"> </span>dynamic<span class="w w2"> </span>compiler<span class="w w1"> </span>for<span class="w w1"> </span>JavaScript<span class="w w1"> </span>based<span class="w w1"> </span>on<span class="w w2"> </span>our<span class="w w1"> </span>technique<span class="w w1"> </span>and<span class="w w1"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:312.463px;top:471.521px;left:54px;">have<span class="w w1"> </span>measured<span class="w w1"> </span>speedups<span class="w w1"> </span>of<span class="w w0"> </span>10x<span class="w w1"> </span>and<span class="w w1"> </span>more<span class="w w1"> </span>for<span class="w w0"> </span>certain<span class="w w1"> </span>benchmark</div>
<div class="l f2 s4 c0" style="bottom:302.5px;top:481.484px;left:54px;">programs.</div>
<div class="l f9 s4 c0" style="bottom:286.959px;top:496.999px;left:54px;">Categories<span class="w w1"> </span>and<span class="w w0"> </span>Subject<span class="w w1"> </span>Descriptors</div>
<div class="l f2 s4 c0" style="bottom:286.896px;top:497.088px;left:196.549px;">D.3.4<span class="w w1"> </span>[</div>
<div class="l fa s4 c0" style="bottom:287.102px;top:497.178px;left:222.971px;">Programming<span class="w w1"> </span>Lan-</div>
<div class="l fa s4 c0" style="bottom:277.139px;top:507.14px;left:54px;">guages</div>
<div class="l f2 s4 c0" style="bottom:276.933px;top:507.051px;left:79.2223px;">]:<span class="w w2"> </span>Processors<span class="w w1"> </span>—</div>
<div class="l fa s4 c0" style="bottom:277.139px;top:507.14px;left:138.74px;">Incremental<span class="w w2"> </span>compilers,<span class="w w1"> </span>code<span class="w w2"> </span>generation</div>
<div class="l f2 s4 c0" style="bottom:276.933px;top:507.051px;left:281.528px;">.</div>
<div class="l f9 s4 c0" style="bottom:261.392px;top:522.565px;left:54px;">General<span class="w w1"> </span>Terms</div>
<div class="l f2 s4 c0" style="bottom:261.329px;top:522.655px;left:118.375px;">Design,<span class="w w1"> </span>Experimentation,<span class="w w1"> </span>Measurement,<span class="w w1"> </span>Perfor-</div>
<div class="l f2 s4 c0" style="bottom:251.366px;top:532.618px;left:54px;">mance.</div>
<div class="l f9 s4 c0" style="bottom:235.825px;top:548.132px;left:54px;">Keywords</div>
<div class="l f2 s4 c0" style="bottom:235.762px;top:548.222px;left:98.4728px;">JavaScript,<span class="w w2"> </span>just-in-time<span class="w w1"> </span>compilation,<span class="w w2"> </span>trace<span class="w w1"> </span>trees.</div>
<div class="l f1 s2 c0" style="bottom:212.831px;top:569.317px;left:54px;">1.<span class="w w3"> </span>Introduction</div>
<div class="l fa s4 c0" style="bottom:199.443px;top:584.837px;left:54px;">Dynamic<span class="w w2"> </span>languages</div>
<div class="l f2 s4 c0" style="bottom:199.237px;top:584.747px;left:127.024px;">such<span class="w w2"> </span>as<span class="w w1"> </span>JavaScript,<span class="w w2"> </span>Python,<span class="w w2"> </span>and<span class="w w1"> </span>Ruby,<span class="w w2"> </span>are<span class="w w2"> </span>pop-</div>
<div class="l f2 s4 c0" style="bottom:189.274px;top:594.71px;left:54px;">ular<span class="w w2"> </span>since<span class="w w1"> </span>they<span class="w w1"> </span>are<span class="w w2"> </span>expressive,<span class="w w1"> </span>accessible<span class="w w2"> </span>to<span class="w w1"> </span>non-experts,<span class="w w1"> </span>and<span class="w w2"> </span>make</div>
<div class="l f2 s4 c0" style="bottom:179.311px;top:604.673px;left:54px;">deployment<span class="w w1"> </span>as<span class="w w2"> </span>easy<span class="w w1"> </span>as<span class="w w1"> </span>distributing<span class="w w1"> </span>a<span class="w w1"> </span>source<span class="w w2"> </span>file.<span class="w w1"> </span>They<span class="w w1"> </span>are<span class="w w1"> </span>used<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:169.349px;top:614.635px;left:54px;">small<span class="w w1"> </span>scripts<span class="w w0"> </span>as<span class="w w1"> </span>well<span class="w w1"> </span>as<span class="w w1"> </span>for<span class="w w0"> </span>complex<span class="w w1"> </span>applications.<span class="w w1"> </span>JavaScript,<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:159.386px;top:624.598px;left:54px;">example,<span class="w w2"> </span>is<span class="w w1"> </span>the<span class="w w1"> </span>de<span class="w w1"> </span>facto<span class="w w2"> </span>standard<span class="w w1"> </span>for<span class="w w1"> </span>client-side<span class="w w2"> </span>web<span class="w w1"> </span>programming</div>
<div class="l f2 s6 c0" style="bottom:118.26px;top:667.505px;left:54px;">Permission<span class="w w2"> </span>to<span class="w w1"> </span>make<span class="w w1"> </span>digital<span class="w w2"> </span>or<span class="w w1"> </span>hard<span class="w w1"> </span>copies<span class="w w2"> </span>of<span class="w w1"> </span>all<span class="w w1"> </span>or<span class="w w2"> </span>part<span class="w w1"> </span>of<span class="w w1"> </span>this<span class="w w2"> </span>work<span class="w w1"> </span>for<span class="w w1"> </span>personal<span class="w w2"> </span>or</div>
<div class="l f2 s6 c0" style="bottom:110.29px;top:675.475px;left:54px;">classroom<span class="w w2"> </span>use<span class="w w1"> </span>is<span class="w w2"> </span>granted<span class="w w2"> </span>without<span class="w w1"> </span>fee<span class="w w2"> </span>provided<span class="w w1"> </span>that<span class="w w2"> </span>copies<span class="w w2"> </span>are<span class="w w1"> </span>not<span class="w w2"> </span>made<span class="w w1"> </span>or<span class="w w2"> </span>distributed</div>
<div class="l f2 s6 c0" style="bottom:102.32px;top:683.446px;left:54px;">for<span class="w w2"> </span>profit<span class="w w2"> </span>or<span class="w w2"> </span>commercial<span class="w w2"> </span>advantage<span class="w w2"> </span>and<span class="w w1"> </span>that<span class="w w2"> </span>copies<span class="w w2"> </span>bear<span class="w w2"> </span>this<span class="w w2"> </span>notice<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w2"> </span>full<span class="w w2"> </span>citation</div>
<div class="l f2 s6 c0" style="bottom:94.3498px;top:691.416px;left:54px;">on<span class="w w2"> </span>the<span class="w w1"> </span>first<span class="w w2"> </span>page.<span class="w w2"> </span>To<span class="w w2"> </span>copy<span class="w w1"> </span>otherwise,<span class="w w2"> </span>to<span class="w w2"> </span>republish,<span class="w w1"> </span>to<span class="w w2"> </span>post<span class="w w1"> </span>on<span class="w w2"> </span>servers<span class="w w2"> </span>or<span class="w w1"> </span>to<span class="w w2"> </span>redistribute</div>
<div class="l f2 s6 c0" style="bottom:86.3797px;top:699.386px;left:54px;">to<span class="w w2"> </span>lists,<span class="w w2"> </span>requires<span class="w w1"> </span>prior<span class="w w2"> </span>specific<span class="w w2"> </span>permission<span class="w w2"> </span>and/or<span class="w w1"> </span>a<span class="w w2"> </span>fee.</div>
<div class="l fb s6 c0" style="bottom:76.4171px;top:709.348px;left:54px;">PLDI’09,</div>
<div class="l f2 s6 c0" style="bottom:76.4171px;top:709.348px;left:87.6277px;">June<span class="w w2"> </span>15–20,<span class="w w2"> </span>2009,<span class="w w1"> </span>Dublin,<span class="w w2"> </span>Ireland.</div>
<div class="l f2 s6 c0" style="bottom:68.447px;top:717.318px;left:54px;">Copyright<span class="w w0"> </span>c</div>
<div class="l fc s6 c0" style="bottom:68.6004px;top:716.816px;left:83.9594px;"></div>
<div class="l f2 s6 c0" style="bottom:68.447px;top:717.318px;left:93.6453px;">2009<span class="w w2"> </span>ACM<span class="w w2"> </span>978-1-60558-392-1/09/06.<span class="w w2"> </span>.<span class="w w2"> </span>.$5.00</div>
<div class="l f2 s4 c0" style="bottom:445.962px;top:338.022px;left:317.014px;">and<span class="w w1"> </span>is<span class="w w2"> </span>used<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>application<span class="w w2"> </span>logic<span class="w w1"> </span>of<span class="w w1"> </span>browser-based<span class="w w2"> </span>productivity</div>
<div class="l f2 s4 c0" style="bottom:435.999px;top:347.985px;left:317.014px;">applications<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w1"> </span>Google<span class="w w1"> </span>Mail,<span class="w w1"> </span>Google<span class="w w0"> </span>Docs<span class="w w2"> </span>and<span class="w w1"> </span>Zimbra<span class="w w0"> </span>Col-</div>
<div class="l f2 s4 c0" style="bottom:426.037px;top:357.947px;left:317.014px;">laboration<span class="w w1"> </span>Suite.<span class="w w0"> </span>In<span class="w w1"> </span>this<span class="w w1"> </span>domain,<span class="w w0"> </span>in<span class="w w1"> </span>order<span class="w w1"> </span>to<span class="w w0"> </span>provide<span class="w w1"> </span>a<span class="w w1"> </span>fluid<span class="w w0"> </span>user</div>
<div class="l f2 s4 c0" style="bottom:416.074px;top:367.91px;left:317.014px;">experience<span class="w w2"> </span>and<span class="w w2"> </span>enable<span class="w w1"> </span>a<span class="w w2"> </span>new<span class="w w2"> </span>generation<span class="w w1"> </span>of<span class="w w2"> </span>applications,<span class="w w1"> </span>virtual<span class="w w2"> </span>ma-</div>
<div class="l f2 s4 c0" style="bottom:406.111px;top:377.873px;left:317.014px;">chines<span class="w w2"> </span>must<span class="w w1"> </span>provide<span class="w w1"> </span>a<span class="w w2"> </span>low<span class="w w1"> </span>startup<span class="w w2"> </span>time<span class="w w1"> </span>and<span class="w w1"> </span>high<span class="w w2"> </span>performance.</div>
<div class="l f2 s4 c0" style="bottom:396.149px;top:387.835px;left:328.969px;">Compilers<span class="w w1"> </span>for<span class="w w1"> </span>statically<span class="w w1"> </span>typed<span class="w w1"> </span>languages<span class="w w1"> </span>rely<span class="w w1"> </span>on<span class="w w2"> </span>type<span class="w w1"> </span>informa-</div>
<div class="l f2 s4 c0" style="bottom:386.186px;top:397.798px;left:317.014px;">tion<span class="w w2"> </span>to<span class="w w2"> </span>generate<span class="w w1"> </span>efficient<span class="w w2"> </span>machine<span class="w w2"> </span>code.<span class="w w1"> </span>In<span class="w w2"> </span>a<span class="w w2"> </span>dynamically<span class="w w1"> </span>typed<span class="w w2"> </span>pro-</div>
<div class="l f2 s4 c0" style="bottom:376.224px;top:407.76px;left:317.014px;">gramming<span class="w w1"> </span>language<span class="w w0"> </span>such<span class="w w1"> </span>as<span class="w w0"> </span>JavaScript,<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w0"> </span>of<span class="w w1"> </span>expressions</div>
<div class="l f2 s4 c0" style="bottom:366.261px;top:417.723px;left:317.014px;">may<span class="w w1"> </span>vary<span class="w w1"> </span>at<span class="w w1"> </span>runtime.<span class="w w1"> </span>This<span class="w w1"> </span>means<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>compiler<span class="w w2"> </span>can<span class="w w1"> </span>no<span class="w w0"> </span>longer</div>
<div class="l f2 s4 c0" style="bottom:356.298px;top:427.686px;left:317.014px;">easily<span class="w w1"> </span>transform<span class="w w1"> </span>operations<span class="w w1"> </span>into<span class="w w1"> </span>machine<span class="w w1"> </span>instructions<span class="w w1"> </span>that<span class="w w1"> </span>operate</div>
<div class="l f2 s4 c0" style="bottom:346.336px;top:437.648px;left:317.014px;">on<span class="w w1"> </span>one<span class="w w2"> </span>specific<span class="w w1"> </span>type.<span class="w w1"> </span>Without<span class="w w2"> </span>exact<span class="w w1"> </span>type<span class="w w1"> </span>information,<span class="w w2"> </span>the<span class="w w1"> </span>compiler</div>
<div class="l f2 s4 c0" style="bottom:336.373px;top:447.611px;left:317.014px;">must<span class="w w1"> </span>emit<span class="w w1"> </span>slower<span class="w w1"> </span>generalized<span class="w w1"> </span>machine<span class="w w1"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>can<span class="w w1"> </span>deal<span class="w w1"> </span>with<span class="w w1"> </span>all</div>
<div class="l f2 s4 c0" style="bottom:326.41px;top:457.574px;left:317.014px;">potential<span class="w w1"> </span>type<span class="w w2"> </span>combinations.<span class="w w1"> </span>While<span class="w w1"> </span>compile-time<span class="w w1"> </span>static<span class="w w1"> </span>type<span class="w w1"> </span>infer-</div>
<div class="l f2 s4 c0" style="bottom:316.448px;top:467.536px;left:317.014px;">ence<span class="w w1"> </span>might<span class="w w0"> </span>be<span class="w w0"> </span>able<span class="w w1"> </span>to<span class="w w0"> </span>gather<span class="w w1"> </span>type<span class="w w0"> </span>information<span class="w w1"> </span>to<span class="w w0"> </span>generate<span class="w w1"> </span>opti-</div>
<div class="l f2 s4 c0" style="bottom:306.485px;top:477.499px;left:317.014px;">mized<span class="w w1"> </span>machine<span class="w w1"> </span>code,<span class="w w0"> </span>traditional<span class="w w1"> </span>static<span class="w w1"> </span>analysis<span class="w w0"> </span>is<span class="w w1"> </span>very<span class="w w1"> </span>expensive</div>
<div class="l f2 s4 c0" style="bottom:296.522px;top:487.462px;left:317.014px;">and<span class="w w2"> </span>hence<span class="w w1"> </span>not<span class="w w1"> </span>well<span class="w w2"> </span>suited<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>highly<span class="w w1"> </span>interactive<span class="w w2"> </span>environment<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:286.56px;top:497.424px;left:317.014px;">a<span class="w w2"> </span>web<span class="w w1"> </span>browser.</div>
<div class="l f2 s4 c0" style="bottom:276.597px;top:507.387px;left:328.969px;">We<span class="w w1"> </span>present<span class="w w0"> </span>a<span class="w w1"> </span>trace-based<span class="w w0"> </span>compilation<span class="w w1"> </span>technique<span class="w w0"> </span>for<span class="w w1"> </span>dynamic</div>
<div class="l f2 s4 c0" style="bottom:266.635px;top:517.349px;left:317.014px;">languages<span class="w w1"> </span>that<span class="w w2"> </span>reconciles<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w1"> </span>compilation<span class="w w1"> </span>with<span class="w w1"> </span>excellent<span class="w w2"> </span>per-</div>
<div class="l f2 s4 c0" style="bottom:256.672px;top:527.312px;left:317.014px;">formance<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>generated<span class="w w2"> </span>machine<span class="w w1"> </span>code.<span class="w w2"> </span>Our<span class="w w2"> </span>system<span class="w w1"> </span>uses<span class="w w2"> </span>a<span class="w w2"> </span>mixed-</div>
<div class="l f2 s4 c0" style="bottom:246.709px;top:537.275px;left:317.014px;">mode<span class="w w2"> </span>execution<span class="w w1"> </span>approach:<span class="w w2"> </span>the<span class="w w1"> </span>system<span class="w w2"> </span>starts<span class="w w1"> </span>running<span class="w w2"> </span>JavaScript<span class="w w2"> </span>in<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:236.747px;top:547.237px;left:317.014px;">fast-starting<span class="w w1"> </span>bytecode<span class="w w2"> </span>interpreter.<span class="w w1"> </span>As<span class="w w1"> </span>the<span class="w w2"> </span>program<span class="w w1"> </span>runs,<span class="w w1"> </span>the<span class="w w1"> </span>system</div>
<div class="l f2 s4 c0" style="bottom:226.784px;top:557.2px;left:317.014px;">identifies</div>
<div class="l fa s4 c0" style="bottom:226.99px;top:557.29px;left:353.699px;">hot</div>
<div class="l f2 s4 c0" style="bottom:226.784px;top:557.2px;left:369.125px;">(frequently<span class="w w0"> </span>executed)<span class="w w1"> </span>bytecode<span class="w w0"> </span>sequences,<span class="w w1"> </span>records</div>
<div class="l f2 s4 c0" style="bottom:216.821px;top:567.163px;left:317.014px;">them,<span class="w w1"> </span>and<span class="w w0"> </span>compiles<span class="w w1"> </span>them<span class="w w1"> </span>to<span class="w w0"> </span>fast<span class="w w1"> </span>native<span class="w w1"> </span>code.<span class="w w1"> </span>We<span class="w w1"> </span>call<span class="w w1"> </span>such<span class="w w0"> </span>a<span class="w w1"> </span>se-</div>
<div class="l f2 s4 c0" style="bottom:206.859px;top:577.125px;left:317.014px;">quence<span class="w w2"> </span>of<span class="w w1"> </span>instructions<span class="w w1"> </span>a</div>
<div class="l fa s4 c0" style="bottom:207.065px;top:577.215px;left:404.668px;">trace</div>
<div class="l f2 s4 c0" style="bottom:206.859px;top:577.125px;left:422.959px;">.</div>
<div class="l f2 s4 c0" style="bottom:196.896px;top:587.088px;left:328.969px;">Unlike<span class="w w1"> </span>method-based<span class="w w0"> </span>dynamic<span class="w w0"> </span>compilers,<span class="w w1"> </span>our<span class="w w0"> </span>dynamic<span class="w w0"> </span>com-</div>
<div class="l f2 s4 c0" style="bottom:186.933px;top:597.051px;left:317.014px;">piler<span class="w w1"> </span>operates<span class="w w0"> </span>at<span class="w w1"> </span>the<span class="w w0"> </span>granularity<span class="w w1"> </span>of<span class="w w1"> </span>individual<span class="w w0"> </span>loops.<span class="w w1"> </span>This<span class="w w0"> </span>design</div>
<div class="l f2 s4 c0" style="bottom:176.971px;top:607.013px;left:317.014px;">choice<span class="w w1"> </span>is<span class="w w0"> </span>based<span class="w w1"> </span>on<span class="w w0"> </span>the<span class="w w1"> </span>expectation<span class="w w1"> </span>that<span class="w w0"> </span>programs<span class="w w1"> </span>spend<span class="w w0"> </span>most<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:167.008px;top:616.976px;left:317.014px;">their<span class="w w1"> </span>time<span class="w w1"> </span>in<span class="w w1"> </span>hot<span class="w w1"> </span>loops.<span class="w w1"> </span>Even<span class="w w1"> </span>in<span class="w w1"> </span>dynamically<span class="w w1"> </span>typed<span class="w w1"> </span>languages,<span class="w w0"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:157.045px;top:626.939px;left:317.014px;">expect<span class="w w2"> </span>hot<span class="w w1"> </span>loops<span class="w w2"> </span>to<span class="w w2"> </span>be<span class="w w1"> </span>mostly</div>
<div class="l fa s4 c0" style="bottom:157.252px;top:627.028px;left:422.929px;">type-stable</div>
<div class="l f2 s4 c0" style="bottom:157.045px;top:626.939px;left:462.273px;">,<span class="w w2"> </span>meaning<span class="w w1"> </span>that<span class="w w2"> </span>the<span class="w w1"> </span>types<span class="w w2"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:147.083px;top:636.901px;left:317.014px;">values<span class="w w2"> </span>are<span class="w w2"> </span>invariant.<span class="w w2"> </span>(12)<span class="w w1"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>we<span class="w w2"> </span>would<span class="w w2"> </span>expect<span class="w w1"> </span>loop<span class="w w2"> </span>coun-</div>
<div class="l f2 s4 c0" style="bottom:137.12px;top:646.864px;left:317.014px;">ters<span class="w w2"> </span>that<span class="w w1"> </span>start<span class="w w1"> </span>as<span class="w w2"> </span>integers<span class="w w1"> </span>to<span class="w w1"> </span>remain<span class="w w2"> </span>integers<span class="w w1"> </span>for<span class="w w2"> </span>all<span class="w w1"> </span>iterations.<span class="w w1"> </span>When</div>
<div class="l f2 s4 c0" style="bottom:127.158px;top:656.826px;left:317.014px;">both<span class="w w1"> </span>of<span class="w w1"> </span>these<span class="w w1"> </span>expectations<span class="w w1"> </span>hold,<span class="w w1"> </span>a<span class="w w1"> </span>trace-based<span class="w w1"> </span>compiler<span class="w w1"> </span>can<span class="w w1"> </span>cover</div>
<div class="l f2 s4 c0" style="bottom:117.195px;top:666.789px;left:317.014px;">the<span class="w w2"> </span>program<span class="w w1"> </span>execution<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>small<span class="w w1"> </span>number<span class="w w2"> </span>of<span class="w w1"> </span>type-specialized,<span class="w w2"> </span>ef-</div>
<div class="l f2 s4 c0" style="bottom:107.232px;top:676.752px;left:317.014px;">ficiently<span class="w w2"> </span>compiled<span class="w w1"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:97.2697px;top:686.714px;left:328.969px;">Each<span class="w w1"> </span>compiled<span class="w w2"> </span>trace<span class="w w1"> </span>covers<span class="w w1"> </span>one<span class="w w2"> </span>path<span class="w w1"> </span>through<span class="w w1"> </span>the<span class="w w1"> </span>program<span class="w w2"> </span>with</div>
<div class="l f2 s4 c0" style="bottom:87.307px;top:696.677px;left:317.014px;">one<span class="w w2"> </span>mapping<span class="w w1"> </span>of<span class="w w2"> </span>values<span class="w w2"> </span>to<span class="w w1"> </span>types.<span class="w w2"> </span>When<span class="w w1"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>executes<span class="w w2"> </span>a<span class="w w2"> </span>compiled</div>
<div class="l f2 s4 c0" style="bottom:77.3444px;top:706.64px;left:317.014px;">trace,<span class="w w0"> </span>it<span class="w w0"> </span>cannot<span class="w w0"> </span>guarantee<span class="w w0"> </span>that<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w0"> </span>path<span class="w w0"> </span>will<span class="w w0"> </span>be<span class="w w0"> </span>followed</div>
<div class="l f2 s4 c0" style="bottom:67.3818px;top:716.602px;left:317.014px;">or<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w1"> </span>types<span class="w w0"> </span>will<span class="w w1"> </span>occur<span class="w w0"> </span>in<span class="w w0"> </span>subsequent<span class="w w1"> </span>loop<span class="w w0"> </span>iterations.</div>
</div>
<div id="page-2" class="p" style="width:612px;height:792px;background-image:url(p2.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:54px;">Hence,<span class="w w2"> </span>recording<span class="w w2"> </span>and<span class="w w1"> </span>compiling<span class="w w2"> </span>a<span class="w w1"> </span>trace</div>
<div class="l fa s4 c0" style="bottom:710.299px;top:73.9805px;left:195.461px;">speculates</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:234.688px;">that<span class="w w2"> </span>the<span class="w w2"> </span>path<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:54px;">typing<span class="w w2"> </span>will<span class="w w1"> </span>be<span class="w w2"> </span>exactly<span class="w w2"> </span>as<span class="w w1"> </span>they<span class="w w2"> </span>were<span class="w w1"> </span>during<span class="w w2"> </span>recording<span class="w w2"> </span>for<span class="w w1"> </span>subsequent</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:54px;">iterations<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>loop.</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:65.9552px;">Every<span class="w w1"> </span>compiled<span class="w w2"> </span>trace<span class="w w1"> </span>contains<span class="w w1"> </span>all<span class="w w1"> </span>the</div>
<div class="l fa s4 c0" style="bottom:680.411px;top:103.868px;left:203.17px;">guards</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:230.303px;">(checks)<span class="w w1"> </span>required</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:54px;">to<span class="w w1"> </span>validate<span class="w w0"> </span>the<span class="w w1"> </span>speculation.<span class="w w0"> </span>If<span class="w w1"> </span>one<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>guards<span class="w w1"> </span>fails<span class="w w0"> </span>(if<span class="w w1"> </span>control</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:54px;">flow<span class="w w1"> </span>is<span class="w w1"> </span>different,<span class="w w0"> </span>or<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w1"> </span>of<span class="w w0"> </span>a<span class="w w1"> </span>different<span class="w w1"> </span>type<span class="w w1"> </span>is<span class="w w0"> </span>generated),<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:54px;">trace<span class="w w1"> </span>exits.<span class="w w0"> </span>If<span class="w w1"> </span>an<span class="w w1"> </span>exit<span class="w w1"> </span>becomes<span class="w w0"> </span>hot,<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w0"> </span>can<span class="w w1"> </span>record<span class="w w1"> </span>a</div>
<div class="l fa s4 c0" style="bottom:650.523px;top:133.756px;left:267.971px;">branch</div>
<div class="l fa s4 c0" style="bottom:640.561px;top:143.719px;left:54px;">trace</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:74.4956px;">starting<span class="w w2"> </span>at<span class="w w1"> </span>the<span class="w w1"> </span>exit<span class="w w2"> </span>to<span class="w w1"> </span>cover<span class="w w2"> </span>the<span class="w w1"> </span>new<span class="w w2"> </span>path.<span class="w w1"> </span>In<span class="w w2"> </span>this<span class="w w1"> </span>way,<span class="w w2"> </span>the<span class="w w1"> </span>VM</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:54px;">records<span class="w w2"> </span>a</div>
<div class="l fa s4 c0" style="bottom:630.598px;top:153.682px;left:88.852px;">trace<span class="w w2"> </span>tree</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:125.237px;">covering<span class="w w2"> </span>all<span class="w w1"> </span>the<span class="w w2"> </span>hot<span class="w w1"> </span>paths<span class="w w1"> </span>through<span class="w w2"> </span>the<span class="w w1"> </span>loop.</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:65.9552px;">Nested<span class="w w1"> </span>loops<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w1"> </span>difficult<span class="w w1"> </span>to<span class="w w0"> </span>optimize<span class="w w1"> </span>for<span class="w w1"> </span>tracing<span class="w w1"> </span>VMs.<span class="w w0"> </span>In</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:54px;">a<span class="w w1"> </span>na¨</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:69.6272px;">ıve<span class="w w1"> </span>implementation,<span class="w w1"> </span>inner<span class="w w0"> </span>loops<span class="w w1"> </span>would<span class="w w1"> </span>become<span class="w w1"> </span>hot<span class="w w0"> </span>first,<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:54px;">the<span class="w w1"> </span>VM<span class="w w1"> </span>would<span class="w w1"> </span>start<span class="w w0"> </span>tracing<span class="w w1"> </span>there.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>exits,<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:54px;">VM<span class="w w2"> </span>would<span class="w w1"> </span>detect<span class="w w2"> </span>that<span class="w w1"> </span>a<span class="w w2"> </span>different<span class="w w2"> </span>branch<span class="w w1"> </span>was<span class="w w2"> </span>taken.<span class="w w1"> </span>The<span class="w w2"> </span>VM<span class="w w1"> </span>would</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:54px;">try<span class="w w1"> </span>to<span class="w w2"> </span>record<span class="w w1"> </span>a<span class="w w1"> </span>branch<span class="w w1"> </span>trace,<span class="w w1"> </span>and<span class="w w1"> </span>find<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>reaches<span class="w w1"> </span>not<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:54px;">inner<span class="w w1"> </span>loop<span class="w w2"> </span>header,<span class="w w1"> </span>but<span class="w w2"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w1"> </span>header.<span class="w w2"> </span>At<span class="w w1"> </span>this<span class="w w2"> </span>point,<span class="w w1"> </span>the<span class="w w1"> </span>VM</div>
<div class="l f2 s4 c0" style="bottom:560.654px;top:223.33px;left:54px;">could<span class="w w1"> </span>continue<span class="w w2"> </span>tracing<span class="w w1"> </span>until<span class="w w1"> </span>it<span class="w w1"> </span>reaches<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w2"> </span>again,</div>
<div class="l f2 s4 c0" style="bottom:550.691px;top:233.293px;left:54px;">thus<span class="w w1"> </span>tracing<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w0"> </span>inside<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>tree<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w0"> </span>loop.</div>
<div class="l f2 s4 c0" style="bottom:540.728px;top:243.256px;left:54px;">But<span class="w w2"> </span>this<span class="w w1"> </span>requires<span class="w w2"> </span>tracing<span class="w w1"> </span>a<span class="w w2"> </span>copy<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>for<span class="w w1"> </span>every<span class="w w2"> </span>side<span class="w w2"> </span>exit</div>
<div class="l f2 s4 c0" style="bottom:530.766px;top:253.218px;left:54px;">and<span class="w w1"> </span>type<span class="w w1"> </span>combination<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop.<span class="w w1"> </span>In<span class="w w1"> </span>essence,<span class="w w1"> </span>this<span class="w w1"> </span>is<span class="w w1"> </span>a<span class="w w0"> </span>form</div>
<div class="l f2 s4 c0" style="bottom:520.803px;top:263.181px;left:54px;">of<span class="w w1"> </span>unintended<span class="w w1"> </span>tail<span class="w w2"> </span>duplication,<span class="w w1"> </span>which<span class="w w1"> </span>can<span class="w w1"> </span>easily<span class="w w1"> </span>overflow<span class="w w2"> </span>the<span class="w w1"> </span>code</div>
<div class="l f2 s4 c0" style="bottom:510.84px;top:273.144px;left:54px;">cache.<span class="w w2"> </span>Alternatively,<span class="w w2"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>could<span class="w w2"> </span>simply<span class="w w2"> </span>stop<span class="w w1"> </span>tracing,<span class="w w2"> </span>and<span class="w w1"> </span>give<span class="w w2"> </span>up</div>
<div class="l f2 s4 c0" style="bottom:500.878px;top:283.106px;left:54px;">on<span class="w w2"> </span>ever<span class="w w1"> </span>tracing<span class="w w2"> </span>outer<span class="w w1"> </span>loops.</div>
<div class="l f2 s4 c0" style="bottom:490.915px;top:293.069px;left:65.9552px;">We<span class="w w1"> </span>solve<span class="w w1"> </span>the<span class="w w0"> </span>nested<span class="w w1"> </span>loop<span class="w w0"> </span>problem<span class="w w1"> </span>by<span class="w w0"> </span>recording</div>
<div class="l fa s4 c0" style="bottom:491.121px;top:293.159px;left:248.302px;">nested<span class="w w1"> </span>trace</div>
<div class="l fa s4 c0" style="bottom:481.159px;top:303.121px;left:54px;">trees</div>
<div class="l f2 s4 c0" style="bottom:480.952px;top:303.032px;left:71.0985px;">.<span class="w w2"> </span>Our<span class="w w1"> </span>system<span class="w w2"> </span>traces<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>loop<span class="w w2"> </span>exactly<span class="w w1"> </span>as<span class="w w2"> </span>the<span class="w w1"> </span>na¨</div>
<div class="l f2 s4 c0" style="bottom:480.952px;top:303.032px;left:251.713px;">ıve<span class="w w2"> </span>version.</div>
<div class="l f2 s4 c0" style="bottom:470.99px;top:312.994px;left:54px;">The<span class="w w2"> </span>system<span class="w w1"> </span>stops<span class="w w1"> </span>extending<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>when<span class="w w2"> </span>it<span class="w w1"> </span>reaches<span class="w w1"> </span>an<span class="w w2"> </span>outer</div>
<div class="l f2 s4 c0" style="bottom:461.027px;top:322.957px;left:54px;">loop,<span class="w w1"> </span>but<span class="w w1"> </span>then<span class="w w1"> </span>it<span class="w w1"> </span>starts<span class="w w1"> </span>a<span class="w w1"> </span>new<span class="w w2"> </span>trace<span class="w w1"> </span>at<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop<span class="w w1"> </span>header.<span class="w w1"> </span>When</div>
<div class="l f2 s4 c0" style="bottom:451.065px;top:332.919px;left:54px;">the<span class="w w2"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>reaches<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>loop<span class="w w2"> </span>header,<span class="w w2"> </span>the<span class="w w1"> </span>system<span class="w w2"> </span>tries<span class="w w1"> </span>to<span class="w w2"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:441.102px;top:342.882px;left:54px;">the<span class="w w2"> </span>trace<span class="w w2"> </span>tree<span class="w w1"> </span>for<span class="w w2"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>loop.<span class="w w2"> </span>If<span class="w w2"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>succeeds,<span class="w w2"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>records</div>
<div class="l f2 s4 c0" style="bottom:431.139px;top:352.845px;left:54px;">the<span class="w w0"> </span>call<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>inner<span class="w w0"> </span>tree<span class="w w0"> </span>as<span class="w w1"> </span>part<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>outer<span class="w w0"> </span>trace<span class="w w1"> </span>and<span class="w w0"> </span>finishes</div>
<div class="l f2 s4 c0" style="bottom:421.177px;top:362.807px;left:54px;">the<span class="w w1"> </span>outer<span class="w w0"> </span>trace<span class="w w1"> </span>as<span class="w w1"> </span>normal.<span class="w w0"> </span>In<span class="w w1"> </span>this<span class="w w0"> </span>way</div>
<div class="l f2 s4 c0" style="bottom:421.177px;top:362.807px;left:194.36px;">,<span class="w w1"> </span>our<span class="w w0"> </span>system<span class="w w1"> </span>can<span class="w w1"> </span>trace<span class="w w0"> </span>any</div>
<div class="l f2 s4 c0" style="bottom:411.214px;top:372.77px;left:54px;">number<span class="w w2"> </span>of<span class="w w1"> </span>loops<span class="w w1"> </span>nested<span class="w w2"> </span>to<span class="w w1"> </span>any<span class="w w2"> </span>depth<span class="w w1"> </span>without<span class="w w1"> </span>causing<span class="w w2"> </span>excessive<span class="w w2"> </span>tail</div>
<div class="l f2 s4 c0" style="bottom:401.251px;top:382.733px;left:54px;">duplication.</div>
<div class="l f2 s4 c0" style="bottom:391.289px;top:392.695px;left:65.9552px;">These<span class="w w1"> </span>techniques<span class="w w1"> </span>allow<span class="w w0"> </span>a<span class="w w1"> </span>VM<span class="w w1"> </span>to<span class="w w1"> </span>dynamically<span class="w w0"> </span>translate<span class="w w1"> </span>a<span class="w w1"> </span>pro-</div>
<div class="l f2 s4 c0" style="bottom:381.326px;top:402.658px;left:54px;">gram<span class="w w0"> </span>to<span class="w w1"> </span>nested,<span class="w w0"> </span>type-specialized<span class="w w1"> </span>trace<span class="w w0"> </span>trees.<span class="w w0"> </span>Because<span class="w w1"> </span>traces<span class="w w0"> </span>can</div>
<div class="l f2 s4 c0" style="bottom:371.363px;top:412.621px;left:54px;">cross<span class="w w1"> </span>function<span class="w w1"> </span>call<span class="w w2"> </span>boundaries,<span class="w w1"> </span>our<span class="w w1"> </span>techniques<span class="w w1"> </span>also<span class="w w1"> </span>achieve<span class="w w1"> </span>the<span class="w w1"> </span>ef-</div>
<div class="l f2 s4 c0" style="bottom:361.401px;top:422.583px;left:54px;">fects<span class="w w2"> </span>of<span class="w w1"> </span>inlining.<span class="w w2"> </span>Because<span class="w w2"> </span>traces<span class="w w1"> </span>have<span class="w w2"> </span>no<span class="w w2"> </span>internal<span class="w w1"> </span>control-flow<span class="w w2"> </span>joins,</div>
<div class="l f2 s4 c0" style="bottom:351.438px;top:432.546px;left:54px;">they<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w1"> </span>optimized<span class="w w1"> </span>in<span class="w w0"> </span>linear<span class="w w1"> </span>time<span class="w w0"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>simple<span class="w w0"> </span>compiler<span class="w w1"> </span>(10).</div>
<div class="l f2 s4 c0" style="bottom:341.475px;top:442.509px;left:54px;">Thus,<span class="w w1"> </span>our<span class="w w0"> </span>tracing<span class="w w1"> </span>VM<span class="w w0"> </span>efficiently<span class="w w1"> </span>performs<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w1"> </span>kind<span class="w w1"> </span>of<span class="w w0"> </span>op-</div>
<div class="l f2 s4 c0" style="bottom:331.513px;top:452.471px;left:54px;">timizations<span class="w w1"> </span>that<span class="w w1"> </span>would<span class="w w1"> </span>require<span class="w w0"> </span>interprocedural<span class="w w1"> </span>analysis<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>static</div>
<div class="l f2 s4 c0" style="bottom:321.55px;top:462.434px;left:54px;">optimization<span class="w w2"> </span>setting.<span class="w w1"> </span>This<span class="w w1"> </span>makes<span class="w w1"> </span>tracing<span class="w w2"> </span>an<span class="w w1"> </span>attractive<span class="w w2"> </span>and<span class="w w1"> </span>effective</div>
<div class="l f2 s4 c0" style="bottom:311.588px;top:472.396px;left:54px;">tool<span class="w w2"> </span>to<span class="w w1"> </span>type<span class="w w1"> </span>specialize<span class="w w2"> </span>even<span class="w w1"> </span>complex<span class="w w2"> </span>function<span class="w w1"> </span>call-rich<span class="w w2"> </span>code.</div>
<div class="l f2 s4 c0" style="bottom:301.625px;top:482.359px;left:65.9552px;">We<span class="w w2"> </span>implemented<span class="w w2"> </span>these<span class="w w1"> </span>techniques<span class="w w1"> </span>for<span class="w w2"> </span>an<span class="w w1"> </span>existing<span class="w w2"> </span>JavaScript<span class="w w1"> </span>in-</div>
<div class="l f2 s4 c0" style="bottom:291.662px;top:492.322px;left:54px;">terpreter,<span class="w w1"> </span>SpiderMonkey</div>
<div class="l f2 s4 c0" style="bottom:291.662px;top:492.322px;left:141.548px;">.<span class="w w1"> </span>We<span class="w w2"> </span>call<span class="w w1"> </span>the<span class="w w1"> </span>resulting<span class="w w1"> </span>tracing<span class="w w0"> </span>VM</div>
<div class="l fa s4 c0" style="bottom:291.868px;top:492.411px;left:269.827px;">Trace-</div>
<div class="l fa s4 c0" style="bottom:281.906px;top:502.374px;left:54px;">Monkey</div>
<div class="l f2 s4 c0" style="bottom:281.7px;top:502.284px;left:82.0198px;">.<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>supports<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>JavaScript<span class="w w1"> </span>features<span class="w w2"> </span>of<span class="w w1"> </span>Spi-</div>
<div class="l f2 s4 c0" style="bottom:271.737px;top:512.247px;left:54px;">derMonkey,<span class="w w2"> </span>with<span class="w w2"> </span>a<span class="w w1"> </span>2x-20x<span class="w w1"> </span>speedup<span class="w w2"> </span>for<span class="w w1"> </span>traceable<span class="w w1"> </span>programs.</div>
<div class="l f2 s4 c0" style="bottom:261.774px;top:522.21px;left:65.9552px;">This<span class="w w2"> </span>paper<span class="w w1"> </span>makes<span class="w w1"> </span>the<span class="w w2"> </span>following<span class="w w1"> </span>contributions:</div>
<div class="l f3 s3 c0" style="bottom:244.134px;top:540.342px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:242.845px;top:541.139px;left:66.9514px;">We<span class="w w2"> </span>explain<span class="w w2"> </span>an<span class="w w1"> </span>algorithm<span class="w w1"> </span>for<span class="w w2"> </span>dynamically<span class="w w1"> </span>forming<span class="w w2"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:232.883px;top:551.101px;left:66.9514px;">cover<span class="w w2"> </span>a<span class="w w2"> </span>program,<span class="w w1"> </span>representing<span class="w w2"> </span>nested<span class="w w2"> </span>loops<span class="w w2"> </span>as<span class="w w1"> </span>nested<span class="w w2"> </span>trace<span class="w w2"> </span>trees.</div>
<div class="l f3 s3 c0" style="bottom:220.224px;top:564.252px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:218.935px;top:565.049px;left:66.9514px;">Weexplain<span class="w w1"> </span>how<span class="w w2"> </span>to<span class="w w2"> </span>speculatively<span class="w w2"> </span>generate<span class="w w2"> </span>efficient<span class="w w2"> </span>type-specialized</div>
<div class="l f2 s4 c0" style="bottom:208.972px;top:575.012px;left:66.9514px;">code<span class="w w2"> </span>for<span class="w w1"> </span>traces<span class="w w1"> </span>from<span class="w w2"> </span>dynamic<span class="w w1"> </span>language<span class="w w1"> </span>programs.</div>
<div class="l f3 s3 c0" style="bottom:196.314px;top:588.163px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:195.025px;top:588.959px;left:66.9514px;">We<span class="w w2"> </span>validate<span class="w w1"> </span>our<span class="w w2"> </span>tracing<span class="w w1"> </span>techniques<span class="w w1"> </span>in<span class="w w2"> </span>an<span class="w w1"> </span>implementation<span class="w w1"> </span>based</div>
<div class="l f2 s4 c0" style="bottom:185.062px;top:598.922px;left:66.9514px;">on<span class="w w1"> </span>the<span class="w w1"> </span>SpiderMonkey<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter,<span class="w w2"> </span>achieving<span class="w w1"> </span>2x-20x</div>
<div class="l f2 s4 c0" style="bottom:175.099px;top:608.885px;left:66.9514px;">speedups<span class="w w2"> </span>on<span class="w w1"> </span>many<span class="w w1"> </span>programs.</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:65.9551px;">The<span class="w w2"> </span>remainder<span class="w w1"> </span>of<span class="w w2"> </span>this<span class="w w2"> </span>paper<span class="w w1"> </span>is<span class="w w2"> </span>organized<span class="w w1"> </span>as<span class="w w2"> </span>follows.<span class="w w2"> </span>Section<span class="w w1"> </span>3<span class="w w2"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:54px;">a<span class="w w1"> </span>general<span class="w w1"> </span>overview<span class="w w2"> </span>of<span class="w w1"> </span>trace<span class="w w1"> </span>tree<span class="w w1"> </span>based<span class="w w1"> </span>compilation<span class="w w1"> </span>we<span class="w w1"> </span>use<span class="w w1"> </span>to<span class="w w1"> </span>cap-</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:54px;">ture<span class="w w1"> </span>and<span class="w w0"> </span>compile<span class="w w1"> </span>frequently<span class="w w1"> </span>executed<span class="w w0"> </span>code<span class="w w1"> </span>regions.<span class="w w1"> </span>In<span class="w w0"> </span>Section<span class="w w1"> </span>4</div>
<div class="l f2 s4 c0" style="bottom:126.283px;top:657.701px;left:54px;">we<span class="w w1"> </span>describe<span class="w w1"> </span>our<span class="w w1"> </span>approach<span class="w w0"> </span>of<span class="w w1"> </span>covering<span class="w w1"> </span>nested<span class="w w1"> </span>loops<span class="w w1"> </span>using<span class="w w1"> </span>a<span class="w w0"> </span>num-</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:54px;">ber<span class="w w1"> </span>of<span class="w w0"> </span>individual<span class="w w2"> </span>trace<span class="w w0"> </span>trees.<span class="w w1"> </span>In<span class="w w1"> </span>Section<span class="w w0"> </span>5<span class="w w1"> </span>we<span class="w w1"> </span>describe<span class="w w0"> </span>our<span class="w w1"> </span>trace-</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:54px;">compilation<span class="w w2"> </span>based<span class="w w1"> </span>speculative<span class="w w2"> </span>type<span class="w w1"> </span>specialization<span class="w w1"> </span>approach<span class="w w2"> </span>we<span class="w w1"> </span>use</div>
<div class="l f2 s4 c0" style="bottom:96.3947px;top:687.589px;left:54px;">to<span class="w w1"> </span>generate<span class="w w1"> </span>efficient<span class="w w2"> </span>machine<span class="w w1"> </span>code<span class="w w1"> </span>from<span class="w w1"> </span>recorded<span class="w w1"> </span>bytecode<span class="w w1"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:86.432px;top:697.552px;left:54px;">Our<span class="w w1"> </span>implementation<span class="w w0"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>dynamic<span class="w w1"> </span>type-specializing<span class="w w0"> </span>compiler<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:76.4694px;top:707.515px;left:54px;">JavaScript<span class="w w1"> </span>is<span class="w w1"> </span>described<span class="w w1"> </span>in<span class="w w1"> </span>Section<span class="w w1"> </span>6.<span class="w w1"> </span>Related<span class="w w1"> </span>work<span class="w w1"> </span>is<span class="w w1"> </span>discussed<span class="w w1"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:54px;">Section<span class="w w2"> </span>8.<span class="w w1"> </span>In<span class="w w2"> </span>Section<span class="w w1"> </span>7<span class="w w2"> </span>we<span class="w w1"> </span>evaluate<span class="w w2"> </span>our<span class="w w2"> </span>dynamic<span class="w w1"> </span>compiler<span class="w w2"> </span>based<span class="w w1"> </span>on</div>
<div class="l f7 s4 c0" style="bottom:711.783px;top:72.7481px;left:317.014px;">1<span class="w w0"> </span>for<span class="w w0"> </span>(var<span class="w w0"> </span>i<span class="w w0"> </span>=<span class="w w4"> </span>2;<span class="w w0"> </span>i<span class="w w0"> </span>&lt;<span class="w w0"> </span>100;<span class="w w0"> </span>++i)<span class="w w4"> </span>{</div>
<div class="l f7 s4 c0" style="bottom:701.82px;top:82.7107px;left:317.014px;">2<span class="w w5"> </span>if<span class="w w0"> </span>(!primes[i])</div>
<div class="l f7 s4 c0" style="bottom:691.858px;top:92.6733px;left:317.014px;">3<span class="w w6"> </span>continue;</div>
<div class="l f7 s4 c0" style="bottom:681.895px;top:102.636px;left:317.014px;">4<span class="w w5"> </span>for<span class="w w0"> </span>(var<span class="w w0"> </span>k<span class="w w0"> </span>=<span class="w w0"> </span>i<span class="w w4"> </span>+<span class="w w0"> </span>i;<span class="w w0"> </span>i<span class="w w0"> </span>&lt;<span class="w w0"> </span>100;<span class="w w4"> </span>k<span class="w w0"> </span>+=<span class="w w0"> </span>i)</div>
<div class="l f7 s4 c0" style="bottom:671.932px;top:112.599px;left:317.014px;">5<span class="w w6"> </span>primes[k]<span class="w w0"> </span>=<span class="w w0"> </span>false;</div>
<div class="l f7 s4 c0" style="bottom:661.97px;top:122.561px;left:317.014px;">6<span class="w w0"> </span>}</div>
<div class="l f1 s4 c0" style="bottom:639.888px;top:144.051px;left:317.014px;">Figure<span class="w w1"> </span>1.<span class="w w0"> </span>Sample<span class="w w0"> </span>program:<span class="w w1"> </span>sieve<span class="w w0"> </span>of<span class="w w1"> </span>Eratosthenes.</div>
<div class="l f7 s4 c0" style="bottom:639.772px;top:144.759px;left:518.232px;">primes</div>
<div class="l f2 s4 c0" style="bottom:639.826px;top:144.158px;left:550.137px;">is</div>
<div class="l f2 s4 c0" style="bottom:629.863px;top:154.121px;left:317.014px;">initialized<span class="w w1"> </span>to<span class="w w1"> </span>an<span class="w w0"> </span>array<span class="w w1"> </span>of<span class="w w1"> </span>100</div>
<div class="l f7 s4 c0" style="bottom:629.809px;top:154.722px;left:426.649px;">false</div>
<div class="l f2 s4 c0" style="bottom:629.863px;top:154.121px;left:453.351px;">values<span class="w w1"> </span>on<span class="w w1"> </span>entry<span class="w w0"> </span>to<span class="w w1"> </span>this<span class="w w1"> </span>code</div>
<div class="l f2 s4 c0" style="bottom:619.9px;top:164.084px;left:317.014px;">snippet.</div>
<div class="l fd s7 c0" style="bottom:574.706px;top:212.124px;left:405.402px;">Interpret</div>
<div class="l fe s7 c0" style="bottom:574.706px;top:212.124px;left:426.372px;"> </div>
<div class="l fe s7 c0" style="bottom:568.675px;top:218.156px;left:403.817px;">Bytecodes</div>
<div class="l fd s7 c0" style="bottom:528.608px;top:258.222px;left:406.412px;">Monitor</div>
<div class="l fe s7 c0" style="bottom:528.608px;top:258.222px;left:425.362px;"> </div>
<div class="l fd s7 c0" style="bottom:512.237px;top:274.593px;left:337.619px;">Record</div>
<div class="l fe s7 c0" style="bottom:506.206px;top:280.624px;left:335.317px;">LIR </div>
<div class="l fe s7 c0" style="bottom:506.206px;top:280.624px;left:344.707px;">T</div>
<div class="l fe s7 c0" style="bottom:506.206px;top:280.624px;left:347.676px;">race</div>
<div class="l fd s7 c0" style="bottom:472.602px;top:314.228px;left:473.396px;">Execute</div>
<div class="l fe s7 c0" style="bottom:472.602px;top:314.228px;left:493.225px;"> </div>
<div class="l fe s7 c0" style="bottom:466.57px;top:320.26px;left:465.206px;">Compiled </div>
<div class="l fe s7 c0" style="bottom:466.57px;top:320.26px;left:488.389px;">T</div>
<div class="l fe s7 c0" style="bottom:466.57px;top:320.26px;left:491.358px;">race</div>
<div class="l fd s7 c0" style="bottom:512.237px;top:274.593px;left:476.703px;">Enter</div>
<div class="l fe s7 c0" style="bottom:512.237px;top:274.593px;left:489.918px;"> </div>
<div class="l fe s7 c0" style="bottom:506.206px;top:280.624px;left:465.206px;">Compiled </div>
<div class="l fe s7 c0" style="bottom:506.206px;top:280.624px;left:488.389px;">T</div>
<div class="l fe s7 c0" style="bottom:506.206px;top:280.624px;left:491.358px;">race</div>
<div class="l fd s7 c0" style="bottom:472.602px;top:314.228px;left:336.328px;">Compile</div>
<div class="l fe s7 c0" style="bottom:466.57px;top:320.26px;left:335.317px;">LIR </div>
<div class="l fe s7 c0" style="bottom:466.57px;top:320.26px;left:344.707px;">T</div>
<div class="l fe s7 c0" style="bottom:466.57px;top:320.26px;left:347.676px;">race</div>
<div class="l fd s7 c0" style="bottom:432.966px;top:353.864px;left:475.981px;">Leave</div>
<div class="l fe s7 c0" style="bottom:432.966px;top:353.864px;left:490.64px;"> </div>
<div class="l fe s7 c0" style="bottom:426.935px;top:359.895px;left:465.206px;">Compiled </div>
<div class="l fe s7 c0" style="bottom:426.935px;top:359.895px;left:488.389px;">T</div>
<div class="l fe s7 c0" style="bottom:426.935px;top:359.895px;left:491.358px;">race</div>
<div class="l fe s7 c0" style="bottom:554.888px;top:231.942px;left:402.383px;">loop </div>
<div class="l fe s7 c0" style="bottom:548.857px;top:237.973px;left:401.52px;">edge</div>
<div class="l fe s7 c0" style="bottom:515.253px;top:271.577px;left:383.859px;">hot</div>
<div class="l fe s7 c0" style="bottom:509.221px;top:277.609px;left:377.825px;">loop/exit</div>
<div class="l fe s7 c0" style="bottom:530.762px;top:256.068px;left:335.248px;">abort </div>
<div class="l fe s7 c0" style="bottom:524.731px;top:262.099px;left:330.363px;">recording</div>
<div class="l fe s7 c0" style="bottom:495.866px;top:290.964px;left:353.557px;">fi</div>
<div class="l fe s7 c0" style="bottom:495.866px;top:290.964px;left:356.142px;">nish at </div>
<div class="l fe s7 c0" style="bottom:489.835px;top:296.996px;left:348.811px;">loop header</div>
<div class="l fe s7 c0" style="bottom:549.719px;top:237.112px;left:441.44px;">cold/blacklisted</div>
<div class="l fe s7 c0" style="bottom:543.687px;top:243.143px;left:449.341px;">loop/exit</div>
<div class="l fe s7 c0" style="bottom:528.608px;top:258.222px;left:444.313px;">compiled trace </div>
<div class="l fe s7 c0" style="bottom:522.577px;top:264.253px;left:454.657px;">ready</div>
<div class="l fe s7 c0" style="bottom:490.912px;top:295.919px;left:425.065px;">loop edge with </div>
<div class="l fe s7 c0" style="bottom:484.88px;top:301.95px;left:428.519px;">same types</div>
<div class="l fe s7 c0" style="bottom:443.737px;top:343.093px;left:518.559px;">side exit to </div>
<div class="l fe s7 c0" style="bottom:437.705px;top:349.125px;left:515.687px;">existing trace</div>
<div class="l fe s7 c0" style="bottom:445.891px;top:340.939px;left:427.442px;">side exit,</div>
<div class="l fe s7 c0" style="bottom:439.859px;top:346.971px;left:418.821px;">no existing trace</div>
<div class="l fe s7 c0" style="bottom:570.398px;top:216.432px;left:507.07px;">Overhead</div>
<div class="l fe s7 c0" style="bottom:570.398px;top:216.432px;left:529.774px;"> </div>
<div class="l fe s7 c0" style="bottom:557.473px;top:229.357px;left:505.346px;">Interpreting</div>
<div class="l fe s7 c0" style="bottom:544.98px;top:241.851px;left:511.095px;">Native</div>
<div class="l fd s7 c0" style="bottom:581.599px;top:205.231px;left:504.918px;">Symbol Key</div>
<div class="l f1 s4 c0" style="bottom:391.444px;top:392.495px;left:317.014px;">Figure<span class="w w1"> </span>2.</div>
<div class="l f2 s4 c0" style="bottom:391.381px;top:392.603px;left:356.264px;">State<span class="w w1"> </span>machine<span class="w w1"> </span>describing<span class="w w1"> </span>the<span class="w w1"> </span>major<span class="w w1"> </span>activities<span class="w w1"> </span>of<span class="w w1"> </span>Trace-</div>
<div class="l f2 s4 c0" style="bottom:381.419px;top:402.565px;left:317.014px;">Monkey<span class="w w1"> </span>and<span class="w w1"> </span>the<span class="w w0"> </span>conditions<span class="w w1"> </span>that<span class="w w1"> </span>cause<span class="w w1"> </span>transitions<span class="w w1"> </span>to<span class="w w0"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>activ-</div>
<div class="l f2 s4 c0" style="bottom:371.456px;top:412.528px;left:317.014px;">ity.<span class="w w1"> </span>In<span class="w w0"> </span>the<span class="w w1"> </span>dark<span class="w w0"> </span>box,<span class="w w1"> </span>TM<span class="w w1"> </span>executes<span class="w w0"> </span>JS<span class="w w1"> </span>as<span class="w w0"> </span>compiled<span class="w w1"> </span>traces.<span class="w w0"> </span>In<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:361.493px;top:422.491px;left:317.014px;">light<span class="w w2"> </span>gray<span class="w w1"> </span>boxes,<span class="w w2"> </span>TM<span class="w w1"> </span>executes<span class="w w2"> </span>JS<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>standard<span class="w w1"> </span>interpreter.<span class="w w2"> </span>White</div>
<div class="l f2 s4 c0" style="bottom:351.531px;top:432.453px;left:317.014px;">boxes<span class="w w1"> </span>are<span class="w w1"> </span>overhead.<span class="w w1"> </span>Thus,<span class="w w0"> </span>to<span class="w w1"> </span>maximize<span class="w w1"> </span>performance,<span class="w w1"> </span>we<span class="w w1"> </span>need<span class="w w0"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:341.568px;top:442.416px;left:317.014px;">maximize<span class="w w2"> </span>time<span class="w w1"> </span>spent<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>darkest<span class="w w1"> </span>box<span class="w w2"> </span>and<span class="w w1"> </span>minimize<span class="w w2"> </span>time<span class="w w1"> </span>spent<span class="w w2"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:331.605px;top:452.379px;left:317.014px;">the<span class="w w2"> </span>white<span class="w w1"> </span>boxes.<span class="w w2"> </span>The<span class="w w1"> </span>best<span class="w w1"> </span>case<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>loop<span class="w w1"> </span>where<span class="w w2"> </span>the<span class="w w1"> </span>types<span class="w w1"> </span>at<span class="w w2"> </span>the<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:321.643px;top:462.341px;left:317.014px;">edge<span class="w w2"> </span>are<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w2"> </span>types<span class="w w1"> </span>on<span class="w w2"> </span>entry–then<span class="w w1"> </span>TM<span class="w w1"> </span>can<span class="w w2"> </span>stay<span class="w w1"> </span>in<span class="w w2"> </span>native</div>
<div class="l f2 s4 c0" style="bottom:311.68px;top:472.304px;left:317.014px;">code<span class="w w2"> </span>until<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w2"> </span>is<span class="w w1"> </span>done.</div>
<div class="l f2 s4 c0" style="bottom:283.185px;top:500.799px;left:317.014px;">a<span class="w w1"> </span>set<span class="w w1"> </span>of<span class="w w1"> </span>industry<span class="w w1"> </span>benchmarks.<span class="w w1"> </span>The<span class="w w1"> </span>paper<span class="w w1"> </span>ends<span class="w w1"> </span>with<span class="w w1"> </span>conclusions<span class="w w1"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:273.222px;top:510.762px;left:317.014px;">Section<span class="w w2"> </span>9<span class="w w1"> </span>and<span class="w w2"> </span>an<span class="w w1"> </span>outlook<span class="w w2"> </span>on<span class="w w1"> </span>future<span class="w w2"> </span>work<span class="w w1"> </span>is<span class="w w2"> </span>presented<span class="w w1"> </span>in<span class="w w2"> </span>Section<span class="w w1"> </span>10.</div>
<div class="l f1 s2 c0" style="bottom:249.465px;top:532.682px;left:317.014px;">2.<span class="w w3"> </span>Overview:<span class="w w1"> </span>Example<span class="w w1"> </span>T</div>
<div class="l f1 s2 c0" style="bottom:249.465px;top:532.682px;left:438.044px;">racing<span class="w w1"> </span>Run</div>
<div class="l f2 s4 c0" style="bottom:235.871px;top:548.113px;left:317.014px;">This<span class="w w0"> </span>section<span class="w w1"> </span>provides<span class="w w0"> </span>an<span class="w w1"> </span>overview<span class="w w0"> </span>of<span class="w w0"> </span>our<span class="w w1"> </span>system<span class="w w0"> </span>by<span class="w w0"> </span>describing</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:317.014px;">how<span class="w w0"> </span>T</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:341.393px;">raceMonkey<span class="w w0"> </span>executes<span class="w w1"> </span>an<span class="w w0"> </span>example<span class="w w1"> </span>program.<span class="w w0"> </span>The<span class="w w0"> </span>example</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:317.014px;">program,<span class="w w2"> </span>shown<span class="w w1"> </span>in<span class="w w2"> </span>Figure<span class="w w1"> </span>1,<span class="w w2"> </span>computes<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w2"> </span>100<span class="w w1"> </span>prime<span class="w w2"> </span>numbers</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:317.014px;">with<span class="w w2"> </span>nested<span class="w w2"> </span>loops.<span class="w w1"> </span>The<span class="w w2"> </span>narrative<span class="w w2"> </span>should<span class="w w2"> </span>be<span class="w w2"> </span>read<span class="w w1"> </span>along<span class="w w2"> </span>with<span class="w w2"> </span>Figure<span class="w w1"> </span>2,</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:317.014px;">which<span class="w w1"> </span>describes<span class="w w1"> </span>the<span class="w w1"> </span>activities<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>performs<span class="w w1"> </span>and<span class="w w1"> </span>when<span class="w w1"> </span>it</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:317.014px;">transitions<span class="w w2"> </span>between<span class="w w1"> </span>the<span class="w w1"> </span>loops.</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:328.969px;">TraceMonkey<span class="w w1"> </span>always<span class="w w1"> </span>begins<span class="w w1"> </span>executing<span class="w w1"> </span>a<span class="w w1"> </span>program<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w0"> </span>byte-</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:317.014px;">code<span class="w w1"> </span>interpreter.<span class="w w1"> </span>Every<span class="w w1"> </span>loop<span class="w w0"> </span>back<span class="w w1"> </span>edge<span class="w w1"> </span>is<span class="w w0"> </span>a<span class="w w1"> </span>potential<span class="w w1"> </span>trace<span class="w w0"> </span>point.</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:317.014px;">When<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>crosses<span class="w w1"> </span>a<span class="w w0"> </span>loop<span class="w w1"> </span>edge,<span class="w w0"> </span>TraceMonkey<span class="w w1"> </span>invokes</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">the</div>
<div class="l fa s4 c0" style="bottom:146.414px;top:637.866px;left:330.558px;">trace<span class="w w1"> </span>monitor</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:379.834px;">,<span class="w w1"> </span>which<span class="w w1"> </span>may<span class="w w2"> </span>decide<span class="w w1"> </span>to<span class="w w1"> </span>record<span class="w w1"> </span>or<span class="w w1"> </span>execute<span class="w w1"> </span>a<span class="w w1"> </span>native</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:317.014px;">trace.<span class="w w2"> </span>At<span class="w w1"> </span>the<span class="w w1"> </span>start<span class="w w2"> </span>of<span class="w w1"> </span>execution,<span class="w w2"> </span>there<span class="w w1"> </span>are<span class="w w2"> </span>no<span class="w w1"> </span>compiled<span class="w w1"> </span>traces<span class="w w2"> </span>yet,<span class="w w1"> </span>so</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">the<span class="w w2"> </span>trace<span class="w w2"> </span>monitor<span class="w w1"> </span>counts<span class="w w2"> </span>the<span class="w w2"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>times<span class="w w2"> </span>each<span class="w w2"> </span>loop<span class="w w1"> </span>back<span class="w w2"> </span>edge<span class="w w2"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:317.014px;">executed<span class="w w2"> </span>until<span class="w w2"> </span>a<span class="w w1"> </span>loop<span class="w w2"> </span>becomes</div>
<div class="l fa s4 c0" style="bottom:116.526px;top:667.754px;left:426.223px;">hot</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:437.682px;">,<span class="w w2"> </span>currently<span class="w w1"> </span>after<span class="w w2"> </span>2<span class="w w1"> </span>crossings.<span class="w w2"> </span>Note</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">that<span class="w w2"> </span>the<span class="w w2"> </span>way<span class="w w1"> </span>our<span class="w w2"> </span>loops<span class="w w2"> </span>are<span class="w w1"> </span>compiled,<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>edge<span class="w w2"> </span>is<span class="w w1"> </span>crossed<span class="w w2"> </span>before</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:317.014px;">entering<span class="w w1"> </span>the<span class="w w2"> </span>loop,<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w1"> </span>second<span class="w w1"> </span>crossing<span class="w w2"> </span>occurs<span class="w w1"> </span>immediately<span class="w w1"> </span>after</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">the<span class="w w2"> </span>first<span class="w w1"> </span>iteration.</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:328.969px;">Here<span class="w w0"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>sequence<span class="w w0"> </span>of<span class="w w0"> </span>events<span class="w w0"> </span>broken<span class="w w0"> </span>down<span class="w w1"> </span>by<span class="w w0"> </span>outer<span class="w w0"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:317.014px;">iteration:</div>
</div>
<div id="page-3" class="p" style="width:612px;height:792px;background-image:url(p3.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f7 s4 c0" style="bottom:711.783px;top:72.7482px;left:54px;">v0<span class="w w0"> </span>:=<span class="w w0"> </span>ld<span class="w w0"> </span>state[748]<span class="w w6"> </span>//<span class="w w0"> </span>load<span class="w w4"> </span>primes<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w0"> </span>trace<span class="w w0"> </span>activation<span class="w w4"> </span>record</div>
<div class="l f7 s4 c0" style="bottom:701.82px;top:82.7108px;left:82.2438px;">st<span class="w w0"> </span>sp[0],<span class="w w0"> </span>v0<span class="w w7"> </span>//<span class="w w0"> </span>store<span class="w w0"> </span>primes<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w4"> </span>stack</div>
<div class="l f7 s4 c0" style="bottom:691.858px;top:92.6734px;left:54px;">v1<span class="w w0"> </span>:=<span class="w w0"> </span>ld<span class="w w0"> </span>state[764]<span class="w w6"> </span>//<span class="w w0"> </span>load<span class="w w4"> </span>k<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w0"> </span>trace<span class="w w0"> </span>activation<span class="w w4"> </span>record</div>
<div class="l f7 s4 c0" style="bottom:681.895px;top:102.636px;left:54px;">v2<span class="w w0"> </span>:=<span class="w w0"> </span>i2f(v1)<span class="w w8"> </span>//<span class="w w0"> </span>convert<span class="w w0"> </span>k<span class="w w0"> </span>from<span class="w w0"> </span>int<span class="w w4"> </span>to<span class="w w0"> </span>double</div>
<div class="l f7 s4 c0" style="bottom:671.932px;top:112.599px;left:82.2438px;">st<span class="w w0"> </span>sp[8],<span class="w w0"> </span>v1<span class="w w7"> </span>//<span class="w w0"> </span>store<span class="w w0"> </span>k<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w4"> </span>stack</div>
<div class="l f7 s4 c0" style="bottom:661.97px;top:122.561px;left:82.2438px;">st<span class="w w0"> </span>sp[16],<span class="w w0"> </span>0<span class="w w7"> </span>//<span class="w w0"> </span>store<span class="w w0"> </span>false<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w4"> </span>stack</div>
<div class="l f7 s4 c0" style="bottom:652.007px;top:132.524px;left:54px;">v3<span class="w w0"> </span>:=<span class="w w0"> </span>ld<span class="w w0"> </span>v0[4]<span class="w w9"> </span>//<span class="w w0"> </span>load<span class="w w0"> </span>class<span class="w w0"> </span>word<span class="w w0"> </span>for<span class="w w4"> </span>primes</div>
<div class="l f7 s4 c0" style="bottom:642.044px;top:142.487px;left:54px;">v4<span class="w w0"> </span>:=<span class="w w0"> </span>and<span class="w w0"> </span>v3,<span class="w w0"> </span>-4<span class="w wa"> </span>//<span class="w w0"> </span>mask<span class="w w0"> </span>out<span class="w w0"> </span>object<span class="w w0"> </span>class<span class="w w4"> </span>tag<span class="w w0"> </span>for<span class="w w0"> </span>primes</div>
<div class="l f7 s4 c0" style="bottom:632.082px;top:152.449px;left:54px;">v5<span class="w w0"> </span>:=<span class="w w0"> </span>eq<span class="w w0"> </span>v4,<span class="w w0"> </span>Array<span class="w w7"> </span>//<span class="w w0"> </span>test<span class="w w0"> </span>whether<span class="w w4"> </span>primes<span class="w w0"> </span>is<span class="w w0"> </span>an<span class="w w0"> </span>array</div>
<div class="l f7 s4 c0" style="bottom:622.119px;top:162.412px;left:82.2438px;">xf<span class="w w0"> </span>v5<span class="w wb"> </span>//<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>v5<span class="w w4"> </span>is<span class="w w0"> </span>false</div>
<div class="l f7 s4 c0" style="bottom:612.156px;top:172.375px;left:54px;">v6<span class="w w0"> </span>:=<span class="w w0"> </span>js_Array_set(v0,<span class="w w0"> </span>v2,<span class="w w0"> </span>false)<span class="w w3"> </span>//<span class="w w0"> </span>call<span class="w w0"> </span>function<span class="w w0"> </span>to<span class="w w0"> </span>set<span class="w w0"> </span>array<span class="w w0"> </span>element</div>
<div class="l f7 s4 c0" style="bottom:602.194px;top:182.337px;left:54px;">v7<span class="w w0"> </span>:=<span class="w w0"> </span>eq<span class="w w0"> </span>v6,<span class="w w0"> </span>0<span class="w w9"> </span>//<span class="w w0"> </span>test<span class="w w0"> </span>return<span class="w w0"> </span>value<span class="w w4"> </span>from<span class="w w0"> </span>call</div>
<div class="l f7 s4 c0" style="bottom:592.231px;top:192.3px;left:82.2438px;">xt<span class="w w0"> </span>v7<span class="w wb"> </span>//<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>js_Array_set<span class="w w4"> </span>returns<span class="w w0"> </span>false.</div>
<div class="l f1 s4 c0" style="bottom:568.905px;top:215.035px;left:54px;">Figure<span class="w w1"> </span>3.<span class="w w0"> </span>LIR<span class="w w1"> </span>snippet<span class="w w0"> </span>for<span class="w w2"> </span>sample<span class="w w0"> </span>program.</div>
<div class="l f2 s4 c0" style="bottom:568.842px;top:215.142px;left:227.171px;">This<span class="w w1"> </span>is<span class="w w1"> </span>the<span class="w w0"> </span>LIR<span class="w w1"> </span>recorded<span class="w w1"> </span>for<span class="w w1"> </span>line<span class="w w0"> </span>5<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>sample<span class="w w1"> </span>program<span class="w w0"> </span>in<span class="w w1"> </span>Figure<span class="w w1"> </span>1.<span class="w w1"> </span>The<span class="w w0"> </span>LIR<span class="w w1"> </span>encodes</div>
<div class="l f2 s4 c0" style="bottom:558.879px;top:225.105px;left:54px;">the<span class="w w1"> </span>semantics<span class="w w1"> </span>in<span class="w w1"> </span>SSA<span class="w w1"> </span>form<span class="w w0"> </span>using<span class="w w2"> </span>temporary<span class="w w0"> </span>variables.<span class="w w2"> </span>The<span class="w w1"> </span>LIR<span class="w w0"> </span>also<span class="w w2"> </span>encodes<span class="w w0"> </span>all<span class="w w2"> </span>the<span class="w w0"> </span>stores<span class="w w2"> </span>that<span class="w w0"> </span>the<span class="w w2"> </span>interpreter<span class="w w0"> </span>would<span class="w w2"> </span>do<span class="w w1"> </span>to<span class="w w0"> </span>its<span class="w w2"> </span>data<span class="w w0"> </span>stack.</div>
<div class="l f2 s4 c0" style="bottom:548.917px;top:235.067px;left:54px;">Sometimes<span class="w w2"> </span>these<span class="w w1"> </span>stores<span class="w w1"> </span>can<span class="w w2"> </span>be<span class="w w1"> </span>optimized<span class="w w1"> </span>away<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w1"> </span>stack<span class="w w2"> </span>locations<span class="w w1"> </span>are<span class="w w1"> </span>live<span class="w w2"> </span>only<span class="w w1"> </span>on<span class="w w2"> </span>exits<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.<span class="w w1"> </span>Finally,<span class="w w2"> </span>the<span class="w w2"> </span>LIR<span class="w w1"> </span>records<span class="w w1"> </span>guards</div>
<div class="l f2 s4 c0" style="bottom:538.954px;top:245.03px;left:54px;">and<span class="w w2"> </span>side<span class="w w1"> </span>exits<span class="w w1"> </span>to<span class="w w2"> </span>verify<span class="w w1"> </span>the<span class="w w2"> </span>assumptions<span class="w w1"> </span>made<span class="w w1"> </span>in<span class="w w2"> </span>this<span class="w w1"> </span>recording:<span class="w w1"> </span>that</div>
<div class="l f7 s4 c0" style="bottom:538.9px;top:245.631px;left:298.295px;">primes</div>
<div class="l f2 s4 c0" style="bottom:538.954px;top:245.03px;left:328.78px;">is<span class="w w2"> </span>an<span class="w w1"> </span>array<span class="w w1"> </span>and<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>to<span class="w w1"> </span>set<span class="w w2"> </span>its<span class="w w1"> </span>element<span class="w w1"> </span>succeeds.</div>
<div class="l f7 s4 c0" style="bottom:512.748px;top:271.783px;left:54px;">mov<span class="w w0"> </span>edx,<span class="w w0"> </span>ebx(748)<span class="w w7"> </span>//<span class="w w0"> </span>load<span class="w w0"> </span>primes<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w4"> </span>trace<span class="w w0"> </span>activation<span class="w w0"> </span>record</div>
<div class="l f7 s4 c0" style="bottom:502.786px;top:281.745px;left:54px;">mov<span class="w w0"> </span>edi(0),<span class="w w0"> </span>edx<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>store<span class="w w0"> </span>primes<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w0"> </span>stack</div>
<div class="l f7 s4 c0" style="bottom:492.823px;top:291.708px;left:54px;">mov<span class="w w0"> </span>esi,<span class="w w0"> </span>ebx(764)<span class="w w7"> </span>//<span class="w w0"> </span>load<span class="w w0"> </span>k<span class="w w0"> </span>from<span class="w w0"> </span>the<span class="w w4"> </span>trace<span class="w w0"> </span>activation<span class="w w0"> </span>record</div>
<div class="l f7 s4 c0" style="bottom:482.86px;top:301.671px;left:54px;">mov<span class="w w0"> </span>edi(8),<span class="w w0"> </span>esi<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>store<span class="w w0"> </span>k<span class="w w0"> </span>to<span class="w w0"> </span>interpreter<span class="w w0"> </span>stack</div>
<div class="l f7 s4 c0" style="bottom:472.898px;top:311.633px;left:54px;">mov<span class="w w0"> </span>edi(16),<span class="w w0"> </span>0<span class="w wc"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>store<span class="w w0"> </span>false<span class="w w0"> </span>to<span class="w w4"> </span>interpreter<span class="w w0"> </span>stack</div>
<div class="l f7 s4 c0" style="bottom:462.935px;top:321.596px;left:54px;">mov<span class="w w0"> </span>eax,<span class="w w0"> </span>edx(4)<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>load<span class="w w0"> </span>object<span class="w w0"> </span>class<span class="w w0"> </span>word<span class="w w0"> </span>for<span class="w w4"> </span>primes</div>
<div class="l f7 s4 c0" style="bottom:452.972px;top:331.559px;left:54px;">and<span class="w w0"> </span>eax,<span class="w w0"> </span>-4<span class="w wd"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>mask<span class="w w0"> </span>out<span class="w w0"> </span>object<span class="w w4"> </span>class<span class="w w0"> </span>tag<span class="w w0"> </span>for<span class="w w0"> </span>primes</div>
<div class="l f7 s4 c0" style="bottom:443.01px;top:341.521px;left:54px;">cmp<span class="w w0"> </span>eax,<span class="w w0"> </span>Array<span class="w wc"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>test<span class="w w0"> </span>whether<span class="w w0"> </span>primes<span class="w w4"> </span>is<span class="w w0"> </span>an<span class="w w0"> </span>array</div>
<div class="l f7 s4 c0" style="bottom:433.047px;top:351.484px;left:54px;">jne<span class="w w0"> </span>side_exit_1<span class="w wa"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>primes<span class="w w0"> </span>is<span class="w w0"> </span>not<span class="w w4"> </span>an<span class="w w0"> </span>array</div>
<div class="l f7 s4 c0" style="bottom:423.084px;top:361.447px;left:54px;">sub<span class="w w0"> </span>esp,<span class="w w0"> </span>8<span class="w wb"> </span>//<span class="w w0"> </span>bump<span class="w w0"> </span>stack<span class="w w0"> </span>for<span class="w w4"> </span>call<span class="w w0"> </span>alignment<span class="w w0"> </span>convention</div>
<div class="l f7 s4 c0" style="bottom:413.122px;top:371.409px;left:54px;">push<span class="w w0"> </span>false<span class="w wb"> </span>//<span class="w w0"> </span>push<span class="w w0"> </span>last<span class="w w0"> </span>argument<span class="w w0"> </span>for<span class="w w4"> </span>call</div>
<div class="l f7 s4 c0" style="bottom:403.159px;top:381.372px;left:54px;">push<span class="w w0"> </span>esi<span class="w we"> </span>//<span class="w w0"> </span>push<span class="w w0"> </span>first<span class="w w0"> </span>argument<span class="w w0"> </span>for<span class="w w4"> </span>call</div>
<div class="l f7 s4 c0" style="bottom:393.197px;top:391.334px;left:54px;">call<span class="w w0"> </span>js_Array_set<span class="w w7"> </span>//<span class="w w0"> </span>call<span class="w w0"> </span>function<span class="w w0"> </span>to<span class="w w0"> </span>set<span class="w w0"> </span>array<span class="w w4"> </span>element</div>
<div class="l f7 s4 c0" style="bottom:383.234px;top:401.297px;left:54px;">add<span class="w w0"> </span>esp,<span class="w w0"> </span>8<span class="w wb"> </span>//<span class="w w0"> </span>clean<span class="w w0"> </span>up<span class="w w0"> </span>extra<span class="w w4"> </span>stack<span class="w w0"> </span>space</div>
<div class="l f7 s4 c0" style="bottom:373.271px;top:411.26px;left:54px;">mov<span class="w w0"> </span>ecx,<span class="w w0"> </span>ebx<span class="w w8"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>created<span class="w w0"> </span>by<span class="w w0"> </span>register<span class="w w4"> </span>allocator</div>
<div class="l f7 s4 c0" style="bottom:363.309px;top:421.222px;left:54px;">test<span class="w w0"> </span>eax,<span class="w w0"> </span>eax<span class="w w9"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>test<span class="w w0"> </span>return<span class="w w0"> </span>value<span class="w w0"> </span>of<span class="w w4"> </span>js_Array_set</div>
<div class="l f7 s4 c0" style="bottom:353.346px;top:431.185px;left:54px;">je<span class="w w0"> </span>side_exit_2<span class="w wc"> </span>//<span class="w w0"> </span>(*)<span class="w w0"> </span>side<span class="w w0"> </span>exit<span class="w w0"> </span>if<span class="w w0"> </span>call<span class="w w4"> </span>failed</div>
<div class="l f7 s4 c0" style="bottom:343.383px;top:441.148px;left:54px;">...</div>
<div class="l f7 s4 c0" style="bottom:333.421px;top:451.11px;left:54px;">side_exit_1:</div>
<div class="l f7 s4 c0" style="bottom:323.458px;top:461.073px;left:54px;">mov<span class="w w0"> </span>ecx,<span class="w w0"> </span>ebp(-4)<span class="w wf"> </span>//<span class="w w0"> </span>restore<span class="w w0"> </span>ecx</div>
<div class="l f7 s4 c0" style="bottom:313.495px;top:471.036px;left:54px;">mov<span class="w w0"> </span>esp,<span class="w w0"> </span>ebp<span class="w w8"> </span>//<span class="w w0"> </span>restore<span class="w w0"> </span>esp</div>
<div class="l f7 s4 c0" style="bottom:303.533px;top:480.998px;left:54px;">jmp<span class="w w0"> </span>epilog<span class="w wb"> </span>//<span class="w w0"> </span>jump<span class="w w0"> </span>to<span class="w w0"> </span>ret<span class="w w0"> </span>statement</div>
<div class="l f1 s4 c0" style="bottom:280.206px;top:503.733px;left:54px;">Figure<span class="w w2"> </span>4.<span class="w w0"> </span>x86<span class="w w1"> </span>snippet<span class="w w2"> </span>for<span class="w w2"> </span>sample<span class="w w1"> </span>program.</div>
<div class="l f2 s4 c0" style="bottom:280.144px;top:503.84px;left:217.914px;">This<span class="w w2"> </span>is<span class="w w1"> </span>the<span class="w w2"> </span>x86<span class="w w1"> </span>code<span class="w w2"> </span>compiled<span class="w w1"> </span>from<span class="w w2"> </span>the<span class="w w2"> </span>LIR<span class="w w1"> </span>snippet<span class="w w2"> </span>in<span class="w w1"> </span>Figure<span class="w w2"> </span>3.<span class="w w1"> </span>Most<span class="w w2"> </span>LIR<span class="w w1"> </span>instructions<span class="w w2"> </span>compile</div>
<div class="l f2 s4 c0" style="bottom:270.181px;top:513.803px;left:54px;">to<span class="w w1"> </span>a<span class="w w1"> </span>single<span class="w w1"> </span>x86<span class="w w1"> </span>instruction.<span class="w w1"> </span>Instructions<span class="w w1"> </span>marked<span class="w w1"> </span>with</div>
<div class="l f7 s4 c0" style="bottom:270.127px;top:514.404px;left:247.567px;">(*)</div>
<div class="l f2 s4 c0" style="bottom:270.181px;top:513.803px;left:264.447px;">would<span class="w w1"> </span>be<span class="w w1"> </span>omitted<span class="w w1"> </span>by<span class="w w1"> </span>an<span class="w w1"> </span>idealized<span class="w w1"> </span>compiler<span class="w w1"> </span>that<span class="w w1"> </span>knew<span class="w w1"> </span>that<span class="w w1"> </span>none<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>side<span class="w w1"> </span>exits</div>
<div class="l f2 s4 c0" style="bottom:260.218px;top:523.766px;left:54px;">would<span class="w w2"> </span>ever<span class="w w1"> </span>be<span class="w w1"> </span>taken.<span class="w w2"> </span>The<span class="w w1"> </span>17<span class="w w1"> </span>instructions<span class="w w2"> </span>generated<span class="w w1"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>compiler<span class="w w2"> </span>compare<span class="w w1"> </span>favorably<span class="w w2"> </span>with<span class="w w1"> </span>the<span class="w w1"> </span>100+<span class="w w1"> </span>instructions<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>would</div>
<div class="l f2 s4 c0" style="bottom:250.256px;top:533.728px;left:54px;">execute<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>same<span class="w w1"> </span>code<span class="w w1"> </span>snippet,<span class="w w2"> </span>including<span class="w w1"> </span>4<span class="w w1"> </span>indirect<span class="w w2"> </span>jumps.</div>
<div class="l f1 s4 c0" style="bottom:220.482px;top:563.457px;left:65.9552px;">i=2.</div>
<div class="l f2 s4 c0" style="bottom:220.419px;top:563.565px;left:83.8015px;">This<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>first<span class="w w0"> </span>iteration<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop.<span class="w w0"> </span>The<span class="w w1"> </span>loop<span class="w w0"> </span>on</div>
<div class="l f2 s4 c0" style="bottom:210.456px;top:573.528px;left:54px;">lines<span class="w w2"> </span>4-5<span class="w w1"> </span>becomes<span class="w w1"> </span>hot<span class="w w1"> </span>on<span class="w w2"> </span>its<span class="w w1"> </span>second<span class="w w1"> </span>iteration,<span class="w w1"> </span>so<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>en-</div>
<div class="l f2 s4 c0" style="bottom:200.494px;top:583.49px;left:54px;">ters<span class="w w1"> </span>recording<span class="w w1"> </span>mode<span class="w w0"> </span>on<span class="w w1"> </span>line<span class="w w1"> </span>4.<span class="w w0"> </span>In<span class="w w1"> </span>recording<span class="w w1"> </span>mode,<span class="w w1"> </span>TraceMonkey</div>
<div class="l f2 s4 c0" style="bottom:190.531px;top:593.453px;left:54px;">records<span class="w w2"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>along<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w2"> </span>low-level<span class="w w2"> </span>compiler<span class="w w1"> </span>intermedi-</div>
<div class="l f2 s4 c0" style="bottom:180.568px;top:603.416px;left:54px;">ate<span class="w w2"> </span>representation<span class="w w1"> </span>we<span class="w w1"> </span>call</div>
<div class="l fa s4 c0" style="bottom:180.775px;top:603.505px;left:147.89px;">LIR</div>
<div class="l f2 s4 c0" style="bottom:180.568px;top:603.416px;left:161.34px;">.<span class="w w2"> </span>The<span class="w w1"> </span>LIR<span class="w w1"> </span>trace<span class="w w2"> </span>encodes<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>oper-</div>
<div class="l f2 s4 c0" style="bottom:170.606px;top:613.378px;left:54px;">ations<span class="w w1"> </span>performed<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w2"> </span>of<span class="w w1"> </span>all<span class="w w1"> </span>operands.<span class="w w1"> </span>The<span class="w w2"> </span>LIR<span class="w w1"> </span>trace<span class="w w1"> </span>also</div>
<div class="l f2 s4 c0" style="bottom:160.643px;top:623.341px;left:54px;">encodes</div>
<div class="l fa s4 c0" style="bottom:160.849px;top:623.43px;left:85.4698px;">guards</div>
<div class="l f2 s4 c0" style="bottom:160.643px;top:623.341px;left:110.047px;">,<span class="w w1"> </span>which<span class="w w1"> </span>are<span class="w w2"> </span>checks<span class="w w1"> </span>that<span class="w w1"> </span>verify<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>control<span class="w w1"> </span>flow</div>
<div class="l f2 s4 c0" style="bottom:150.681px;top:633.303px;left:54px;">and<span class="w w1"> </span>types<span class="w w0"> </span>are<span class="w w1"> </span>identical<span class="w w1"> </span>to<span class="w w0"> </span>those<span class="w w1"> </span>observed<span class="w w1"> </span>during<span class="w w1"> </span>trace<span class="w w0"> </span>recording.</div>
<div class="l f2 s4 c0" style="bottom:140.718px;top:643.266px;left:54px;">Thus,<span class="w w1"> </span>on<span class="w w1"> </span>later<span class="w w1"> </span>executions,<span class="w w1"> </span>if<span class="w w1"> </span>and<span class="w w1"> </span>only<span class="w w1"> </span>if<span class="w w1"> </span>all<span class="w w1"> </span>guards<span class="w w1"> </span>are<span class="w w1"> </span>passed,<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:130.755px;top:653.229px;left:54px;">trace<span class="w w2"> </span>has<span class="w w1"> </span>the<span class="w w1"> </span>required<span class="w w2"> </span>program<span class="w w1"> </span>semantics.</div>
<div class="l f2 s4 c0" style="bottom:120.793px;top:663.191px;left:65.9552px;">TraceMonkey<span class="w w1"> </span>stops<span class="w w0"> </span>recording<span class="w w0"> </span>when<span class="w w1"> </span>execution<span class="w w0"> </span>returns<span class="w w0"> </span>to<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:110.83px;top:673.154px;left:54px;">loop<span class="w w1"> </span>header<span class="w w2"> </span>or<span class="w w1"> </span>exits<span class="w w1"> </span>the<span class="w w1"> </span>loop.<span class="w w1"> </span>In<span class="w w1"> </span>this<span class="w w2"> </span>case,<span class="w w1"> </span>execution<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:100.867px;top:683.117px;left:54px;">loop<span class="w w2"> </span>header<span class="w w1"> </span>on<span class="w w1"> </span>line<span class="w w2"> </span>4.</div>
<div class="l f2 s4 c0" style="bottom:90.9048px;top:693.079px;left:65.9552px;">After<span class="w w1"> </span>recording<span class="w w2"> </span>is<span class="w w1"> </span>finished,<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>compiles<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:80.9421px;top:703.042px;left:54px;">native<span class="w w1"> </span>code<span class="w w1"> </span>using<span class="w w1"> </span>the<span class="w w1"> </span>recorded<span class="w w1"> </span>type<span class="w w1"> </span>information<span class="w w1"> </span>for<span class="w w1"> </span>optimization.</div>
<div class="l f2 s4 c0" style="bottom:70.9795px;top:713.005px;left:54px;">The<span class="w w0"> </span>result<span class="w w1"> </span>is<span class="w w0"> </span>a<span class="w w0"> </span>native<span class="w w1"> </span>code<span class="w w0"> </span>fragment<span class="w w0"> </span>that<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w0"> </span>entered<span class="w w1"> </span>if<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:220.419px;top:563.565px;left:317.014px;">interpreter<span class="w w1"> </span>PC<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w1"> </span>of<span class="w w1"> </span>values<span class="w w1"> </span>match<span class="w w2"> </span>those<span class="w w1"> </span>observed<span class="w w1"> </span>when</div>
<div class="l f2 s4 c0" style="bottom:210.456px;top:573.528px;left:317.014px;">trace<span class="w w1"> </span>recording<span class="w w0"> </span>was<span class="w w1"> </span>started.<span class="w w0"> </span>The<span class="w w1"> </span>first<span class="w w0"> </span>trace<span class="w w1"> </span>in<span class="w w1"> </span>our<span class="w w0"> </span>example,</div>
<div class="l ff s4 c0" style="bottom:210.654px;top:573.384px;left:540.696px;">T</div>
<div class="l f8 s5 c0" style="bottom:210.237px;top:576.455px;left:546.072px;">45</div>
<div class="l f2 s4 c0" style="bottom:210.456px;top:573.528px;left:553.875px;">,</div>
<div class="l f2 s4 c0" style="bottom:200.494px;top:583.49px;left:317.014px;">covers<span class="w w2"> </span>lines<span class="w w1"> </span>4<span class="w w2"> </span>and<span class="w w1"> </span>5.<span class="w w2"> </span>This<span class="w w1"> </span>trace<span class="w w2"> </span>can<span class="w w1"> </span>be<span class="w w1"> </span>entered<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>PC<span class="w w1"> </span>is<span class="w w2"> </span>at<span class="w w1"> </span>line<span class="w w2"> </span>4,</div>
<div class="l f7 s4 c0" style="bottom:190.477px;top:594.054px;left:317.014px;">i</div>
<div class="l f2 s4 c0" style="bottom:190.531px;top:593.453px;left:323.788px;">and</div>
<div class="l f7 s4 c0" style="bottom:190.477px;top:594.054px;left:338.802px;">k</div>
<div class="l f2 s4 c0" style="bottom:190.531px;top:593.453px;left:345.576px;">are<span class="w w2"> </span>integers,<span class="w w1"> </span>and</div>
<div class="l f7 s4 c0" style="bottom:190.477px;top:594.054px;left:406.166px;">primes</div>
<div class="l f2 s4 c0" style="bottom:190.531px;top:593.453px;left:436.476px;">is<span class="w w2"> </span>an<span class="w w1"> </span>object.<span class="w w2"> </span>After<span class="w w1"> </span>compiling</div>
<div class="l ff s4 c0" style="bottom:190.728px;top:593.309px;left:540.696px;">T</div>
<div class="l f8 s5 c0" style="bottom:190.312px;top:596.38px;left:546.072px;">45</div>
<div class="l f2 s4 c0" style="bottom:190.531px;top:593.453px;left:553.875px;">,</div>
<div class="l f2 s4 c0" style="bottom:180.568px;top:603.416px;left:317.014px;">TraceMonkey<span class="w w2"> </span>returns<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>and<span class="w w2"> </span>loops<span class="w w1"> </span>back<span class="w w2"> </span>to<span class="w w1"> </span>line<span class="w w1"> </span>1.</div>
<div class="l f1 s4 c0" style="bottom:170.669px;top:613.271px;left:328.969px;">i=3.</div>
<div class="l f2 s4 c0" style="bottom:170.606px;top:613.378px;left:346.282px;">Now<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>at<span class="w w0"> </span>line<span class="w w2"> </span>1<span class="w w0"> </span>has<span class="w w2"> </span>become<span class="w w0"> </span>hot,<span class="w w1"> </span>so<span class="w w1"> </span>Trace-</div>
<div class="l f2 s4 c0" style="bottom:160.643px;top:623.341px;left:317.014px;">Monkey<span class="w w1"> </span>starts<span class="w w0"> </span>recording.<span class="w w1"> </span>When<span class="w w0"> </span>recording<span class="w w1"> </span>reaches<span class="w w1"> </span>line<span class="w w0"> </span>4,<span class="w w1"> </span>Trace-</div>
<div class="l f2 s4 c0" style="bottom:150.681px;top:633.303px;left:317.014px;">Monkey<span class="w w1"> </span>observes<span class="w w1"> </span>that<span class="w w1"> </span>it<span class="w w1"> </span>has<span class="w w1"> </span>reached<span class="w w1"> </span>an<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>that<span class="w w1"> </span>al-</div>
<div class="l f2 s4 c0" style="bottom:140.718px;top:643.266px;left:317.014px;">ready<span class="w w1"> </span>has<span class="w w1"> </span>a<span class="w w1"> </span>compiled<span class="w w1"> </span>trace,<span class="w w0"> </span>so<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>attempts<span class="w w1"> </span>to<span class="w w0"> </span>nest<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:130.755px;top:653.229px;left:317.014px;">inner<span class="w w2"> </span>loop<span class="w w1"> </span>inside<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>trace.<span class="w w1"> </span>The<span class="w w2"> </span>first<span class="w w1"> </span>step<span class="w w1"> </span>is<span class="w w2"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>the<span class="w w2"> </span>inner</div>
<div class="l f2 s4 c0" style="bottom:120.793px;top:663.191px;left:317.014px;">trace<span class="w w2"> </span>as<span class="w w2"> </span>a<span class="w w1"> </span>subroutine.<span class="w w2"> </span>This<span class="w w1"> </span>executes<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w2"> </span>on<span class="w w1"> </span>line<span class="w w2"> </span>4<span class="w w1"> </span>to<span class="w w2"> </span>completion</div>
<div class="l f2 s4 c0" style="bottom:110.83px;top:673.154px;left:317.014px;">and<span class="w w2"> </span>then<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>recorder.<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>verifies<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:100.867px;top:683.117px;left:317.014px;">was<span class="w w2"> </span>successful<span class="w w1"> </span>and<span class="w w2"> </span>then<span class="w w1"> </span>records<span class="w w2"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>trace<span class="w w2"> </span>as<span class="w w1"> </span>part<span class="w w2"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:90.9048px;top:693.079px;left:317.014px;">the<span class="w w1"> </span>current<span class="w w2"> </span>trace.<span class="w w1"> </span>Recording<span class="w w1"> </span>continues<span class="w w1"> </span>until<span class="w w1"> </span>execution<span class="w w2"> </span>reaches<span class="w w1"> </span>line</div>
<div class="l f2 s4 c0" style="bottom:80.9421px;top:703.042px;left:317.014px;">1,<span class="w w1"> </span>and<span class="w w1"> </span>at<span class="w w1"> </span>which<span class="w w1"> </span>point<span class="w w1"> </span>TraceMonkey<span class="w w1"> </span>finishes<span class="w w1"> </span>and<span class="w w1"> </span>compiles<span class="w w1"> </span>a<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:70.9795px;top:713.005px;left:317.014px;">for<span class="w w2"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop,</div>
<div class="l ff s4 c0" style="bottom:71.1767px;top:712.861px;left:384.001px;">T</div>
<div class="l f8 s5 c0" style="bottom:70.7603px;top:715.932px;left:389.377px;">16</div>
<div class="l f2 s4 c0" style="bottom:70.9795px;top:713.005px;left:397.181px;">.</div>
</div>
<div id="page-4" class="p" style="width:612px;height:792px;background-image:url(p4.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f1 s4 c0" style="bottom:710.156px;top:73.7833px;left:65.9552px;">i=4.</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:82.2805px;">On<span class="w w2"> </span>this<span class="w w1"> </span>iteration,<span class="w w2"> </span>TraceMonkey<span class="w w2"> </span>calls</div>
<div class="l ff s4 c0" style="bottom:710.29px;top:73.7474px;left:214.494px;">T</div>
<div class="l f8 s5 c0" style="bottom:709.874px;top:76.8179px;left:219.87px;">16</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:227.674px;">.<span class="w w2"> </span>Because</div>
<div class="l f7 s4 c0" style="bottom:710.039px;top:74.4916px;left:263.786px;">i=4</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:277.908px;">,<span class="w w2"> </span>the</div>
<div class="l f7 s4 c0" style="bottom:700.077px;top:84.4543px;left:54px;">if</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:66.3342px;">statement<span class="w w1"> </span>on<span class="w w1"> </span>line<span class="w w1"> </span>2<span class="w w1"> </span>is<span class="w w1"> </span>taken.<span class="w w1"> </span>This<span class="w w0"> </span>branch<span class="w w2"> </span>was<span class="w w0"> </span>not<span class="w w2"> </span>taken<span class="w w1"> </span>in<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:54px;">original<span class="w w2"> </span>trace,<span class="w w1"> </span>so<span class="w w2"> </span>this<span class="w w1"> </span>causes</div>
<div class="l ff s4 c0" style="bottom:690.365px;top:93.6727px;left:156.252px;">T</div>
<div class="l f8 s5 c0" style="bottom:689.949px;top:96.7431px;left:161.628px;">16</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:171.505px;">to<span class="w w2"> </span>fail<span class="w w1"> </span>a<span class="w w2"> </span>guard<span class="w w1"> </span>and<span class="w w2"> </span>take<span class="w w1"> </span>a<span class="w w2"> </span>side<span class="w w1"> </span>exit.</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:54px;">The<span class="w w1"> </span>exit<span class="w w1"> </span>is<span class="w w1"> </span>not<span class="w w1"> </span>yet<span class="w w1"> </span>hot,<span class="w w1"> </span>so<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter,</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:54px;">which<span class="w w2"> </span>executes<span class="w w1"> </span>the<span class="w w2"> </span>continue<span class="w w1"> </span>statement.</div>
<div class="l f1 s4 c0" style="bottom:660.343px;top:123.596px;left:65.9552px;">i=5.</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:82.2987px;">TraceMonkey<span class="w w2"> </span>calls</div>
<div class="l ff s4 c0" style="bottom:660.477px;top:123.561px;left:152.518px;">T</div>
<div class="l f8 s5 c0" style="bottom:660.061px;top:126.631px;left:157.894px;">16</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:165.698px;">,<span class="w w2"> </span>which<span class="w w1"> </span>in<span class="w w2"> </span>turn<span class="w w1"> </span>calls<span class="w w2"> </span>the<span class="w w1"> </span>nested<span class="w w2"> </span>trace</div>
<div class="l ff s4 c0" style="bottom:650.515px;top:133.523px;left:54px;">T</div>
<div class="l f8 s5 c0" style="bottom:650.098px;top:136.594px;left:59.376px;">45</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:67.18px;">.</div>
<div class="l ff s4 c0" style="bottom:650.515px;top:133.523px;left:72.5721px;">T</div>
<div class="l f8 s5 c0" style="bottom:650.098px;top:136.594px;left:77.9481px;">16</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:88.9025px;">loops<span class="w w1"> </span>back<span class="w w1"> </span>to<span class="w w0"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>header,<span class="w w1"> </span>starting<span class="w w1"> </span>the<span class="w w1"> </span>next<span class="w w0"> </span>iteration</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:54px;">without<span class="w w2"> </span>ever<span class="w w1"> </span>returning<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>monitor.</div>
<div class="l f1 s4 c0" style="bottom:630.455px;top:153.484px;left:65.9552px;">i=6.</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:82.4598px;">On<span class="w w2"> </span>this<span class="w w1"> </span>iteration,<span class="w w1"> </span>the<span class="w w2"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>on<span class="w w1"> </span>line<span class="w w2"> </span>2<span class="w w1"> </span>is<span class="w w1"> </span>taken<span class="w w2"> </span>again.<span class="w w1"> </span>This</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:54px;">time,<span class="w w1"> </span>the<span class="w w1"> </span>side<span class="w w0"> </span>exit<span class="w w1"> </span>becomes<span class="w w1"> </span>hot,<span class="w w1"> </span>so<span class="w w0"> </span>a<span class="w w1"> </span>trace</div>
<div class="l ff s4 c0" style="bottom:620.627px;top:163.411px;left:213.742px;">T</div>
<div class="l f8 s5 c0" style="bottom:620.21px;top:166.482px;left:219.118px;">23</div>
<div class="l f10 s5 c0" style="bottom:620.21px;top:166.482px;left:226.424px;">,</div>
<div class="l f8 s5 c0" style="bottom:620.21px;top:166.482px;left:228.693px;">1</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:235.999px;">is<span class="w w1"> </span>recorded<span class="w w1"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:54px;">covers<span class="w w2"> </span>line<span class="w w1"> </span>3<span class="w w1"> </span>and<span class="w w2"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>header.<span class="w w2"> </span>Thus,<span class="w w1"> </span>the<span class="w w1"> </span>end<span class="w w2"> </span>of</div>
<div class="l ff s4 c0" style="bottom:610.664px;top:173.374px;left:274.001px;">T</div>
<div class="l f8 s5 c0" style="bottom:610.248px;top:176.444px;left:279.377px;">23</div>
<div class="l f10 s5 c0" style="bottom:610.248px;top:176.444px;left:286.683px;">,</div>
<div class="l f8 s5 c0" style="bottom:610.248px;top:176.444px;left:288.952px;">1</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:54px;">jumps<span class="w w1"> </span>directly<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>start<span class="w w1"> </span>of</div>
<div class="l ff s4 c0" style="bottom:600.701px;top:183.337px;left:161.019px;">T</div>
<div class="l f8 s5 c0" style="bottom:600.285px;top:186.407px;left:166.395px;">16</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:174.199px;">.<span class="w w1"> </span>The<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>is<span class="w w1"> </span>patched<span class="w w1"> </span>so<span class="w w1"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:54px;">on<span class="w w2"> </span>future<span class="w w1"> </span>iterations,<span class="w w1"> </span>it<span class="w w2"> </span>jumps<span class="w w1"> </span>directly<span class="w w1"> </span>to</div>
<div class="l ff s4 c0" style="bottom:590.739px;top:193.299px;left:196.958px;">T</div>
<div class="l f8 s5 c0" style="bottom:590.322px;top:196.37px;left:202.334px;">23</div>
<div class="l f10 s5 c0" style="bottom:590.322px;top:196.37px;left:209.64px;">,</div>
<div class="l f8 s5 c0" style="bottom:590.322px;top:196.37px;left:211.909px;">1</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:216.06px;">.</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:65.9552px;">At<span class="w w2"> </span>this<span class="w w2"> </span>point,<span class="w w1"> </span>TraceMonkeyhas<span class="w w1"> </span>compiled<span class="w w2"> </span>enough<span class="w w2"> </span>traces<span class="w w2"> </span>to<span class="w w1"> </span>cover</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:54px;">the<span class="w w1"> </span>entire<span class="w w0"> </span>nested<span class="w w1"> </span>loop<span class="w w0"> </span>structure,<span class="w w1"> </span>so<span class="w w0"> </span>the<span class="w w1"> </span>rest<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>program<span class="w w1"> </span>runs</div>
<div class="l f2 s4 c0" style="bottom:560.654px;top:223.33px;left:54px;">entirely<span class="w w2"> </span>as<span class="w w1"> </span>native<span class="w w2"> </span>code.</div>
<div class="l f1 s2 c0" style="bottom:533.201px;top:248.946px;left:54px;">3.<span class="w w3"> </span>Trace<span class="w w2"> </span>Trees</div>
<div class="l f2 s4 c0" style="bottom:519.607px;top:264.377px;left:54px;">In<span class="w w1"> </span>this<span class="w w0"> </span>section,<span class="w w1"> </span>we<span class="w w1"> </span>describe<span class="w w0"> </span>traces,<span class="w w1"> </span>trace<span class="w w1"> </span>trees,<span class="w w0"> </span>and<span class="w w1"> </span>how<span class="w w1"> </span>they<span class="w w1"> </span>are</div>
<div class="l f2 s4 c0" style="bottom:509.645px;top:274.339px;left:54px;">formed<span class="w w2"> </span>at<span class="w w1"> </span>run<span class="w w1"> </span>time.<span class="w w2"> </span>Although<span class="w w1"> </span>our<span class="w w2"> </span>techniques<span class="w w1"> </span>apply<span class="w w2"> </span>to<span class="w w1"> </span>any<span class="w w1"> </span>dynamic</div>
<div class="l f2 s4 c0" style="bottom:499.682px;top:284.302px;left:54px;">language<span class="w w1"> </span>interpreter,<span class="w w1"> </span>we<span class="w w1"> </span>will<span class="w w0"> </span>describe<span class="w w1"> </span>them<span class="w w1"> </span>assuming<span class="w w1"> </span>a<span class="w w0"> </span>bytecode</div>
<div class="l f2 s4 c0" style="bottom:489.72px;top:294.264px;left:54px;">interpreter<span class="w w2"> </span>to<span class="w w1"> </span>keep<span class="w w1"> </span>the<span class="w w2"> </span>exposition<span class="w w1"> </span>simple.</div>
<div class="l f1 s4 c0" style="bottom:469.06px;top:314.879px;left:54px;">3.1<span class="w w10"> </span>Traces</div>
<div class="l f2 s4 c0" style="bottom:455.05px;top:328.934px;left:54px;">A</div>
<div class="l fa s4 c0" style="bottom:455.256px;top:329.024px;left:63.4995px;">trace</div>
<div class="l f2 s4 c0" style="bottom:455.05px;top:328.934px;left:84.8173px;">is<span class="w w1"> </span>simply<span class="w w1"> </span>a<span class="w w1"> </span>program<span class="w w0"> </span>path,<span class="w w1"> </span>which<span class="w w1"> </span>may<span class="w w1"> </span>cross<span class="w w1"> </span>function<span class="w w1"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:445.087px;top:338.897px;left:54px;">boundaries.<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>focuses<span class="w w1"> </span>on</div>
<div class="l fa s4 c0" style="bottom:445.293px;top:338.987px;left:191.269px;">loop<span class="w w1"> </span>traces</div>
<div class="l f2 s4 c0" style="bottom:445.087px;top:338.897px;left:231.509px;">,<span class="w w1"> </span>that<span class="w w2"> </span>originate<span class="w w1"> </span>at</div>
<div class="l f2 s4 c0" style="bottom:435.124px;top:348.86px;left:54px;">a<span class="w w1"> </span>loop<span class="w w2"> </span>edge<span class="w w1"> </span>and<span class="w w1"> </span>represent<span class="w w1"> </span>a<span class="w w1"> </span>single<span class="w w1"> </span>iteration<span class="w w1"> </span>through<span class="w w2"> </span>the<span class="w w1"> </span>associated</div>
<div class="l f2 s4 c0" style="bottom:425.162px;top:358.822px;left:54px;">loop.</div>
<div class="l f2 s4 c0" style="bottom:415.199px;top:368.785px;left:65.9552px;">Similar<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w1"> </span>extended<span class="w w1"> </span>basic<span class="w w1"> </span>block,<span class="w w0"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>is<span class="w w0"> </span>only<span class="w w1"> </span>entered<span class="w w1"> </span>at</div>
<div class="l f2 s4 c0" style="bottom:405.236px;top:378.748px;left:54px;">the<span class="w w1"> </span>top,<span class="w w2"> </span>but<span class="w w1"> </span>may<span class="w w1"> </span>have<span class="w w1"> </span>many<span class="w w2"> </span>exits.<span class="w w1"> </span>In<span class="w w1"> </span>contrast<span class="w w1"> </span>to<span class="w w1"> </span>an<span class="w w2"> </span>extended<span class="w w1"> </span>basic</div>
<div class="l f2 s4 c0" style="bottom:395.274px;top:388.71px;left:54px;">block,<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>can<span class="w w1"> </span>contain<span class="w w0"> </span>join<span class="w w1"> </span>nodes.<span class="w w0"> </span>Since<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>always<span class="w w1"> </span>only</div>
<div class="l f2 s4 c0" style="bottom:385.311px;top:398.673px;left:54px;">follows<span class="w w2"> </span>one<span class="w w2"> </span>single<span class="w w1"> </span>path<span class="w w2"> </span>through<span class="w w1"> </span>the<span class="w w2"> </span>original<span class="w w2"> </span>program,<span class="w w1"> </span>however</div>
<div class="l f2 s4 c0" style="bottom:385.311px;top:398.673px;left:275.004px;">,<span class="w w2"> </span>join</div>
<div class="l f2 s4 c0" style="bottom:375.348px;top:408.636px;left:54px;">nodes<span class="w w1"> </span>are<span class="w w0"> </span>not<span class="w w1"> </span>recognizable<span class="w w0"> </span>as<span class="w w1"> </span>such<span class="w w0"> </span>in<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>and<span class="w w0"> </span>have<span class="w w1"> </span>a<span class="w w1"> </span>single</div>
<div class="l f2 s4 c0" style="bottom:365.386px;top:418.598px;left:54px;">predecessor<span class="w w2"> </span>node<span class="w w1"> </span>like<span class="w w1"> </span>regular<span class="w w2"> </span>nodes.</div>
<div class="l f2 s4 c0" style="bottom:355.423px;top:428.561px;left:65.9552px;">A</div>
<div class="l fa s4 c0" style="bottom:355.629px;top:428.651px;left:74.653px;">typed<span class="w w2"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:355.423px;top:428.561px;left:116.813px;">is<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>annotated<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>type<span class="w w1"> </span>for<span class="w w1"> </span>every<span class="w w2"> </span>variable</div>
<div class="l f2 s4 c0" style="bottom:345.461px;top:438.523px;left:54px;">(including<span class="w w2"> </span>temporaries)<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w2"> </span>trace.<span class="w w2"> </span>A<span class="w w1"> </span>typed<span class="w w2"> </span>trace<span class="w w2"> </span>also<span class="w w1"> </span>has<span class="w w2"> </span>an<span class="w w2"> </span>entry</div>
<div class="l fa s4 c0" style="bottom:335.704px;top:448.576px;left:54px;">type<span class="w w1"> </span>map</div>
<div class="l f2 s4 c0" style="bottom:335.498px;top:448.486px;left:89.813px;">giving<span class="w w1"> </span>the<span class="w w1"> </span>required<span class="w w1"> </span>types<span class="w w1"> </span>for<span class="w w1"> </span>variables<span class="w w2"> </span>used<span class="w w1"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:325.535px;top:458.449px;left:54px;">before<span class="w w2"> </span>they<span class="w w1"> </span>are<span class="w w2"> </span>defined.<span class="w w2"> </span>For<span class="w w1"> </span>example,<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w2"> </span>could<span class="w w2"> </span>have<span class="w w1"> </span>a<span class="w w2"> </span>type<span class="w w2"> </span>map</div>
<div class="l f7 s4 c0" style="bottom:315.519px;top:469.012px;left:54px;">(x:<span class="w w0"> </span>int,<span class="w w0"> </span>b:<span class="w w0"> </span>boolean)</div>
<div class="l f2 s4 c0" style="bottom:315.573px;top:468.411px;left:148.146px;">,<span class="w w1"> </span>meaning<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w1"> </span>entered</div>
<div class="l f2 s4 c0" style="bottom:305.61px;top:478.374px;left:54px;">only<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w1"> </span>value<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>variable</div>
<div class="l f7 s4 c0" style="bottom:305.556px;top:478.975px;left:169.041px;">x</div>
<div class="l f2 s4 c0" style="bottom:305.61px;top:478.374px;left:176.089px;">is<span class="w w2"> </span>of<span class="w w1"> </span>type</div>
<div class="l f7 s4 c0" style="bottom:305.556px;top:478.975px;left:212.001px;">int</div>
<div class="l f2 s4 c0" style="bottom:305.61px;top:478.374px;left:228.463px;">and<span class="w w2"> </span>the<span class="w w1"> </span>value<span class="w w1"> </span>of</div>
<div class="l f7 s4 c0" style="bottom:305.556px;top:478.975px;left:288.396px;">b</div>
<div class="l f2 s4 c0" style="bottom:295.647px;top:488.337px;left:54px;">is<span class="w w1"> </span>of<span class="w w2"> </span>type</div>
<div class="l f7 s4 c0" style="bottom:295.594px;top:488.937px;left:90.06px;">boolean</div>
<div class="l f2 s4 c0" style="bottom:295.647px;top:488.337px;left:123.011px;">.<span class="w w1"> </span>The<span class="w w2"> </span>entry<span class="w w1"> </span>type<span class="w w1"> </span>map<span class="w w2"> </span>is<span class="w w1"> </span>much<span class="w w1"> </span>like<span class="w w1"> </span>the<span class="w w2"> </span>signature</div>
<div class="l f2 s4 c0" style="bottom:285.685px;top:498.299px;left:54px;">of<span class="w w2"> </span>a<span class="w w1"> </span>function.</div>
<div class="l f2 s4 c0" style="bottom:275.722px;top:508.262px;left:65.9552px;">In<span class="w w1"> </span>this<span class="w w0"> </span>paper,<span class="w w2"> </span>we<span class="w w0"> </span>only<span class="w w1"> </span>discuss<span class="w w1"> </span>typed<span class="w w0"> </span>loop<span class="w w1"> </span>traces,<span class="w w1"> </span>and<span class="w w0"> </span>we<span class="w w1"> </span>will</div>
<div class="l f2 s4 c0" style="bottom:265.759px;top:518.225px;left:54px;">refer<span class="w w1"> </span>to<span class="w w1"> </span>them<span class="w w0"> </span>simply<span class="w w2"> </span>as<span class="w w0"> </span>“traces”.<span class="w w1"> </span>The<span class="w w1"> </span>key<span class="w w1"> </span>property<span class="w w1"> </span>of<span class="w w0"> </span>typed<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:255.797px;top:528.187px;left:54px;">traces<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w1"> </span>they<span class="w w1"> </span>can<span class="w w2"> </span>be<span class="w w1"> </span>compiled<span class="w w1"> </span>to<span class="w w1"> </span>efficient<span class="w w2"> </span>machine<span class="w w1"> </span>code<span class="w w1"> </span>using</div>
<div class="l f2 s4 c0" style="bottom:245.834px;top:538.15px;left:54px;">the<span class="w w2"> </span>same<span class="w w1"> </span>techniques<span class="w w1"> </span>used<span class="w w2"> </span>for<span class="w w1"> </span>typed<span class="w w1"> </span>languages.</div>
<div class="l f2 s4 c0" style="bottom:235.871px;top:548.113px;left:65.9552px;">In<span class="w w2"> </span>TraceMonkey,<span class="w w2"> </span>traces<span class="w w1"> </span>are<span class="w w1"> </span>recorded<span class="w w2"> </span>in<span class="w w1"> </span>trace-flavored<span class="w w1"> </span>SSA</div>
<div class="l fa s4 c0" style="bottom:236.078px;top:548.202px;left:279.654px;">LIR</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:54px;">(low-level<span class="w w1"> </span>intermediate<span class="w w1"> </span>representation).<span class="w w1"> </span>In<span class="w w1"> </span>trace-flavored<span class="w w1"> </span>SSA<span class="w w1"> </span>(or</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:54px;">TSSA),<span class="w w1"> </span>phi<span class="w w2"> </span>nodes<span class="w w1"> </span>appear<span class="w w1"> </span>only<span class="w w1"> </span>at<span class="w w1"> </span>the<span class="w w2"> </span>entry<span class="w w1"> </span>point,<span class="w w1"> </span>which<span class="w w1"> </span>is<span class="w w1"> </span>reached</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:54px;">both<span class="w w1"> </span>on<span class="w w0"> </span>entry<span class="w w1"> </span>and<span class="w w1"> </span>via<span class="w w0"> </span>loop<span class="w w1"> </span>edges.<span class="w w0"> </span>The<span class="w w1"> </span>important<span class="w w1"> </span>LIR<span class="w w0"> </span>primitives</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:54px;">are<span class="w w0"> </span>constant<span class="w w0"> </span>values,<span class="w w0"> </span>memory<span class="w w1"> </span>loads<span class="w w0"> </span>and<span class="w w0"> </span>stores<span class="w w0"> </span>(by<span class="w w0"> </span>address<span class="w w0"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:54px;">offset),<span class="w w1"> </span>integer<span class="w w1"> </span>operators,<span class="w w0"> </span>floating-point<span class="w w1"> </span>operators,<span class="w w0"> </span>function<span class="w w1"> </span>calls,</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:54px;">and<span class="w w1"> </span>conditional<span class="w w2"> </span>exits.<span class="w w1"> </span>Type<span class="w w2"> </span>conversions,<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w2"> </span>integer<span class="w w1"> </span>to<span class="w w1"> </span>double,</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:54px;">are<span class="w w0"> </span>represented<span class="w w1"> </span>by<span class="w w0"> </span>function<span class="w w0"> </span>calls.<span class="w w1"> </span>This<span class="w w0"> </span>makes<span class="w w0"> </span>the<span class="w w0"> </span>LIR<span class="w w1"> </span>used<span class="w w0"> </span>by</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:54px;">TraceMonkey<span class="w w1"> </span>independent<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>concrete<span class="w w0"> </span>type<span class="w w1"> </span>system<span class="w w0"> </span>and<span class="w w1"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:54px;">conversion<span class="w w1"> </span>rules<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>source<span class="w w1"> </span>language.<span class="w w0"> </span>The<span class="w w1"> </span>LIR<span class="w w1"> </span>operations<span class="w w0"> </span>are</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:54px;">generic<span class="w w2"> </span>enough<span class="w w1"> </span>that<span class="w w2"> </span>the<span class="w w1"> </span>backend<span class="w w2"> </span>compiler<span class="w w2"> </span>is<span class="w w1"> </span>language<span class="w w2"> </span>independent.</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:54px;">Figure<span class="w w2"> </span>3<span class="w w1"> </span>shows<span class="w w2"> </span>an<span class="w w1"> </span>example<span class="w w1"> </span>LIR<span class="w w2"> </span>trace.</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:65.9552px;">Bytecode<span class="w w0"> </span>interpreters<span class="w w1"> </span>typically<span class="w w0"> </span>represent<span class="w w0"> </span>values<span class="w w0"> </span>in<span class="w w1"> </span>a<span class="w w0"> </span>various</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:54px;">complex<span class="w w1"> </span>data<span class="w w1"> </span>structures<span class="w w1"> </span>(e.g.,<span class="w w1"> </span>hash<span class="w w1"> </span>tables)<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>boxed<span class="w w2"> </span>format<span class="w w1"> </span>(i.e.,</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:54px;">with<span class="w w1"> </span>attached<span class="w w1"> </span>type<span class="w w1"> </span>tag<span class="w w1"> </span>bits).<span class="w w1"> </span>Since<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>intended<span class="w w1"> </span>to<span class="w w1"> </span>represent</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:54px;">efficient<span class="w w1"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>eliminates<span class="w w1"> </span>all<span class="w w1"> </span>that<span class="w w0"> </span>complexity</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:230.324px;">,<span class="w w1"> </span>our<span class="w w1"> </span>traces<span class="w w1"> </span>oper-</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:54px;">ate<span class="w w1"> </span>on<span class="w w1"> </span>unboxed<span class="w w1"> </span>values<span class="w w1"> </span>in<span class="w w0"> </span>simple<span class="w w1"> </span>variables<span class="w w1"> </span>and<span class="w w1"> </span>arrays<span class="w w1"> </span>as<span class="w w1"> </span>much<span class="w w0"> </span>as</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:54px;">possible.</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:328.969px;">A<span class="w w1"> </span>trace<span class="w w1"> </span>records<span class="w w1"> </span>all<span class="w w1"> </span>its<span class="w w2"> </span>intermediate<span class="w w1"> </span>values<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>small<span class="w w1"> </span>activation</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:317.014px;">record<span class="w w1"> </span>area.<span class="w w2"> </span>To<span class="w w1"> </span>make<span class="w w2"> </span>variable<span class="w w1"> </span>accesses<span class="w w1"> </span>fast<span class="w w1"> </span>on<span class="w w2"> </span>trace,<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>also</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:317.014px;">imports<span class="w w1"> </span>local<span class="w w1"> </span>and<span class="w w1"> </span>global<span class="w w1"> </span>variables<span class="w w2"> </span>by<span class="w w1"> </span>unboxing<span class="w w1"> </span>them<span class="w w1"> </span>and<span class="w w1"> </span>copying</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:317.014px;">them<span class="w w1"> </span>to<span class="w w0"> </span>its<span class="w w1"> </span>activation<span class="w w1"> </span>record.<span class="w w0"> </span>Thus,<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>can<span class="w w1"> </span>read<span class="w w0"> </span>and<span class="w w1"> </span>write</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:317.014px;">these<span class="w w2"> </span>variables<span class="w w2"> </span>with<span class="w w1"> </span>simple<span class="w w2"> </span>loads<span class="w w2"> </span>and<span class="w w2"> </span>stores<span class="w w1"> </span>from<span class="w w2"> </span>a<span class="w w2"> </span>native<span class="w w2"> </span>activation</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:317.014px;">recording,<span class="w w0"> </span>independently<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w0"> </span>boxing<span class="w w1"> </span>mechanism<span class="w w0"> </span>used<span class="w w0"> </span>by<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:317.014px;">interpreter.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>exits,<span class="w w1"> </span>the<span class="w w0"> </span>VM<span class="w w1"> </span>boxes<span class="w w1"> </span>the<span class="w w0"> </span>values<span class="w w1"> </span>from</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:317.014px;">this<span class="w w1"> </span>native<span class="w w2"> </span>storage<span class="w w1"> </span>location<span class="w w2"> </span>and<span class="w w1"> </span>copies<span class="w w1"> </span>them<span class="w w1"> </span>back<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:317.014px;">structures.</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:328.969px;">For<span class="w w0"> </span>every<span class="w w4"> </span>control-flow<span class="w w0"> </span>branch<span class="w w4"> </span>in<span class="w w0"> </span>the<span class="w w4"> </span>source<span class="w w4"> </span>program,<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:317.014px;">recorder<span class="w w2"> </span>generates<span class="w w1"> </span>conditional<span class="w w2"> </span>exit<span class="w w1"> </span>LIR<span class="w w2"> </span>instructions.<span class="w w1"> </span>These<span class="w w2"> </span>instruc-</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:317.014px;">tions<span class="w w1"> </span>exit<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>if<span class="w w1"> </span>required<span class="w w0"> </span>control<span class="w w2"> </span>flow<span class="w w1"> </span>is<span class="w w1"> </span>different<span class="w w1"> </span>from</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:317.014px;">what<span class="w w1"> </span>it<span class="w w1"> </span>was<span class="w w1"> </span>at<span class="w w1"> </span>trace<span class="w w1"> </span>recording,<span class="w w1"> </span>ensuring<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>instructions</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:317.014px;">are<span class="w w1"> </span>run<span class="w w0"> </span>only<span class="w w0"> </span>if<span class="w w1"> </span>they<span class="w w0"> </span>are<span class="w w1"> </span>supposed<span class="w w0"> </span>to.<span class="w w1"> </span>We<span class="w w0"> </span>call<span class="w w1"> </span>these<span class="w w0"> </span>instructions</div>
<div class="l fa s4 c0" style="bottom:570.822px;top:213.458px;left:317.014px;">guard</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:340.586px;">instructions.</div>
<div class="l f2 s4 c0" style="bottom:560.654px;top:223.33px;left:328.969px;">Most<span class="w w2"> </span>of<span class="w w2"> </span>our<span class="w w1"> </span>traces<span class="w w2"> </span>represent<span class="w w2"> </span>loops<span class="w w1"> </span>and<span class="w w2"> </span>end<span class="w w2"> </span>with<span class="w w2"> </span>the<span class="w w1"> </span>special</div>
<div class="l f7 s4 c0" style="bottom:560.6px;top:223.931px;left:537.288px;">loop</div>
<div class="l f2 s4 c0" style="bottom:550.691px;top:233.293px;left:317.014px;">LIR<span class="w w1"> </span>instruction.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w1"> </span>just<span class="w w1"> </span>an<span class="w w1"> </span>unconditional<span class="w w1"> </span>branch<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>top<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:540.728px;top:243.256px;left:317.014px;">the<span class="w w2"> </span>trace.<span class="w w1"> </span>Such<span class="w w1"> </span>traces<span class="w w2"> </span>return<span class="w w1"> </span>only<span class="w w1"> </span>via<span class="w w2"> </span>guards.</div>
<div class="l f2 s4 c0" style="bottom:530.766px;top:253.218px;left:328.969px;">Now,<span class="w w2"> </span>we<span class="w w1"> </span>describe<span class="w w0"> </span>the<span class="w w2"> </span>key<span class="w w1"> </span>optimizations<span class="w w1"> </span>that<span class="w w0"> </span>are<span class="w w2"> </span>performed<span class="w w0"> </span>as</div>
<div class="l f2 s4 c0" style="bottom:520.803px;top:263.181px;left:317.014px;">part<span class="w w1"> </span>of<span class="w w1"> </span>recording<span class="w w1"> </span>LIR.<span class="w w1"> </span>All<span class="w w1"> </span>of<span class="w w1"> </span>these<span class="w w1"> </span>optimizations<span class="w w0"> </span>reduce<span class="w w2"> </span>complex</div>
<div class="l f2 s4 c0" style="bottom:510.84px;top:273.144px;left:317.014px;">dynamic<span class="w w1"> </span>language<span class="w w0"> </span>constructs<span class="w w1"> </span>to<span class="w w0"> </span>simple<span class="w w1"> </span>typed<span class="w w0"> </span>constructs<span class="w w1"> </span>by<span class="w w0"> </span>spe-</div>
<div class="l f2 s4 c0" style="bottom:500.878px;top:283.106px;left:317.014px;">cializing<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>trace.<span class="w w1"> </span>Each<span class="w w2"> </span>optimization<span class="w w1"> </span>requires<span class="w w2"> </span>guard<span class="w w1"> </span>in-</div>
<div class="l f2 s4 c0" style="bottom:490.915px;top:293.069px;left:317.014px;">structions<span class="w w1"> </span>to<span class="w w1"> </span>verify<span class="w w1"> </span>their<span class="w w0"> </span>assumptions<span class="w w1"> </span>about<span class="w w1"> </span>the<span class="w w1"> </span>state<span class="w w1"> </span>and<span class="w w0"> </span>exit<span class="w w2"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:480.952px;top:303.032px;left:317.014px;">trace<span class="w w2"> </span>if<span class="w w1"> </span>necessary.</div>
<div class="l f1 s4 c0" style="bottom:471.053px;top:312.887px;left:328.969px;">Type<span class="w w2"> </span>specialization.</div>
<div class="l f2 s4 c0" style="bottom:461.027px;top:322.957px;left:328.969px;">All<span class="w w1"> </span>LIR<span class="w w0"> </span>primitives<span class="w w2"> </span>apply<span class="w w0"> </span>to<span class="w w1"> </span>operands<span class="w w1"> </span>of<span class="w w0"> </span>specific<span class="w w1"> </span>types.<span class="w w1"> </span>Thus,</div>
<div class="l f2 s4 c0" style="bottom:451.064px;top:332.92px;left:317.014px;">LIR<span class="w w0"> </span>traces<span class="w w1"> </span>are<span class="w w0"> </span>necessarily<span class="w w0"> </span>type-specialized,<span class="w w1"> </span>and<span class="w w0"> </span>a<span class="w w0"> </span>compiler<span class="w w1"> </span>can</div>
<div class="l f2 s4 c0" style="bottom:441.102px;top:342.882px;left:317.014px;">easily<span class="w w0"> </span>produce<span class="w w1"> </span>a<span class="w w0"> </span>translation<span class="w w1"> </span>that<span class="w w0"> </span>requires<span class="w w0"> </span>no<span class="w w1"> </span>type<span class="w w0"> </span>dispatches.<span class="w w0"> </span>A</div>
<div class="l f2 s4 c0" style="bottom:431.139px;top:352.845px;left:317.014px;">typical<span class="w w1"> </span>bytecode<span class="w w1"> </span>interpreter<span class="w w2"> </span>carries<span class="w w1"> </span>tag<span class="w w1"> </span>bits<span class="w w1"> </span>along<span class="w w1"> </span>with<span class="w w1"> </span>each<span class="w w1"> </span>value,</div>
<div class="l f2 s4 c0" style="bottom:421.177px;top:362.807px;left:317.014px;">and<span class="w w2"> </span>to<span class="w w1"> </span>perform<span class="w w2"> </span>any<span class="w w1"> </span>operation,<span class="w w1"> </span>must<span class="w w2"> </span>check<span class="w w1"> </span>the<span class="w w2"> </span>tag<span class="w w1"> </span>bits,<span class="w w2"> </span>dynamically</div>
<div class="l f2 s4 c0" style="bottom:411.214px;top:372.77px;left:317.014px;">dispatch,<span class="w w0"> </span>mask<span class="w w0"> </span>out<span class="w w0"> </span>the<span class="w w1"> </span>tag<span class="w w0"> </span>bits<span class="w w0"> </span>to<span class="w w0"> </span>recover<span class="w w0"> </span>the<span class="w w0"> </span>untagged<span class="w w0"> </span>value,</div>
<div class="l f2 s4 c0" style="bottom:401.251px;top:382.733px;left:317.014px;">perform<span class="w w2"> </span>the<span class="w w1"> </span>operation,<span class="w w2"> </span>and<span class="w w1"> </span>then<span class="w w2"> </span>reapply<span class="w w1"> </span>tags.<span class="w w2"> </span>LIR<span class="w w1"> </span>omits<span class="w w2"> </span>everything</div>
<div class="l f2 s4 c0" style="bottom:391.289px;top:392.695px;left:317.014px;">except<span class="w w2"> </span>the<span class="w w1"> </span>operation<span class="w w1"> </span>itself.</div>
<div class="l f2 s4 c0" style="bottom:381.326px;top:402.658px;left:328.969px;">A<span class="w w2"> </span>potential<span class="w w1"> </span>problem<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w1"> </span>some<span class="w w2"> </span>operations<span class="w w1"> </span>can<span class="w w2"> </span>produce<span class="w w1"> </span>values</div>
<div class="l f2 s4 c0" style="bottom:371.363px;top:412.621px;left:317.014px;">of<span class="w w1"> </span>unpredictable<span class="w w0"> </span>types.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w1"> </span>reading<span class="w w0"> </span>a<span class="w w1"> </span>property<span class="w w1"> </span>from<span class="w w0"> </span>an</div>
<div class="l f2 s4 c0" style="bottom:361.401px;top:422.583px;left:317.014px;">object<span class="w w1"> </span>could<span class="w w0"> </span>yield<span class="w w0"> </span>a<span class="w w1"> </span>value<span class="w w1"> </span>of<span class="w w0"> </span>any<span class="w w0"> </span>type,<span class="w w1"> </span>not<span class="w w0"> </span>necessarily<span class="w w1"> </span>the<span class="w w0"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:351.438px;top:432.546px;left:317.014px;">observed<span class="w w1"> </span>during<span class="w w1"> </span>recording.<span class="w w1"> </span>The<span class="w w0"> </span>recorder<span class="w w1"> </span>emits<span class="w w1"> </span>guard<span class="w w1"> </span>instructions</div>
<div class="l f2 s4 c0" style="bottom:341.475px;top:442.509px;left:317.014px;">that<span class="w w1"> </span>conditionally<span class="w w2"> </span>exit<span class="w w1"> </span>if<span class="w w1"> </span>the<span class="w w1"> </span>operation<span class="w w1"> </span>yields<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>different</div>
<div class="l f2 s4 c0" style="bottom:331.513px;top:452.471px;left:317.014px;">type<span class="w w0"> </span>from<span class="w w0"> </span>that<span class="w w1"> </span>seen<span class="w w0"> </span>during<span class="w w0"> </span>recording.<span class="w w0"> </span>These<span class="w w0"> </span>guard<span class="w w1"> </span>instructions</div>
<div class="l f2 s4 c0" style="bottom:321.55px;top:462.434px;left:317.014px;">guarantee<span class="w w1"> </span>that<span class="w w2"> </span>as<span class="w w1"> </span>long<span class="w w1"> </span>as<span class="w w1"> </span>execution<span class="w w1"> </span>is<span class="w w1"> </span>on<span class="w w2"> </span>trace,<span class="w w1"> </span>the<span class="w w1"> </span>types<span class="w w1"> </span>of<span class="w w1"> </span>values</div>
<div class="l f2 s4 c0" style="bottom:311.588px;top:472.396px;left:317.014px;">match<span class="w w1"> </span>those<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>typed<span class="w w1"> </span>trace.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>observes<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit</div>
<div class="l f2 s4 c0" style="bottom:301.625px;top:482.359px;left:317.014px;">along<span class="w w1"> </span>such<span class="w w2"> </span>a<span class="w w1"> </span>type<span class="w w1"> </span>guard,<span class="w w1"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>typed<span class="w w2"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>recorded<span class="w w1"> </span>originating</div>
<div class="l f2 s4 c0" style="bottom:291.662px;top:492.322px;left:317.014px;">at<span class="w w2"> </span>the<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>location,<span class="w w2"> </span>capturing<span class="w w1"> </span>the<span class="w w1"> </span>new<span class="w w2"> </span>type<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>operation<span class="w w2"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:281.7px;top:502.284px;left:317.014px;">question.</div>
<div class="l f1 s4 c0" style="bottom:271.8px;top:512.139px;left:328.969px;">Representation<span class="w w1"> </span>specialization:<span class="w w0"> </span>objects.</div>
<div class="l f2 s4 c0" style="bottom:271.737px;top:512.247px;left:482.423px;">In<span class="w w0"> </span>Jav</div>
<div class="l f2 s4 c0" style="bottom:271.737px;top:512.247px;left:505.251px;">aScript,<span class="w w0"> </span>name</div>
<div class="l f2 s4 c0" style="bottom:261.774px;top:522.21px;left:317.014px;">lookup<span class="w w1"> </span>semantics<span class="w w1"> </span>are<span class="w w0"> </span>complex<span class="w w1"> </span>and<span class="w w1"> </span>potentially<span class="w w1"> </span>expensive<span class="w w1"> </span>because</div>
<div class="l f2 s4 c0" style="bottom:251.812px;top:532.172px;left:317.014px;">they<span class="w w2"> </span>include<span class="w w1"> </span>features<span class="w w1"> </span>like<span class="w w2"> </span>object<span class="w w1"> </span>inheritance<span class="w w1"> </span>and</div>
<div class="l f7 s4 c0" style="bottom:251.758px;top:532.773px;left:491.658px;">eval</div>
<div class="l f2 s4 c0" style="bottom:251.812px;top:532.172px;left:510.488px;">.<span class="w w2"> </span>To<span class="w w1"> </span>evaluate</div>
<div class="l f2 s4 c0" style="bottom:241.849px;top:542.135px;left:317.014px;">an<span class="w w1"> </span>object<span class="w w0"> </span>property<span class="w w1"> </span>read<span class="w w1"> </span>expression<span class="w w1"> </span>like</div>
<div class="l f7 s4 c0" style="bottom:241.795px;top:542.736px;left:464.267px;">o.x</div>
<div class="l f2 s4 c0" style="bottom:241.849px;top:542.135px;left:478.389px;">,<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>must</div>
<div class="l f2 s4 c0" style="bottom:231.886px;top:552.098px;left:317.014px;">search<span class="w w1"> </span>the<span class="w w2"> </span>property<span class="w w1"> </span>map<span class="w w1"> </span>of</div>
<div class="l f7 s4 c0" style="bottom:231.833px;top:552.698px;left:416.848px;">o</div>
<div class="l f2 s4 c0" style="bottom:231.886px;top:552.098px;left:424.093px;">and<span class="w w1"> </span>all<span class="w w2"> </span>of<span class="w w1"> </span>its<span class="w w1"> </span>prototypes<span class="w w1"> </span>and<span class="w w1"> </span>parents.</div>
<div class="l f2 s4 c0" style="bottom:221.924px;top:562.06px;left:317.014px;">Property<span class="w w1"> </span>maps<span class="w w1"> </span>can<span class="w w0"> </span>be<span class="w w1"> </span>implemented<span class="w w1"> </span>with<span class="w w1"> </span>different<span class="w w1"> </span>data<span class="w w0"> </span>structures</div>
<div class="l f2 s4 c0" style="bottom:211.961px;top:572.023px;left:317.014px;">(e.g.,<span class="w w1"> </span>per-object<span class="w w1"> </span>hash<span class="w w0"> </span>tables<span class="w w1"> </span>or<span class="w w1"> </span>shared<span class="w w1"> </span>hash<span class="w w0"> </span>tables),<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w0"> </span>search</div>
<div class="l f2 s4 c0" style="bottom:201.998px;top:581.986px;left:317.014px;">process<span class="w w0"> </span>also<span class="w w1"> </span>must<span class="w w0"> </span>dispatch<span class="w w1"> </span>on<span class="w w0"> </span>the<span class="w w1"> </span>representation<span class="w w0"> </span>of<span class="w w0"> </span>each<span class="w w1"> </span>object</div>
<div class="l f2 s4 c0" style="bottom:192.036px;top:591.948px;left:317.014px;">found<span class="w w2"> </span>during<span class="w w2"> </span>search.<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>can<span class="w w2"> </span>simply<span class="w w1"> </span>observe<span class="w w2"> </span>the<span class="w w2"> </span>result<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:182.073px;top:601.911px;left:317.014px;">the<span class="w w1"> </span>search<span class="w w1"> </span>process<span class="w w1"> </span>and<span class="w w1"> </span>record<span class="w w1"> </span>the<span class="w w1"> </span>simplest<span class="w w1"> </span>possible<span class="w w1"> </span>LIR<span class="w w1"> </span>to<span class="w w1"> </span>access</div>
<div class="l f2 s4 c0" style="bottom:172.111px;top:611.873px;left:317.014px;">the<span class="w w2"> </span>property<span class="w w1"> </span>value.<span class="w w2"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>the<span class="w w2"> </span>search<span class="w w2"> </span>might<span class="w w1"> </span>finds<span class="w w2"> </span>the<span class="w w1"> </span>value<span class="w w2"> </span>of</div>
<div class="l f7 s4 c0" style="bottom:162.094px;top:622.437px;left:317.014px;">o.x</div>
<div class="l f2 s4 c0" style="bottom:162.148px;top:621.836px;left:333.256px;">in<span class="w w2"> </span>the<span class="w w1"> </span>prototype<span class="w w2"> </span>of</div>
<div class="l f7 s4 c0" style="bottom:162.094px;top:622.437px;left:401.505px;">o</div>
<div class="l f2 s4 c0" style="bottom:162.148px;top:621.836px;left:406.213px;">,<span class="w w2"> </span>which<span class="w w1"> </span>uses<span class="w w2"> </span>a<span class="w w1"> </span>shared<span class="w w2"> </span>hash-table<span class="w w1"> </span>represen-</div>
<div class="l f2 s4 c0" style="bottom:152.185px;top:631.799px;left:317.014px;">tation<span class="w w2"> </span>that<span class="w w1"> </span>places</div>
<div class="l f7 s4 c0" style="bottom:152.131px;top:632.4px;left:379.55px;">x</div>
<div class="l f2 s4 c0" style="bottom:152.185px;top:631.799px;left:386.342px;">in<span class="w w2"> </span>slot<span class="w w1"> </span>2<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w2"> </span>property<span class="w w1"> </span>vector.<span class="w w2"> </span>Then<span class="w w2"> </span>the<span class="w w1"> </span>recorded</div>
<div class="l f2 s4 c0" style="bottom:142.223px;top:641.761px;left:317.014px;">can<span class="w w2"> </span>generate<span class="w w1"> </span>LIR<span class="w w2"> </span>that<span class="w w1"> </span>reads</div>
<div class="l f7 s4 c0" style="bottom:142.169px;top:642.362px;left:416.779px;">o.x</div>
<div class="l f2 s4 c0" style="bottom:142.223px;top:641.761px;left:432.929px;">with<span class="w w2"> </span>just<span class="w w1"> </span>two<span class="w w2"> </span>or<span class="w w1"> </span>three<span class="w w2"> </span>loads:<span class="w w1"> </span>one<span class="w w2"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:132.26px;top:651.724px;left:317.014px;">get<span class="w w2"> </span>the<span class="w w1"> </span>prototype,<span class="w w2"> </span>possibly<span class="w w1"> </span>one<span class="w w2"> </span>to<span class="w w1"> </span>get<span class="w w2"> </span>the<span class="w w2"> </span>property<span class="w w1"> </span>value<span class="w w2"> </span>vector,<span class="w w2"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:122.297px;top:661.687px;left:317.014px;">one<span class="w w2"> </span>more<span class="w w1"> </span>to<span class="w w1"> </span>get<span class="w w1"> </span>slot<span class="w w2"> </span>2<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w2"> </span>vector.<span class="w w1"> </span>This<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w1"> </span>vast<span class="w w2"> </span>simplification</div>
<div class="l f2 s4 c0" style="bottom:112.335px;top:671.649px;left:317.014px;">and<span class="w w2"> </span>speedup<span class="w w1"> </span>compared<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>original<span class="w w1"> </span>interpreter<span class="w w1"> </span>code.<span class="w w2"> </span>Inheritance</div>
<div class="l f2 s4 c0" style="bottom:102.372px;top:681.612px;left:317.014px;">relationships<span class="w w1"> </span>and<span class="w w1"> </span>object<span class="w w1"> </span>representations<span class="w w1"> </span>can<span class="w w1"> </span>change<span class="w w1"> </span>during<span class="w w1"> </span>execu-</div>
<div class="l f2 s4 c0" style="bottom:92.4095px;top:691.575px;left:317.014px;">tion,<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w2"> </span>simplified<span class="w w1"> </span>code<span class="w w1"> </span>requires<span class="w w1"> </span>guard<span class="w w1"> </span>instructions<span class="w w1"> </span>that<span class="w w1"> </span>ensure</div>
<div class="l f2 s4 c0" style="bottom:82.4469px;top:701.537px;left:317.014px;">the<span class="w w2"> </span>object<span class="w w2"> </span>representation<span class="w w1"> </span>is<span class="w w2"> </span>the<span class="w w2"> </span>same.<span class="w w1"> </span>In<span class="w w2"> </span>TraceMonkey,objects’<span class="w w1"> </span>rep-</div>
</div>
<div id="page-5" class="p" style="width:612px;height:792px;background-image:url(p5.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:54px;">resentations<span class="w w1"> </span>are<span class="w w0"> </span>assigned<span class="w w1"> </span>an<span class="w w0"> </span>integer<span class="w w1"> </span>key<span class="w w1"> </span>called<span class="w w0"> </span>the</div>
<div class="l fa s4 c0" style="bottom:710.299px;top:73.9805px;left:244.58px;">object<span class="w w1"> </span>shape</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:290.862px;">.</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:54px;">Thus,<span class="w w2"> </span>the<span class="w w1"> </span>guard<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>simple<span class="w w1"> </span>equality<span class="w w2"> </span>check<span class="w w1"> </span>on<span class="w w2"> </span>the<span class="w w1"> </span>object<span class="w w1"> </span>shape.</div>
<div class="l f1 s4 c0" style="bottom:690.231px;top:93.7086px;left:65.9552px;">Representation<span class="w w0"> </span>specialization:<span class="w w1"> </span>numbers.</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:227.131px;">JavaScript<span class="w w1"> </span>has<span class="w w0"> </span>no</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:54px;">integer<span class="w w1"> </span>type,<span class="w w0"> </span>only<span class="w w1"> </span>a<span class="w w1"> </span>Number<span class="w w0"> </span>type<span class="w w1"> </span>that<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>set<span class="w w1"> </span>of<span class="w w0"> </span>64-bit<span class="w w1"> </span>IEEE-</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:54px;">754<span class="w w0"> </span>floating-pointer<span class="w w0"> </span>numbers<span class="w w1"> </span>(“doubles”).<span class="w w0"> </span>But<span class="w w0"> </span>many<span class="w w0"> </span>JavaScript</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:54px;">operators,<span class="w w2"> </span>in<span class="w w1"> </span>particular<span class="w w1"> </span>array<span class="w w1"> </span>accesses<span class="w w2"> </span>and<span class="w w1"> </span>bitwise<span class="w w1"> </span>operators,<span class="w w2"> </span>really</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:54px;">operate<span class="w w1"> </span>on<span class="w w1"> </span>integers,<span class="w w2"> </span>so<span class="w w1"> </span>they<span class="w w1"> </span>first<span class="w w1"> </span>convert<span class="w w1"> </span>the<span class="w w1"> </span>number<span class="w w1"> </span>to<span class="w w1"> </span>an<span class="w w1"> </span>integer,</div>
<div class="l f2 s4 c0" style="bottom:639.992px;top:143.992px;left:54px;">and<span class="w w1"> </span>then<span class="w w0"> </span>conv</div>
<div class="l f2 s4 c0" style="bottom:639.992px;top:143.992px;left:106.005px;">ert<span class="w w1"> </span>any<span class="w w0"> </span>integer<span class="w w1"> </span>result<span class="w w1"> </span>back<span class="w w0"> </span>to<span class="w w1"> </span>a<span class="w w1"> </span>double.</div>
<div class="l f2 s5 c0" style="bottom:644.447px;top:142.209px;left:250.896px;">1</div>
<div class="l f2 s4 c0" style="bottom:639.992px;top:143.992px;left:257.725px;">Clearly,<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:630.03px;top:153.954px;left:54px;">JavaScript<span class="w w2"> </span>VM<span class="w w1"> </span>that<span class="w w1"> </span>wants<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w2"> </span>fast<span class="w w1"> </span>must<span class="w w1"> </span>find<span class="w w1"> </span>a<span class="w w1"> </span>way<span class="w w2"> </span>to<span class="w w1"> </span>operate<span class="w w1"> </span>on</div>
<div class="l f2 s4 c0" style="bottom:620.067px;top:163.917px;left:54px;">integers<span class="w w2"> </span>directly<span class="w w1"> </span>and<span class="w w1"> </span>avoid<span class="w w2"> </span>these<span class="w w1"> </span>conversions.</div>
<div class="l f2 s4 c0" style="bottom:610.104px;top:173.88px;left:65.9552px;">In<span class="w w1"> </span>TraceMonkey</div>
<div class="l f2 s4 c0" style="bottom:610.104px;top:173.88px;left:125.376px;">,<span class="w w1"> </span>we<span class="w w1"> </span>support<span class="w w1"> </span>two<span class="w w1"> </span>representations<span class="w w1"> </span>for<span class="w w1"> </span>numbers:</div>
<div class="l f2 s4 c0" style="bottom:600.142px;top:183.842px;left:54px;">integers<span class="w w1"> </span>and<span class="w w1"> </span>doubles.<span class="w w0"> </span>The<span class="w w1"> </span>interpreter<span class="w w1"> </span>uses<span class="w w1"> </span>integer<span class="w w1"> </span>representations</div>
<div class="l f2 s4 c0" style="bottom:590.179px;top:193.805px;left:54px;">as<span class="w w2"> </span>much<span class="w w1"> </span>as<span class="w w2"> </span>it<span class="w w1"> </span>can,<span class="w w2"> </span>switching<span class="w w1"> </span>for<span class="w w2"> </span>results<span class="w w2"> </span>that<span class="w w1"> </span>can<span class="w w2"> </span>only<span class="w w1"> </span>be<span class="w w2"> </span>represented</div>
<div class="l f2 s4 c0" style="bottom:580.217px;top:203.767px;left:54px;">as<span class="w w1"> </span>doubles.<span class="w w1"> </span>When<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>started,<span class="w w1"> </span>some<span class="w w1"> </span>values<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w1"> </span>imported</div>
<div class="l f2 s4 c0" style="bottom:570.254px;top:213.73px;left:54px;">and<span class="w w1"> </span>represented<span class="w w0"> </span>as<span class="w w1"> </span>integers.<span class="w w1"> </span>Some<span class="w w1"> </span>operations<span class="w w0"> </span>on<span class="w w1"> </span>integers<span class="w w1"> </span>require</div>
<div class="l f2 s4 c0" style="bottom:560.291px;top:223.693px;left:54px;">guards.<span class="w w1"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>adding<span class="w w1"> </span>two<span class="w w1"> </span>integers<span class="w w1"> </span>can<span class="w w1"> </span>produce<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w2"> </span>too</div>
<div class="l f2 s4 c0" style="bottom:550.329px;top:233.655px;left:54px;">large<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>integer<span class="w w2"> </span>representation.</div>
<div class="l f1 s4 c0" style="bottom:540.429px;top:243.51px;left:65.9552px;">Function<span class="w w1"> </span>inlining.</div>
<div class="l f2 s4 c0" style="bottom:540.366px;top:243.618px;left:139.22px;">LIR<span class="w w1"> </span>traces<span class="w w0"> </span>can<span class="w w0"> </span>cross<span class="w w1"> </span>function<span class="w w0"> </span>boundaries</div>
<div class="l f2 s4 c0" style="bottom:530.403px;top:253.581px;left:54px;">in<span class="w w1"> </span>either<span class="w w1"> </span>direction,<span class="w w1"> </span>achieving<span class="w w1"> </span>function<span class="w w1"> </span>inlining.<span class="w w1"> </span>Move<span class="w w1"> </span>instructions</div>
<div class="l f2 s4 c0" style="bottom:520.441px;top:263.543px;left:54px;">need<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w2"> </span>recorded<span class="w w1"> </span>for<span class="w w1"> </span>function<span class="w w1"> </span>entry<span class="w w1"> </span>and<span class="w w1"> </span>exit<span class="w w1"> </span>to<span class="w w1"> </span>copy<span class="w w1"> </span>arguments</div>
<div class="l f2 s4 c0" style="bottom:510.478px;top:273.506px;left:54px;">in<span class="w w2"> </span>and<span class="w w1"> </span>return<span class="w w2"> </span>values<span class="w w2"> </span>out.<span class="w w1"> </span>These<span class="w w2"> </span>move<span class="w w1"> </span>statements<span class="w w2"> </span>are<span class="w w1"> </span>then<span class="w w2"> </span>optimized</div>
<div class="l f2 s4 c0" style="bottom:500.515px;top:283.469px;left:54px;">away<span class="w w1"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>compiler<span class="w w1"> </span>using<span class="w w1"> </span>copy<span class="w w2"> </span>propagation.<span class="w w1"> </span>In<span class="w w1"> </span>order<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>able</div>
<div class="l f2 s4 c0" style="bottom:490.553px;top:293.431px;left:54px;">to<span class="w w0"> </span>return<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>interpreter,<span class="w w0"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>must<span class="w w1"> </span>also<span class="w w0"> </span>generate<span class="w w0"> </span>LIR<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:480.59px;top:303.394px;left:54px;">record<span class="w w1"> </span>that<span class="w w0"> </span>a<span class="w w1"> </span>call<span class="w w0"> </span>frame<span class="w w1"> </span>has<span class="w w1"> </span>been<span class="w w0"> </span>entered<span class="w w1"> </span>and<span class="w w0"> </span>exited.<span class="w w1"> </span>The<span class="w w1"> </span>frame</div>
<div class="l f2 s4 c0" style="bottom:470.627px;top:313.357px;left:54px;">entry<span class="w w0"> </span>and<span class="w w0"> </span>exit<span class="w w1"> </span>LIR<span class="w w0"> </span>saves<span class="w w0"> </span>just<span class="w w0"> </span>enough<span class="w w1"> </span>information<span class="w w0"> </span>to<span class="w w0"> </span>allow<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:460.665px;top:323.319px;left:54px;">intepreter<span class="w w1"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>restored<span class="w w1"> </span>later<span class="w w0"> </span>and<span class="w w2"> </span>is<span class="w w0"> </span>much<span class="w w2"> </span>simpler<span class="w w0"> </span>than</div>
<div class="l f2 s4 c0" style="bottom:450.702px;top:333.282px;left:54px;">the<span class="w w1"> </span>interpreter’s<span class="w w1"> </span>standard<span class="w w0"> </span>call<span class="w w1"> </span>code.<span class="w w1"> </span>If<span class="w w1"> </span>the<span class="w w0"> </span>function<span class="w w1"> </span>being<span class="w w1"> </span>entered</div>
<div class="l f2 s4 c0" style="bottom:440.74px;top:343.244px;left:54px;">is<span class="w w1"> </span>not<span class="w w1"> </span>constant<span class="w w1"> </span>(which<span class="w w1"> </span>in<span class="w w1"> </span>JavaScript<span class="w w1"> </span>includes<span class="w w1"> </span>any<span class="w w1"> </span>call<span class="w w1"> </span>by<span class="w w1"> </span>function</div>
<div class="l f2 s4 c0" style="bottom:430.777px;top:353.207px;left:54px;">name),<span class="w w1"> </span>the<span class="w w1"> </span>recorder<span class="w w1"> </span>must<span class="w w1"> </span>also<span class="w w1"> </span>emit<span class="w w1"> </span>LIR<span class="w w1"> </span>to<span class="w w1"> </span>guard<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>function</div>
<div class="l f2 s4 c0" style="bottom:420.814px;top:363.17px;left:54px;">is<span class="w w2"> </span>the<span class="w w1"> </span>same.</div>
<div class="l f1 s4 c0" style="bottom:410.914px;top:373.025px;left:65.9552px;">Guards<span class="w w0"> </span>and<span class="w w0"> </span>side<span class="w w0"> </span>exits.</div>
<div class="l f2 s4 c0" style="bottom:410.852px;top:373.132px;left:161.308px;">Each<span class="w w0"> </span>optimization<span class="w w0"> </span>described<span class="w w0"> </span>above</div>
<div class="l f2 s4 c0" style="bottom:400.889px;top:383.095px;left:54px;">requires<span class="w w0"> </span>one<span class="w w1"> </span>or<span class="w w0"> </span>more<span class="w w1"> </span>guards<span class="w w0"> </span>to<span class="w w1"> </span>verify<span class="w w0"> </span>the<span class="w w0"> </span>assumptions<span class="w w1"> </span>made<span class="w w0"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:390.926px;top:393.058px;left:54px;">doing<span class="w w2"> </span>the<span class="w w1"> </span>optimization.<span class="w w1"> </span>A<span class="w w1"> </span>guard<span class="w w2"> </span>is<span class="w w1"> </span>just<span class="w w1"> </span>a<span class="w w2"> </span>group<span class="w w1"> </span>of<span class="w w1"> </span>LIR<span class="w w2"> </span>instructions</div>
<div class="l f2 s4 c0" style="bottom:380.964px;top:403.02px;left:54px;">that<span class="w w1"> </span>performs<span class="w w0"> </span>a<span class="w w1"> </span>test<span class="w w0"> </span>and<span class="w w1"> </span>conditional<span class="w w1"> </span>exit.<span class="w w0"> </span>The<span class="w w1"> </span>exit<span class="w w1"> </span>branches<span class="w w0"> </span>to<span class="w w1"> </span>a</div>
<div class="l fa s4 c0" style="bottom:371.207px;top:413.073px;left:54px;">side<span class="w w1"> </span>exit</div>
<div class="l f2 s4 c0" style="bottom:371.001px;top:412.983px;left:84.551px;">,<span class="w w1"> </span>a<span class="w w0"> </span>small<span class="w w1"> </span>off-trace<span class="w w1"> </span>piece<span class="w w0"> </span>of<span class="w w1"> </span>LIR<span class="w w1"> </span>that<span class="w w0"> </span>returns<span class="w w1"> </span>a<span class="w w1"> </span>pointer<span class="w w0"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:361.038px;top:422.946px;left:54px;">a<span class="w w1"> </span>structure<span class="w w0"> </span>that<span class="w w0"> </span>describes<span class="w w1"> </span>the<span class="w w0"> </span>reason<span class="w w1"> </span>for<span class="w w0"> </span>the<span class="w w1"> </span>exit<span class="w w0"> </span>along<span class="w w0"> </span>with<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:351.076px;top:432.908px;left:54px;">interpreter<span class="w w2"> </span>PC<span class="w w1"> </span>at<span class="w w2"> </span>the<span class="w w1"> </span>exit<span class="w w2"> </span>point<span class="w w1"> </span>and<span class="w w1"> </span>any<span class="w w2"> </span>other<span class="w w1"> </span>data<span class="w w2"> </span>needed<span class="w w1"> </span>to<span class="w w2"> </span>restore</div>
<div class="l f2 s4 c0" style="bottom:341.113px;top:442.871px;left:54px;">the<span class="w w2"> </span>interpreter’s<span class="w w1"> </span>state<span class="w w2"> </span>structures.</div>
<div class="l f1 s4 c0" style="bottom:331.213px;top:452.726px;left:65.9552px;">Aborts.</div>
<div class="l f2 s4 c0" style="bottom:331.151px;top:452.833px;left:97.7225px;">Some<span class="w w1"> </span>constructs<span class="w w1"> </span>are<span class="w w0"> </span>difficult<span class="w w2"> </span>to<span class="w w0"> </span>record<span class="w w1"> </span>in<span class="w w1"> </span>LIR<span class="w w1"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:321.188px;top:462.796px;left:54px;">For<span class="w w1"> </span>example,</div>
<div class="l f7 s4 c0" style="bottom:321.134px;top:463.397px;left:105.54px;">eval</div>
<div class="l f2 s4 c0" style="bottom:321.188px;top:462.796px;left:127.737px;">or<span class="w w1"> </span>calls<span class="w w0"> </span>to<span class="w w1"> </span>external<span class="w w1"> </span>functions<span class="w w0"> </span>can<span class="w w1"> </span>change<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:311.225px;top:472.759px;left:54px;">program<span class="w w0"> </span>state<span class="w w1"> </span>in<span class="w w0"> </span>unpredictable<span class="w w1"> </span>ways,<span class="w w0"> </span>making<span class="w w0"> </span>it<span class="w w1"> </span>difficult<span class="w w0"> </span>for<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:301.263px;top:482.721px;left:54px;">tracer<span class="w w1"> </span>to<span class="w w1"> </span>know<span class="w w1"> </span>the<span class="w w0"> </span>current<span class="w w1"> </span>type<span class="w w1"> </span>map<span class="w w1"> </span>in<span class="w w1"> </span>order<span class="w w0"> </span>to<span class="w w1"> </span>continue<span class="w w1"> </span>tracing.</div>
<div class="l f2 s4 c0" style="bottom:291.3px;top:492.684px;left:54px;">A<span class="w w1"> </span>tracing<span class="w w2"> </span>implementation<span class="w w1"> </span>can<span class="w w1"> </span>also<span class="w w1"> </span>have<span class="w w2"> </span>any<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>other<span class="w w1"> </span>limi-</div>
<div class="l f2 s4 c0" style="bottom:281.337px;top:502.647px;left:54px;">tations,<span class="w w1"> </span>e.g.,a<span class="w w2"> </span>small-memory<span class="w w1"> </span>device<span class="w w1"> </span>may<span class="w w2"> </span>limit<span class="w w1"> </span>the<span class="w w1"> </span>length<span class="w w1"> </span>of<span class="w w1"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:271.375px;top:512.609px;left:54px;">When<span class="w w1"> </span>any<span class="w w1"> </span>situation<span class="w w1"> </span>occurs<span class="w w1"> </span>that<span class="w w1"> </span>prevents<span class="w w1"> </span>the<span class="w w1"> </span>implementation<span class="w w1"> </span>from</div>
<div class="l f2 s4 c0" style="bottom:261.412px;top:522.572px;left:54px;">continuing<span class="w w2"> </span>trace<span class="w w1"> </span>recording,<span class="w w2"> </span>the<span class="w w2"> </span>implementation</div>
<div class="l fa s4 c0" style="bottom:261.618px;top:522.662px;left:223.092px;">aborts</div>
<div class="l f2 s4 c0" style="bottom:261.412px;top:522.572px;left:247.903px;">trace<span class="w w2"> </span>record-</div>
<div class="l f2 s4 c0" style="bottom:251.449px;top:532.535px;left:54px;">ing<span class="w w2"> </span>and<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor.</div>
<div class="l f1 s4 c0" style="bottom:227.061px;top:556.879px;left:54px;">3.2<span class="w w10"> </span>Trace<span class="w w2"> </span>Trees</div>
<div class="l f2 s4 c0" style="bottom:213.05px;top:570.934px;left:54px;">Especially<span class="w w1"> </span>simple<span class="w w0"> </span>loops,<span class="w w1"> </span>namely<span class="w w1"> </span>those<span class="w w0"> </span>where<span class="w w1"> </span>control<span class="w w1"> </span>flow,<span class="w w1"> </span>value</div>
<div class="l f2 s4 c0" style="bottom:203.088px;top:580.896px;left:54px;">types,<span class="w w2"> </span>value<span class="w w1"> </span>representations,<span class="w w2"> </span>and<span class="w w1"> </span>inlined<span class="w w1"> </span>functions<span class="w w2"> </span>are<span class="w w1"> </span>all<span class="w w2"> </span>invariant,</div>
<div class="l f2 s4 c0" style="bottom:193.125px;top:590.859px;left:54px;">can<span class="w w1"> </span>be<span class="w w1"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>single<span class="w w1"> </span>trace.<span class="w w1"> </span>But<span class="w w1"> </span>most<span class="w w1"> </span>loops<span class="w w1"> </span>have<span class="w w1"> </span>at<span class="w w1"> </span>least</div>
<div class="l f2 s4 c0" style="bottom:183.162px;top:600.822px;left:54px;">some<span class="w w1"> </span>variation,<span class="w w1"> </span>and<span class="w w0"> </span>so<span class="w w1"> </span>the<span class="w w1"> </span>program<span class="w w0"> </span>will<span class="w w1"> </span>take<span class="w w1"> </span>side<span class="w w1"> </span>exits<span class="w w0"> </span>from<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:173.2px;top:610.784px;left:54px;">main<span class="w w1"> </span>trace.<span class="w w1"> </span>When<span class="w w1"> </span>a<span class="w w0"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>becomes<span class="w w1"> </span>hot,<span class="w w1"> </span>TraceMonkey<span class="w w1"> </span>starts<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:163.237px;top:620.747px;left:54px;">new</div>
<div class="l fa s4 c0" style="bottom:163.443px;top:620.837px;left:71.021px;">branch<span class="w w2"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:163.237px;top:620.747px;left:119.059px;">from<span class="w w2"> </span>that<span class="w w1"> </span>point<span class="w w1"> </span>and<span class="w w2"> </span>patches<span class="w w1"> </span>the<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>to<span class="w w1"> </span>jump</div>
<div class="l f2 s4 c0" style="bottom:153.274px;top:630.71px;left:54px;">directly<span class="w w2"> </span>to<span class="w w1"> </span>that<span class="w w2"> </span>trace.<span class="w w1"> </span>In<span class="w w2"> </span>this<span class="w w1"> </span>way,<span class="w w2"> </span>a<span class="w w1"> </span>single<span class="w w2"> </span>trace<span class="w w1"> </span>expands<span class="w w2"> </span>on<span class="w w1"> </span>demand</div>
<div class="l f2 s4 c0" style="bottom:143.312px;top:640.672px;left:54px;">to<span class="w w2"> </span>a<span class="w w1"> </span>single-entry,<span class="w w2"> </span>multiple-exit</div>
<div class="l fa s4 c0" style="bottom:143.518px;top:640.762px;left:164.608px;">trace<span class="w w2"> </span>tree</div>
<div class="l f2 s4 c0" style="bottom:143.312px;top:640.672px;left:198.751px;">.</div>
<div class="l f2 s4 c0" style="bottom:133.349px;top:650.635px;left:65.9552px;">This<span class="w w1"> </span>section<span class="w w2"> </span>explains<span class="w w1"> </span>how<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w2"> </span>are<span class="w w1"> </span>formed<span class="w w1"> </span>during<span class="w w1"> </span>execu-</div>
<div class="l f2 s4 c0" style="bottom:123.386px;top:660.598px;left:54px;">tion.<span class="w w1"> </span>The<span class="w w2"> </span>goal<span class="w w1"> </span>is<span class="w w1"> </span>to<span class="w w2"> </span>form<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>during<span class="w w2"> </span>execution<span class="w w1"> </span>that<span class="w w1"> </span>cover<span class="w w2"> </span>all</div>
<div class="l f2 s4 c0" style="bottom:113.424px;top:670.56px;left:54px;">the<span class="w w2"> </span>hot<span class="w w1"> </span>paths<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>program.</div>
<div class="l f2 s5 c0" style="bottom:87.8977px;top:698.758px;left:54px;">1</div>
<div class="l f2 s3 c0" style="bottom:84.6546px;top:700.22px;left:58.4832px;">Arrays<span class="w w2"> </span>are<span class="w w1"> </span>actually<span class="w w2"> </span>worse<span class="w w2"> </span>than<span class="w w1"> </span>this:<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>index<span class="w w2"> </span>value<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>number,<span class="w w2"> </span>it<span class="w w2"> </span>must</div>
<div class="l f2 s3 c0" style="bottom:75.6882px;top:709.187px;left:54px;">be<span class="w w2"> </span>converted<span class="w w2"> </span>from<span class="w w1"> </span>a<span class="w w2"> </span>double<span class="w w1"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>string<span class="w w2"> </span>for<span class="w w2"> </span>the<span class="w w1"> </span>property<span class="w w2"> </span>access<span class="w w1"> </span>operator,<span class="w w2"> </span>and</div>
<div class="l f2 s3 c0" style="bottom:66.7218px;top:718.153px;left:54px;">then<span class="w w2"> </span>to<span class="w w1"> </span>an<span class="w w2"> </span>integer<span class="w w2"> </span>internally<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>array<span class="w w2"> </span>implementation.</div>
<div class="l f1 s4 c0" style="bottom:710.156px;top:73.7833px;left:328.969px;">Starting<span class="w w2"> </span>a<span class="w w1"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:388.04px;">Tree<span class="w w2"> </span>trees<span class="w w1"> </span>always<span class="w w2"> </span>start<span class="w w2"> </span>at<span class="w w1"> </span>loop<span class="w w2"> </span>headers,<span class="w w1"> </span>because</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:317.014px;">they<span class="w w2"> </span>are<span class="w w1"> </span>a<span class="w w2"> </span>natural<span class="w w1"> </span>place<span class="w w2"> </span>to<span class="w w2"> </span>look<span class="w w1"> </span>for<span class="w w2"> </span>hot<span class="w w1"> </span>paths.<span class="w w2"> </span>In<span class="w w1"> </span>TraceMonkey</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:535.919px;">,<span class="w w2"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:317.014px;">headers<span class="w w1"> </span>are<span class="w w0"> </span>easy<span class="w w1"> </span>to<span class="w w0"> </span>detect–the<span class="w w1"> </span>bytecode<span class="w w0"> </span>compiler<span class="w w1"> </span>ensures<span class="w w0"> </span>that<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:317.014px;">bytecode<span class="w w1"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>iff<span class="w w1"> </span>it<span class="w w1"> </span>is<span class="w w1"> </span>the<span class="w w1"> </span>target<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>backward<span class="w w1"> </span>branch.</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:317.014px;">TraceMonkey<span class="w w2"> </span>starts<span class="w w1"> </span>a<span class="w w1"> </span>tree<span class="w w2"> </span>when<span class="w w1"> </span>a<span class="w w1"> </span>given<span class="w w2"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>has<span class="w w2"> </span>been<span class="w w1"> </span>exe-</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:317.014px;">cuted<span class="w w1"> </span>a<span class="w w2"> </span>certain<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w1"> </span>times<span class="w w1"> </span>(2<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>current<span class="w w1"> </span>implementation).</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:317.014px;">Starting<span class="w w1"> </span>a<span class="w w2"> </span>tree<span class="w w1"> </span>just<span class="w w1"> </span>means<span class="w w1"> </span>starting<span class="w w1"> </span>recording<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>current</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:317.014px;">point<span class="w w2"> </span>and<span class="w w1"> </span>type<span class="w w2"> </span>map<span class="w w1"> </span>and<span class="w w2"> </span>marking<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w2"> </span>root<span class="w w1"> </span>of<span class="w w2"> </span>a<span class="w w2"> </span>tree.<span class="w w1"> </span>Each</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:317.014px;">tree<span class="w w2"> </span>is<span class="w w1"> </span>associated<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>loop<span class="w w1"> </span>header<span class="w w2"> </span>and<span class="w w1"> </span>type<span class="w w2"> </span>map,<span class="w w1"> </span>so<span class="w w1"> </span>there<span class="w w2"> </span>may<span class="w w1"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:317.014px;">several<span class="w w2"> </span>trees<span class="w w1"> </span>for<span class="w w2"> </span>a<span class="w w1"> </span>given<span class="w w2"> </span>loop<span class="w w1"> </span>header.</div>
<div class="l f1 s4 c0" style="bottom:610.53px;top:173.41px;left:328.969px;">Closing<span class="w w2"> </span>the<span class="w w1"> </span>loop.</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:395.23px;">Trace<span class="w w2"> </span>recording<span class="w w1"> </span>can<span class="w w2"> </span>end<span class="w w1"> </span>in<span class="w w1"> </span>several<span class="w w2"> </span>ways.</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:328.969px;">Ideally,<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>reaches<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w0"> </span>header<span class="w w2"> </span>where<span class="w w1"> </span>it<span class="w w1"> </span>started<span class="w w1"> </span>with</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:317.014px;">the<span class="w w1"> </span>same<span class="w w0"> </span>type<span class="w w1"> </span>map<span class="w w1"> </span>as<span class="w w0"> </span>on<span class="w w1"> </span>entry.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w0"> </span>called<span class="w w1"> </span>a</div>
<div class="l fa s4 c0" style="bottom:590.748px;top:193.532px;left:497.521px;">type-stable</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:540.175px;">loop</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:317.014px;">iteration.<span class="w w1"> </span>In<span class="w w0"> </span>this<span class="w w1"> </span>case,<span class="w w1"> </span>the<span class="w w0"> </span>end<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>can<span class="w w1"> </span>jump<span class="w w0"> </span>right<span class="w w1"> </span>to<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:317.014px;">beginning,<span class="w w2"> </span>as<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>value<span class="w w2"> </span>representations<span class="w w1"> </span>are<span class="w w1"> </span>exactly<span class="w w2"> </span>as<span class="w w1"> </span>needed<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:560.654px;top:223.33px;left:317.014px;">enter<span class="w w1"> </span>the<span class="w w1"> </span>trace.<span class="w w1"> </span>The<span class="w w2"> </span>jump<span class="w w1"> </span>can<span class="w w1"> </span>even<span class="w w1"> </span>skip<span class="w w1"> </span>the<span class="w w1"> </span>usual<span class="w w1"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>would</div>
<div class="l f2 s4 c0" style="bottom:550.691px;top:233.293px;left:317.014px;">copy<span class="w w1"> </span>out<span class="w w2"> </span>the<span class="w w1"> </span>state<span class="w w1"> </span>at<span class="w w1"> </span>the<span class="w w1"> </span>end<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>and<span class="w w1"> </span>copy<span class="w w2"> </span>it<span class="w w1"> </span>back<span class="w w1"> </span>in<span class="w w1"> </span>to<span class="w w2"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:540.728px;top:243.256px;left:317.014px;">trace<span class="w w2"> </span>activation<span class="w w1"> </span>record<span class="w w2"> </span>to<span class="w w1"> </span>enter<span class="w w1"> </span>a<span class="w w2"> </span>trace.</div>
<div class="l f2 s4 c0" style="bottom:530.766px;top:253.218px;left:328.969px;">In<span class="w w1"> </span>certain<span class="w w0"> </span>cases<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>might<span class="w w1"> </span>reach<span class="w w1"> </span>the<span class="w w0"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>with<span class="w w0"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:520.803px;top:263.181px;left:317.014px;">different<span class="w w2"> </span>type<span class="w w1"> </span>map.<span class="w w2"> </span>This<span class="w w1"> </span>scenario<span class="w w2"> </span>is<span class="w w1"> </span>sometime<span class="w w2"> </span>observed<span class="w w1"> </span>for<span class="w w2"> </span>the<span class="w w1"> </span>first</div>
<div class="l f2 s4 c0" style="bottom:510.84px;top:273.144px;left:317.014px;">iteration<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w2"> </span>loop.<span class="w w2"> </span>Some<span class="w w1"> </span>variables<span class="w w2"> </span>inside<span class="w w2"> </span>the<span class="w w1"> </span>loop<span class="w w2"> </span>might<span class="w w1"> </span>initially<span class="w w2"> </span>be</div>
<div class="l fa s4 c0" style="bottom:501.084px;top:283.196px;left:317.014px;">undefined</div>
<div class="l f2 s4 c0" style="bottom:500.878px;top:283.106px;left:351.875px;">,<span class="w w2"> </span>before<span class="w w2"> </span>they<span class="w w1"> </span>are<span class="w w2"> </span>set<span class="w w2"> </span>to<span class="w w1"> </span>a<span class="w w2"> </span>concrete<span class="w w2"> </span>type<span class="w w1"> </span>during<span class="w w2"> </span>the<span class="w w2"> </span>first<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:490.915px;top:293.069px;left:317.014px;">iteration.<span class="w w1"> </span>When<span class="w w0"> </span>recording<span class="w w0"> </span>such<span class="w w1"> </span>an<span class="w w0"> </span>iteration,<span class="w w1"> </span>the<span class="w w0"> </span>recorder<span class="w w1"> </span>cannot</div>
<div class="l f2 s4 c0" style="bottom:480.952px;top:303.032px;left:317.014px;">link<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>back<span class="w w1"> </span>to<span class="w w1"> </span>its<span class="w w2"> </span>own<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>since<span class="w w2"> </span>it<span class="w w1"> </span>is</div>
<div class="l fa s4 c0" style="bottom:481.159px;top:303.121px;left:505.565px;">type-unstable</div>
<div class="l f2 s4 c0" style="bottom:480.952px;top:303.032px;left:553.875px;">.</div>
<div class="l f2 s4 c0" style="bottom:470.99px;top:312.994px;left:317.014px;">Instead,<span class="w w2"> </span>the<span class="w w1"> </span>iteration<span class="w w1"> </span>is<span class="w w1"> </span>terminated<span class="w w2"> </span>with<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>that<span class="w w1"> </span>will<span class="w w1"> </span>always</div>
<div class="l f2 s4 c0" style="bottom:461.027px;top:322.957px;left:317.014px;">fail<span class="w w1"> </span>and<span class="w w1"> </span>return<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>interpreter.<span class="w w2"> </span>At<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>time<span class="w w1"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>trace<span class="w w1"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:451.064px;top:332.92px;left:317.014px;">recorded<span class="w w1"> </span>with<span class="w w0"> </span>the<span class="w w1"> </span>new<span class="w w1"> </span>type<span class="w w1"> </span>map.<span class="w w0"> </span>Every<span class="w w1"> </span>time<span class="w w1"> </span>an<span class="w w0"> </span>additional<span class="w w1"> </span>type-</div>
<div class="l f2 s4 c0" style="bottom:441.102px;top:342.882px;left:317.014px;">unstable<span class="w w2"> </span>trace<span class="w w1"> </span>is<span class="w w2"> </span>added<span class="w w1"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>region,<span class="w w2"> </span>its<span class="w w1"> </span>exit<span class="w w2"> </span>type<span class="w w1"> </span>map<span class="w w2"> </span>is<span class="w w1"> </span>compared<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:431.139px;top:352.845px;left:317.014px;">the<span class="w w1"> </span>entry<span class="w w1"> </span>map<span class="w w1"> </span>of<span class="w w1"> </span>all<span class="w w1"> </span>existing<span class="w w1"> </span>traces<span class="w w1"> </span>in<span class="w w1"> </span>case<span class="w w1"> </span>they<span class="w w1"> </span>complement<span class="w w1"> </span>each</div>
<div class="l f2 s4 c0" style="bottom:421.177px;top:362.807px;left:317.014px;">other.<span class="w w2"> </span>With<span class="w w1"> </span>this<span class="w w1"> </span>approach<span class="w w1"> </span>we<span class="w w1"> </span>are<span class="w w0"> </span>able<span class="w w2"> </span>to<span class="w w1"> </span>cover<span class="w w1"> </span>type-unstable<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:411.214px;top:372.77px;left:317.014px;">iterations<span class="w w2"> </span>as<span class="w w1"> </span>long<span class="w w1"> </span>they<span class="w w2"> </span>eventually<span class="w w1"> </span>form<span class="w w2"> </span>a<span class="w w1"> </span>stable<span class="w w2"> </span>equilibrium.</div>
<div class="l f2 s4 c0" style="bottom:401.251px;top:382.733px;left:328.969px;">Finally,<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>might<span class="w w1"> </span>exit<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w0"> </span>before<span class="w w2"> </span>reaching<span class="w w0"> </span>the<span class="w w2"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:391.289px;top:392.695px;left:317.014px;">header,<span class="w w2"> </span>for<span class="w w1"> </span>example<span class="w w2"> </span>because<span class="w w1"> </span>execution<span class="w w2"> </span>reaches<span class="w w1"> </span>a</div>
<div class="l f7 s4 c0" style="bottom:391.235px;top:393.296px;left:492.524px;">break</div>
<div class="l f2 s4 c0" style="bottom:391.289px;top:392.695px;left:518.233px;">or</div>
<div class="l f7 s4 c0" style="bottom:391.235px;top:393.296px;left:527.873px;">return</div>
<div class="l f2 s4 c0" style="bottom:381.326px;top:402.658px;left:317.014px;">statement.<span class="w w1"> </span>In<span class="w w1"> </span>this<span class="w w1"> </span>case,<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>simply<span class="w w1"> </span>ends<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>with<span class="w w1"> </span>an<span class="w w1"> </span>exit</div>
<div class="l f2 s4 c0" style="bottom:371.363px;top:412.621px;left:317.014px;">to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor.</div>
<div class="l f2 s4 c0" style="bottom:361.401px;top:422.583px;left:328.969px;">As<span class="w w1"> </span>mentioned<span class="w w1"> </span>previously,<span class="w w1"> </span>we<span class="w w1"> </span>may<span class="w w0"> </span>speculatively<span class="w w1"> </span>chose<span class="w w1"> </span>to<span class="w w1"> </span>rep-</div>
<div class="l f2 s4 c0" style="bottom:351.438px;top:432.546px;left:317.014px;">resent<span class="w w1"> </span>certain<span class="w w2"> </span>Number-typed<span class="w w1"> </span>values<span class="w w1"> </span>as<span class="w w1"> </span>integers<span class="w w1"> </span>on<span class="w w2"> </span>trace.<span class="w w1"> </span>We<span class="w w1"> </span>do<span class="w w2"> </span>so</div>
<div class="l f2 s4 c0" style="bottom:341.475px;top:442.509px;left:317.014px;">when<span class="w w1"> </span>we<span class="w w1"> </span>observe<span class="w w1"> </span>that<span class="w w1"> </span>Number-typed<span class="w w0"> </span>variables<span class="w w2"> </span>contain<span class="w w0"> </span>an<span class="w w2"> </span>integer</div>
<div class="l f2 s4 c0" style="bottom:331.513px;top:452.471px;left:317.014px;">value<span class="w w1"> </span>at<span class="w w2"> </span>trace<span class="w w1"> </span>entry.<span class="w w1"> </span>If<span class="w w1"> </span>during<span class="w w1"> </span>trace<span class="w w1"> </span>recording<span class="w w2"> </span>the<span class="w w1"> </span>variable<span class="w w1"> </span>is<span class="w w1"> </span>unex-</div>
<div class="l f2 s4 c0" style="bottom:321.55px;top:462.434px;left:317.014px;">pectedly<span class="w w1"> </span>assigned<span class="w w1"> </span>a<span class="w w1"> </span>non-integer<span class="w w1"> </span>value,<span class="w w1"> </span>we<span class="w w1"> </span>have<span class="w w1"> </span>to<span class="w w1"> </span>widen<span class="w w1"> </span>the<span class="w w1"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:311.588px;top:472.396px;left:317.014px;">of<span class="w w2"> </span>the<span class="w w1"> </span>variable<span class="w w1"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>double.<span class="w w2"> </span>As<span class="w w1"> </span>a<span class="w w1"> </span>result,<span class="w w2"> </span>the<span class="w w1"> </span>recorded<span class="w w1"> </span>trace<span class="w w2"> </span>becomes</div>
<div class="l f2 s4 c0" style="bottom:301.625px;top:482.359px;left:317.014px;">inherently<span class="w w1"> </span>type-unstable<span class="w w0"> </span>since<span class="w w1"> </span>it<span class="w w0"> </span>starts<span class="w w1"> </span>with<span class="w w0"> </span>an<span class="w w1"> </span>integer<span class="w w0"> </span>value<span class="w w1"> </span>but</div>
<div class="l f2 s4 c0" style="bottom:291.662px;top:492.322px;left:317.014px;">ends<span class="w w1"> </span>with<span class="w w1"> </span>a<span class="w w2"> </span>double<span class="w w1"> </span>value.<span class="w w1"> </span>This<span class="w w1"> </span>represents<span class="w w1"> </span>a<span class="w w1"> </span>mis-speculation,<span class="w w1"> </span>since</div>
<div class="l f2 s4 c0" style="bottom:281.7px;top:502.284px;left:317.014px;">at<span class="w w2"> </span>trace<span class="w w1"> </span>entry<span class="w w1"> </span>we<span class="w w2"> </span>specialized<span class="w w1"> </span>the<span class="w w2"> </span>Number-typed<span class="w w1"> </span>value<span class="w w2"> </span>to<span class="w w1"> </span>an<span class="w w1"> </span>integer,</div>
<div class="l f2 s4 c0" style="bottom:271.737px;top:512.247px;left:317.014px;">assuming<span class="w w2"> </span>that<span class="w w1"> </span>at<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>edge<span class="w w2"> </span>we<span class="w w2"> </span>would<span class="w w1"> </span>again<span class="w w2"> </span>find<span class="w w1"> </span>an<span class="w w2"> </span>integer<span class="w w2"> </span>value</div>
<div class="l f2 s4 c0" style="bottom:261.774px;top:522.21px;left:317.014px;">in<span class="w w2"> </span>the<span class="w w1"> </span>variable,<span class="w w1"> </span>allowing<span class="w w2"> </span>us<span class="w w1"> </span>to<span class="w w2"> </span>close<span class="w w1"> </span>the<span class="w w1"> </span>loop.<span class="w w2"> </span>To<span class="w w1"> </span>avoid<span class="w w2"> </span>future<span class="w w1"> </span>spec-</div>
<div class="l f2 s4 c0" style="bottom:251.812px;top:532.172px;left:317.014px;">ulative<span class="w w1"> </span>failures<span class="w w2"> </span>involving<span class="w w1"> </span>this<span class="w w1"> </span>variable,<span class="w w1"> </span>and<span class="w w1"> </span>to<span class="w w1"> </span>obtain<span class="w w1"> </span>a<span class="w w1"> </span>type-stable</div>
<div class="l f2 s4 c0" style="bottom:241.849px;top:542.135px;left:317.014px;">trace<span class="w w2"> </span>we<span class="w w1"> </span>note<span class="w w2"> </span>the<span class="w w1"> </span>fact<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w2"> </span>variable<span class="w w2"> </span>in<span class="w w1"> </span>question<span class="w w2"> </span>as<span class="w w1"> </span>been<span class="w w2"> </span>observed</div>
<div class="l f2 s4 c0" style="bottom:231.886px;top:552.098px;left:317.014px;">to<span class="w w2"> </span>sometimes<span class="w w1"> </span>hold<span class="w w1"> </span>non-integer<span class="w w1"> </span>values<span class="w w2"> </span>in<span class="w w1"> </span>an<span class="w w1"> </span>advisory<span class="w w2"> </span>data<span class="w w1"> </span>structure</div>
<div class="l f2 s4 c0" style="bottom:221.924px;top:562.06px;left:317.014px;">which<span class="w w2"> </span>we<span class="w w1"> </span>call<span class="w w1"> </span>the<span class="w w2"> </span>“oracle”.</div>
<div class="l f2 s4 c0" style="bottom:211.961px;top:572.023px;left:328.969px;">When<span class="w w1"> </span>compiling<span class="w w1"> </span>loops,<span class="w w1"> </span>we<span class="w w1"> </span>consult<span class="w w2"> </span>the<span class="w w1"> </span>oracle<span class="w w1"> </span>before<span class="w w1"> </span>specializ-</div>
<div class="l f2 s4 c0" style="bottom:201.998px;top:581.986px;left:317.014px;">ing<span class="w w1"> </span>values<span class="w w1"> </span>to<span class="w w0"> </span>integers.<span class="w w1"> </span>Speculation<span class="w w1"> </span>towards<span class="w w1"> </span>integers<span class="w w1"> </span>is<span class="w w0"> </span>performed</div>
<div class="l f2 s4 c0" style="bottom:192.036px;top:591.948px;left:317.014px;">only<span class="w w1"> </span>if<span class="w w0"> </span>no<span class="w w1"> </span>adverse<span class="w w1"> </span>information<span class="w w1"> </span>is<span class="w w0"> </span>known<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>oracle<span class="w w0"> </span>about<span class="w w1"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:182.073px;top:601.911px;left:317.014px;">particular<span class="w w1"> </span>variable.<span class="w w2"> </span>Whenever<span class="w w1"> </span>we<span class="w w1"> </span>accidentally<span class="w w1"> </span>compile<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:172.111px;top:611.873px;left:317.014px;">is<span class="w w1"> </span>type-unstable<span class="w w0"> </span>due<span class="w w1"> </span>to<span class="w w0"> </span>mis-speculation<span class="w w1"> </span>of<span class="w w1"> </span>a<span class="w w0"> </span>Number-typed<span class="w w1"> </span>vari-</div>
<div class="l f2 s4 c0" style="bottom:162.148px;top:621.836px;left:317.014px;">able,<span class="w w1"> </span>we<span class="w w1"> </span>immediately<span class="w w1"> </span>trigger<span class="w w1"> </span>the<span class="w w0"> </span>recording<span class="w w2"> </span>of<span class="w w0"> </span>a<span class="w w1"> </span>new<span class="w w1"> </span>trace,<span class="w w1"> </span>which</div>
<div class="l f2 s4 c0" style="bottom:152.185px;top:631.799px;left:317.014px;">based<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>now<span class="w w2"> </span>updated<span class="w w1"> </span>oracle<span class="w w1"> </span>information<span class="w w2"> </span>will<span class="w w1"> </span>start<span class="w w1"> </span>with<span class="w w2"> </span>a<span class="w w1"> </span>dou-</div>
<div class="l f2 s4 c0" style="bottom:142.223px;top:641.761px;left:317.014px;">ble<span class="w w2"> </span>value<span class="w w1"> </span>and<span class="w w2"> </span>thus<span class="w w1"> </span>become<span class="w w1"> </span>type<span class="w w2"> </span>stable.</div>
<div class="l f1 s4 c0" style="bottom:132.323px;top:651.616px;left:328.969px;">Extending<span class="w w0"> </span>a<span class="w w1"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:132.26px;top:651.724px;left:401.212px;">Side<span class="w w0"> </span>exits<span class="w w1"> </span>lead<span class="w w0"> </span>to<span class="w w1"> </span>different<span class="w w0"> </span>paths<span class="w w1"> </span>through</div>
<div class="l f2 s4 c0" style="bottom:122.297px;top:661.687px;left:317.014px;">the<span class="w w1"> </span>loop,<span class="w w1"> </span>or<span class="w w1"> </span>paths<span class="w w1"> </span>with<span class="w w1"> </span>different<span class="w w2"> </span>types<span class="w w1"> </span>or<span class="w w1"> </span>representations.<span class="w w1"> </span>Thus,<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:112.335px;top:671.649px;left:317.014px;">completely<span class="w w2"> </span>cover<span class="w w2"> </span>the<span class="w w1"> </span>loop,<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>must<span class="w w1"> </span>record<span class="w w2"> </span>traces<span class="w w2"> </span>starting<span class="w w1"> </span>at<span class="w w2"> </span>all</div>
<div class="l f2 s4 c0" style="bottom:102.372px;top:681.612px;left:317.014px;">side<span class="w w2"> </span>exits.<span class="w w1"> </span>These<span class="w w1"> </span>traces<span class="w w1"> </span>are<span class="w w2"> </span>recorded<span class="w w1"> </span>much<span class="w w1"> </span>like<span class="w w2"> </span>root<span class="w w1"> </span>traces:<span class="w w1"> </span>there<span class="w w1"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:92.4095px;top:691.575px;left:317.014px;">a<span class="w w2"> </span>counter<span class="w w1"> </span>for<span class="w w2"> </span>each<span class="w w2"> </span>side<span class="w w1"> </span>exit,<span class="w w2"> </span>and<span class="w w1"> </span>when<span class="w w2"> </span>the<span class="w w2"> </span>counter<span class="w w1"> </span>reaches<span class="w w2"> </span>a<span class="w w1"> </span>hotness</div>
<div class="l f2 s4 c0" style="bottom:82.4468px;top:701.537px;left:317.014px;">threshold,<span class="w w1"> </span>recording<span class="w w1"> </span>starts.<span class="w w2"> </span>Recording<span class="w w1"> </span>stops<span class="w w1"> </span>exactly<span class="w w1"> </span>as<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>root</div>
<div class="l f2 s4 c0" style="bottom:72.4842px;top:711.5px;left:317.014px;">trace,<span class="w w2"> </span>using<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w2"> </span>header<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>root<span class="w w1"> </span>trace<span class="w w2"> </span>as<span class="w w1"> </span>the<span class="w w1"> </span>target<span class="w w2"> </span>to<span class="w w1"> </span>reach.</div>
</div>
<div id="page-6" class="p" style="width:612px;height:792px;background-image:url(p6.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:65.9552px;">Our<span class="w w2"> </span>implementation<span class="w w1"> </span>does<span class="w w1"> </span>not<span class="w w1"> </span>extend<span class="w w2"> </span>at<span class="w w1"> </span>all<span class="w w1"> </span>side<span class="w w2"> </span>exits.<span class="w w1"> </span>It<span class="w w1"> </span>extends</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:54px;">only<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>is<span class="w w2"> </span>for<span class="w w1"> </span>a<span class="w w2"> </span>control-flow<span class="w w1"> </span>branch,<span class="w w2"> </span>and<span class="w w1"> </span>only<span class="w w2"> </span>if<span class="w w2"> </span>the<span class="w w1"> </span>side</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:54px;">exit<span class="w w2"> </span>does<span class="w w1"> </span>not<span class="w w1"> </span>leave<span class="w w2"> </span>the<span class="w w1"> </span>loop.<span class="w w2"> </span>In<span class="w w1"> </span>particular<span class="w w1"> </span>we<span class="w w2"> </span>do<span class="w w1"> </span>not<span class="w w1"> </span>want<span class="w w2"> </span>to<span class="w w1"> </span>extend</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:54px;">a<span class="w w1"> </span>trace<span class="w w0"> </span>tree<span class="w w1"> </span>along<span class="w w1"> </span>a<span class="w w1"> </span>path<span class="w w0"> </span>that<span class="w w1"> </span>leads<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w1"> </span>outer<span class="w w1"> </span>loop,<span class="w w1"> </span>because<span class="w w0"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:54px;">want<span class="w w2"> </span>to<span class="w w1"> </span>cover<span class="w w2"> </span>such<span class="w w1"> </span>paths<span class="w w1"> </span>in<span class="w w2"> </span>an<span class="w w1"> </span>outer<span class="w w1"> </span>tree<span class="w w2"> </span>through<span class="w w1"> </span>tree</div>
<div class="l fa s4 c0" style="bottom:670.449px;top:113.831px;left:246.623px;">nesting</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:272.527px;">.</div>
<div class="l f1 s4 c0" style="bottom:652.771px;top:131.168px;left:54px;">3.3<span class="w w10"> </span>Blacklisting</div>
<div class="l f2 s4 c0" style="bottom:638.761px;top:145.223px;left:54px;">Sometimes,<span class="w w0"> </span>a<span class="w w0"> </span>program<span class="w w1"> </span>follows<span class="w w0"> </span>a<span class="w w0"> </span>path<span class="w w0"> </span>that<span class="w w1"> </span>cannot<span class="w w0"> </span>be<span class="w w0"> </span>compiled</div>
<div class="l f2 s4 c0" style="bottom:628.798px;top:155.186px;left:54px;">into<span class="w w1"> </span>a<span class="w w1"> </span>trace,<span class="w w1"> </span>usually<span class="w w1"> </span>because<span class="w w1"> </span>of<span class="w w1"> </span>limitations<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>implementation.</div>
<div class="l f2 s4 c0" style="bottom:618.835px;top:165.149px;left:54px;">TraceMonkey<span class="w w1"> </span>does<span class="w w1"> </span>not<span class="w w1"> </span>currently<span class="w w0"> </span>support<span class="w w1"> </span>recording<span class="w w1"> </span>throwing<span class="w w0"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:608.873px;top:175.111px;left:54px;">catching<span class="w w1"> </span>of<span class="w w2"> </span>arbitrary<span class="w w1"> </span>exceptions.<span class="w w1"> </span>This<span class="w w2"> </span>design<span class="w w1"> </span>trade<span class="w w1"> </span>off<span class="w w2"> </span>was<span class="w w1"> </span>chosen,</div>
<div class="l f2 s4 c0" style="bottom:598.91px;top:185.074px;left:54px;">because<span class="w w1"> </span>exceptions<span class="w w0"> </span>are<span class="w w1"> </span>usually<span class="w w0"> </span>rare<span class="w w1"> </span>in<span class="w w0"> </span>JavaScript.<span class="w w1"> </span>However</div>
<div class="l f2 s4 c0" style="bottom:598.91px;top:185.074px;left:274.304px;">,<span class="w w1"> </span>if<span class="w w0"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:588.947px;top:195.037px;left:54px;">program<span class="w w0"> </span>opts<span class="w w1"> </span>to<span class="w w0"> </span>use<span class="w w1"> </span>exceptions<span class="w w0"> </span>intensively,<span class="w w1"> </span>we<span class="w w0"> </span>would<span class="w w1"> </span>suddenly</div>
<div class="l f2 s4 c0" style="bottom:578.985px;top:204.999px;left:54px;">incur<span class="w w1"> </span>a<span class="w w1"> </span>punishing<span class="w w1"> </span>runtime<span class="w w1"> </span>overhead<span class="w w1"> </span>if<span class="w w1"> </span>we<span class="w w1"> </span>repeatedly<span class="w w1"> </span>try<span class="w w1"> </span>to<span class="w w1"> </span>record</div>
<div class="l f2 s4 c0" style="bottom:569.022px;top:214.962px;left:54px;">a<span class="w w1"> </span>trace<span class="w w0"> </span>for<span class="w w1"> </span>this<span class="w w1"> </span>path<span class="w w0"> </span>and<span class="w w1"> </span>repeatedly<span class="w w1"> </span>fail<span class="w w0"> </span>to<span class="w w1"> </span>do<span class="w w1"> </span>so,<span class="w w0"> </span>since<span class="w w1"> </span>we<span class="w w1"> </span>abort</div>
<div class="l f2 s4 c0" style="bottom:559.06px;top:224.924px;left:54px;">tracing<span class="w w2"> </span>every<span class="w w1"> </span>time<span class="w w2"> </span>we<span class="w w1"> </span>observe<span class="w w1"> </span>an<span class="w w2"> </span>exception<span class="w w1"> </span>being<span class="w w2"> </span>thrown.</div>
<div class="l f2 s4 c0" style="bottom:549.097px;top:234.887px;left:65.9552px;">As<span class="w w2"> </span>a<span class="w w1"> </span>result,<span class="w w2"> </span>if<span class="w w1"> </span>a<span class="w w2"> </span>hot<span class="w w2"> </span>loop<span class="w w1"> </span>contains<span class="w w2"> </span>traces<span class="w w1"> </span>that<span class="w w2"> </span>always<span class="w w2"> </span>fail,<span class="w w1"> </span>the<span class="w w2"> </span>VM</div>
<div class="l f2 s4 c0" style="bottom:539.134px;top:244.85px;left:54px;">could<span class="w w1"> </span>potentially<span class="w w1"> </span>run<span class="w w1"> </span>much<span class="w w1"> </span>more<span class="w w1"> </span>slowly<span class="w w1"> </span>than<span class="w w1"> </span>the<span class="w w1"> </span>base<span class="w w1"> </span>interpreter:</div>
<div class="l f2 s4 c0" style="bottom:529.172px;top:254.812px;left:54px;">the<span class="w w2"> </span>VM<span class="w w1"> </span>repeatedly<span class="w w1"> </span>spends<span class="w w2"> </span>time<span class="w w1"> </span>trying<span class="w w1"> </span>to<span class="w w2"> </span>record<span class="w w1"> </span>traces,<span class="w w1"> </span>but<span class="w w2"> </span>is<span class="w w1"> </span>never</div>
<div class="l f2 s4 c0" style="bottom:519.209px;top:264.775px;left:54px;">able<span class="w w1"> </span>to<span class="w w1"> </span>run<span class="w w2"> </span>any.<span class="w w1"> </span>To<span class="w w2"> </span>avoid<span class="w w1"> </span>this<span class="w w1"> </span>problem,<span class="w w1"> </span>whenever<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w1"> </span>is<span class="w w1"> </span>about</div>
<div class="l f2 s4 c0" style="bottom:509.246px;top:274.738px;left:54px;">to<span class="w w2"> </span>start<span class="w w1"> </span>tracing,<span class="w w2"> </span>it<span class="w w1"> </span>must<span class="w w2"> </span>try<span class="w w1"> </span>to<span class="w w2"> </span>predict<span class="w w1"> </span>whether<span class="w w2"> </span>it<span class="w w1"> </span>will<span class="w w2"> </span>finish<span class="w w1"> </span>the<span class="w w2"> </span>trace.</div>
<div class="l f2 s4 c0" style="bottom:499.284px;top:284.7px;left:65.9552px;">Our<span class="w w0"> </span>prediction<span class="w w1"> </span>algorithm<span class="w w0"> </span>is<span class="w w1"> </span>based<span class="w w0"> </span>on</div>
<div class="l fa s4 c0" style="bottom:499.49px;top:284.79px;left:209.431px;">blacklisting</div>
<div class="l f2 s4 c0" style="bottom:499.284px;top:284.7px;left:254.921px;">traces<span class="w w0"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:489.321px;top:294.663px;left:54px;">have<span class="w w2"> </span>been<span class="w w2"> </span>tried<span class="w w1"> </span>and<span class="w w2"> </span>failed.<span class="w w2"> </span>When<span class="w w1"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>fails<span class="w w2"> </span>to<span class="w w2"> </span>finish<span class="w w1"> </span>a<span class="w w2"> </span>trace<span class="w w2"> </span>start-</div>
<div class="l f2 s4 c0" style="bottom:479.358px;top:304.626px;left:54px;">ing<span class="w w2"> </span>at<span class="w w1"> </span>a<span class="w w2"> </span>given<span class="w w2"> </span>point,<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>records<span class="w w1"> </span>that<span class="w w2"> </span>a<span class="w w2"> </span>failure<span class="w w1"> </span>has<span class="w w2"> </span>occurred.<span class="w w1"> </span>The</div>
<div class="l f2 s4 c0" style="bottom:469.396px;top:314.588px;left:54px;">VM<span class="w w2"> </span>also<span class="w w2"> </span>sets<span class="w w1"> </span>a<span class="w w2"> </span>counter<span class="w w2"> </span>so<span class="w w2"> </span>that<span class="w w1"> </span>it<span class="w w2"> </span>will<span class="w w2"> </span>not<span class="w w2"> </span>try<span class="w w1"> </span>to<span class="w w2"> </span>record<span class="w w2"> </span>a<span class="w w2"> </span>trace<span class="w w1"> </span>starting</div>
<div class="l f2 s4 c0" style="bottom:459.433px;top:324.551px;left:54px;">at<span class="w w1"> </span>that<span class="w w1"> </span>point<span class="w w1"> </span>until<span class="w w1"> </span>it<span class="w w1"> </span>is<span class="w w1"> </span>passed<span class="w w1"> </span>a<span class="w w1"> </span>few<span class="w w1"> </span>more<span class="w w0"> </span>times<span class="w w2"> </span>(32<span class="w w1"> </span>in<span class="w w1"> </span>our<span class="w w0"> </span>imple-</div>
<div class="l f2 s4 c0" style="bottom:449.47px;top:334.514px;left:54px;">mentation).<span class="w w1"> </span>This</div>
<div class="l fa s4 c0" style="bottom:449.677px;top:334.603px;left:117.226px;">backoff</div>
<div class="l f2 s4 c0" style="bottom:449.47px;top:334.514px;left:147.597px;">counter<span class="w w1"> </span>gives<span class="w w1"> </span>temporary<span class="w w1"> </span>conditions<span class="w w0"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:439.508px;top:344.476px;left:54px;">prevent<span class="w w1"> </span>tracing<span class="w w1"> </span>a<span class="w w1"> </span>chance<span class="w w1"> </span>to<span class="w w1"> </span>end.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>may<span class="w w1"> </span>behave</div>
<div class="l f2 s4 c0" style="bottom:429.545px;top:354.439px;left:54px;">differently<span class="w w2"> </span>during<span class="w w2"> </span>startup<span class="w w1"> </span>than<span class="w w2"> </span>during<span class="w w2"> </span>its<span class="w w1"> </span>steady-state<span class="w w2"> </span>execution.<span class="w w2"> </span>Af-</div>
<div class="l f2 s4 c0" style="bottom:419.583px;top:364.401px;left:54px;">ter<span class="w w1"> </span>a<span class="w w1"> </span>given<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w1"> </span>failures<span class="w w1"> </span>(2<span class="w w1"> </span>in<span class="w w1"> </span>our<span class="w w1"> </span>implementation),<span class="w w1"> </span>the<span class="w w1"> </span>VM</div>
<div class="l f2 s4 c0" style="bottom:409.62px;top:374.364px;left:54px;">marks<span class="w w2"> </span>the<span class="w w1"> </span>fragment<span class="w w2"> </span>as<span class="w w1"> </span>blacklisted,<span class="w w1"> </span>which<span class="w w2"> </span>means<span class="w w1"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>will<span class="w w2"> </span>never</div>
<div class="l f2 s4 c0" style="bottom:399.657px;top:384.327px;left:54px;">again<span class="w w2"> </span>start<span class="w w1"> </span>recording<span class="w w1"> </span>at<span class="w w2"> </span>that<span class="w w1"> </span>point.</div>
<div class="l f2 s4 c0" style="bottom:389.695px;top:394.289px;left:65.9552px;">After<span class="w w0"> </span>implementing<span class="w w1"> </span>this<span class="w w0"> </span>basic<span class="w w1"> </span>strategy,<span class="w w0"> </span>we<span class="w w1"> </span>observed<span class="w w0"> </span>that<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:379.732px;top:404.252px;left:54px;">small<span class="w w1"> </span>loops<span class="w w2"> </span>that<span class="w w1"> </span>get<span class="w w1"> </span>blacklisted,<span class="w w1"> </span>the<span class="w w1"> </span>system<span class="w w2"> </span>can<span class="w w1"> </span>spend<span class="w w1"> </span>a<span class="w w1"> </span>noticeable</div>
<div class="l f2 s4 c0" style="bottom:369.769px;top:414.215px;left:54px;">amount<span class="w w2"> </span>of<span class="w w1"> </span>time<span class="w w2"> </span>just<span class="w w1"> </span>finding<span class="w w1"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>fragment<span class="w w2"> </span>and<span class="w w1"> </span>determining<span class="w w2"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:359.807px;top:424.177px;left:54px;">it<span class="w w2"> </span>has<span class="w w1"> </span>been<span class="w w2"> </span>blacklisted.<span class="w w1"> </span>We<span class="w w2"> </span>now<span class="w w2"> </span>avoid<span class="w w1"> </span>that<span class="w w2"> </span>problem<span class="w w1"> </span>by<span class="w w2"> </span>patching<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:349.844px;top:434.14px;left:54px;">bytecode.<span class="w w1"> </span>We<span class="w w2"> </span>define<span class="w w1"> </span>an<span class="w w1"> </span>extra<span class="w w1"> </span>no-op<span class="w w1"> </span>bytecode<span class="w w2"> </span>that<span class="w w1"> </span>indicates<span class="w w1"> </span>a<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:339.881px;top:444.103px;left:54px;">header.<span class="w w1"> </span>The<span class="w w1"> </span>VM<span class="w w1"> </span>calls<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor<span class="w w0"> </span>ev</div>
<div class="l f2 s4 c0" style="bottom:339.881px;top:444.103px;left:226.729px;">ery<span class="w w1"> </span>time<span class="w w1"> </span>the<span class="w w1"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:329.919px;top:454.065px;left:54px;">preter<span class="w w1"> </span>executes<span class="w w1"> </span>a<span class="w w0"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>no-op.<span class="w w1"> </span>To<span class="w w1"> </span>blacklist<span class="w w1"> </span>a<span class="w w0"> </span>fragment,<span class="w w1"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:319.956px;top:464.028px;left:54px;">simply<span class="w w1"> </span>replace<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>header<span class="w w1"> </span>no-op<span class="w w1"> </span>with<span class="w w1"> </span>a<span class="w w1"> </span>regular<span class="w w1"> </span>no-op.<span class="w w0"> </span>Thus,</div>
<div class="l f2 s4 c0" style="bottom:309.994px;top:473.99px;left:54px;">the<span class="w w2"> </span>interpreter<span class="w w1"> </span>will<span class="w w1"> </span>never<span class="w w2"> </span>again<span class="w w1"> </span>even<span class="w w2"> </span>call<span class="w w1"> </span>into<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>monitor.</div>
<div class="l f2 s4 c0" style="bottom:300.031px;top:483.953px;left:65.9552px;">There<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>related<span class="w w2"> </span>problem<span class="w w1"> </span>we<span class="w w2"> </span>have<span class="w w1"> </span>not<span class="w w2"> </span>yet<span class="w w2"> </span>solved,<span class="w w1"> </span>which<span class="w w2"> </span>occurs</div>
<div class="l f2 s4 c0" style="bottom:290.068px;top:493.916px;left:54px;">when<span class="w w2"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>meets<span class="w w2"> </span>all<span class="w w1"> </span>of<span class="w w1"> </span>these<span class="w w2"> </span>conditions:</div>
<div class="l f3 s3 c0" style="bottom:276.513px;top:507.964px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:275.224px;top:508.76px;left:66.9514px;">The<span class="w w2"> </span>VM<span class="w w1"> </span>can<span class="w w1"> </span>form<span class="w w2"> </span>at<span class="w w1"> </span>least<span class="w w1"> </span>one<span class="w w2"> </span>root<span class="w w1"> </span>trace<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>loop.</div>
<div class="l f3 s3 c0" style="bottom:262.565px;top:521.911px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:261.276px;top:522.708px;left:66.9514px;">There<span class="w w1"> </span>is<span class="w w0"> </span>at<span class="w w1"> </span>least<span class="w w0"> </span>one<span class="w w1"> </span>hot<span class="w w0"> </span>side<span class="w w1"> </span>exit<span class="w w0"> </span>for<span class="w w1"> </span>which<span class="w w1"> </span>the<span class="w w0"> </span>VM<span class="w w1"> </span>cannot</div>
<div class="l f2 s4 c0" style="bottom:251.314px;top:532.67px;left:66.9514px;">complete<span class="w w2"> </span>a<span class="w w1"> </span>trace.</div>
<div class="l f3 s3 c0" style="bottom:238.655px;top:545.822px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:237.366px;top:546.618px;left:66.9514px;">The<span class="w w2"> </span>loop<span class="w w1"> </span>body<span class="w w1"> </span>is<span class="w w2"> </span>short.</div>
<div class="l f2 s4 c0" style="bottom:222.522px;top:561.462px;left:65.9551px;">In<span class="w w2"> </span>this<span class="w w1"> </span>case,<span class="w w2"> </span>the<span class="w w2"> </span>VM<span class="w w1"> </span>will<span class="w w2"> </span>repeatedly<span class="w w1"> </span>pass<span class="w w2"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>header,<span class="w w2"> </span>search</div>
<div class="l f2 s4 c0" style="bottom:212.559px;top:571.425px;left:54px;">for<span class="w w0"> </span>a<span class="w w0"> </span>trace,<span class="w w1"> </span>find<span class="w w0"> </span>it,<span class="w w0"> </span>execute<span class="w w0"> </span>it,<span class="w w0"> </span>and<span class="w w0"> </span>fall<span class="w w1"> </span>back<span class="w w0"> </span>to<span class="w w0"> </span>the<span class="w w0"> </span>interpreter.</div>
<div class="l f2 s4 c0" style="bottom:202.596px;top:581.388px;left:54px;">With<span class="w w1"> </span>a<span class="w w0"> </span>short<span class="w w1"> </span>loop<span class="w w0"> </span>body</div>
<div class="l f2 s4 c0" style="bottom:202.596px;top:581.388px;left:141.091px;">,<span class="w w1"> </span>the<span class="w w0"> </span>overhead<span class="w w1"> </span>of<span class="w w0"> </span>finding<span class="w w1"> </span>and<span class="w w0"> </span>calling<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:192.634px;top:591.35px;left:54px;">trace<span class="w w1"> </span>is<span class="w w1"> </span>high,<span class="w w1"> </span>and<span class="w w0"> </span>causes<span class="w w1"> </span>performance<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>even<span class="w w1"> </span>slower<span class="w w1"> </span>than<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:182.671px;top:601.313px;left:54px;">basic<span class="w w1"> </span>interpreter.<span class="w w0"> </span>So<span class="w w1"> </span>far,<span class="w w0"> </span>in<span class="w w1"> </span>this<span class="w w0"> </span>situation<span class="w w1"> </span>we<span class="w w0"> </span>have<span class="w w1"> </span>improved<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:172.708px;top:611.276px;left:54px;">implementation<span class="w w0"> </span>so<span class="w w1"> </span>that<span class="w w0"> </span>the<span class="w w0"> </span>VM<span class="w w1"> </span>can<span class="w w0"> </span>complete<span class="w w0"> </span>the<span class="w w0"> </span>branch<span class="w w1"> </span>trace.</div>
<div class="l f2 s4 c0" style="bottom:162.746px;top:621.238px;left:54px;">But<span class="w w1"> </span>it<span class="w w0"> </span>is<span class="w w1"> </span>hard<span class="w w0"> </span>to<span class="w w1"> </span>guarantee<span class="w w0"> </span>that<span class="w w1"> </span>this<span class="w w1"> </span>situation<span class="w w0"> </span>will<span class="w w1"> </span>never<span class="w w0"> </span>happen.</div>
<div class="l f2 s4 c0" style="bottom:152.783px;top:631.201px;left:54px;">As<span class="w w1"> </span>future<span class="w w1"> </span>work,<span class="w w0"> </span>this<span class="w w1"> </span>situation<span class="w w1"> </span>could<span class="w w1"> </span>be<span class="w w0"> </span>avoided<span class="w w1"> </span>by<span class="w w1"> </span>detecting<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:142.82px;top:641.164px;left:54px;">blacklisting<span class="w w1"> </span>loops<span class="w w0"> </span>for<span class="w w1"> </span>which<span class="w w0"> </span>the<span class="w w0"> </span>av</div>
<div class="l f2 s4 c0" style="bottom:142.82px;top:641.164px;left:184.945px;">erage<span class="w w1"> </span>trace<span class="w w0"> </span>call<span class="w w1"> </span>executes<span class="w w0"> </span>few</div>
<div class="l f2 s4 c0" style="bottom:132.858px;top:651.126px;left:54px;">bytecodes<span class="w w2"> </span>before<span class="w w1"> </span>returning<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>interpreter.</div>
<div class="l f1 s2 c0" style="bottom:109.989px;top:672.159px;left:54px;">4.<span class="w w3"> </span>Nested<span class="w w1"> </span>Trace<span class="w w2"> </span>Tree<span class="w w2"> </span>Formation</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:54px;">Figure<span class="w w2"> </span>7<span class="w w1"> </span>shows<span class="w w2"> </span>basic<span class="w w2"> </span>trace<span class="w w1"> </span>tree<span class="w w2"> </span>compilation<span class="w w1"> </span>(11)<span class="w w2"> </span>applied<span class="w w2"> </span>to<span class="w w1"> </span>a<span class="w w2"> </span>nested</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:54px;">loop<span class="w w1"> </span>where<span class="w w0"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w1"> </span>contains<span class="w w0"> </span>two<span class="w w1"> </span>paths.<span class="w w1"> </span>Usually,<span class="w w1"> </span>the<span class="w w0"> </span>inner</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:54px;">loop<span class="w w2"> </span>(with<span class="w w1"> </span>header<span class="w w2"> </span>at</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:127.814px;">i</div>
<div class="l f8 s5 c0" style="bottom:76.2501px;top:710.442px;left:130.967px;">2</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:135.118px;">)<span class="w w2"> </span>becomes<span class="w w1"> </span>hot<span class="w w2"> </span>first,<span class="w w1"> </span>and<span class="w w1"> </span>a<span class="w w2"> </span>trace<span class="w w1"> </span>tree<span class="w w2"> </span>is<span class="w w1"> </span>rooted</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:54px;">at<span class="w w1"> </span>that<span class="w w1"> </span>point.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w1"> </span>recorded<span class="w w1"> </span>trace<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w1"> </span>a<span class="w w1"> </span>cycle</div>
<div class="l f11 s8 c0" style="bottom:700.083px;top:81.0122px;left:407.908px;">T</div>
<div class="l f11 s9 c0" style="bottom:682.702px;top:103.846px;left:449.541px;">T</div>
<div class="l f11 s9 c0" style="bottom:682.702px;top:103.846px;left:451.523px;">runk T</div>
<div class="l f11 s9 c0" style="bottom:682.702px;top:103.846px;left:463.038px;">r</div>
<div class="l f11 s9 c0" style="bottom:682.702px;top:103.846px;left:464.527px;">ace</div>
<div class="l f11 s9 c0" style="bottom:692.75px;top:93.798px;left:449.004px;">T</div>
<div class="l f11 s9 c0" style="bottom:692.75px;top:93.798px;left:450.986px;">r</div>
<div class="l f11 s9 c0" style="bottom:692.75px;top:93.798px;left:452.524px;">ee Anchor</div>
<div class="l f11 s9 c0" style="bottom:672.655px;top:113.893px;left:448.116px;">T</div>
<div class="l f11 s9 c0" style="bottom:672.655px;top:113.893px;left:450.098px;">r</div>
<div class="l f11 s9 c0" style="bottom:672.655px;top:113.893px;left:451.587px;">ace Anchor</div>
<div class="l f11 s9 c0" style="bottom:662.607px;top:123.941px;left:448.364px;">Br</div>
<div class="l f11 s9 c0" style="bottom:662.607px;top:123.941px;left:452.357px;">anch T</div>
<div class="l f11 s9 c0" style="bottom:662.607px;top:123.941px;left:464.214px;">r</div>
<div class="l f11 s9 c0" style="bottom:662.607px;top:123.941px;left:465.703px;">ace</div>
<div class="l f11 s9 c0" style="bottom:652.56px;top:133.988px;left:454.507px;">Guar</div>
<div class="l f11 s9 c0" style="bottom:652.56px;top:133.988px;left:463.486px;">d</div>
<div class="l f11 s9 c0" style="bottom:642.512px;top:144.036px;left:452.326px;">Side Exit</div>
<div class="l f1 s4 c0" style="bottom:560.476px;top:223.463px;left:317.014px;">Figure<span class="w w1"> </span>5.</div>
<div class="l f2 s4 c0" style="bottom:560.413px;top:223.571px;left:357.068px;">A<span class="w w1"> </span>tree<span class="w w0"> </span>with<span class="w w1"> </span>two<span class="w w0"> </span>traces,<span class="w w1"> </span>a<span class="w w0"> </span>trunk<span class="w w1"> </span>trace<span class="w w0"> </span>and<span class="w w1"> </span>one<span class="w w0"> </span>branch</div>
<div class="l f2 s4 c0" style="bottom:550.45px;top:233.534px;left:317.014px;">trace.<span class="w w2"> </span>The<span class="w w1"> </span>trunk<span class="w w1"> </span>trace<span class="w w2"> </span>contains<span class="w w1"> </span>a<span class="w w2"> </span>guard<span class="w w1"> </span>to<span class="w w1"> </span>which<span class="w w2"> </span>a<span class="w w1"> </span>branch<span class="w w2"> </span>trace<span class="w w1"> </span>was</div>
<div class="l f2 s4 c0" style="bottom:540.488px;top:243.496px;left:317.014px;">attached.<span class="w w2"> </span>The<span class="w w1"> </span>branch<span class="w w2"> </span>trace<span class="w w1"> </span>contain<span class="w w2"> </span>a<span class="w w1"> </span>guard<span class="w w2"> </span>that<span class="w w1"> </span>may<span class="w w2"> </span>fail<span class="w w1"> </span>and<span class="w w2"> </span>trigger</div>
<div class="l f2 s4 c0" style="bottom:530.525px;top:253.459px;left:317.014px;">a<span class="w w2"> </span>side<span class="w w1"> </span>exit.<span class="w w2"> </span>Both<span class="w w2"> </span>the<span class="w w1"> </span>trunk<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w2"> </span>branch<span class="w w1"> </span>trace<span class="w w2"> </span>loop<span class="w w1"> </span>back<span class="w w2"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>tree</div>
<div class="l f2 s4 c0" style="bottom:520.562px;top:263.422px;left:317.014px;">anchor,<span class="w w2"> </span>which<span class="w w1"> </span>is<span class="w w2"> </span>the<span class="w w1"> </span>beginning<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>tree.</div>
<div class="l f12 sa c0" style="bottom:491.661px;top:294.646px;left:400.607px;">T</div>
<div class="l f12 sa c0" style="bottom:491.661px;top:294.646px;left:402.676px;">r</div>
<div class="l f12 sa c0" style="bottom:491.661px;top:294.646px;left:404.231px;">ace 2</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:367.039px;">T</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:369.109px;">r</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:370.663px;">ace 1</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:490.121px;">T</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:492.191px;">r</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:493.745px;">ace 2</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:456.553px;">T</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:458.623px;">r</div>
<div class="l f12 sa c0" style="bottom:491.662px;top:294.645px;left:460.178px;">ace 1</div>
<div class="l f12 sa c0" style="bottom:424.983px;top:361.324px;left:367.446px;">Closed</div>
<div class="l f12 sa c0" style="bottom:424.984px;top:361.324px;left:401.139px;">Link</div>
<div class="l f12 sa c0" style="bottom:424.984px;top:361.324px;left:408.867px;">ed</div>
<div class="l f12 sa c0" style="bottom:424.984px;top:361.324px;left:457.085px;">Link</div>
<div class="l f12 sa c0" style="bottom:424.984px;top:361.324px;left:464.814px;">ed</div>
<div class="l f12 sa c0" style="bottom:424.984px;top:361.324px;left:490.653px;">Link</div>
<div class="l f12 sa c0" style="bottom:424.984px;top:361.324px;left:498.381px;">ed</div>
<div class="l f12 sb c0" style="bottom:385.692px;top:401.754px;left:358.474px;">Number</div>
<div class="l f12 sb c0" style="bottom:347.755px;top:439.691px;left:397.637px;">Number</div>
<div class="l f12 sb c0" style="bottom:383.827px;top:403.619px;left:485.924px;">String</div>
<div class="l f12 sb c0" style="bottom:347.755px;top:439.691px;left:441.718px;">String</div>
<div class="l f12 sb c0" style="bottom:348.394px;top:439.052px;left:485.924px;">String</div>
<div class="l f12 sb c0" style="bottom:340.935px;top:446.511px;left:362.204px;">String</div>
<div class="l f12 sb c0" style="bottom:385.053px;top:402.393px;left:441.778px;">Boolean</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:431.112px;">T</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:433.182px;">r</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:434.736px;">ace 2</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:367.039px;">T</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:369.109px;">r</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:370.663px;">ace 1</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:490.76px;">T</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:492.829px;">r</div>
<div class="l f12 sa c0" style="bottom:400.922px;top:385.386px;left:494.384px;">ace 3</div>
<div class="l f12 sa c0" style="bottom:327.25px;top:459.057px;left:367.571px;">Link</div>
<div class="l f12 sa c0" style="bottom:327.25px;top:459.057px;left:375.299px;">ed</div>
<div class="l f12 sa c0" style="bottom:330.98px;top:455.328px;left:406.733px;">Link</div>
<div class="l f12 sa c0" style="bottom:330.98px;top:455.328px;left:414.462px;">ed</div>
<div class="l f12 sa c0" style="bottom:330.98px;top:455.328px;left:431.644px;">Link</div>
<div class="l f12 sa c0" style="bottom:330.98px;top:455.328px;left:439.372px;">ed</div>
<div class="l f12 sa c0" style="bottom:330.755px;top:455.552px;left:490.528px;">Closed</div>
<div class="l f12 sb c0" style="bottom:476.432px;top:311.014px;left:358.474px;">Number</div>
<div class="l f12 sb c0" style="bottom:437.269px;top:350.176px;left:358.474px;">Number</div>
<div class="l f12 sb c0" style="bottom:437.269px;top:350.176px;left:410.115px;">Number</div>
<div class="l f12 sb c0" style="bottom:476.432px;top:311.014px;left:410.075px;">Boolean</div>
<div class="l f12 sb c0" style="bottom:476.432px;top:311.014px;left:447.988px;">Number</div>
<div class="l f12 sb c0" style="bottom:437.269px;top:350.176px;left:447.988px;">Boolean</div>
<div class="l f12 sb c0" style="bottom:437.269px;top:350.176px;left:499.63px;">Number</div>
<div class="l f12 sb c0" style="bottom:476.432px;top:311.014px;left:499.59px;">Boolean</div>
<div class="l f12 sc c0" style="bottom:416.703px;top:367.328px;left:387.084px;">(a)</div>
<div class="l f12 sc c0" style="bottom:417.318px;top:366.713px;left:476.151px;">(b)</div>
<div class="l f12 sc c0" style="bottom:320.135px;top:463.896px;left:436.062px;">(c)</div>
<div class="l f1 s4 c0" style="bottom:291.866px;top:492.073px;left:317.014px;">Figure<span class="w w0"> </span>6.</div>
<div class="l f2 s4 c0" style="bottom:291.803px;top:492.181px;left:357.371px;">We<span class="w w1"> </span>handle<span class="w w0"> </span>type-unstable<span class="w w0"> </span>loops<span class="w w1"> </span>by<span class="w w0"> </span>allowing<span class="w w1"> </span>traces<span class="w w0"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:281.841px;top:502.143px;left:317.014px;">compile<span class="w w1"> </span>that<span class="w w0"> </span>cannot<span class="w w1"> </span>loop<span class="w w0"> </span>back<span class="w w1"> </span>to<span class="w w1"> </span>themselves<span class="w w0"> </span>due<span class="w w1"> </span>to<span class="w w0"> </span>a<span class="w w1"> </span>type<span class="w w1"> </span>mis-</div>
<div class="l f2 s4 c0" style="bottom:271.878px;top:512.106px;left:317.014px;">match.<span class="w w2"> </span>As<span class="w w1"> </span>such<span class="w w2"> </span>traces<span class="w w1"> </span>accumulate,<span class="w w2"> </span>we<span class="w w2"> </span>attempt<span class="w w1"> </span>to<span class="w w2"> </span>connect<span class="w w1"> </span>their<span class="w w2"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:261.916px;top:522.068px;left:317.014px;">edges<span class="w w2"> </span>to<span class="w w1"> </span>form<span class="w w2"> </span>groups<span class="w w1"> </span>of<span class="w w1"> </span>trace<span class="w w2"> </span>trees<span class="w w1"> </span>that<span class="w w2"> </span>can<span class="w w1"> </span>execute<span class="w w2"> </span>without<span class="w w1"> </span>having</div>
<div class="l f2 s4 c0" style="bottom:251.953px;top:532.031px;left:317.014px;">to<span class="w w1"> </span>side-exit<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>to<span class="w w1"> </span>cover<span class="w w1"> </span>odd<span class="w w1"> </span>type<span class="w w1"> </span>cases.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w1"> </span>par-</div>
<div class="l f2 s4 c0" style="bottom:241.99px;top:541.994px;left:317.014px;">ticularly<span class="w w2"> </span>important<span class="w w1"> </span>for<span class="w w2"> </span>nested<span class="w w1"> </span>trace<span class="w w2"> </span>trees<span class="w w2"> </span>where<span class="w w1"> </span>an<span class="w w2"> </span>outer<span class="w w1"> </span>tree<span class="w w2"> </span>tries<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:232.028px;top:551.956px;left:317.014px;">call<span class="w w2"> </span>an<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w2"> </span>(or<span class="w w1"> </span>in<span class="w w2"> </span>this<span class="w w1"> </span>case<span class="w w1"> </span>a<span class="w w2"> </span>forest<span class="w w1"> </span>of<span class="w w2"> </span>inner<span class="w w1"> </span>trees),<span class="w w1"> </span>since<span class="w w2"> </span>inner</div>
<div class="l f2 s4 c0" style="bottom:222.065px;top:561.919px;left:317.014px;">loops<span class="w w2"> </span>frequently<span class="w w1"> </span>have<span class="w w2"> </span>initially<span class="w w1"> </span>undefined<span class="w w2"> </span>values<span class="w w1"> </span>which<span class="w w1"> </span>change<span class="w w2"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:212.102px;top:571.882px;left:317.014px;">to<span class="w w2"> </span>a<span class="w w1"> </span>concrete<span class="w w1"> </span>value<span class="w w2"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>first<span class="w w1"> </span>iteration.</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:317.014px;">through<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>loop,</div>
<div class="l f6 s4 c0" style="bottom:186.256px;top:597.28px;left:407.042px;">{</div>
<div class="l ff s4 c0" style="bottom:186.256px;top:597.782px;left:411.65px;">i</div>
<div class="l f8 s5 c0" style="bottom:185.839px;top:600.853px;left:414.803px;">2</div>
<div class="l ff s4 c0" style="bottom:186.256px;top:597.782px;left:418.954px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:185.839px;top:600.853px;left:426.203px;">3</div>
<div class="l ff s4 c0" style="bottom:186.256px;top:597.782px;left:430.354px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:185.839px;top:600.853px;left:437.604px;">5</div>
<div class="l ff s4 c0" style="bottom:186.256px;top:597.782px;left:441.755px;">,<span class="w w2"> </span>α</div>
<div class="l f6 s4 c0" style="bottom:186.256px;top:597.28px;left:451.763px;">}</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:456.371px;">.<span class="w w1"> </span>The</div>
<div class="l ff s4 c0" style="bottom:186.256px;top:597.782px;left:479.839px;">α</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:489.394px;">symbol<span class="w w1"> </span>is<span class="w w0"> </span>used<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:317.014px;">indicate<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>loops<span class="w w1"> </span>back<span class="w w1"> </span>the<span class="w w2"> </span>tree<span class="w w1"> </span>anchor.</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:328.969px;">When<span class="w w2"> </span>execution<span class="w w1"> </span>leaves<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop,<span class="w w1"> </span>the<span class="w w2"> </span>basic<span class="w w1"> </span>design<span class="w w1"> </span>has<span class="w w2"> </span>two</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:317.014px;">choices.<span class="w w2"> </span>First,<span class="w w1"> </span>the<span class="w w2"> </span>system<span class="w w2"> </span>can<span class="w w1"> </span>stop<span class="w w2"> </span>tracing<span class="w w2"> </span>and<span class="w w1"> </span>give<span class="w w2"> </span>up<span class="w w2"> </span>on<span class="w w1"> </span>compiling</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">the<span class="w w1"> </span>outer<span class="w w2"> </span>loop,<span class="w w1"> </span>clearly<span class="w w1"> </span>an<span class="w w1"> </span>undesirable<span class="w w2"> </span>solution.<span class="w w1"> </span>The<span class="w w1"> </span>other<span class="w w1"> </span>choice<span class="w w1"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:317.014px;">to<span class="w w1"> </span>continue<span class="w w1"> </span>tracing,<span class="w w1"> </span>compiling<span class="w w1"> </span>traces<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w0"> </span>loop<span class="w w2"> </span>inside<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">inner<span class="w w2"> </span>loop’s<span class="w w1"> </span>trace<span class="w w2"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:328.969px;">For<span class="w w1"> </span>example,<span class="w w2"> </span>the<span class="w w1"> </span>program<span class="w w1"> </span>might<span class="w w1"> </span>exit<span class="w w1"> </span>at</div>
<div class="l ff s4 c0" style="bottom:116.517px;top:667.521px;left:474.128px;">i</div>
<div class="l f8 s5 c0" style="bottom:116.101px;top:670.591px;left:477.281px;">5</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:484.047px;">and<span class="w w1"> </span>record<span class="w w1"> </span>a<span class="w w2"> </span>branch</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">trace<span class="w w0"> </span>that<span class="w w4"> </span>incorporates<span class="w w0"> </span>the<span class="w w4"> </span>outer<span class="w w0"> </span>loop:</div>
<div class="l f6 s4 c0" style="bottom:106.554px;top:676.981px;left:470.346px;">{</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:474.954px;">i</div>
<div class="l f8 s5 c0" style="bottom:106.138px;top:680.554px;left:478.108px;">5</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:482.259px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:106.138px;top:680.554px;left:489.508px;">7</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:493.659px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:106.138px;top:680.554px;left:500.908px;">1</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:505.059px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:106.138px;top:680.554px;left:512.308px;">6</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:516.459px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:106.138px;top:680.554px;left:523.708px;">7</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:527.859px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:106.138px;top:680.554px;left:535.108px;">1</div>
<div class="l ff s4 c0" style="bottom:106.554px;top:677.483px;left:539.259px;">,<span class="w w2"> </span>α</div>
<div class="l f6 s4 c0" style="bottom:106.554px;top:676.981px;left:549.268px;">}</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:553.875px;">.</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:317.014px;">Later,<span class="w w0"> </span>the<span class="w w1"> </span>program<span class="w w0"> </span>might<span class="w w0"> </span>take<span class="w w0"> </span>the<span class="w w1"> </span>other<span class="w w0"> </span>branch<span class="w w0"> </span>at</div>
<div class="l ff s4 c0" style="bottom:96.5917px;top:687.446px;left:512.199px;">i</div>
<div class="l f8 s5 c0" style="bottom:96.1753px;top:690.517px;left:515.352px;">2</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:523.616px;">and<span class="w w0"> </span>then</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">exit,<span class="w w1"> </span>recording<span class="w w1"> </span>another<span class="w w1"> </span>branch<span class="w w0"> </span>trace<span class="w w2"> </span>incorporating<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop:</div>
<div class="l f6 s4 c0" style="bottom:76.6665px;top:706.869px;left:317.014px;">{</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:321.621px;">i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:324.775px;">2</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:328.926px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:336.175px;">4</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:340.326px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:347.575px;">5</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:351.726px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:358.975px;">7</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:363.126px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:370.375px;">1</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:374.526px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:381.775px;">6</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:385.926px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:393.176px;">7</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:397.327px;">,<span class="w w2"> </span>i</div>
<div class="l f8 s5 c0" style="bottom:76.25px;top:710.442px;left:404.576px;">1</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:408.727px;">,<span class="w w2"> </span>α</div>
<div class="l f6 s4 c0" style="bottom:76.6665px;top:706.869px;left:418.735px;">}</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:423.343px;">.<span class="w w2"> </span>Thus,<span class="w w1"> </span>the<span class="w w2"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>is<span class="w w1"> </span>recorded<span class="w w2"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:317.014px;">compiled<span class="w w2"> </span>twice,<span class="w w2"> </span>and<span class="w w1"> </span>both<span class="w w2"> </span>copies<span class="w w2"> </span>must<span class="w w2"> </span>be<span class="w w1"> </span>retained<span class="w w2"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>cache.</div>
</div>
<div id="page-7" class="p" style="width:612px;height:792px;background-image:url(p7.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f13 sd c0" style="bottom:684.106px;top:101.911px;left:133.648px;">i</div>
<div class="l f13 se c0" style="bottom:684.483px;top:103.244px;left:134.852px;">2</div>
<div class="l f13 sd c0" style="bottom:657.769px;top:128.248px;left:120.938px;">i</div>
<div class="l f13 se c0" style="bottom:658.145px;top:129.581px;left:122.141px;">3</div>
<div class="l f13 sd c0" style="bottom:657.769px;top:128.248px;left:146.138px;">i</div>
<div class="l f13 se c0" style="bottom:658.145px;top:129.581px;left:147.341px;">4</div>
<div class="l f13 sd c0" style="bottom:635.958px;top:150.059px;left:133.823px;">i</div>
<div class="l f13 se c0" style="bottom:636.335px;top:151.392px;left:135.027px;">5</div>
<div class="l f13 sd c0" style="bottom:705.894px;top:80.1234px;left:133.363px;">i</div>
<div class="l f13 se c0" style="bottom:706.27px;top:81.4562px;left:134.566px;">1</div>
<div class="l f13 sd c0" style="bottom:658.655px;top:127.362px;left:102.522px;">i</div>
<div class="l f13 se c0" style="bottom:659.031px;top:128.695px;left:103.726px;">6</div>
<div class="l f13 sd c0" style="bottom:614.212px;top:171.805px;left:133.363px;">i</div>
<div class="l f13 se c0" style="bottom:614.589px;top:173.138px;left:134.566px;">7</div>
<div class="l f13 sd c0" style="bottom:704.784px;top:81.2336px;left:178.122px;">t</div>
<div class="l f13 se c0" style="bottom:705.16px;top:82.5664px;left:179.82px;">1</div>
<div class="l f13 sd c0" style="bottom:660.969px;top:125.048px;left:209.557px;">t</div>
<div class="l f13 se c0" style="bottom:661.345px;top:126.381px;left:211.256px;">2</div>
<div class="l f13 sf c0" style="bottom:695.837px;top:91.0349px;left:222.77px;">T</div>
<div class="l f13 sf c0" style="bottom:695.837px;top:91.0349px;left:224.634px;">r</div>
<div class="l f13 sf c0" style="bottom:695.837px;top:91.0349px;left:226.079px;">ee Call</div>
<div class="l f13 sf c0" style="bottom:708.426px;top:78.4459px;left:211.446px;">Out</div>
<div class="l f13 sf c0" style="bottom:708.426px;top:78.4459px;left:217.945px;">er T</div>
<div class="l f13 sf c0" style="bottom:708.426px;top:78.4459px;left:224.366px;">r</div>
<div class="l f13 sf c0" style="bottom:708.426px;top:78.4459px;left:225.812px;">ee</div>
<div class="l f13 sf c0" style="bottom:676.955px;top:109.917px;left:222.958px;">Nes</div>
<div class="l f13 sf c0" style="bottom:676.955px;top:109.917px;left:229.467px;">t</div>
<div class="l f13 sf c0" style="bottom:676.955px;top:109.917px;left:230.872px;">ed T</div>
<div class="l f13 sf c0" style="bottom:676.955px;top:109.917px;left:238.054px;">r</div>
<div class="l f13 sf c0" style="bottom:676.955px;top:109.917px;left:239.5px;">ee</div>
<div class="l f13 sf c0" style="bottom:616.68px;top:170.192px;left:224.286px;">Exit Guar</div>
<div class="l f13 sf c0" style="bottom:616.68px;top:170.192px;left:240.147px;">d</div>
<div class="l f13 s10 c0" style="bottom:585.128px;top:199.18px;left:131.69px;">(a)</div>
<div class="l f13 s10 c0" style="bottom:586.528px;top:197.78px;left:203.52px;">(b)</div>
<div class="l f1 s4 c0" style="bottom:558.073px;top:225.866px;left:54px;">Figure<span class="w w2"> </span>7.</div>
<div class="l f2 s4 c0" style="bottom:558.011px;top:225.973px;left:92.6815px;">Control<span class="w w2"> </span>flow<span class="w w1"> </span>graph<span class="w w2"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>nested<span class="w w2"> </span>loop<span class="w w1"> </span>with<span class="w w1"> </span>an<span class="w w2"> </span>if<span class="w w1"> </span>statement</div>
<div class="l f2 s4 c0" style="bottom:548.048px;top:235.936px;left:54px;">inside<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w0"> </span>most<span class="w w1"> </span>loop<span class="w w0"> </span>(a).<span class="w w1"> </span>An<span class="w w0"> </span>inner<span class="w w1"> </span>tree<span class="w w0"> </span>captures<span class="w w1"> </span>the<span class="w w0"> </span>inner</div>
<div class="l f2 s4 c0" style="bottom:538.085px;top:245.899px;left:54px;">loop,<span class="w w2"> </span>and<span class="w w1"> </span>is<span class="w w2"> </span>nested<span class="w w1"> </span>inside<span class="w w1"> </span>an<span class="w w2"> </span>outer<span class="w w1"> </span>tree<span class="w w2"> </span>which<span class="w w1"> </span>“calls”<span class="w w1"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:528.123px;top:255.861px;left:54px;">The<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>returns<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree<span class="w w1"> </span>once<span class="w w1"> </span>it<span class="w w1"> </span>exits<span class="w w1"> </span>along<span class="w w1"> </span>its<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:518.16px;top:265.824px;left:54px;">condition<span class="w w2"> </span>guard<span class="w w1"> </span>(b).</div>
<div class="l f2 s4 c0" style="bottom:489.476px;top:294.508px;left:54px;">In<span class="w w2"> </span>general,<span class="w w1"> </span>if<span class="w w2"> </span>loops<span class="w w1"> </span>are<span class="w w2"> </span>nested<span class="w w1"> </span>to<span class="w w2"> </span>depth</div>
<div class="l ff s4 c0" style="bottom:489.673px;top:294.364px;left:191.924px;">k</div>
<div class="l f2 s4 c0" style="bottom:489.476px;top:294.508px;left:196.985px;">,<span class="w w2"> </span>and<span class="w w1"> </span>each<span class="w w2"> </span>loop<span class="w w1"> </span>has</div>
<div class="l ff s4 c0" style="bottom:489.673px;top:294.364px;left:266.596px;">n</div>
<div class="l f2 s4 c0" style="bottom:489.476px;top:294.508px;left:274.176px;">paths</div>
<div class="l f2 s4 c0" style="bottom:479.077px;top:304.907px;left:54px;">(on<span class="w w1"> </span>geometric<span class="w w0"> </span>average),<span class="w w1"> </span>this<span class="w w0"> </span>na¨</div>
<div class="l f2 s4 c0" style="bottom:479.077px;top:304.907px;left:170.454px;">ıve<span class="w w1"> </span>strategy<span class="w w0"> </span>yields</div>
<div class="l ff s4 c0" style="bottom:479.274px;top:304.764px;left:241.776px;">O</div>
<div class="l f14 s4 c0" style="bottom:479.274px;top:304.764px;left:249.044px;">(</div>
<div class="l ff s4 c0" style="bottom:479.274px;top:304.764px;left:252.628px;">n</div>
<div class="l f10 s5 c0" style="bottom:483.663px;top:303.029px;left:258.187px;">k</div>
<div class="l f14 s4 c0" style="bottom:479.274px;top:304.764px;left:262.76px;">)</div>
<div class="l f2 s4 c0" style="bottom:479.077px;top:304.907px;left:269.953px;">traces,</div>
<div class="l f2 s4 c0" style="bottom:469.114px;top:314.87px;left:54px;">which<span class="w w2"> </span>can<span class="w w1"> </span>easily<span class="w w1"> </span>fill<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>cache.</div>
<div class="l f2 s4 c0" style="bottom:459.151px;top:324.833px;left:65.9552px;">In<span class="w w1"> </span>order<span class="w w0"> </span>to<span class="w w1"> </span>execute<span class="w w0"> </span>programs<span class="w w1"> </span>with<span class="w w0"> </span>nested<span class="w w1"> </span>loops<span class="w w0"> </span>efficiently,<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:449.189px;top:334.795px;left:54px;">tracing<span class="w w2"> </span>system<span class="w w1"> </span>needs<span class="w w2"> </span>a<span class="w w2"> </span>technique<span class="w w1"> </span>for<span class="w w2"> </span>covering<span class="w w2"> </span>the<span class="w w1"> </span>nested<span class="w w2"> </span>loops<span class="w w1"> </span>with</div>
<div class="l f2 s4 c0" style="bottom:439.226px;top:344.758px;left:54px;">native<span class="w w2"> </span>code<span class="w w1"> </span>without<span class="w w2"> </span>exponential<span class="w w1"> </span>trace<span class="w w1"> </span>duplication.</div>
<div class="l f1 s4 c0" style="bottom:420.936px;top:363.003px;left:54px;">4.1<span class="w w10"> </span>Nesting<span class="w w2"> </span>Algorithm</div>
<div class="l f2 s4 c0" style="bottom:406.926px;top:377.058px;left:54px;">The<span class="w w1"> </span>key<span class="w w2"> </span>insight<span class="w w1"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>if<span class="w w1"> </span>each<span class="w w1"> </span>loop<span class="w w1"> </span>is<span class="w w2"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:396.963px;top:387.021px;left:54px;">tree,<span class="w w1"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>for<span class="w w1"> </span>each<span class="w w2"> </span>loop<span class="w w1"> </span>can<span class="w w1"> </span>be<span class="w w1"> </span>contained<span class="w w1"> </span>only<span class="w w1"> </span>in<span class="w w1"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>tree,</div>
<div class="l f2 s4 c0" style="bottom:387px;top:396.984px;left:54px;">and<span class="w w2"> </span>outer<span class="w w1"> </span>loop<span class="w w2"> </span>paths<span class="w w1"> </span>will<span class="w w2"> </span>not<span class="w w1"> </span>be<span class="w w2"> </span>duplicated.<span class="w w1"> </span>Another<span class="w w2"> </span>key<span class="w w2"> </span>fact<span class="w w1"> </span>is<span class="w w2"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:377.038px;top:406.946px;left:54px;">we<span class="w w2"> </span>are<span class="w w1"> </span>not<span class="w w2"> </span>tracing<span class="w w1"> </span>arbitrary<span class="w w1"> </span>bytecodes<span class="w w2"> </span>that<span class="w w1"> </span>might<span class="w w2"> </span>have<span class="w w1"> </span>irreduceable</div>
<div class="l f2 s4 c0" style="bottom:367.075px;top:416.909px;left:54px;">control<span class="w w1"> </span>flow<span class="w w1"> </span>graphs,<span class="w w1"> </span>but<span class="w w1"> </span>rather<span class="w w1"> </span>bytecodes<span class="w w1"> </span>produced<span class="w w1"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>compiler</div>
<div class="l f2 s4 c0" style="bottom:357.113px;top:426.871px;left:54px;">for<span class="w w1"> </span>a<span class="w w1"> </span>language<span class="w w1"> </span>with<span class="w w1"> </span>structured<span class="w w1"> </span>control<span class="w w1"> </span>flow.<span class="w w1"> </span>Thus,<span class="w w1"> </span>given<span class="w w1"> </span>two<span class="w w1"> </span>loop</div>
<div class="l f2 s4 c0" style="bottom:347.15px;top:436.834px;left:54px;">edges,<span class="w w1"> </span>the<span class="w w0"> </span>system<span class="w w0"> </span>can<span class="w w1"> </span>easily<span class="w w0"> </span>determine<span class="w w1"> </span>whether<span class="w w0"> </span>they<span class="w w1"> </span>are<span class="w w0"> </span>nested</div>
<div class="l f2 s4 c0" style="bottom:337.187px;top:446.797px;left:54px;">and<span class="w w1"> </span>which<span class="w w2"> </span>is<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop.<span class="w w2"> </span>Using<span class="w w1"> </span>this<span class="w w1"> </span>knowledge,<span class="w w2"> </span>the<span class="w w1"> </span>system<span class="w w1"> </span>can</div>
<div class="l f2 s4 c0" style="bottom:327.225px;top:456.759px;left:54px;">compile<span class="w w2"> </span>inner<span class="w w1"> </span>and<span class="w w2"> </span>outer<span class="w w2"> </span>loops<span class="w w1"> </span>separately,<span class="w w2"> </span>and<span class="w w2"> </span>make<span class="w w1"> </span>the<span class="w w2"> </span>outer<span class="w w2"> </span>loop’s</div>
<div class="l f2 s4 c0" style="bottom:317.262px;top:466.722px;left:54px;">traces</div>
<div class="l fa s4 c0" style="bottom:317.468px;top:466.812px;left:77.1508px;">call</div>
<div class="l f2 s4 c0" style="bottom:317.262px;top:466.722px;left:92.8506px;">the<span class="w w2"> </span>inner<span class="w w1"> </span>loop’s<span class="w w2"> </span>trace<span class="w w1"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:307.299px;top:476.685px;left:65.9552px;">The<span class="w w1"> </span>algorithm<span class="w w1"> </span>for<span class="w w1"> </span>building<span class="w w2"> </span>nested<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>is<span class="w w1"> </span>as<span class="w w1"> </span>follows.<span class="w w1"> </span>We</div>
<div class="l f2 s4 c0" style="bottom:297.337px;top:486.647px;left:54px;">start<span class="w w1"> </span>tracing<span class="w w2"> </span>at<span class="w w1"> </span>loop<span class="w w1"> </span>headers<span class="w w1"> </span>exactly<span class="w w1"> </span>as<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>basic<span class="w w1"> </span>tracing<span class="w w1"> </span>system.</div>
<div class="l f2 s4 c0" style="bottom:287.374px;top:496.61px;left:54px;">When<span class="w w1"> </span>we<span class="w w0"> </span>exit<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w0"> </span>(detected<span class="w w1"> </span>by<span class="w w0"> </span>comparing<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>PC</div>
<div class="l f2 s4 c0" style="bottom:277.411px;top:506.573px;left:54px;">with<span class="w w1"> </span>the<span class="w w0"> </span>range<span class="w w0"> </span>given<span class="w w1"> </span>by<span class="w w0"> </span>the<span class="w w1"> </span>loop<span class="w w0"> </span>edge),<span class="w w1"> </span>we<span class="w w0"> </span>stop<span class="w w1"> </span>the<span class="w w0"> </span>trace.<span class="w w0"> </span>The</div>
<div class="l f2 s4 c0" style="bottom:267.449px;top:516.535px;left:54px;">key<span class="w w1"> </span>step<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>algorithm<span class="w w1"> </span>occurs<span class="w w1"> </span>when<span class="w w0"> </span>we<span class="w w1"> </span>are<span class="w w0"> </span>recording<span class="w w1"> </span>a<span class="w w0"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:257.486px;top:526.498px;left:54px;">for<span class="w w1"> </span>loop</div>
<div class="l ff s4 c0" style="bottom:257.683px;top:526.354px;left:85.7379px;">L</div>
<div class="l f10 s5 c0" style="bottom:257.267px;top:529.425px;left:92.0088px;">R</div>
<div class="l f2 s4 c0" style="bottom:257.486px;top:526.498px;left:100.712px;">(</div>
<div class="l ff s4 c0" style="bottom:257.683px;top:526.354px;left:103.697px;">R</div>
<div class="l f2 s4 c0" style="bottom:257.486px;top:526.498px;left:113.403px;">for<span class="w w1"> </span>loop<span class="w w1"> </span>being<span class="w w1"> </span>recorded)<span class="w w1"> </span>and<span class="w w1"> </span>we<span class="w w2"> </span>reach<span class="w w1"> </span>the<span class="w w1"> </span>header</div>
<div class="l f2 s4 c0" style="bottom:247.524px;top:536.46px;left:54.0001px;">of<span class="w w2"> </span>a<span class="w w1"> </span>different<span class="w w2"> </span>loop</div>
<div class="l ff s4 c0" style="bottom:247.721px;top:536.317px;left:120.731px;">L</div>
<div class="l f10 s5 c0" style="bottom:247.304px;top:539.388px;left:127.001px;">O</div>
<div class="l f2 s4 c0" style="bottom:247.524px;top:536.46px;left:135.45px;">(</div>
<div class="l ff s4 c0" style="bottom:247.721px;top:536.317px;left:138.435px;">O</div>
<div class="l f2 s4 c0" style="bottom:247.524px;top:536.46px;left:147.877px;">for<span class="w w2"> </span>other<span class="w w1"> </span>loop).<span class="w w1"> </span>Note<span class="w w2"> </span>that</div>
<div class="l ff s4 c0" style="bottom:247.721px;top:536.317px;left:239.671px;">L</div>
<div class="l f10 s5 c0" style="bottom:247.304px;top:539.388px;left:245.942px;">O</div>
<div class="l f2 s4 c0" style="bottom:247.524px;top:536.46px;left:254.39px;">must<span class="w w2"> </span>be<span class="w w1"> </span>an</div>
<div class="l f2 s4 c0" style="bottom:237.561px;top:546.423px;left:54.0001px;">inner<span class="w w2"> </span>loop<span class="w w1"> </span>of</div>
<div class="l ff s4 c0" style="bottom:237.758px;top:546.28px;left:102.562px;">L</div>
<div class="l f10 s5 c0" style="bottom:237.342px;top:549.35px;left:108.833px;">R</div>
<div class="l f2 s4 c0" style="bottom:237.561px;top:546.423px;left:117.106px;">because<span class="w w2"> </span>we<span class="w w1"> </span>stop<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>when<span class="w w1"> </span>we<span class="w w2"> </span>exit<span class="w w1"> </span>a<span class="w w2"> </span>loop.</div>
<div class="l f3 s3 c0" style="bottom:223.696px;top:560.781px;left:59.2304px;">•</div>
<div class="l f2 s4 c0" style="bottom:222.407px;top:561.577px;left:66.9516px;">If</div>
<div class="l ff s4 c0" style="bottom:222.604px;top:561.434px;left:75.6513px;">L</div>
<div class="l f10 s5 c0" style="bottom:222.188px;top:564.504px;left:81.9222px;">O</div>
<div class="l f2 s4 c0" style="bottom:222.407px;top:561.577px;left:90.9257px;">has<span class="w w1"> </span>a<span class="w w1"> </span>type-matching<span class="w w1"> </span>compiled<span class="w w1"> </span>trace<span class="w w1"> </span>tree,<span class="w w1"> </span>we<span class="w w1"> </span>call</div>
<div class="l ff s4 c0" style="bottom:222.604px;top:561.434px;left:270.36px;">L</div>
<div class="l f10 s5 c0" style="bottom:222.188px;top:564.504px;left:276.631px;">O</div>
<div class="l f2 s4 c0" style="bottom:222.407px;top:561.577px;left:285.635px;">as</div>
<div class="l f2 s4 c0" style="bottom:212.444px;top:571.54px;left:66.9516px;">a<span class="w w1"> </span>nested<span class="w w2"> </span>trace<span class="w w1"> </span>tree.<span class="w w1"> </span>If<span class="w w1"> </span>the<span class="w w1"> </span>call<span class="w w2"> </span>succeeds,<span class="w w1"> </span>then<span class="w w1"> </span>we<span class="w w1"> </span>record<span class="w w2"> </span>the<span class="w w1"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:202.482px;top:581.502px;left:66.9516px;">in<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>for</div>
<div class="l ff s4 c0" style="bottom:202.679px;top:581.359px;left:122.101px;">L</div>
<div class="l f10 s5 c0" style="bottom:202.263px;top:584.429px;left:128.372px;">R</div>
<div class="l f2 s4 c0" style="bottom:202.482px;top:581.502px;left:134.404px;">.<span class="w w2"> </span>On<span class="w w1"> </span>future<span class="w w1"> </span>executions,<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>for</div>
<div class="l ff s4 c0" style="bottom:202.679px;top:581.359px;left:264.514px;">L</div>
<div class="l f10 s5 c0" style="bottom:202.263px;top:584.429px;left:270.785px;">R</div>
<div class="l f2 s4 c0" style="bottom:202.482px;top:581.502px;left:279.152px;">will</div>
<div class="l f2 s4 c0" style="bottom:192.519px;top:591.465px;left:66.9516px;">call<span class="w w2"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>trace<span class="w w2"> </span>directly.</div>
<div class="l f3 s3 c0" style="bottom:179.86px;top:604.616px;left:59.2305px;">•</div>
<div class="l f2 s4 c0" style="bottom:178.571px;top:605.413px;left:66.9516px;">If</div>
<div class="l ff s4 c0" style="bottom:178.769px;top:605.269px;left:75.9145px;">L</div>
<div class="l f10 s5 c0" style="bottom:178.352px;top:608.34px;left:82.1854px;">O</div>
<div class="l f2 s4 c0" style="bottom:178.571px;top:605.413px;left:91.4521px;">does<span class="w w1"> </span>not<span class="w w1"> </span>have<span class="w w1"> </span>a<span class="w w1"> </span>type-matching<span class="w w1"> </span>compiled<span class="w w0"> </span>trace<span class="w w1"> </span>tree<span class="w w1"> </span>yet,</div>
<div class="l f2 s4 c0" style="bottom:168.609px;top:615.375px;left:66.9516px;">we<span class="w w1"> </span>have<span class="w w0"> </span>to<span class="w w1"> </span>obtain<span class="w w1"> </span>it<span class="w w0"> </span>before<span class="w w1"> </span>we<span class="w w0"> </span>are<span class="w w1"> </span>able<span class="w w1"> </span>to<span class="w w0"> </span>proceed.<span class="w w1"> </span>In<span class="w w0"> </span>order</div>
<div class="l f2 s4 c0" style="bottom:158.646px;top:625.338px;left:66.9516px;">to<span class="w w1"> </span>do<span class="w w1"> </span>this,<span class="w w1"> </span>we<span class="w w1"> </span>simply<span class="w w1"> </span>abort<span class="w w1"> </span>recording<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w0"> </span>trace.<span class="w w2"> </span>The<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:148.684px;top:635.3px;left:66.9516px;">monitor<span class="w w1"> </span>will<span class="w w0"> </span>see<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loop<span class="w w0"> </span>header,<span class="w w1"> </span>and<span class="w w1"> </span>will<span class="w w0"> </span>immediately</div>
<div class="l f2 s4 c0" style="bottom:138.359px;top:645.625px;left:66.9516px;">start<span class="w w2"> </span>recording<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w2"> </span>loop.</div>
<div class="l f2 s5 c0" style="bottom:142.813px;top:643.843px;left:175.524px;">2</div>
<div class="l f2 s4 c0" style="bottom:123.205px;top:660.779px;left:65.9554px;">If<span class="w w2"> </span>all<span class="w w2"> </span>the<span class="w w1"> </span>loops<span class="w w2"> </span>in<span class="w w2"> </span>a<span class="w w1"> </span>nest<span class="w w2"> </span>are<span class="w w2"> </span>type-stable,<span class="w w1"> </span>then<span class="w w2"> </span>loop<span class="w w2"> </span>nesting<span class="w w1"> </span>creates</div>
<div class="l f2 s4 c0" style="bottom:113.242px;top:670.742px;left:54.0002px;">no<span class="w w2"> </span>duplication.<span class="w w2"> </span>Otherwise,<span class="w w1"> </span>if<span class="w w2"> </span>loops<span class="w w2"> </span>are<span class="w w1"> </span>nested<span class="w w2"> </span>to<span class="w w2"> </span>a<span class="w w1"> </span>depth</div>
<div class="l ff s4 c0" style="bottom:113.439px;top:670.599px;left:252.739px;">k</div>
<div class="l f2 s4 c0" style="bottom:113.242px;top:670.742px;left:257.799px;">,<span class="w w2"> </span>and<span class="w w2"> </span>each</div>
<div class="l f2 s5 c0" style="bottom:96.864px;top:689.792px;left:54px;">2</div>
<div class="l f2 s3 c0" style="bottom:93.6209px;top:691.254px;left:58.4832px;">Instead<span class="w w2"> </span>of<span class="w w1"> </span>aborting<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w2"> </span>recording,<span class="w w1"> </span>we<span class="w w1"> </span>could<span class="w w2"> </span>principally<span class="w w1"> </span>merely<span class="w w1"> </span>sus-</div>
<div class="l f2 s3 c0" style="bottom:84.6545px;top:700.22px;left:54px;">pend<span class="w w1"> </span>the<span class="w w1"> </span>recording,<span class="w w1"> </span>but<span class="w w1"> </span>that<span class="w w1"> </span>would<span class="w w1"> </span>require<span class="w w1"> </span>the<span class="w w1"> </span>implementation<span class="w w1"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>able</div>
<div class="l f2 s3 c0" style="bottom:75.6882px;top:709.187px;left:54px;">to<span class="w w1"> </span>record<span class="w w1"> </span>several<span class="w w2"> </span>traces<span class="w w1"> </span>simultaneously,<span class="w w1"> </span>complicating<span class="w w1"> </span>the<span class="w w1"> </span>implementation,</div>
<div class="l f2 s3 c0" style="bottom:66.7218px;top:718.153px;left:54px;">while<span class="w w2"> </span>saving<span class="w w1"> </span>only<span class="w w2"> </span>a<span class="w w2"> </span>few<span class="w w1"> </span>iterations<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.</div>
<div class="l f15 s11 c0" style="bottom:685.588px;top:100.77px;left:398.856px;">i</div>
<div class="l f15 s12 c0" style="bottom:685.943px;top:102.027px;left:399.991px;">2</div>
<div class="l f15 s11 c0" style="bottom:665.785px;top:120.573px;left:398.856px;">i</div>
<div class="l f15 s12 c0" style="bottom:666.14px;top:121.83px;left:399.991px;">3</div>
<div class="l f15 s11 c0" style="bottom:706.711px;top:79.6468px;left:398.856px;">i</div>
<div class="l f15 s12 c0" style="bottom:707.066px;top:80.9036px;left:399.991px;">1</div>
<div class="l f15 s11 c0" style="bottom:606.376px;top:179.982px;left:398.856px;">i</div>
<div class="l f15 s12 c0" style="bottom:606.731px;top:181.239px;left:399.991px;">6</div>
<div class="l f15 s11 c0" style="bottom:644.662px;top:141.696px;left:398.856px;">i</div>
<div class="l f15 s12 c0" style="bottom:645.017px;top:142.953px;left:399.991px;">4</div>
<div class="l f15 s11 c0" style="bottom:624.859px;top:161.499px;left:398.856px;">i</div>
<div class="l f15 s12 c0" style="bottom:625.214px;top:162.756px;left:399.991px;">5</div>
<div class="l f15 s11 c0" style="bottom:685.735px;top:100.623px;left:447.409px;">t</div>
<div class="l f15 s12 c0" style="bottom:686.09px;top:101.88px;left:449.011px;">2</div>
<div class="l f15 s11 c0" style="bottom:708.032px;top:78.3266px;left:430.308px;">t</div>
<div class="l f15 s12 c0" style="bottom:708.387px;top:79.5834px;left:431.909px;">1</div>
<div class="l f15 s11 c0" style="bottom:642.682px;top:143.676px;left:447.409px;">t</div>
<div class="l f15 s12 c0" style="bottom:643.037px;top:144.933px;left:449.011px;">4</div>
<div class="l f15 s13 c0" style="bottom:651.275px;top:135.889px;left:463.34px;">Exit Guar</div>
<div class="l f15 s13 c0" style="bottom:651.275px;top:135.889px;left:478.297px;">d</div>
<div class="l f15 s13 c0" style="bottom:701.443px;top:85.721px;left:459.447px;">Nes</div>
<div class="l f15 s13 c0" style="bottom:701.443px;top:85.721px;left:465.586px;">t</div>
<div class="l f15 s13 c0" style="bottom:701.443px;top:85.721px;left:466.91px;">ed T</div>
<div class="l f15 s13 c0" style="bottom:701.443px;top:85.721px;left:473.683px;">r</div>
<div class="l f15 s13 c0" style="bottom:701.443px;top:85.721px;left:475.046px;">ee</div>
<div class="l f1 s4 c0" style="bottom:576.869px;top:207.071px;left:317.014px;">Figure<span class="w w2"> </span>8.</div>
<div class="l f2 s4 c0" style="bottom:576.806px;top:207.178px;left:355.477px;">Control<span class="w w2"> </span>flow<span class="w w1"> </span>graph<span class="w w2"> </span>of<span class="w w2"> </span>a<span class="w w1"> </span>loop<span class="w w2"> </span>with<span class="w w1"> </span>two<span class="w w2"> </span>nested<span class="w w1"> </span>loops<span class="w w2"> </span>(left)</div>
<div class="l f2 s4 c0" style="bottom:566.843px;top:217.141px;left:317.014px;">and<span class="w w1"> </span>its<span class="w w1"> </span>nested<span class="w w1"> </span>trace<span class="w w1"> </span>tree<span class="w w1"> </span>configuration<span class="w w1"> </span>(right).<span class="w w1"> </span>The<span class="w w0"> </span>outer<span class="w w2"> </span>tree<span class="w w1"> </span>calls</div>
<div class="l f2 s4 c0" style="bottom:556.88px;top:227.104px;left:317.014px;">the<span class="w w1"> </span>two<span class="w w2"> </span>inner<span class="w w1"> </span>nested<span class="w w1"> </span>trace<span class="w w1"> </span>trees<span class="w w2"> </span>and<span class="w w1"> </span>places<span class="w w1"> </span>guards<span class="w w1"> </span>at<span class="w w2"> </span>their<span class="w w1"> </span>side<span class="w w1"> </span>exit</div>
<div class="l f2 s4 c0" style="bottom:546.918px;top:237.066px;left:317.014px;">locations.</div>
<div class="l f2 s4 c0" style="bottom:513.53px;top:270.454px;left:317.014px;">loop<span class="w w2"> </span>is<span class="w w1"> </span>entered<span class="w w2"> </span>with</div>
<div class="l ff s4 c0" style="bottom:513.728px;top:270.31px;left:389.714px;">m</div>
<div class="l f2 s4 c0" style="bottom:513.53px;top:270.454px;left:399.945px;">different<span class="w w2"> </span>type<span class="w w1"> </span>maps<span class="w w2"> </span>(on<span class="w w1"> </span>geometric<span class="w w2"> </span>average),</div>
<div class="l f2 s4 c0" style="bottom:503.131px;top:280.853px;left:317.014px;">then<span class="w w1"> </span>we<span class="w w1"> </span>compile</div>
<div class="l ff s4 c0" style="bottom:503.328px;top:280.71px;left:379.553px;">O</div>
<div class="l f14 s4 c0" style="bottom:503.328px;top:280.71px;left:386.821px;">(</div>
<div class="l ff s4 c0" style="bottom:503.328px;top:280.71px;left:390.405px;">m</div>
<div class="l f10 s5 c0" style="bottom:507.717px;top:278.975px;left:398.524px;">k</div>
<div class="l f14 s4 c0" style="bottom:503.328px;top:280.71px;left:403.097px;">)</div>
<div class="l f2 s4 c0" style="bottom:503.131px;top:280.853px;left:409.266px;">copies<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>innermost<span class="w w1"> </span>loop.<span class="w w1"> </span>As<span class="w w1"> </span>long<span class="w w1"> </span>as</div>
<div class="l ff s4 c0" style="bottom:493.366px;top:290.672px;left:317.014px;">m</div>
<div class="l f2 s4 c0" style="bottom:493.168px;top:290.816px;left:327.374px;">is<span class="w w2"> </span>close<span class="w w1"> </span>to<span class="w w1"> </span>1,<span class="w w2"> </span>the<span class="w w1"> </span>resulting<span class="w w1"> </span>trace<span class="w w2"> </span>trees<span class="w w1"> </span>will<span class="w w2"> </span>be<span class="w w1"> </span>tractable.</div>
<div class="l f2 s4 c0" style="bottom:483.206px;top:300.778px;left:328.969px;">An<span class="w w2"> </span>important<span class="w w2"> </span>detail<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w2"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w2"> </span>inner<span class="w w1"> </span>trace<span class="w w2"> </span>tree<span class="w w2"> </span>must<span class="w w2"> </span>act</div>
<div class="l f2 s4 c0" style="bottom:473.243px;top:310.741px;left:317.014px;">like<span class="w w2"> </span>a<span class="w w1"> </span>function<span class="w w2"> </span>call<span class="w w1"> </span>site:<span class="w w2"> </span>it<span class="w w1"> </span>must<span class="w w1"> </span>return<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>same<span class="w w1"> </span>point<span class="w w2"> </span>every<span class="w w1"> </span>time.</div>
<div class="l f2 s4 c0" style="bottom:463.28px;top:320.704px;left:317.014px;">The<span class="w w1"> </span>goal<span class="w w1"> </span>of<span class="w w2"> </span>nesting<span class="w w1"> </span>is<span class="w w1"> </span>to<span class="w w1"> </span>make<span class="w w1"> </span>inner<span class="w w1"> </span>and<span class="w w1"> </span>outer<span class="w w1"> </span>loops<span class="w w2"> </span>independent;</div>
<div class="l f2 s4 c0" style="bottom:453.318px;top:330.666px;left:317.014px;">thus<span class="w w1"> </span>when<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>is<span class="w w0"> </span>called,<span class="w w1"> </span>it<span class="w w1"> </span>must<span class="w w1"> </span>exit<span class="w w0"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>point</div>
<div class="l f2 s4 c0" style="bottom:443.355px;top:340.629px;left:317.014px;">in<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree<span class="w w1"> </span>every<span class="w w1"> </span>time<span class="w w1"> </span>with<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w2"> </span>type<span class="w w0"> </span>map.<span class="w w2"> </span>Because<span class="w w0"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:433.392px;top:350.592px;left:317.014px;">cannot<span class="w w1"> </span>actually<span class="w w1"> </span>guarantee<span class="w w1"> </span>this<span class="w w1"> </span>property,<span class="w w1"> </span>we<span class="w w1"> </span>must<span class="w w1"> </span>guard<span class="w w1"> </span>on<span class="w w1"> </span>it<span class="w w1"> </span>after</div>
<div class="l f2 s4 c0" style="bottom:423.43px;top:360.554px;left:317.014px;">the<span class="w w1"> </span>call,<span class="w w0"> </span>and<span class="w w1"> </span>side<span class="w w0"> </span>exit<span class="w w1"> </span>if<span class="w w1"> </span>the<span class="w w0"> </span>property<span class="w w1"> </span>does<span class="w w0"> </span>not<span class="w w1"> </span>hold.<span class="w w1"> </span>A<span class="w w0"> </span>common</div>
<div class="l f2 s4 c0" style="bottom:413.467px;top:370.517px;left:317.014px;">reason<span class="w w0"> </span>for<span class="w w1"> </span>the<span class="w w0"> </span>inner<span class="w w1"> </span>tree<span class="w w0"> </span>not<span class="w w0"> </span>to<span class="w w1"> </span>return<span class="w w0"> </span>to<span class="w w1"> </span>the<span class="w w0"> </span>same<span class="w w0"> </span>point<span class="w w1"> </span>would</div>
<div class="l f2 s4 c0" style="bottom:403.504px;top:380.48px;left:317.014px;">be<span class="w w1"> </span>if<span class="w w0"> </span>the<span class="w w1"> </span>inner<span class="w w0"> </span>tree<span class="w w1"> </span>took<span class="w w0"> </span>a<span class="w w1"> </span>new<span class="w w0"> </span>side<span class="w w1"> </span>exit<span class="w w0"> </span>for<span class="w w1"> </span>which<span class="w w1"> </span>it<span class="w w0"> </span>had<span class="w w1"> </span>never</div>
<div class="l f2 s4 c0" style="bottom:393.542px;top:390.442px;left:317.014px;">compiled<span class="w w1"> </span>a<span class="w w1"> </span>trace.<span class="w w0"> </span>At<span class="w w1"> </span>this<span class="w w1"> </span>point,<span class="w w1"> </span>the<span class="w w0"> </span>interpreter<span class="w w1"> </span>PC<span class="w w1"> </span>is<span class="w w1"> </span>in<span class="w w0"> </span>the<span class="w w1"> </span>inner</div>
<div class="l f2 s4 c0" style="bottom:383.579px;top:400.405px;left:317.014px;">tree,<span class="w w1"> </span>so<span class="w w1"> </span>we<span class="w w1"> </span>cannot<span class="w w1"> </span>continue<span class="w w1"> </span>recording<span class="w w1"> </span>or<span class="w w1"> </span>executing<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w0"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:373.617px;top:410.367px;left:317.014px;">If<span class="w w1"> </span>this<span class="w w1"> </span>happens<span class="w w1"> </span>during<span class="w w1"> </span>recording,<span class="w w1"> </span>we<span class="w w1"> </span>abort<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>trace,<span class="w w1"> </span>to<span class="w w1"> </span>give</div>
<div class="l f2 s4 c0" style="bottom:363.654px;top:420.33px;left:317.014px;">the<span class="w w2"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>a<span class="w w2"> </span>chance<span class="w w1"> </span>to<span class="w w1"> </span>finish<span class="w w1"> </span>growing.<span class="w w2"> </span>A<span class="w w1"> </span>future<span class="w w2"> </span>execution<span class="w w1"> </span>of<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:353.691px;top:430.293px;left:317.014px;">outer<span class="w w2"> </span>tree<span class="w w1"> </span>would<span class="w w1"> </span>then<span class="w w2"> </span>be<span class="w w1"> </span>able<span class="w w2"> </span>to<span class="w w1"> </span>properly<span class="w w1"> </span>finish<span class="w w2"> </span>and<span class="w w1"> </span>record<span class="w w1"> </span>a<span class="w w2"> </span>call<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:343.729px;top:440.255px;left:317.014px;">the<span class="w w2"> </span>inner<span class="w w1"> </span>tree.<span class="w w2"> </span>If<span class="w w1"> </span>an<span class="w w2"> </span>inner<span class="w w1"> </span>tree<span class="w w2"> </span>side<span class="w w1"> </span>exit<span class="w w2"> </span>happens<span class="w w1"> </span>during<span class="w w2"> </span>execution<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:333.766px;top:450.218px;left:317.014px;">a<span class="w w1"> </span>compiled<span class="w w1"> </span>trace<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree,<span class="w w1"> </span>we<span class="w w1"> </span>simply<span class="w w1"> </span>exit<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:323.803px;top:460.181px;left:317.014px;">and<span class="w w2"> </span>start<span class="w w1"> </span>recording<span class="w w1"> </span>a<span class="w w2"> </span>new<span class="w w1"> </span>branch<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w2"> </span>tree.</div>
<div class="l f1 s4 c0" style="bottom:302.243px;top:481.697px;left:317.014px;">4.2<span class="w w10"> </span>Blacklisting<span class="w w2"> </span>with<span class="w w1"> </span>Nesting</div>
<div class="l f2 s4 c0" style="bottom:288.232px;top:495.752px;left:317.014px;">The<span class="w w1"> </span>blacklisting<span class="w w0"> </span>algorithm<span class="w w1"> </span>needs<span class="w w1"> </span>modification<span class="w w1"> </span>to<span class="w w0"> </span>work<span class="w w1"> </span>well<span class="w w1"> </span>with</div>
<div class="l f2 s4 c0" style="bottom:278.269px;top:505.715px;left:317.014px;">nesting.<span class="w w1"> </span>The<span class="w w1"> </span>problem<span class="w w0"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>outer<span class="w w0"> </span>loop<span class="w w1"> </span>traces<span class="w w1"> </span>often<span class="w w1"> </span>abort<span class="w w0"> </span>during</div>
<div class="l f2 s4 c0" style="bottom:268.307px;top:515.677px;left:317.014px;">startup<span class="w w2"> </span>(because<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w2"> </span>is<span class="w w1"> </span>not<span class="w w1"> </span>available<span class="w w2"> </span>or<span class="w w1"> </span>takes<span class="w w1"> </span>a<span class="w w2"> </span>side<span class="w w1"> </span>exit),</div>
<div class="l f2 s4 c0" style="bottom:258.344px;top:525.64px;left:317.014px;">which<span class="w w1"> </span>would<span class="w w1"> </span>lead<span class="w w0"> </span>to<span class="w w1"> </span>their<span class="w w1"> </span>being<span class="w w0"> </span>quickly<span class="w w1"> </span>blacklisted<span class="w w1"> </span>by<span class="w w0"> </span>the<span class="w w1"> </span>basic</div>
<div class="l f2 s4 c0" style="bottom:248.382px;top:535.602px;left:317.014px;">algorithm.</div>
<div class="l f2 s4 c0" style="bottom:238.419px;top:545.565px;left:328.969px;">The<span class="w w1"> </span>key<span class="w w2"> </span>observation<span class="w w1"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>when<span class="w w1"> </span>an<span class="w w2"> </span>outer<span class="w w1"> </span>trace<span class="w w1"> </span>aborts<span class="w w1"> </span>because</div>
<div class="l f2 s4 c0" style="bottom:228.456px;top:555.528px;left:317.014px;">the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>is<span class="w w1"> </span>not<span class="w w1"> </span>ready,<span class="w w2"> </span>this<span class="w w1"> </span>is<span class="w w1"> </span>probably<span class="w w1"> </span>a<span class="w w1"> </span>temporary<span class="w w1"> </span>condition.</div>
<div class="l f2 s4 c0" style="bottom:218.494px;top:565.49px;left:317.014px;">Thus,<span class="w w1"> </span>we<span class="w w2"> </span>should<span class="w w1"> </span>not<span class="w w1"> </span>count<span class="w w1"> </span>such<span class="w w1"> </span>aborts<span class="w w1"> </span>toward<span class="w w2"> </span>blacklisting<span class="w w1"> </span>as<span class="w w1"> </span>long</div>
<div class="l f2 s4 c0" style="bottom:208.531px;top:575.453px;left:317.014px;">as<span class="w w2"> </span>we<span class="w w1"> </span>are<span class="w w1"> </span>able<span class="w w2"> </span>to<span class="w w1"> </span>build<span class="w w2"> </span>up<span class="w w1"> </span>more<span class="w w1"> </span>traces<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w2"> </span>tree.</div>
<div class="l f2 s4 c0" style="bottom:198.568px;top:585.416px;left:328.969px;">In<span class="w w1"> </span>our<span class="w w1"> </span>implementation,<span class="w w1"> </span>when<span class="w w1"> </span>an<span class="w w1"> </span>outer<span class="w w0"> </span>tree<span class="w w2"> </span>aborts<span class="w w0"> </span>on<span class="w w2"> </span>the<span class="w w0"> </span>inner</div>
<div class="l f2 s4 c0" style="bottom:188.606px;top:595.378px;left:317.014px;">tree,<span class="w w1"> </span>we<span class="w w1"> </span>increment<span class="w w0"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>tree’s<span class="w w1"> </span>blacklist<span class="w w1"> </span>counter<span class="w w0"> </span>as<span class="w w1"> </span>usual<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:178.643px;top:605.341px;left:317.014px;">back<span class="w w1"> </span>off<span class="w w1"> </span>on<span class="w w1"> </span>compiling<span class="w w1"> </span>it.<span class="w w1"> </span>When<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>tree<span class="w w1"> </span>finishes<span class="w w1"> </span>a<span class="w w1"> </span>trace,<span class="w w1"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:168.68px;top:615.304px;left:317.014px;">decrement<span class="w w1"> </span>the<span class="w w1"> </span>blacklist<span class="w w1"> </span>counter<span class="w w1"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>outer<span class="w w1"> </span>loop,<span class="w w1"> </span>“forgiving”<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:158.718px;top:625.266px;left:317.014px;">outer<span class="w w2"> </span>loop<span class="w w1"> </span>for<span class="w w2"> </span>aborting<span class="w w2"> </span>previously.<span class="w w2"> </span>We<span class="w w2"> </span>also<span class="w w1"> </span>undo<span class="w w2"> </span>the<span class="w w2"> </span>backoff<span class="w w1"> </span>so<span class="w w2"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:148.755px;top:635.229px;left:317.014px;">the<span class="w w2"> </span>outer<span class="w w1"> </span>tree<span class="w w1"> </span>can<span class="w w2"> </span>start<span class="w w1"> </span>immediately<span class="w w2"> </span>trying<span class="w w1"> </span>to<span class="w w1"> </span>compile<span class="w w2"> </span>the<span class="w w1"> </span>next<span class="w w2"> </span>time</div>
<div class="l f2 s4 c0" style="bottom:138.792px;top:645.192px;left:317.014px;">we<span class="w w2"> </span>reach<span class="w w1"> </span>it.</div>
<div class="l f1 s2 c0" style="bottom:109.988px;top:672.159px;left:317.014px;">5.<span class="w w3"> </span>Trace<span class="w w2"> </span>Tree<span class="w w2"> </span>Optimization</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:317.014px;">This<span class="w w0"> </span>section<span class="w w0"> </span>explains<span class="w w0"> </span>how<span class="w w1"> </span>a<span class="w w0"> </span>recorded<span class="w w0"> </span>trace<span class="w w0"> </span>is<span class="w w0"> </span>translated<span class="w w0"> </span>to<span class="w w0"> </span>an</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">optimized<span class="w w1"> </span>machine<span class="w w1"> </span>code<span class="w w0"> </span>trace.<span class="w w1"> </span>The<span class="w w1"> </span>trace<span class="w w0"> </span>compilation<span class="w w1"> </span>subsystem,</div>
<div class="l f2 s14 c0" style="bottom:76.8565px;top:708.731px;left:317.238px;">NAN<span class="w w2"> </span>OJI<span class="w w2"> </span>T</div>
<div class="l f2 s4 c0" style="bottom:76.4692px;top:707.515px;left:350.153px;">,<span class="w w0"> </span>is<span class="w w0"> </span>separate<span class="w w1"> </span>from<span class="w w0"> </span>the<span class="w w0"> </span>VM<span class="w w0"> </span>and<span class="w w0"> </span>can<span class="w w0"> </span>be<span class="w w0"> </span>used<span class="w w1"> </span>for<span class="w w0"> </span>other</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:317.014px;">applications.</div>
</div>
<div id="page-8" class="p" style="width:612px;height:792px;background-image:url(p8.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f1 s4 c0" style="bottom:710.156px;top:73.7833px;left:54px;">5.1<span class="w w10"> </span>Optimizations</div>
<div class="l f2 s4 c0" style="bottom:696.145px;top:87.8386px;left:54px;">Because<span class="w w0"> </span>traces<span class="w w1"> </span>are<span class="w w0"> </span>in<span class="w w1"> </span>SSA<span class="w w0"> </span>form<span class="w w0"> </span>and<span class="w w1"> </span>have<span class="w w0"> </span>no<span class="w w1"> </span>join<span class="w w0"> </span>points<span class="w w0"> </span>or</div>
<div class="l ff s4 c0" style="bottom:696.343px;top:87.6951px;left:284.633px;">φ</div>
<div class="l f2 s4 c0" style="bottom:696.145px;top:87.8386px;left:290.118px;">-</div>
<div class="l f2 s4 c0" style="bottom:686.183px;top:97.8012px;left:54px;">nodes,<span class="w w0"> </span>certain<span class="w w1"> </span>optimizations<span class="w w0"> </span>are<span class="w w0"> </span>easy<span class="w w1"> </span>to<span class="w w0"> </span>implement.<span class="w w1"> </span>In<span class="w w0"> </span>order<span class="w w0"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:676.22px;top:107.764px;left:54px;">get<span class="w w1"> </span>good<span class="w w1"> </span>startup<span class="w w2"> </span>performance,<span class="w w1"> </span>the<span class="w w1"> </span>optimizations<span class="w w1"> </span>must<span class="w w1"> </span>run<span class="w w1"> </span>quickly,</div>
<div class="l f2 s4 c0" style="bottom:666.258px;top:117.726px;left:54px;">so<span class="w w0"> </span>we<span class="w w1"> </span>chose<span class="w w0"> </span>a<span class="w w0"> </span>small<span class="w w1"> </span>set<span class="w w0"> </span>of<span class="w w0"> </span>optimizations.<span class="w w1"> </span>We<span class="w w1"> </span>implemented<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:656.295px;top:127.689px;left:54px;">optimizations<span class="w w1"> </span>as<span class="w w2"> </span>pipelined<span class="w w1"> </span>filters<span class="w w1"> </span>so<span class="w w1"> </span>that<span class="w w2"> </span>they<span class="w w1"> </span>can<span class="w w1"> </span>be<span class="w w2"> </span>turned<span class="w w1"> </span>on<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:646.332px;top:137.652px;left:54px;">off<span class="w w1"> </span>independently,<span class="w w2"> </span>and<span class="w w1"> </span>yet<span class="w w1"> </span>all<span class="w w1"> </span>run<span class="w w1"> </span>in<span class="w w1"> </span>just<span class="w w1"> </span>two<span class="w w1"> </span>loop<span class="w w1"> </span>passes<span class="w w1"> </span>over<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:636.37px;top:147.614px;left:54px;">trace:<span class="w w2"> </span>one<span class="w w1"> </span>forward<span class="w w1"> </span>and<span class="w w2"> </span>one<span class="w w1"> </span>backward.</div>
<div class="l f2 s4 c0" style="bottom:626.407px;top:157.577px;left:65.9552px;">Every<span class="w w1"> </span>time<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>recorder<span class="w w1"> </span>emits<span class="w w0"> </span>a<span class="w w1"> </span>LIR<span class="w w1"> </span>instruction,<span class="w w1"> </span>the<span class="w w0"> </span>in-</div>
<div class="l f2 s4 c0" style="bottom:616.444px;top:167.54px;left:54px;">struction<span class="w w0"> </span>is<span class="w w1"> </span>immediately<span class="w w0"> </span>passed<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w0"> </span>first<span class="w w1"> </span>filter<span class="w w0"> </span>in<span class="w w1"> </span>the<span class="w w0"> </span>forward</div>
<div class="l f2 s4 c0" style="bottom:606.482px;top:177.502px;left:54px;">pipeline.<span class="w w1"> </span>Thus,<span class="w w0"> </span>forward<span class="w w1"> </span>filter<span class="w w1"> </span>optimizations<span class="w w0"> </span>are<span class="w w1"> </span>performed<span class="w w1"> </span>as<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:596.519px;top:187.465px;left:54px;">trace<span class="w w1"> </span>is<span class="w w1"> </span>recorded.<span class="w w2"> </span>Each<span class="w w1"> </span>filter<span class="w w1"> </span>may<span class="w w1"> </span>pass<span class="w w1"> </span>each<span class="w w1"> </span>instruction<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w2"> </span>next</div>
<div class="l f2 s4 c0" style="bottom:586.556px;top:197.428px;left:54px;">filter<span class="w w1"> </span>unchanged,<span class="w w1"> </span>write<span class="w w1"> </span>a<span class="w w0"> </span>different<span class="w w2"> </span>instruction<span class="w w0"> </span>to<span class="w w2"> </span>the<span class="w w0"> </span>next<span class="w w2"> </span>filter,<span class="w w1"> </span>or</div>
<div class="l f2 s4 c0" style="bottom:576.594px;top:207.39px;left:54px;">write<span class="w w1"> </span>no<span class="w w1"> </span>instruction<span class="w w1"> </span>at<span class="w w1"> </span>all.<span class="w w1"> </span>For<span class="w w1"> </span>example,<span class="w w2"> </span>the<span class="w w1"> </span>constant<span class="w w1"> </span>folding<span class="w w1"> </span>filter</div>
<div class="l f2 s4 c0" style="bottom:566.631px;top:217.353px;left:54px;">can<span class="w w1"> </span>replace<span class="w w1"> </span>a<span class="w w1"> </span>multiply<span class="w w1"> </span>instruction<span class="w w1"> </span>like</div>
<div class="l ff s4 c0" style="bottom:566.828px;top:217.209px;left:195.046px;">v</div>
<div class="l f8 s5 c0" style="bottom:566.412px;top:220.28px;left:199.522px;">13</div>
<div class="l f14 s4 c0" style="bottom:566.828px;top:217.209px;left:210.892px;">:=</div>
<div class="l ff s4 c0" style="bottom:566.828px;top:217.209px;left:224.185px;">mul</div>
<div class="l f14 s4 c0" style="bottom:566.828px;top:217.209px;left:240.506px;">3</div>
<div class="l ff s4 c0" style="bottom:566.828px;top:217.209px;left:245.114px;">,</div>
<div class="l f14 s4 c0" style="bottom:566.828px;top:217.209px;left:249.209px;">1000</div>
<div class="l f2 s4 c0" style="bottom:566.631px;top:217.353px;left:270.41px;">with<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:556.668px;top:227.316px;left:54px;">constant<span class="w w2"> </span>instruction</div>
<div class="l ff s4 c0" style="bottom:556.866px;top:227.172px;left:126.725px;">v</div>
<div class="l f8 s5 c0" style="bottom:556.449px;top:230.243px;left:131.202px;">13</div>
<div class="l f14 s4 c0" style="bottom:556.866px;top:227.172px;left:141.565px;">=<span class="w w1"> </span>3000</div>
<div class="l f2 s4 c0" style="bottom:556.668px;top:227.316px;left:169.723px;">.</div>
<div class="l f2 s4 c0" style="bottom:546.706px;top:237.278px;left:65.9551px;">We<span class="w w2"> </span>currently<span class="w w2"> </span>apply<span class="w w1"> </span>four<span class="w w1"> </span>forward<span class="w w2"> </span>filters:</div>
<div class="l f3 s3 c0" style="bottom:530.66px;top:253.817px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:529.371px;top:254.613px;left:66.9514px;">On<span class="w w1"> </span>ISAs<span class="w w0"> </span>without<span class="w w1"> </span>floating-point<span class="w w1"> </span>instructions,<span class="w w0"> </span>a<span class="w w1"> </span>soft-float<span class="w w1"> </span>filter</div>
<div class="l f2 s4 c0" style="bottom:519.408px;top:264.576px;left:66.9514px;">converts<span class="w w2"> </span>floating-point<span class="w w1"> </span>LIR<span class="w w2"> </span>instructions<span class="w w1"> </span>to<span class="w w1"> </span>sequences<span class="w w2"> </span>of<span class="w w1"> </span>integer</div>
<div class="l f2 s4 c0" style="bottom:509.446px;top:274.538px;left:66.9514px;">instructions.</div>
<div class="l f3 s3 c0" style="bottom:496.787px;top:287.69px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:495.498px;top:288.486px;left:66.9514px;">CSE<span class="w w2"> </span>(constant<span class="w w1"> </span>subexpression<span class="w w1"> </span>elimination),</div>
<div class="l f3 s3 c0" style="bottom:482.839px;top:301.637px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:481.55px;top:302.434px;left:66.9514px;">expression<span class="w w2"> </span>simplification,<span class="w w1"> </span>including<span class="w w1"> </span>constant<span class="w w1"> </span>folding<span class="w w2"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>few</div>
<div class="l f2 s4 c0" style="bottom:471.588px;top:312.396px;left:66.9514px;">algebraic<span class="w w2"> </span>identities<span class="w w1"> </span>(e.g.,</div>
<div class="l ff s4 c0" style="bottom:471.785px;top:312.253px;left:157.591px;">a</div>
<div class="l f6 s4 c0" style="bottom:471.785px;top:311.751px;left:164.521px;">−</div>
<div class="l ff s4 c0" style="bottom:471.785px;top:312.253px;left:173.736px;">a</div>
<div class="l f14 s4 c0" style="bottom:471.785px;top:312.253px;left:181.178px;">=<span class="w w1"> </span>0</div>
<div class="l f2 s4 c0" style="bottom:471.588px;top:312.396px;left:195.513px;">),<span class="w w2"> </span>and</div>
<div class="l f3 s3 c0" style="bottom:458.929px;top:325.548px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:457.64px;top:326.344px;left:66.9514px;">source<span class="w w0"> </span>language<span class="w w0"> </span>semantic-specific<span class="w w0"> </span>expression<span class="w w0"> </span>simplification,</div>
<div class="l f2 s4 c0" style="bottom:447.677px;top:336.307px;left:66.9514px;">primarily<span class="w w2"> </span>algebraic<span class="w w1"> </span>identities<span class="w w2"> </span>that<span class="w w1"> </span>allow</div>
<div class="l f2 s14 c0" style="bottom:448.065px;top:337.523px;left:209.65px;">DOU<span class="w w2"> </span>BLE</div>
<div class="l f2 s4 c0" style="bottom:447.677px;top:336.307px;left:243.209px;">to<span class="w w2"> </span>be<span class="w w1"> </span>replaced</div>
<div class="l f2 s4 c0" style="bottom:437.715px;top:346.269px;left:66.9514px;">with</div>
<div class="l f2 s14 c0" style="bottom:438.102px;top:347.485px;left:85.6326px;">INT</div>
<div class="l f2 s4 c0" style="bottom:437.715px;top:346.269px;left:98.6874px;">.<span class="w w1"> </span>For<span class="w w2"> </span>example,<span class="w w1"> </span>LIR<span class="w w1"> </span>that<span class="w w1"> </span>converts<span class="w w2"> </span>an</div>
<div class="l f2 s14 c0" style="bottom:438.102px;top:347.485px;left:229.806px;">INT</div>
<div class="l f2 s4 c0" style="bottom:437.715px;top:346.269px;left:245.376px;">to<span class="w w1"> </span>a</div>
<div class="l f2 s14 c0" style="bottom:438.102px;top:347.485px;left:261.587px;">DOU<span class="w w2"> </span>BLE</div>
<div class="l f2 s4 c0" style="bottom:427.752px;top:356.232px;left:66.9514px;">and<span class="w w2"> </span>then<span class="w w1"> </span>back<span class="w w1"> </span>again<span class="w w2"> </span>would<span class="w w1"> </span>be<span class="w w2"> </span>removed<span class="w w1"> </span>by<span class="w w1"> </span>this<span class="w w2"> </span>filter.</div>
<div class="l f2 s4 c0" style="bottom:410.417px;top:373.567px;left:65.9551px;">When<span class="w w1"> </span>trace<span class="w w1"> </span>recording<span class="w w1"> </span>is<span class="w w1"> </span>completed,<span class="w w1"> </span>nanojit<span class="w w1"> </span>runs<span class="w w1"> </span>the<span class="w w1"> </span>backward</div>
<div class="l f2 s4 c0" style="bottom:400.454px;top:383.53px;left:54px;">optimization<span class="w w1"> </span>filters.<span class="w w1"> </span>These<span class="w w1"> </span>are<span class="w w0"> </span>used<span class="w w1"> </span>for<span class="w w1"> </span>optimizations<span class="w w1"> </span>that<span class="w w1"> </span>require</div>
<div class="l f2 s4 c0" style="bottom:390.492px;top:393.492px;left:54px;">backward<span class="w w1"> </span>program<span class="w w0"> </span>analysis.<span class="w w1"> </span>When<span class="w w0"> </span>running<span class="w w1"> </span>the<span class="w w0"> </span>backward<span class="w w1"> </span>filters,</div>
<div class="l f2 s4 c0" style="bottom:380.529px;top:403.455px;left:54px;">nanojit<span class="w w2"> </span>reads<span class="w w1"> </span>one<span class="w w2"> </span>LIR<span class="w w2"> </span>instruction<span class="w w1"> </span>at<span class="w w2"> </span>a<span class="w w1"> </span>time,<span class="w w2"> </span>and<span class="w w2"> </span>the<span class="w w1"> </span>reads<span class="w w2"> </span>are<span class="w w1"> </span>passed</div>
<div class="l f2 s4 c0" style="bottom:370.566px;top:413.418px;left:54px;">through<span class="w w2"> </span>the<span class="w w1"> </span>pipeline.</div>
<div class="l f2 s4 c0" style="bottom:360.604px;top:423.38px;left:65.9551px;">We<span class="w w2"> </span>currently<span class="w w2"> </span>apply<span class="w w1"> </span>three<span class="w w1"> </span>backward<span class="w w2"> </span>filters:</div>
<div class="l f3 s3 c0" style="bottom:344.558px;top:439.919px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:343.269px;top:440.715px;left:66.9514px;">Dead<span class="w w2"> </span>data-stack<span class="w w1"> </span>store<span class="w w2"> </span>elimination.<span class="w w1"> </span>The<span class="w w2"> </span>LIR<span class="w w2"> </span>trace<span class="w w1"> </span>encodes<span class="w w2"> </span>many</div>
<div class="l f2 s4 c0" style="bottom:333.306px;top:450.678px;left:66.9514px;">stores<span class="w w1"> </span>to<span class="w w2"> </span>locations<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>stack.<span class="w w2"> </span>But<span class="w w1"> </span>these<span class="w w1"> </span>values<span class="w w1"> </span>are</div>
<div class="l f2 s4 c0" style="bottom:323.343px;top:460.641px;left:66.9514px;">never<span class="w w1"> </span>read<span class="w w1"> </span>back<span class="w w1"> </span>before<span class="w w1"> </span>exiting<span class="w w0"> </span>the<span class="w w2"> </span>trace<span class="w w0"> </span>(by<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w1"> </span>or</div>
<div class="l f2 s4 c0" style="bottom:313.381px;top:470.603px;left:66.9514px;">another<span class="w w0"> </span>trace).<span class="w w1"> </span>Thus,<span class="w w0"> </span>stores<span class="w w1"> </span>to<span class="w w0"> </span>the<span class="w w1"> </span>stack<span class="w w0"> </span>that<span class="w w0"> </span>are<span class="w w1"> </span>overwritten</div>
<div class="l f2 s4 c0" style="bottom:303.418px;top:480.566px;left:66.9514px;">before<span class="w w1"> </span>the<span class="w w0"> </span>next<span class="w w1"> </span>exit<span class="w w1"> </span>are<span class="w w0"> </span>dead.<span class="w w1"> </span>Stores<span class="w w1"> </span>to<span class="w w0"> </span>locations<span class="w w1"> </span>that<span class="w w1"> </span>are<span class="w w0"> </span>off</div>
<div class="l f2 s4 c0" style="bottom:293.456px;top:490.528px;left:66.9514px;">the<span class="w w2"> </span>top<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>interpreter<span class="w w1"> </span>stack<span class="w w1"> </span>at<span class="w w2"> </span>future<span class="w w1"> </span>exits<span class="w w2"> </span>are<span class="w w1"> </span>also<span class="w w1"> </span>dead.</div>
<div class="l f3 s3 c0" style="bottom:280.797px;top:503.68px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:279.508px;top:504.476px;left:66.9514px;">Dead<span class="w w2"> </span>call-stack<span class="w w1"> </span>store<span class="w w2"> </span>elimination.<span class="w w2"> </span>This<span class="w w1"> </span>is<span class="w w2"> </span>the<span class="w w1"> </span>same<span class="w w2"> </span>optimization</div>
<div class="l f2 s4 c0" style="bottom:269.545px;top:514.439px;left:66.9514px;">as<span class="w w1"> </span>above,<span class="w w2"> </span>except<span class="w w1"> </span>applied<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>interpreter’s<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>used<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:259.583px;top:524.401px;left:66.9514px;">function<span class="w w2"> </span>call<span class="w w1"> </span>inlining.</div>
<div class="l f3 s3 c0" style="bottom:246.924px;top:537.553px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:245.635px;top:538.349px;left:66.9514px;">Dead<span class="w w0"> </span>code<span class="w w0"> </span>elimination.<span class="w w4"> </span>This<span class="w w0"> </span>eliminates<span class="w w0"> </span>any<span class="w w4"> </span>operation<span class="w w0"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:235.672px;top:548.312px;left:66.9514px;">stores<span class="w w2"> </span>to<span class="w w1"> </span>a<span class="w w1"> </span>value<span class="w w2"> </span>that<span class="w w1"> </span>is<span class="w w2"> </span>never<span class="w w1"> </span>used.</div>
<div class="l f2 s4 c0" style="bottom:218.337px;top:565.647px;left:65.9551px;">After<span class="w w0"> </span>a<span class="w w1"> </span>LIR<span class="w w0"> </span>instruction<span class="w w0"> </span>is<span class="w w0"> </span>successfully<span class="w w1"> </span>read<span class="w w0"> </span>(“pulled”)<span class="w w0"> </span>from</div>
<div class="l f2 s4 c0" style="bottom:208.375px;top:575.609px;left:54px;">the<span class="w w1"> </span>backward<span class="w w1"> </span>filter<span class="w w1"> </span>pipeline,<span class="w w1"> </span>nanojit’s<span class="w w1"> </span>code<span class="w w1"> </span>generator<span class="w w1"> </span>emits<span class="w w1"> </span>native</div>
<div class="l f2 s4 c0" style="bottom:198.412px;top:585.572px;left:54px;">machine<span class="w w2"> </span>instruction(s)<span class="w w1"> </span>for<span class="w w1"> </span>it.</div>
<div class="l f1 s4 c0" style="bottom:180.144px;top:603.796px;left:54px;">5.2<span class="w w10"> </span>Register<span class="w w2"> </span>Allocation</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:54px;">We<span class="w w1"> </span>use<span class="w w0"> </span>a<span class="w w0"> </span>simple<span class="w w0"> </span>greedy<span class="w w0"> </span>register<span class="w w0"> </span>allocator<span class="w w0"> </span>that<span class="w w0"> </span>makes<span class="w w0"> </span>a<span class="w w0"> </span>single</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:54px;">backward<span class="w w1"> </span>pass<span class="w w1"> </span>over<span class="w w0"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>(it<span class="w w1"> </span>is<span class="w w0"> </span>integrated<span class="w w1"> </span>with<span class="w w1"> </span>the<span class="w w1"> </span>code<span class="w w0"> </span>gen-</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:54px;">erator).<span class="w w1"> </span>By<span class="w w0"> </span>the<span class="w w1"> </span>time<span class="w w1"> </span>the<span class="w w0"> </span>allocator<span class="w w1"> </span>has<span class="w w1"> </span>reached<span class="w w0"> </span>an<span class="w w1"> </span>instruction<span class="w w1"> </span>like</div>
<div class="l ff s4 c0" style="bottom:136.442px;top:647.595px;left:54px;">v</div>
<div class="l f8 s5 c0" style="bottom:136.026px;top:650.666px;left:58.4762px;">3</div>
<div class="l f14 s4 c0" style="bottom:136.442px;top:647.595px;left:65.5404px;">=</div>
<div class="l ff s4 c0" style="bottom:136.442px;top:647.595px;left:75.6211px;">add<span class="w w1"> </span>v</div>
<div class="l f8 s5 c0" style="bottom:136.026px;top:650.666px;left:96.9561px;">1</div>
<div class="l ff s4 c0" style="bottom:136.442px;top:647.595px;left:101.107px;">,<span class="w w2"> </span>v</div>
<div class="l f8 s5 c0" style="bottom:136.026px;top:650.666px;left:109.679px;">2</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:113.83px;">,<span class="w w1"> </span>it<span class="w w2"> </span>has<span class="w w1"> </span>already<span class="w w1"> </span>assigned<span class="w w1"> </span>a<span class="w w2"> </span>register<span class="w w1"> </span>to</div>
<div class="l ff s4 c0" style="bottom:136.442px;top:647.595px;left:247.407px;">v</div>
<div class="l f8 s5 c0" style="bottom:136.026px;top:650.666px;left:251.883px;">3</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:256.034px;">.<span class="w w1"> </span>If</div>
<div class="l ff s4 c0" style="bottom:136.442px;top:647.595px;left:269.101px;">v</div>
<div class="l f8 s5 c0" style="bottom:136.026px;top:650.666px;left:273.578px;">1</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:280.156px;">and</div>
<div class="l ff s4 c0" style="bottom:126.48px;top:657.558px;left:53.9999px;">v</div>
<div class="l f8 s5 c0" style="bottom:126.063px;top:660.629px;left:58.4762px;">2</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:64.9004px;">have<span class="w w2"> </span>not<span class="w w1"> </span>yet<span class="w w1"> </span>been<span class="w w2"> </span>assigned<span class="w w1"> </span>registers,<span class="w w2"> </span>the<span class="w w1"> </span>allocator<span class="w w1"> </span>assigns<span class="w w2"> </span>a<span class="w w1"> </span>free</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:53.9999px;">register<span class="w w2"> </span>to<span class="w w1"> </span>each.<span class="w w2"> </span>If<span class="w w1"> </span>there<span class="w w2"> </span>are<span class="w w1"> </span>no<span class="w w1"> </span>free<span class="w w2"> </span>registers,<span class="w w1"> </span>a<span class="w w2"> </span>value<span class="w w1"> </span>is<span class="w w2"> </span>selected<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:53.9999px;">spilling.<span class="w w1"> </span>We<span class="w w2"> </span>use<span class="w w1"> </span>a<span class="w w1"> </span>class<span class="w w1"> </span>heuristic<span class="w w1"> </span>that<span class="w w1"> </span>selects<span class="w w1"> </span>the<span class="w w1"> </span>“oldest”<span class="w w1"> </span>register-</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:53.9999px;">carried<span class="w w2"> </span>value<span class="w w1"> </span>(6).</div>
<div class="l f2 s4 c0" style="bottom:86.432px;top:697.552px;left:65.9551px;">The<span class="w w2"> </span>heuristic<span class="w w1"> </span>considers<span class="w w1"> </span>the<span class="w w2"> </span>set</div>
<div class="l ff s4 c0" style="bottom:86.6292px;top:697.409px;left:176.891px;">R</div>
<div class="l f2 s4 c0" style="bottom:86.432px;top:697.552px;left:186.192px;">of<span class="w w2"> </span>values</div>
<div class="l ff s4 c0" style="bottom:86.6292px;top:697.409px;left:220.878px;">v</div>
<div class="l f2 s4 c0" style="bottom:86.432px;top:697.552px;left:227.942px;">in<span class="w w2"> </span>registers<span class="w w1"> </span>imme-</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:53.9999px;">diately<span class="w w1"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>instruction<span class="w w1"> </span>for<span class="w w1"> </span>spilling.<span class="w w1"> </span>Let</div>
<div class="l ff s4 c0" style="bottom:76.6665px;top:707.371px;left:241.91px;">v</div>
<div class="l f10 s5 c0" style="bottom:76.2501px;top:710.442px;left:246.387px;">m</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:256.025px;">be<span class="w w1"> </span>the<span class="w w1"> </span>last</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:53.9999px;">instruction<span class="w w2"> </span>before<span class="w w1"> </span>the<span class="w w1"> </span>current<span class="w w2"> </span>where<span class="w w1"> </span>each</div>
<div class="l ff s4 c0" style="bottom:66.7039px;top:717.334px;left:203.802px;">v</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:210.911px;">is<span class="w w2"> </span>referred<span class="w w1"> </span>to.<span class="w w1"> </span>Then<span class="w w2"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:711.089px;top:72.8946px;left:323.551px;">Tag<span class="w w3"> </span>JS<span class="w w1"> </span>Type<span class="w w11"> </span>Description</div>
<div class="l f2 s4 c0" style="bottom:700.728px;top:83.2558px;left:323.551px;">xx1<span class="w w3"> </span>number<span class="w w12"> </span>31-bit<span class="w w2"> </span>integer<span class="w w1"> </span>representation</div>
<div class="l f2 s4 c0" style="bottom:690.766px;top:93.2184px;left:323.551px;">000<span class="w w3"> </span>object<span class="w w13"> </span>pointer<span class="w w2"> </span>to<span class="w w1"> </span>JSObject<span class="w w1"> </span>handle</div>
<div class="l f2 s4 c0" style="bottom:680.803px;top:103.181px;left:323.551px;">010<span class="w w3"> </span>number<span class="w w12"> </span>pointer<span class="w w2"> </span>to<span class="w w1"> </span>double<span class="w w1"> </span>handle</div>
<div class="l f2 s4 c0" style="bottom:670.84px;top:113.144px;left:323.551px;">100<span class="w w3"> </span>string<span class="w w7"> </span>pointer<span class="w w2"> </span>to<span class="w w2"> </span>JSString<span class="w w1"> </span>handle</div>
<div class="l f2 s4 c0" style="bottom:660.878px;top:123.106px;left:323.551px;">110<span class="w w3"> </span>boolean<span class="w w12"> </span>enumeration<span class="w w2"> </span>for<span class="w w2"> </span>null,<span class="w w1"> </span>undefined,<span class="w w1"> </span>true,<span class="w w2"> </span>false</div>
<div class="l f2 s4 c0" style="bottom:650.915px;top:133.069px;left:348.956px;">null,<span class="w w2"> </span>or</div>
<div class="l f2 s4 c0" style="bottom:640.952px;top:143.032px;left:348.956px;">undefined</div>
<div class="l f1 s4 c0" style="bottom:623.55px;top:160.389px;left:317.014px;">Figure<span class="w w1"> </span>9.<span class="w w0"> </span>Tagged<span class="w w1"> </span>values<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w0"> </span>SpiderMonkey<span class="w w1"> </span>JS<span class="w w1"> </span>interpreter.</div>
<div class="l f2 s4 c0" style="bottom:613.524px;top:170.46px;left:317.014px;">Testing<span class="w w2"> </span>tags,<span class="w w1"> </span>unboxing<span class="w w1"> </span>(extracting<span class="w w2"> </span>the<span class="w w1"> </span>untagged<span class="w w1"> </span>value)<span class="w w1"> </span>and<span class="w w2"> </span>boxing</div>
<div class="l f2 s4 c0" style="bottom:603.562px;top:180.422px;left:317.014px;">(creating<span class="w w1"> </span>tagged<span class="w w2"> </span>values)<span class="w w1"> </span>are<span class="w w1"> </span>significant<span class="w w1"> </span>costs.<span class="w w2"> </span>Avoiding<span class="w w1"> </span>these<span class="w w2"> </span>costs</div>
<div class="l f2 s4 c0" style="bottom:593.599px;top:190.385px;left:317.014px;">is<span class="w w2"> </span>a<span class="w w1"> </span>key<span class="w w2"> </span>benefit<span class="w w1"> </span>of<span class="w w1"> </span>tracing.</div>
<div class="l f2 s4 c0" style="bottom:556.514px;top:227.47px;left:317.014px;">heuristic<span class="w w1"> </span>selects</div>
<div class="l ff s4 c0" style="bottom:556.711px;top:227.327px;left:377.839px;">v</div>
<div class="l f2 s4 c0" style="bottom:556.514px;top:227.47px;left:385.657px;">with<span class="w w1"> </span>minimum</div>
<div class="l ff s4 c0" style="bottom:556.711px;top:227.327px;left:442.52px;">v</div>
<div class="l f10 s5 c0" style="bottom:556.295px;top:230.397px;left:446.996px;">m</div>
<div class="l f2 s4 c0" style="bottom:556.514px;top:227.47px;left:454.032px;">.<span class="w w1"> </span>The<span class="w w1"> </span>motivation<span class="w w1"> </span>is<span class="w w1"> </span>that<span class="w w1"> </span>this</div>
<div class="l f2 s4 c0" style="bottom:546.551px;top:237.433px;left:317.014px;">frees<span class="w w2"> </span>up<span class="w w1"> </span>a<span class="w w1"> </span>register<span class="w w2"> </span>for<span class="w w1"> </span>as<span class="w w2"> </span>long<span class="w w1"> </span>as<span class="w w1"> </span>possible<span class="w w2"> </span>given<span class="w w1"> </span>a<span class="w w2"> </span>single<span class="w w1"> </span>spill.</div>
<div class="l f2 s4 c0" style="bottom:536.589px;top:247.395px;left:328.969px;">If<span class="w w1"> </span>we<span class="w w0"> </span>need<span class="w w0"> </span>to<span class="w w1"> </span>spill<span class="w w0"> </span>a<span class="w w1"> </span>value</div>
<div class="l ff s4 c0" style="bottom:536.786px;top:247.252px;left:433.684px;">v</div>
<div class="l f10 s5 c0" style="bottom:536.369px;top:250.322px;left:438.16px;">s</div>
<div class="l f2 s4 c0" style="bottom:536.589px;top:247.395px;left:445.832px;">at<span class="w w1"> </span>this<span class="w w0"> </span>point,<span class="w w0"> </span>we<span class="w w1"> </span>generate<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:526.626px;top:257.358px;left:317.014px;">restore<span class="w w0"> </span>code<span class="w w1"> </span>just<span class="w w0"> </span>after<span class="w w0"> </span>the<span class="w w1"> </span>code<span class="w w0"> </span>for<span class="w w0"> </span>the<span class="w w1"> </span>current<span class="w w0"> </span>instruction.<span class="w w0"> </span>The</div>
<div class="l f2 s4 c0" style="bottom:516.663px;top:267.321px;left:317.014px;">corresponding<span class="w w2"> </span>spill<span class="w w1"> </span>code<span class="w w2"> </span>is<span class="w w1"> </span>generated<span class="w w1"> </span>just<span class="w w2"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>last<span class="w w1"> </span>point<span class="w w2"> </span>where</div>
<div class="l ff s4 c0" style="bottom:506.898px;top:277.14px;left:317.014px;">v</div>
<div class="l f10 s5 c0" style="bottom:506.482px;top:280.21px;left:321.49px;">s</div>
<div class="l f2 s4 c0" style="bottom:506.701px;top:277.283px;left:327.529px;">was<span class="w w2"> </span>used.<span class="w w1"> </span>The<span class="w w2"> </span>register<span class="w w1"> </span>that<span class="w w2"> </span>was<span class="w w2"> </span>assigned<span class="w w1"> </span>to</div>
<div class="l ff s4 c0" style="bottom:506.898px;top:277.14px;left:482.291px;">v</div>
<div class="l f10 s5 c0" style="bottom:506.482px;top:280.21px;left:486.768px;">s</div>
<div class="l f2 s4 c0" style="bottom:506.701px;top:277.283px;left:492.807px;">is<span class="w w2"> </span>marked<span class="w w1"> </span>free<span class="w w2"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:496.738px;top:287.246px;left:317.014px;">the<span class="w w1"> </span>preceding<span class="w w1"> </span>code,<span class="w w0"> </span>because<span class="w w1"> </span>that<span class="w w1"> </span>register<span class="w w1"> </span>can<span class="w w0"> </span>now<span class="w w2"> </span>be<span class="w w0"> </span>used<span class="w w1"> </span>freely</div>
<div class="l f2 s4 c0" style="bottom:486.775px;top:297.209px;left:317.014px;">without<span class="w w2"> </span>affecting<span class="w w1"> </span>the<span class="w w2"> </span>following<span class="w w1"> </span>code</div>
<div class="l f1 s2 c0" style="bottom:461.807px;top:320.341px;left:317.014px;">6.<span class="w w3"> </span>Implementation</div>
<div class="l f2 s4 c0" style="bottom:448.213px;top:335.771px;left:317.014px;">To<span class="w w1"> </span>demonstrate<span class="w w0"> </span>the<span class="w w1"> </span>effectiveness<span class="w w0"> </span>of<span class="w w1"> </span>our<span class="w w0"> </span>approach,<span class="w w0"> </span>we<span class="w w1"> </span>have<span class="w w0"> </span>im-</div>
<div class="l f2 s4 c0" style="bottom:438.25px;top:345.734px;left:317.014px;">plemented<span class="w w1"> </span>a<span class="w w1"> </span>trace-based<span class="w w1"> </span>dynamic<span class="w w1"> </span>compiler<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>SpiderMonkey</div>
<div class="l f2 s4 c0" style="bottom:428.288px;top:355.696px;left:317.014px;">JavaScript<span class="w w1"> </span>Virtual<span class="w w0"> </span>Machine<span class="w w1"> </span>(4).<span class="w w0"> </span>SpiderMonkey<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>JavaScript</div>
<div class="l f2 s4 c0" style="bottom:418.325px;top:365.659px;left:317.014px;">VM<span class="w w1"> </span>embedded<span class="w w2"> </span>in<span class="w w1"> </span>Mozilla’s<span class="w w1"> </span>Firefox<span class="w w1"> </span>open-source<span class="w w1"> </span>web<span class="w w2"> </span>browser<span class="w w1"> </span>(2),</div>
<div class="l f2 s4 c0" style="bottom:408.363px;top:375.621px;left:317.014px;">which<span class="w w2"> </span>is<span class="w w1"> </span>used<span class="w w2"> </span>by<span class="w w2"> </span>more<span class="w w1"> </span>than<span class="w w2"> </span>200<span class="w w1"> </span>million<span class="w w2"> </span>users<span class="w w2"> </span>world-wide.<span class="w w1"> </span>The<span class="w w2"> </span>core</div>
<div class="l f2 s4 c0" style="bottom:398.4px;top:385.584px;left:317.014px;">of<span class="w w2"> </span>SpiderMonkey<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>bytecode<span class="w w1"> </span>interpreter<span class="w w2"> </span>implemented<span class="w w1"> </span>in<span class="w w1"> </span>C++.</div>
<div class="l f2 s4 c0" style="bottom:388.437px;top:395.547px;left:328.969px;">In<span class="w w1"> </span>SpiderMonkey,<span class="w w1"> </span>all<span class="w w1"> </span>JavaScript<span class="w w1"> </span>values<span class="w w1"> </span>are<span class="w w1"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:378.475px;top:405.509px;left:317.014px;">type</div>
<div class="l f7 s4 c0" style="bottom:378.421px;top:406.11px;left:334.917px;">jsval</div>
<div class="l f2 s4 c0" style="bottom:378.475px;top:405.509px;left:358.453px;">.<span class="w w1"> </span>A</div>
<div class="l f7 s4 c0" style="bottom:378.421px;top:406.11px;left:372.095px;">jsval</div>
<div class="l f2 s4 c0" style="bottom:378.475px;top:405.509px;left:398.094px;">is<span class="w w1"> </span>machine<span class="w w2"> </span>word<span class="w w1"> </span>in<span class="w w1"> </span>which<span class="w w1"> </span>up<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>3<span class="w w1"> </span>of<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:368.512px;top:415.472px;left:317.014px;">least<span class="w w2"> </span>significant<span class="w w1"> </span>bits<span class="w w1"> </span>are<span class="w w2"> </span>a<span class="w w1"> </span>type<span class="w w1"> </span>tag,<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>remaining<span class="w w2"> </span>bits<span class="w w1"> </span>are<span class="w w1"> </span>data.</div>
<div class="l f2 s4 c0" style="bottom:358.549px;top:425.435px;left:317.014px;">See<span class="w w1"> </span>Figure<span class="w w2"> </span>6<span class="w w1"> </span>for<span class="w w1"> </span>details.<span class="w w2"> </span>All<span class="w w1"> </span>pointers<span class="w w1"> </span>contained<span class="w w1"> </span>in</div>
<div class="l f7 s4 c0" style="bottom:358.496px;top:426.035px;left:497.678px;">jsvals</div>
<div class="l f2 s4 c0" style="bottom:358.549px;top:425.435px;left:528.314px;">point<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:348.587px;top:435.397px;left:317.014px;">GC-controlled<span class="w w2"> </span>blocks<span class="w w1"> </span>aligned<span class="w w1"> </span>on<span class="w w2"> </span>8-byte<span class="w w1"> </span>boundaries.</div>
<div class="l f2 s4 c0" style="bottom:338.624px;top:445.36px;left:328.969px;">JavaScript</div>
<div class="l fa s4 c0" style="bottom:338.83px;top:445.45px;left:368.016px;">object</div>
<div class="l f2 s4 c0" style="bottom:338.624px;top:445.36px;left:392.189px;">values<span class="w w2"> </span>are<span class="w w1"> </span>mappings<span class="w w2"> </span>of<span class="w w1"> </span>string-valued<span class="w w2"> </span>property</div>
<div class="l f2 s4 c0" style="bottom:328.661px;top:455.323px;left:317.014px;">names<span class="w w2"> </span>to<span class="w w1"> </span>arbitrary<span class="w w2"> </span>values.<span class="w w1"> </span>They<span class="w w2"> </span>are<span class="w w1"> </span>represented<span class="w w1"> </span>in<span class="w w2"> </span>one<span class="w w1"> </span>of<span class="w w2"> </span>two<span class="w w1"> </span>ways</div>
<div class="l f2 s4 c0" style="bottom:318.699px;top:465.285px;left:317.014px;">in<span class="w w1"> </span>SpiderMonkey.<span class="w w2"> </span>Most<span class="w w1"> </span>objects<span class="w w1"> </span>are<span class="w w1"> </span>represented<span class="w w1"> </span>by<span class="w w1"> </span>a<span class="w w1"> </span>shared<span class="w w1"> </span>struc-</div>
<div class="l f2 s4 c0" style="bottom:308.736px;top:475.248px;left:317.014px;">tural<span class="w w2"> </span>description,<span class="w w1"> </span>called<span class="w w2"> </span>the</div>
<div class="l fa s4 c0" style="bottom:308.942px;top:475.338px;left:415.671px;">object<span class="w w2"> </span>shape</div>
<div class="l f2 s4 c0" style="bottom:308.736px;top:475.248px;left:460.445px;">,<span class="w w2"> </span>that<span class="w w1"> </span>maps<span class="w w2"> </span>property<span class="w w2"> </span>names</div>
<div class="l f2 s4 c0" style="bottom:298.773px;top:485.211px;left:317.014px;">to<span class="w w1"> </span>array<span class="w w1"> </span>indexes<span class="w w1"> </span>using<span class="w w1"> </span>a<span class="w w1"> </span>hash<span class="w w1"> </span>table.<span class="w w1"> </span>The<span class="w w1"> </span>object<span class="w w1"> </span>stores<span class="w w1"> </span>a<span class="w w1"> </span>pointer<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:288.811px;top:495.173px;left:317.014px;">the<span class="w w1"> </span>shape<span class="w w1"> </span>and<span class="w w0"> </span>the<span class="w w1"> </span>array<span class="w w1"> </span>of<span class="w w0"> </span>its<span class="w w1"> </span>own<span class="w w1"> </span>property<span class="w w1"> </span>values.<span class="w w0"> </span>Objects<span class="w w1"> </span>with</div>
<div class="l f2 s4 c0" style="bottom:278.848px;top:505.136px;left:317.014px;">large,<span class="w w1"> </span>unique<span class="w w2"> </span>sets<span class="w w1"> </span>of<span class="w w1"> </span>property<span class="w w1"> </span>names<span class="w w1"> </span>store<span class="w w1"> </span>their<span class="w w1"> </span>properties<span class="w w1"> </span>directly</div>
<div class="l f2 s4 c0" style="bottom:268.886px;top:515.098px;left:317.014px;">in<span class="w w2"> </span>a<span class="w w1"> </span>hash<span class="w w1"> </span>table.</div>
<div class="l f2 s4 c0" style="bottom:258.923px;top:525.061px;left:328.969px;">The<span class="w w1"> </span>garbage<span class="w w0"> </span>collector<span class="w w1"> </span>is<span class="w w1"> </span>an<span class="w w0"> </span>exact,<span class="w w1"> </span>non-generational,<span class="w w1"> </span>stop-the-</div>
<div class="l f2 s4 c0" style="bottom:248.96px;top:535.024px;left:317.014px;">world<span class="w w2"> </span>mark-and-sweep<span class="w w1"> </span>collector.</div>
<div class="l f2 s4 c0" style="bottom:238.998px;top:544.986px;left:328.969px;">In<span class="w w2"> </span>the<span class="w w1"> </span>rest<span class="w w2"> </span>of<span class="w w1"> </span>this<span class="w w2"> </span>section<span class="w w2"> </span>we<span class="w w1"> </span>discuss<span class="w w2"> </span>key<span class="w w1"> </span>areas<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>TraceMon-</div>
<div class="l f2 s4 c0" style="bottom:229.035px;top:554.949px;left:317.014px;">key<span class="w w2"> </span>implementation.</div>
<div class="l f1 s4 c0" style="bottom:210.031px;top:573.908px;left:317.014px;">6.1<span class="w w10"> </span>Calling<span class="w w2"> </span>Compiled<span class="w w1"> </span>Traces</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:317.014px;">Compiled<span class="w w1"> </span>traces<span class="w w1"> </span>are<span class="w w1"> </span>stored<span class="w w2"> </span>in<span class="w w1"> </span>a</div>
<div class="l fa s4 c0" style="bottom:196.227px;top:588.053px;left:432.865px;">trace<span class="w w1"> </span>cache</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:474.556px;">,<span class="w w1"> </span>indexed<span class="w w2"> </span>by<span class="w w1"> </span>intepreter</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:317.014px;">PC<span class="w w0"> </span>and<span class="w w0"> </span>type<span class="w w4"> </span>map.<span class="w w0"> </span>Traces<span class="w w0"> </span>are<span class="w w0"> </span>compiled<span class="w w4"> </span>so<span class="w w0"> </span>that<span class="w w0"> </span>they<span class="w w4"> </span>may<span class="w w0"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:317.014px;">called<span class="w w1"> </span>as<span class="w w2"> </span>functions<span class="w w1"> </span>using<span class="w w1"> </span>standard<span class="w w1"> </span>native<span class="w w2"> </span>calling<span class="w w1"> </span>conventions<span class="w w1"> </span>(e.g.,</div>
<div class="l f7 s4 c0" style="bottom:166.079px;top:618.452px;left:317.014px;">FASTCALL</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:356.914px;">on<span class="w w2"> </span>x86).</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:328.969px;">The<span class="w w1"> </span>interpreter<span class="w w1"> </span>must<span class="w w0"> </span>hit<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w1"> </span>edge<span class="w w0"> </span>and<span class="w w1"> </span>enter<span class="w w1"> </span>the<span class="w w1"> </span>monitor<span class="w w0"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">order<span class="w w2"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>a<span class="w w2"> </span>native<span class="w w1"> </span>trace<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>first<span class="w w2"> </span>time.<span class="w w1"> </span>The<span class="w w1"> </span>monitor<span class="w w2"> </span>computes</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:317.014px;">the<span class="w w1"> </span>current<span class="w w0"> </span>type<span class="w w1"> </span>map,<span class="w w0"> </span>checks<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>cache<span class="w w0"> </span>for<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>for<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">current<span class="w w2"> </span>PC<span class="w w1"> </span>and<span class="w w1"> </span>type<span class="w w2"> </span>map,<span class="w w1"> </span>and<span class="w w1"> </span>if<span class="w w2"> </span>it<span class="w w1"> </span>finds<span class="w w2"> </span>one,<span class="w w1"> </span>executes<span class="w w1"> </span>the<span class="w w2"> </span>trace.</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:328.969px;">To<span class="w w1"> </span>execute<span class="w w1"> </span>a<span class="w w0"> </span>trace,<span class="w w1"> </span>the<span class="w w0"> </span>monitor<span class="w w1"> </span>must<span class="w w0"> </span>build<span class="w w1"> </span>a<span class="w w0"> </span>trace<span class="w w1"> </span>activation</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">record<span class="w w1"> </span>containing<span class="w w1"> </span>imported<span class="w w0"> </span>local<span class="w w1"> </span>and<span class="w w1"> </span>global<span class="w w1"> </span>variables,<span class="w w1"> </span>temporary</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:317.014px;">stack<span class="w w1"> </span>space,<span class="w w2"> </span>and<span class="w w1"> </span>space<span class="w w1"> </span>for<span class="w w1"> </span>arguments<span class="w w2"> </span>to<span class="w w1"> </span>native<span class="w w2"> </span>calls.<span class="w w1"> </span>The<span class="w w1"> </span>local<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">global<span class="w w1"> </span>values<span class="w w2"> </span>are<span class="w w1"> </span>then<span class="w w1"> </span>copied<span class="w w2"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>state<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:317.014px;">activation<span class="w w2"> </span>record.<span class="w w1"> </span>Then,<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>is<span class="w w1"> </span>called<span class="w w1"> </span>like<span class="w w2"> </span>a<span class="w w1"> </span>normal<span class="w w2"> </span>C<span class="w w1"> </span>function</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:317.014px;">pointer.</div>
</div>
<div id="page-9" class="p" style="width:612px;height:792px;background-image:url(p9.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:65.9552px;">When<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>call<span class="w w1"> </span>returns,<span class="w w1"> </span>the<span class="w w1"> </span>monitor<span class="w w0"> </span>restores<span class="w w1"> </span>the<span class="w w1"> </span>interpreter</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:54px;">state.<span class="w w1"> </span>First,<span class="w w0"> </span>the<span class="w w1"> </span>monitor<span class="w w0"> </span>checks<span class="w w1"> </span>the<span class="w w0"> </span>reason<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w0"> </span>trace<span class="w w1"> </span>exit<span class="w w0"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:54px;">applies<span class="w w1"> </span>blacklisting<span class="w w1"> </span>if<span class="w w0"> </span>needed.<span class="w w1"> </span>Then,<span class="w w1"> </span>it<span class="w w1"> </span>pops<span class="w w0"> </span>or<span class="w w1"> </span>synthesizes<span class="w w1"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:54px;">preter<span class="w w1"> </span>JavaScript<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>frames<span class="w w2"> </span>as<span class="w w1"> </span>needed.<span class="w w1"> </span>Finally,<span class="w w2"> </span>it<span class="w w1"> </span>copies<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:54px;">imported<span class="w w1"> </span>variables<span class="w w2"> </span>back<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>activation<span class="w w1"> </span>record<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>in-</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:54px;">terpreter<span class="w w2"> </span>state.</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:65.9552px;">At<span class="w w1"> </span>least<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>current<span class="w w1"> </span>implementation,<span class="w w1"> </span>these<span class="w w1"> </span>steps<span class="w w1"> </span>have<span class="w w1"> </span>a<span class="w w1"> </span>non-</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:54px;">negligible<span class="w w1"> </span>runtime<span class="w w1"> </span>cost,<span class="w w1"> </span>so<span class="w w1"> </span>minimizing<span class="w w1"> </span>the<span class="w w0"> </span>number<span class="w w2"> </span>of<span class="w w0"> </span>interpreter-</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:54px;">to-trace<span class="w w1"> </span>and<span class="w w1"> </span>trace-to-interpreter<span class="w w0"> </span>transitions<span class="w w1"> </span>is<span class="w w1"> </span>essential<span class="w w1"> </span>for<span class="w w1"> </span>perfor-</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:54px;">mance.<span class="w w0"> </span>(see<span class="w w1"> </span>also<span class="w w0"> </span>Section<span class="w w1"> </span>3.3).<span class="w w0"> </span>Our<span class="w w1"> </span>experiments<span class="w w0"> </span>(see<span class="w w0"> </span>Figure<span class="w w1"> </span>12)</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:54px;">show<span class="w w1"> </span>that<span class="w w0"> </span>for<span class="w w1"> </span>programs<span class="w w0"> </span>we<span class="w w0"> </span>can<span class="w w1"> </span>trace<span class="w w0"> </span>well<span class="w w1"> </span>such<span class="w w0"> </span>transitions<span class="w w1"> </span>hap-</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:54px;">pen<span class="w w1"> </span>infrequently<span class="w w1"> </span>and<span class="w w1"> </span>hence<span class="w w1"> </span>do<span class="w w1"> </span>not<span class="w w1"> </span>contribute<span class="w w1"> </span>significantly<span class="w w1"> </span>to<span class="w w1"> </span>total</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:54px;">runtime.<span class="w w1"> </span>In<span class="w w1"> </span>a<span class="w w0"> </span>few<span class="w w1"> </span>programs,<span class="w w1"> </span>where<span class="w w1"> </span>the<span class="w w0"> </span>system<span class="w w1"> </span>is<span class="w w1"> </span>prevented<span class="w w1"> </span>from</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:54px;">recording<span class="w w1"> </span>branch<span class="w w1"> </span>traces<span class="w w1"> </span>for<span class="w w0"> </span>hot<span class="w w1"> </span>side<span class="w w1"> </span>exits<span class="w w1"> </span>by<span class="w w1"> </span>aborts,<span class="w w1"> </span>this<span class="w w0"> </span>cost<span class="w w2"> </span>can</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:54px;">rise<span class="w w2"> </span>to<span class="w w1"> </span>up<span class="w w1"> </span>to<span class="w w2"> </span>10%<span class="w w1"> </span>of<span class="w w1"> </span>total<span class="w w2"> </span>execution<span class="w w1"> </span>time.</div>
<div class="l f1 s4 c0" style="bottom:551.75px;top:232.189px;left:54px;">6.2<span class="w w10"> </span>Trace<span class="w w2"> </span>Stitching</div>
<div class="l f2 s4 c0" style="bottom:537.739px;top:246.245px;left:54px;">Transitions<span class="w w1"> </span>from<span class="w w1"> </span>a<span class="w w1"> </span>trace<span class="w w1"> </span>to<span class="w w1"> </span>a<span class="w w0"> </span>branch<span class="w w2"> </span>trace<span class="w w0"> </span>at<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit<span class="w w1"> </span>avoid<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:527.777px;top:256.207px;left:54px;">costs<span class="w w1"> </span>of<span class="w w1"> </span>calling<span class="w w0"> </span>traces<span class="w w1"> </span>from<span class="w w1"> </span>the<span class="w w1"> </span>monitor,<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w0"> </span>feature<span class="w w1"> </span>called</div>
<div class="l fa s4 c0" style="bottom:527.983px;top:256.297px;left:274.812px;">trace</div>
<div class="l fa s4 c0" style="bottom:518.02px;top:266.26px;left:54px;">stitching</div>
<div class="l f2 s4 c0" style="bottom:517.814px;top:266.17px;left:84.7542px;">.<span class="w w1"> </span>At<span class="w w1"> </span>a<span class="w w1"> </span>side<span class="w w1"> </span>exit,<span class="w w1"> </span>the<span class="w w0"> </span>exiting<span class="w w2"> </span>trace<span class="w w1"> </span>only<span class="w w0"> </span>needs<span class="w w2"> </span>to<span class="w w0"> </span>write<span class="w w2"> </span>live</div>
<div class="l f2 s4 c0" style="bottom:507.852px;top:276.132px;left:54px;">register-carried<span class="w w2"> </span>values<span class="w w2"> </span>back<span class="w w1"> </span>to<span class="w w2"> </span>its<span class="w w1"> </span>trace<span class="w w2"> </span>activation<span class="w w2"> </span>record.<span class="w w1"> </span>In<span class="w w2"> </span>our<span class="w w1"> </span>im-</div>
<div class="l f2 s4 c0" style="bottom:497.889px;top:286.095px;left:54px;">plementation,<span class="w w1"> </span>identical<span class="w w1"> </span>type<span class="w w2"> </span>maps<span class="w w1"> </span>yield<span class="w w1"> </span>identical<span class="w w1"> </span>activation<span class="w w1"> </span>record</div>
<div class="l f2 s4 c0" style="bottom:487.926px;top:296.058px;left:54px;">layouts,<span class="w w1"> </span>so<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w0"> </span>activation<span class="w w2"> </span>record<span class="w w0"> </span>can<span class="w w1"> </span>be<span class="w w1"> </span>reused<span class="w w1"> </span>immediately</div>
<div class="l f2 s4 c0" style="bottom:477.964px;top:306.02px;left:54px;">by<span class="w w2"> </span>the<span class="w w1"> </span>branch<span class="w w1"> </span>trace.</div>
<div class="l f2 s4 c0" style="bottom:468.001px;top:315.983px;left:65.9552px;">In<span class="w w1"> </span>programs<span class="w w0"> </span>with<span class="w w1"> </span>branchy<span class="w w1"> </span>trace<span class="w w0"> </span>trees<span class="w w1"> </span>with<span class="w w0"> </span>small<span class="w w1"> </span>traces,<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:458.038px;top:325.946px;left:54px;">stitching<span class="w w1"> </span>has<span class="w w0"> </span>a<span class="w w1"> </span>noticeable<span class="w w1"> </span>cost.<span class="w w1"> </span>Although<span class="w w0"> </span>writing<span class="w w1"> </span>to<span class="w w1"> </span>memory<span class="w w0"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:448.076px;top:335.908px;left:54px;">then<span class="w w0"> </span>soon<span class="w w0"> </span>reading<span class="w w0"> </span>back<span class="w w1"> </span>would<span class="w w0"> </span>be<span class="w w0"> </span>expected<span class="w w0"> </span>to<span class="w w0"> </span>have<span class="w w1"> </span>a<span class="w w0"> </span>high<span class="w w0"> </span>L1</div>
<div class="l f2 s4 c0" style="bottom:438.113px;top:345.871px;left:54px;">cache<span class="w w1"> </span>hit<span class="w w1"> </span>rate,<span class="w w1"> </span>for<span class="w w1"> </span>small<span class="w w1"> </span>traces<span class="w w1"> </span>the<span class="w w1"> </span>increased<span class="w w1"> </span>instruction<span class="w w1"> </span>count<span class="w w1"> </span>has</div>
<div class="l f2 s4 c0" style="bottom:428.15px;top:355.834px;left:54px;">a<span class="w w0"> </span>noticeable<span class="w w0"> </span>cost.<span class="w w0"> </span>Also,<span class="w w1"> </span>if<span class="w w0"> </span>the<span class="w w0"> </span>writes<span class="w w0"> </span>and<span class="w w0"> </span>reads<span class="w w0"> </span>are<span class="w w0"> </span>very<span class="w w0"> </span>close</div>
<div class="l f2 s4 c0" style="bottom:418.188px;top:365.796px;left:54px;">in<span class="w w0"> </span>the<span class="w w0"> </span>dynamic<span class="w w0"> </span>instruction<span class="w w0"> </span>stream,<span class="w w1"> </span>we<span class="w w0"> </span>have<span class="w w0"> </span>found<span class="w w0"> </span>that<span class="w w0"> </span>current</div>
<div class="l f2 s4 c0" style="bottom:408.225px;top:375.759px;left:54px;">x86<span class="w w1"> </span>processors<span class="w w1"> </span>often<span class="w w0"> </span>incur<span class="w w1"> </span>penalties<span class="w w1"> </span>of<span class="w w0"> </span>6<span class="w w1"> </span>cycles<span class="w w1"> </span>or<span class="w w1"> </span>more<span class="w w0"> </span>(e.g.,<span class="w w1"> </span>if</div>
<div class="l f2 s4 c0" style="bottom:398.262px;top:385.722px;left:54px;">the<span class="w w1"> </span>instructions<span class="w w1"> </span>use<span class="w w1"> </span>different<span class="w w1"> </span>base<span class="w w1"> </span>registers<span class="w w1"> </span>with<span class="w w1"> </span>equal<span class="w w0"> </span>values,<span class="w w2"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:388.3px;top:395.684px;left:54px;">processor<span class="w w2"> </span>may<span class="w w1"> </span>not<span class="w w1"> </span>be<span class="w w2"> </span>able<span class="w w1"> </span>to<span class="w w1"> </span>detect<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w2"> </span>addresses<span class="w w1"> </span>are<span class="w w1"> </span>the<span class="w w2"> </span>same</div>
<div class="l f2 s4 c0" style="bottom:378.337px;top:405.647px;left:54px;">right<span class="w w2"> </span>away).</div>
<div class="l f2 s4 c0" style="bottom:368.375px;top:415.609px;left:65.9552px;">The<span class="w w1"> </span>alternate<span class="w w1"> </span>solution<span class="w w1"> </span>is<span class="w w1"> </span>to<span class="w w1"> </span>recompile<span class="w w1"> </span>an<span class="w w1"> </span>entire<span class="w w1"> </span>trace<span class="w w1"> </span>tree,<span class="w w1"> </span>thus</div>
<div class="l f2 s4 c0" style="bottom:358.412px;top:425.572px;left:54px;">achieving<span class="w w1"> </span>inter-trace<span class="w w1"> </span>register<span class="w w1"> </span>allocation<span class="w w0"> </span>(10).<span class="w w1"> </span>The<span class="w w1"> </span>disadvantage<span class="w w1"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:348.449px;top:435.535px;left:54px;">that<span class="w w2"> </span>tree<span class="w w2"> </span>recompilation<span class="w w1"> </span>takes<span class="w w2"> </span>time<span class="w w1"> </span>quadratic<span class="w w2"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>number<span class="w w2"> </span>of<span class="w w2"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:338.487px;top:445.497px;left:54px;">We<span class="w w1"> </span>believe<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>cost<span class="w w1"> </span>of<span class="w w0"> </span>recompiling<span class="w w0"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>tree<span class="w w1"> </span>every<span class="w w0"> </span>time</div>
<div class="l f2 s4 c0" style="bottom:328.524px;top:455.46px;left:54px;">a<span class="w w1"> </span>branch<span class="w w0"> </span>is<span class="w w1"> </span>added<span class="w w0"> </span>would<span class="w w1"> </span>be<span class="w w0"> </span>prohibitive.<span class="w w1"> </span>That<span class="w w1"> </span>problem<span class="w w0"> </span>might<span class="w w1"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:318.561px;top:465.423px;left:54px;">mitigated<span class="w w1"> </span>by<span class="w w1"> </span>recompiling<span class="w w0"> </span>only<span class="w w1"> </span>at<span class="w w1"> </span>certain<span class="w w0"> </span>points,<span class="w w1"> </span>or<span class="w w1"> </span>only<span class="w w1"> </span>for<span class="w w0"> </span>very</div>
<div class="l f2 s4 c0" style="bottom:308.599px;top:475.385px;left:54px;">hot,<span class="w w2"> </span>stable<span class="w w1"> </span>trees.</div>
<div class="l f2 s4 c0" style="bottom:298.636px;top:485.348px;left:65.9552px;">In<span class="w w1"> </span>the<span class="w w0"> </span>future,<span class="w w1"> </span>multicore<span class="w w1"> </span>hardware<span class="w w0"> </span>is<span class="w w1"> </span>expected<span class="w w1"> </span>to<span class="w w0"> </span>be<span class="w w1"> </span>common,</div>
<div class="l f2 s4 c0" style="bottom:288.673px;top:495.311px;left:54px;">making<span class="w w1"> </span>background<span class="w w1"> </span>tree<span class="w w1"> </span>recompilation<span class="w w0"> </span>attractive.<span class="w w2"> </span>In<span class="w w0"> </span>a<span class="w w1"> </span>closely<span class="w w1"> </span>re-</div>
<div class="l f2 s4 c0" style="bottom:278.711px;top:505.273px;left:54px;">lated<span class="w w1"> </span>project<span class="w w0"> </span>(13)<span class="w w1"> </span>background<span class="w w1"> </span>recompilation<span class="w w1"> </span>yielded<span class="w w0"> </span>speedups<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:268.748px;top:515.236px;left:54px;">up<span class="w w1"> </span>to<span class="w w1"> </span>1.25x<span class="w w1"> </span>on<span class="w w0"> </span>benchmarks<span class="w w1"> </span>with<span class="w w1"> </span>many<span class="w w1"> </span>branch<span class="w w1"> </span>traces.<span class="w w1"> </span>We<span class="w w1"> </span>plan<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:258.786px;top:525.198px;left:54px;">apply<span class="w w2"> </span>this<span class="w w1"> </span>technique<span class="w w1"> </span>to<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>as<span class="w w2"> </span>future<span class="w w1"> </span>work.</div>
<div class="l f1 s4 c0" style="bottom:239.919px;top:544.02px;left:54px;">6.3<span class="w w10"> </span>Trace<span class="w w2"> </span>Recording</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:54px;">The<span class="w w2"> </span>job<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>recorder<span class="w w2"> </span>is<span class="w w2"> </span>to<span class="w w1"> </span>emit<span class="w w2"> </span>LIR<span class="w w2"> </span>with<span class="w w1"> </span>identical<span class="w w2"> </span>semantics</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:54px;">to<span class="w w1"> </span>the<span class="w w1"> </span>currently<span class="w w1"> </span>running<span class="w w2"> </span>interpreter<span class="w w1"> </span>bytecode<span class="w w1"> </span>trace.<span class="w w1"> </span>A<span class="w w1"> </span>good<span class="w w1"> </span>imple-</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:54px;">mentation<span class="w w1"> </span>should<span class="w w1"> </span>have<span class="w w1"> </span>low<span class="w w1"> </span>impact<span class="w w1"> </span>on<span class="w w1"> </span>non-tracing<span class="w w1"> </span>interpreter<span class="w w1"> </span>per-</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:54px;">formance<span class="w w1"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>convenient<span class="w w1"> </span>way<span class="w w1"> </span>for<span class="w w1"> </span>implementers<span class="w w1"> </span>to<span class="w w0"> </span>maintain<span class="w w2"> </span>se-</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:54px;">mantic<span class="w w2"> </span>equivalence.</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:65.9552px;">In<span class="w w2"> </span>our<span class="w w1"> </span>implementation,<span class="w w2"> </span>the<span class="w w1"> </span>only<span class="w w1"> </span>direct<span class="w w2"> </span>modification<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:54px;">preter<span class="w w2"> </span>is<span class="w w1"> </span>a<span class="w w2"> </span>call<span class="w w1"> </span>to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>monitor<span class="w w1"> </span>at<span class="w w2"> </span>loop<span class="w w1"> </span>edges.<span class="w w1"> </span>In<span class="w w2"> </span>our<span class="w w1"> </span>benchmark</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:54px;">results<span class="w w1"> </span>(see<span class="w w1"> </span>Figure<span class="w w1"> </span>12)<span class="w w1"> </span>the<span class="w w0"> </span>total<span class="w w2"> </span>time<span class="w w0"> </span>spent<span class="w w2"> </span>in<span class="w w0"> </span>the<span class="w w2"> </span>monitor<span class="w w0"> </span>(for<span class="w w2"> </span>all</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:54px;">activities)<span class="w w1"> </span>is<span class="w w1"> </span>usually<span class="w w0"> </span>less<span class="w w1"> </span>than<span class="w w1"> </span>5%,<span class="w w1"> </span>so<span class="w w0"> </span>we<span class="w w1"> </span>consider<span class="w w1"> </span>the<span class="w w1"> </span>interpreter</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:54px;">impact<span class="w w1"> </span>requirement<span class="w w1"> </span>met.<span class="w w1"> </span>Incrementing<span class="w w0"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>hit<span class="w w1"> </span>counter<span class="w w1"> </span>is<span class="w w1"> </span>ex-</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:54px;">pensive<span class="w w2"> </span>because<span class="w w2"> </span>it<span class="w w1"> </span>requires<span class="w w2"> </span>us<span class="w w1"> </span>to<span class="w w2"> </span>look<span class="w w2"> </span>up<span class="w w1"> </span>the<span class="w w2"> </span>loop<span class="w w1"> </span>in<span class="w w2"> </span>the<span class="w w2"> </span>trace<span class="w w1"> </span>cache,</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:54px;">but<span class="w w2"> </span>we<span class="w w1"> </span>have<span class="w w1"> </span>tuned<span class="w w1"> </span>our<span class="w w1"> </span>loops<span class="w w2"> </span>to<span class="w w1"> </span>become<span class="w w1"> </span>hot<span class="w w1"> </span>and<span class="w w1"> </span>trace<span class="w w2"> </span>very<span class="w w1"> </span>quickly</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:54px;">(on<span class="w w2"> </span>the<span class="w w1"> </span>second<span class="w w1"> </span>iteration).<span class="w w1"> </span>The<span class="w w2"> </span>hit<span class="w w1"> </span>counter<span class="w w1"> </span>implementation<span class="w w2"> </span>could<span class="w w1"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:54px;">improved,<span class="w w1"> </span>which<span class="w w1"> </span>might<span class="w w1"> </span>give<span class="w w2"> </span>us<span class="w w1"> </span>a<span class="w w1"> </span>small<span class="w w1"> </span>increase<span class="w w0"> </span>in<span class="w w2"> </span>overall<span class="w w1"> </span>perfor-</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:54px;">mance,<span class="w w1"> </span>as<span class="w w1"> </span>well<span class="w w1"> </span>as<span class="w w1"> </span>more<span class="w w1"> </span>flexibility<span class="w w1"> </span>with<span class="w w1"> </span>tuning<span class="w w1"> </span>hotness<span class="w w1"> </span>thresholds.</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:54px;">Once<span class="w w1"> </span>a<span class="w w1"> </span>loop<span class="w w2"> </span>is<span class="w w1"> </span>blacklisted<span class="w w1"> </span>we<span class="w w1"> </span>never<span class="w w1"> </span>call<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>trace<span class="w w2"> </span>monitor<span class="w w1"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:54px;">that<span class="w w2"> </span>loop<span class="w w1"> </span>(see<span class="w w1"> </span>Section<span class="w w2"> </span>3.3).</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:328.969px;">Recording<span class="w w0"> </span>is<span class="w w1"> </span>activated<span class="w w0"> </span>by<span class="w w1"> </span>a<span class="w w0"> </span>pointer<span class="w w1"> </span>swap<span class="w w0"> </span>that<span class="w w0"> </span>sets<span class="w w1"> </span>the<span class="w w0"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:317.014px;">preter’s<span class="w w1"> </span>dispatch<span class="w w1"> </span>table<span class="w w0"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>a<span class="w w0"> </span>single<span class="w w1"> </span>“interrupt”<span class="w w0"> </span>routine<span class="w w1"> </span>for<span class="w w1"> </span>ev-</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:317.014px;">ery<span class="w w1"> </span>bytecode.<span class="w w1"> </span>The<span class="w w0"> </span>interrupt<span class="w w1"> </span>routine<span class="w w1"> </span>first<span class="w w0"> </span>calls<span class="w w1"> </span>a<span class="w w1"> </span>bytecode-specific</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:317.014px;">recording<span class="w w1"> </span>routine.<span class="w w0"> </span>Then,<span class="w w1"> </span>it<span class="w w1"> </span>turns<span class="w w0"> </span>off<span class="w w1"> </span>recording<span class="w w1"> </span>if<span class="w w0"> </span>necessary<span class="w w1"> </span>(e.g.,</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:317.014px;">the<span class="w w1"> </span>trace<span class="w w1"> </span>ended).<span class="w w2"> </span>Finally,<span class="w w1"> </span>it<span class="w w1"> </span>jumps<span class="w w1"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>standard<span class="w w2"> </span>interpreter<span class="w w1"> </span>byte-</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:317.014px;">code<span class="w w2"> </span>implementation.<span class="w w2"> </span>Some<span class="w w1"> </span>bytecodes<span class="w w2"> </span>have<span class="w w2"> </span>effects<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w2"> </span>type<span class="w w2"> </span>map</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:317.014px;">that<span class="w w1"> </span>cannot<span class="w w1"> </span>be<span class="w w1"> </span>predicted<span class="w w1"> </span>before<span class="w w1"> </span>executing<span class="w w1"> </span>the<span class="w w1"> </span>bytecode<span class="w w1"> </span>(e.g.,<span class="w w1"> </span>call-</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:317.014px;">ing</div>
<div class="l f7 s4 c0" style="bottom:640.301px;top:144.23px;left:331.189px;">String.charCodeAt</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:411.213px;">,<span class="w w1"> </span>which<span class="w w1"> </span>returns<span class="w w1"> </span>an<span class="w w1"> </span>integer<span class="w w1"> </span>or</div>
<div class="l fa s4 c0" style="bottom:640.561px;top:143.719px;left:517.267px;">NaN</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:536.965px;">if<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:317.014px;">index<span class="w w2"> </span>argument<span class="w w1"> </span>is<span class="w w2"> </span>out<span class="w w1"> </span>of<span class="w w2"> </span>range).<span class="w w2"> </span>For<span class="w w1"> </span>these,<span class="w w2"> </span>we<span class="w w1"> </span>arrange<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w2"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:317.014px;">preter<span class="w w1"> </span>to<span class="w w1"> </span>call<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>recorder<span class="w w1"> </span>again<span class="w w1"> </span>after<span class="w w1"> </span>executing<span class="w w1"> </span>the<span class="w w1"> </span>bytecode.</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:317.014px;">Since<span class="w w1"> </span>such<span class="w w1"> </span>hooks<span class="w w1"> </span>are<span class="w w1"> </span>relatively<span class="w w2"> </span>rare,<span class="w w1"> </span>we<span class="w w1"> </span>embed<span class="w w1"> </span>them<span class="w w1"> </span>directly<span class="w w1"> </span>into</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:317.014px;">the<span class="w w1"> </span>interpreter,<span class="w w1"> </span>with<span class="w w1"> </span>an<span class="w w1"> </span>additional<span class="w w1"> </span>runtime<span class="w w1"> </span>check<span class="w w1"> </span>to<span class="w w1"> </span>see<span class="w w1"> </span>whether<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:317.014px;">recorder<span class="w w2"> </span>is<span class="w w1"> </span>currently<span class="w w1"> </span>active.</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:328.969px;">While<span class="w w2"> </span>separating<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>from<span class="w w1"> </span>the<span class="w w2"> </span>recorder<span class="w w1"> </span>reduces<span class="w w1"> </span>indi-</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:317.014px;">vidual<span class="w w2"> </span>code<span class="w w1"> </span>complexity,it<span class="w w1"> </span>also<span class="w w2"> </span>requires<span class="w w1"> </span>careful<span class="w w2"> </span>implementation<span class="w w2"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:560.654px;top:223.33px;left:317.014px;">extensive<span class="w w2"> </span>testing<span class="w w1"> </span>to<span class="w w2"> </span>achieve<span class="w w1"> </span>semantic<span class="w w2"> </span>equivalence.</div>
<div class="l f2 s4 c0" style="bottom:550.691px;top:233.293px;left:328.969px;">In<span class="w w1"> </span>some<span class="w w1"> </span>cases<span class="w w1"> </span>achieving<span class="w w2"> </span>this<span class="w w1"> </span>equivalence<span class="w w1"> </span>is<span class="w w1"> </span>difficult<span class="w w1"> </span>since<span class="w w1"> </span>Spi-</div>
<div class="l f2 s4 c0" style="bottom:540.728px;top:243.256px;left:317.014px;">derMonkey<span class="w w1"> </span>follows<span class="w w1"> </span>a</div>
<div class="l fa s4 c0" style="bottom:540.934px;top:243.345px;left:397.193px;">fat-bytecode</div>
<div class="l f2 s4 c0" style="bottom:540.728px;top:243.256px;left:444.318px;">design,<span class="w w1"> </span>which<span class="w w1"> </span>was<span class="w w1"> </span>found<span class="w w1"> </span>to<span class="w w1"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:530.766px;top:253.218px;left:317.014px;">beneficial<span class="w w2"> </span>to<span class="w w1"> </span>pure<span class="w w1"> </span>interpreter<span class="w w2"> </span>performance.</div>
<div class="l f2 s4 c0" style="bottom:520.803px;top:263.181px;left:328.969px;">In<span class="w w0"> </span>fat-bytecode<span class="w w1"> </span>designs,<span class="w w0"> </span>individual<span class="w w1"> </span>bytecodes<span class="w w0"> </span>can<span class="w w0"> </span>implement</div>
<div class="l f2 s4 c0" style="bottom:510.84px;top:273.144px;left:317.014px;">complex<span class="w w0"> </span>processing<span class="w w1"> </span>(e.g.,<span class="w w0"> </span>the</div>
<div class="l f7 s4 c0" style="bottom:510.787px;top:273.744px;left:431.235px;">getprop</div>
<div class="l f2 s4 c0" style="bottom:510.84px;top:273.144px;left:468.185px;">bytecode,<span class="w w0"> </span>which<span class="w w1"> </span>imple-</div>
<div class="l f2 s4 c0" style="bottom:500.878px;top:283.106px;left:317.014px;">ments<span class="w w2"> </span>full<span class="w w1"> </span>JavaScript<span class="w w2"> </span>property<span class="w w2"> </span>value<span class="w w1"> </span>access,<span class="w w2"> </span>including<span class="w w2"> </span>special<span class="w w1"> </span>cases</div>
<div class="l f2 s4 c0" style="bottom:490.915px;top:293.069px;left:317.014px;">for<span class="w w2"> </span>cached<span class="w w1"> </span>and<span class="w w1"> </span>dense<span class="w w2"> </span>array<span class="w w1"> </span>access).</div>
<div class="l f2 s4 c0" style="bottom:480.952px;top:303.032px;left:328.969px;">Fat<span class="w w0"> </span>bytecodes<span class="w w1"> </span>have<span class="w w0"> </span>two<span class="w w0"> </span>advantages:<span class="w w1"> </span>fewer<span class="w w0"> </span>bytecodes<span class="w w0"> </span>means</div>
<div class="l f2 s4 c0" style="bottom:470.99px;top:312.994px;left:317.014px;">lower<span class="w w2"> </span>dispatch<span class="w w1"> </span>cost,<span class="w w1"> </span>and<span class="w w2"> </span>bigger<span class="w w1"> </span>bytecode<span class="w w1"> </span>implementations<span class="w w2"> </span>give<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:461.027px;top:322.957px;left:317.014px;">compiler<span class="w w2"> </span>more<span class="w w1"> </span>opportunities<span class="w w1"> </span>to<span class="w w2"> </span>optimize<span class="w w1"> </span>the<span class="w w1"> </span>interpreter.</div>
<div class="l f2 s4 c0" style="bottom:451.064px;top:332.92px;left:328.969px;">Fat<span class="w w0"> </span>bytecodes<span class="w w1"> </span>are<span class="w w0"> </span>a<span class="w w0"> </span>problem<span class="w w1"> </span>for<span class="w w0"> </span>TraceMonkey<span class="w w1"> </span>because<span class="w w0"> </span>they</div>
<div class="l f2 s4 c0" style="bottom:441.102px;top:342.882px;left:317.014px;">require<span class="w w1"> </span>the<span class="w w0"> </span>recorder<span class="w w0"> </span>to<span class="w w1"> </span>reimplement<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w0"> </span>special<span class="w w1"> </span>case<span class="w w0"> </span>logic</div>
<div class="l f2 s4 c0" style="bottom:431.139px;top:352.845px;left:317.014px;">in<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w0"> </span>way.<span class="w w1"> </span>Also,<span class="w w0"> </span>the<span class="w w1"> </span>advantages<span class="w w0"> </span>are<span class="w w0"> </span>reduced<span class="w w1"> </span>because<span class="w w0"> </span>(a)</div>
<div class="l f2 s4 c0" style="bottom:421.177px;top:362.807px;left:317.014px;">dispatch<span class="w w1"> </span>costs<span class="w w0"> </span>are<span class="w w1"> </span>eliminated<span class="w w1"> </span>entirely<span class="w w0"> </span>in<span class="w w1"> </span>compiled<span class="w w1"> </span>traces,<span class="w w0"> </span>(b)<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:411.214px;top:372.77px;left:317.014px;">traces<span class="w w0"> </span>contain<span class="w w1"> </span>only<span class="w w0"> </span>one<span class="w w0"> </span>special<span class="w w0"> </span>case,<span class="w w0"> </span>not<span class="w w1"> </span>the<span class="w w0"> </span>interpreter’s<span class="w w0"> </span>large</div>
<div class="l f2 s4 c0" style="bottom:401.251px;top:382.733px;left:317.014px;">chunk<span class="w w1"> </span>of<span class="w w2"> </span>code,<span class="w w1"> </span>and<span class="w w1"> </span>(c)<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>spends<span class="w w1"> </span>less<span class="w w1"> </span>time<span class="w w1"> </span>running<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:391.289px;top:392.695px;left:317.014px;">base<span class="w w2"> </span>interpreter.</div>
<div class="l f2 s4 c0" style="bottom:381.326px;top:402.658px;left:328.969px;">One<span class="w w2"> </span>way<span class="w w1"> </span>we<span class="w w1"> </span>have<span class="w w2"> </span>mitigated<span class="w w2"> </span>these<span class="w w1"> </span>problems<span class="w w1"> </span>is<span class="w w2"> </span>by<span class="w w1"> </span>implementing</div>
<div class="l f2 s4 c0" style="bottom:371.363px;top:412.621px;left:317.014px;">certain<span class="w w1"> </span>complex<span class="w w1"> </span>bytecodes<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>recorder<span class="w w1"> </span>as<span class="w w1"> </span>sequences<span class="w w1"> </span>of<span class="w w1"> </span>simple</div>
<div class="l f2 s4 c0" style="bottom:361.401px;top:422.583px;left:317.014px;">bytecodes.<span class="w w2"> </span>Expressing<span class="w w2"> </span>the<span class="w w1"> </span>original<span class="w w2"> </span>semantics<span class="w w2"> </span>this<span class="w w2"> </span>way<span class="w w2"> </span>is<span class="w w1"> </span>not<span class="w w2"> </span>too<span class="w w2"> </span>dif-</div>
<div class="l f2 s4 c0" style="bottom:351.438px;top:432.546px;left:317.014px;">ficult,<span class="w w2"> </span>and<span class="w w1"> </span>recording<span class="w w1"> </span>simple<span class="w w2"> </span>bytecodes<span class="w w1"> </span>is<span class="w w2"> </span>much<span class="w w1"> </span>easier.<span class="w w2"> </span>This<span class="w w1"> </span>enables</div>
<div class="l f2 s4 c0" style="bottom:341.475px;top:442.509px;left:317.014px;">us<span class="w w2"> </span>to<span class="w w1"> </span>retain<span class="w w2"> </span>the<span class="w w1"> </span>advantages<span class="w w2"> </span>of<span class="w w1"> </span>fat<span class="w w2"> </span>bytecodes<span class="w w1"> </span>while<span class="w w2"> </span>avoiding<span class="w w1"> </span>some<span class="w w2"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:331.513px;top:452.471px;left:317.014px;">their<span class="w w2"> </span>problems<span class="w w1"> </span>for<span class="w w1"> </span>trace<span class="w w2"> </span>recording.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w2"> </span>particularly<span class="w w1"> </span>effective<span class="w w2"> </span>for</div>
<div class="l f2 s4 c0" style="bottom:321.55px;top:462.434px;left:317.014px;">fat<span class="w w1"> </span>bytecodes<span class="w w2"> </span>that<span class="w w1"> </span>recurse<span class="w w1"> </span>back<span class="w w1"> </span>into<span class="w w1"> </span>the<span class="w w1"> </span>interpreter,<span class="w w2"> </span>for<span class="w w1"> </span>example<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:311.588px;top:472.396px;left:317.014px;">convert<span class="w w2"> </span>an<span class="w w1"> </span>object<span class="w w1"> </span>into<span class="w w1"> </span>a<span class="w w1"> </span>primitive<span class="w w2"> </span>value<span class="w w1"> </span>by<span class="w w1"> </span>invoking<span class="w w2"> </span>a<span class="w w1"> </span>well-known</div>
<div class="l f2 s4 c0" style="bottom:301.625px;top:482.359px;left:317.014px;">method<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>object,<span class="w w2"> </span>since<span class="w w1"> </span>it<span class="w w1"> </span>lets<span class="w w2"> </span>us<span class="w w1"> </span>inline<span class="w w2"> </span>this<span class="w w1"> </span>function<span class="w w1"> </span>call.</div>
<div class="l f2 s4 c0" style="bottom:291.662px;top:492.322px;left:328.969px;">It<span class="w w1"> </span>is<span class="w w2"> </span>important<span class="w w1"> </span>to<span class="w w1"> </span>note<span class="w w1"> </span>that<span class="w w2"> </span>we<span class="w w1"> </span>split<span class="w w1"> </span>fat<span class="w w1"> </span>opcodes<span class="w w2"> </span>into<span class="w w1"> </span>thinner<span class="w w1"> </span>op-</div>
<div class="l f2 s4 c0" style="bottom:281.7px;top:502.284px;left:317.014px;">codes<span class="w w2"> </span>only<span class="w w1"> </span>during<span class="w w1"> </span>recording.<span class="w w2"> </span>When<span class="w w1"> </span>running<span class="w w1"> </span>purely<span class="w w2"> </span>interpretatively</div>
<div class="l f2 s4 c0" style="bottom:271.737px;top:512.247px;left:317.014px;">(i.e.<span class="w w2"> </span>code<span class="w w1"> </span>that<span class="w w1"> </span>has<span class="w w1"> </span>been<span class="w w2"> </span>blacklisted),<span class="w w1"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>directly<span class="w w1"> </span>and<span class="w w1"> </span>ef-</div>
<div class="l f2 s4 c0" style="bottom:261.774px;top:522.21px;left:317.014px;">ficiently<span class="w w2"> </span>executes<span class="w w1"> </span>the<span class="w w2"> </span>fat<span class="w w1"> </span>opcodes.</div>
<div class="l f1 s4 c0" style="bottom:229.957px;top:553.983px;left:317.014px;">6.4<span class="w w10"> </span>Preemption</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:317.014px;">SpiderMonkey,<span class="w w2"> </span>like<span class="w w2"> </span>many<span class="w w2"> </span>VMs,<span class="w w1"> </span>needs<span class="w w2"> </span>to<span class="w w1"> </span>preempt<span class="w w2"> </span>the<span class="w w1"> </span>user<span class="w w2"> </span>program</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:317.014px;">periodically.<span class="w w1"> </span>The<span class="w w0"> </span>main<span class="w w0"> </span>reasons<span class="w w1"> </span>are<span class="w w0"> </span>to<span class="w w0"> </span>prevent<span class="w w1"> </span>infinitely<span class="w w0"> </span>looping</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:317.014px;">scripts<span class="w w2"> </span>from<span class="w w1"> </span>locking<span class="w w1"> </span>up<span class="w w2"> </span>the<span class="w w1"> </span>host<span class="w w1"> </span>system<span class="w w2"> </span>and<span class="w w1"> </span>to<span class="w w2"> </span>schedule<span class="w w1"> </span>GC.</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:328.969px;">In<span class="w w1"> </span>the<span class="w w2"> </span>interpreter,<span class="w w1"> </span>this<span class="w w1"> </span>had<span class="w w2"> </span>been<span class="w w1"> </span>implemented<span class="w w1"> </span>by<span class="w w1"> </span>setting<span class="w w1"> </span>a<span class="w w2"> </span>“pre-</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:317.014px;">empt<span class="w w1"> </span>now”<span class="w w1"> </span>flag<span class="w w0"> </span>that<span class="w w1"> </span>was<span class="w w1"> </span>checked<span class="w w1"> </span>on<span class="w w0"> </span>ev</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:463.677px;">ery<span class="w w1"> </span>backward<span class="w w1"> </span>jump.<span class="w w0"> </span>This</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:317.014px;">strategy<span class="w w2"> </span>carried<span class="w w1"> </span>over<span class="w w2"> </span>into<span class="w w1"> </span>TraceMonkey:<span class="w w2"> </span>the<span class="w w1"> </span>VM<span class="w w2"> </span>inserts<span class="w w1"> </span>a<span class="w w2"> </span>guard<span class="w w1"> </span>on</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:317.014px;">the<span class="w w1"> </span>preemption<span class="w w1"> </span>flag<span class="w w1"> </span>at<span class="w w0"> </span>every<span class="w w2"> </span>loop<span class="w w0"> </span>edge.<span class="w w1"> </span>We<span class="w w2"> </span>measured<span class="w w0"> </span>less<span class="w w1"> </span>than<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">1%<span class="w w1"> </span>increase<span class="w w1"> </span>in<span class="w w1"> </span>runtime<span class="w w1"> </span>on<span class="w w1"> </span>most<span class="w w0"> </span>benchmarks<span class="w w2"> </span>for<span class="w w0"> </span>this<span class="w w2"> </span>extra<span class="w w0"> </span>guard.</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:317.014px;">In<span class="w w2"> </span>practice,<span class="w w1"> </span>the<span class="w w2"> </span>cost<span class="w w1"> </span>is<span class="w w2"> </span>detectable<span class="w w1"> </span>only<span class="w w1"> </span>for<span class="w w2"> </span>programs<span class="w w1"> </span>with<span class="w w2"> </span>very<span class="w w1"> </span>short</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">loops.</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:328.969px;">We<span class="w w1"> </span>tested<span class="w w1"> </span>and<span class="w w0"> </span>rejected<span class="w w1"> </span>a<span class="w w0"> </span>solution<span class="w w1"> </span>that<span class="w w0"> </span>avoided<span class="w w1"> </span>the<span class="w w1"> </span>guards<span class="w w0"> </span>by</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">compiling<span class="w w1"> </span>the<span class="w w0"> </span>loop<span class="w w1"> </span>edge<span class="w w1"> </span>as<span class="w w1"> </span>an<span class="w w0"> </span>unconditional<span class="w w1"> </span>jump,<span class="w w1"> </span>and<span class="w w0"> </span>patching</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:317.014px;">the<span class="w w1"> </span>jump<span class="w w0"> </span>target<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w0"> </span>exit<span class="w w1"> </span>routine<span class="w w0"> </span>when<span class="w w1"> </span>preemption<span class="w w0"> </span>is<span class="w w1"> </span>required.</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">This<span class="w w1"> </span>solution<span class="w w0"> </span>can<span class="w w1"> </span>make<span class="w w0"> </span>the<span class="w w1"> </span>normal<span class="w w0"> </span>case<span class="w w1"> </span>slightly<span class="w w0"> </span>faster</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:520.085px;">,<span class="w w1"> </span>but<span class="w w0"> </span>then</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:317.014px;">preemption<span class="w w2"> </span>becomes<span class="w w1"> </span>very<span class="w w1"> </span>slow.<span class="w w2"> </span>The<span class="w w2"> </span>implementation<span class="w w1"> </span>was<span class="w w1"> </span>also<span class="w w2"> </span>very</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:317.014px;">complex,<span class="w w2"> </span>especially<span class="w w2"> </span>trying<span class="w w1"> </span>to<span class="w w2"> </span>restart<span class="w w2"> </span>execution<span class="w w2"> </span>after<span class="w w1"> </span>the<span class="w w2"> </span>preemption.</div>
</div>
<div id="page-10" class="p" style="width:612px;height:792px;background-image:url(pa.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f1 s4 c0" style="bottom:710.156px;top:73.7833px;left:54px;">6.5<span class="w w10"> </span>Calling<span class="w w2"> </span>External<span class="w w1"> </span>Functions</div>
<div class="l f2 s4 c0" style="bottom:696.145px;top:87.8386px;left:54px;">Like<span class="w w2"> </span>most<span class="w w1"> </span>interpreters,<span class="w w1"> </span>SpiderMonkey<span class="w w2"> </span>has<span class="w w1"> </span>a<span class="w w2"> </span>foreign<span class="w w1"> </span>function<span class="w w1"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:686.183px;top:97.8012px;left:54px;">face<span class="w w2"> </span>(FFI)<span class="w w1"> </span>that<span class="w w2"> </span>allows<span class="w w1"> </span>it<span class="w w2"> </span>to<span class="w w1"> </span>call<span class="w w2"> </span>C<span class="w w1"> </span>builtins<span class="w w2"> </span>and<span class="w w2"> </span>host<span class="w w1"> </span>system<span class="w w1"> </span>functions</div>
<div class="l f2 s4 c0" style="bottom:676.22px;top:107.764px;left:54px;">(e.g.,<span class="w w1"> </span>web<span class="w w1"> </span>browser<span class="w w1"> </span>control<span class="w w2"> </span>and<span class="w w1"> </span>DOM<span class="w w1"> </span>access).<span class="w w1"> </span>The<span class="w w1"> </span>FFI<span class="w w1"> </span>has<span class="w w1"> </span>a<span class="w w1"> </span>stan-</div>
<div class="l f2 s4 c0" style="bottom:666.258px;top:117.726px;left:54px;">dard<span class="w w2"> </span>signature<span class="w w1"> </span>for<span class="w w2"> </span>JS-callable<span class="w w1"> </span>functions,<span class="w w2"> </span>the<span class="w w1"> </span>key<span class="w w2"> </span>argument<span class="w w2"> </span>of<span class="w w1"> </span>which</div>
<div class="l f2 s4 c0" style="bottom:656.295px;top:127.689px;left:54px;">is<span class="w w1"> </span>an<span class="w w1"> </span>array<span class="w w1"> </span>of<span class="w w1"> </span>boxed<span class="w w1"> </span>values.<span class="w w1"> </span>External<span class="w w1"> </span>functions<span class="w w1"> </span>called<span class="w w1"> </span>through<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:646.332px;top:137.652px;left:54px;">FFI<span class="w w2"> </span>interact<span class="w w1"> </span>with<span class="w w2"> </span>the<span class="w w2"> </span>program<span class="w w1"> </span>state<span class="w w2"> </span>through<span class="w w1"> </span>an<span class="w w2"> </span>interpreter<span class="w w2"> </span>API<span class="w w1"> </span>(e.g.,</div>
<div class="l f2 s4 c0" style="bottom:636.37px;top:147.614px;left:54px;">to<span class="w w1"> </span>read<span class="w w2"> </span>a<span class="w w1"> </span>property<span class="w w1"> </span>from<span class="w w1"> </span>an<span class="w w1"> </span>argument).<span class="w w2"> </span>There<span class="w w1"> </span>are<span class="w w1"> </span>also<span class="w w1"> </span>certain<span class="w w1"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:626.407px;top:157.577px;left:54px;">preter<span class="w w2"> </span>builtins<span class="w w1"> </span>that<span class="w w2"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>use<span class="w w2"> </span>the<span class="w w1"> </span>FFI,<span class="w w2"> </span>but<span class="w w1"> </span>interact<span class="w w2"> </span>with<span class="w w1"> </span>the<span class="w w2"> </span>program</div>
<div class="l f2 s4 c0" style="bottom:616.444px;top:167.54px;left:54px;">state<span class="w w1"> </span>in<span class="w w0"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>way,<span class="w w1"> </span>such<span class="w w1"> </span>as<span class="w w0"> </span>the</div>
<div class="l f7 s4 c0" style="bottom:616.391px;top:168.14px;left:184.597px;">CallIteratorNext</div>
<div class="l f2 s4 c0" style="bottom:616.444px;top:167.54px;left:263.219px;">function</div>
<div class="l f2 s4 c0" style="bottom:606.482px;top:177.502px;left:54px;">used<span class="w w1"> </span>with<span class="w w1"> </span>iterator<span class="w w1"> </span>objects.<span class="w w1"> </span>TraceMonkey<span class="w w1"> </span>must<span class="w w1"> </span>support<span class="w w1"> </span>this<span class="w w1"> </span>FFI<span class="w w0"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:596.519px;top:187.465px;left:54px;">order<span class="w w2"> </span>to<span class="w w1"> </span>speed<span class="w w2"> </span>up<span class="w w2"> </span>code<span class="w w1"> </span>that<span class="w w2"> </span>interacts<span class="w w1"> </span>with<span class="w w2"> </span>the<span class="w w1"> </span>host<span class="w w2"> </span>system<span class="w w2"> </span>inside<span class="w w1"> </span>hot</div>
<div class="l f2 s4 c0" style="bottom:586.556px;top:197.428px;left:54px;">loops.</div>
<div class="l f2 s4 c0" style="bottom:576.594px;top:207.39px;left:65.9552px;">Calling<span class="w w2"> </span>external<span class="w w1"> </span>functions<span class="w w2"> </span>from<span class="w w1"> </span>TraceMonkey<span class="w w2"> </span>is<span class="w w2"> </span>potentially<span class="w w1"> </span>dif-</div>
<div class="l f2 s4 c0" style="bottom:566.631px;top:217.353px;left:54px;">ficult<span class="w w1"> </span>because<span class="w w1"> </span>traces<span class="w w1"> </span>do<span class="w w1"> </span>not<span class="w w0"> </span>update<span class="w w2"> </span>the<span class="w w0"> </span>interpreter<span class="w w2"> </span>state<span class="w w0"> </span>until<span class="w w1"> </span>exit-</div>
<div class="l f2 s4 c0" style="bottom:556.668px;top:227.316px;left:54px;">ing.<span class="w w1"> </span>In<span class="w w2"> </span>particular,<span class="w w1"> </span>external<span class="w w2"> </span>functions<span class="w w1"> </span>may<span class="w w1"> </span>need<span class="w w1"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>or<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:546.706px;top:237.278px;left:54px;">global<span class="w w2"> </span>variables,<span class="w w1"> </span>but<span class="w w2"> </span>they<span class="w w1"> </span>may<span class="w w1"> </span>be<span class="w w2"> </span>out<span class="w w1"> </span>of<span class="w w2"> </span>date.</div>
<div class="l f2 s4 c0" style="bottom:536.743px;top:247.241px;left:65.9552px;">For<span class="w w1"> </span>the<span class="w w1"> </span>out-of-date<span class="w w1"> </span>call<span class="w w0"> </span>stack<span class="w w1"> </span>problem,<span class="w w1"> </span>we<span class="w w1"> </span>refactored<span class="w w1"> </span>some<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:526.781px;top:257.203px;left:54px;">the<span class="w w1"> </span>interpreter<span class="w w1"> </span>API<span class="w w1"> </span>implementation<span class="w w1"> </span>functions<span class="w w1"> </span>to<span class="w w1"> </span>re-materialize<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:516.818px;top:267.166px;left:54px;">interpreter<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>on<span class="w w2"> </span>demand.</div>
<div class="l f2 s4 c0" style="bottom:506.855px;top:277.129px;left:65.9552px;">We<span class="w w2"> </span>developed<span class="w w1"> </span>a<span class="w w1"> </span>C++<span class="w w1"> </span>static<span class="w w1"> </span>analysis<span class="w w1"> </span>and<span class="w w1"> </span>annotated<span class="w w1"> </span>some<span class="w w1"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:496.893px;top:287.091px;left:54px;">preter<span class="w w1"> </span>functions<span class="w w1"> </span>in<span class="w w0"> </span>order<span class="w w1"> </span>to<span class="w w1"> </span>verify<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>call<span class="w w1"> </span>stack<span class="w w0"> </span>is<span class="w w1"> </span>refreshed</div>
<div class="l f2 s4 c0" style="bottom:486.93px;top:297.054px;left:54px;">at<span class="w w1"> </span>any<span class="w w1"> </span>point<span class="w w1"> </span>it<span class="w w1"> </span>needs<span class="w w1"> </span>to<span class="w w0"> </span>be<span class="w w2"> </span>used.<span class="w w0"> </span>In<span class="w w2"> </span>order<span class="w w1"> </span>to<span class="w w0"> </span>access<span class="w w2"> </span>the<span class="w w0"> </span>call<span class="w w2"> </span>stack,</div>
<div class="l f2 s4 c0" style="bottom:476.967px;top:307.017px;left:54px;">a<span class="w w0"> </span>function<span class="w w0"> </span>must<span class="w w1"> </span>be<span class="w w0"> </span>annotated<span class="w w0"> </span>as<span class="w w0"> </span>either<span class="w w0"> </span>F</div>
<div class="l f2 s14 c0" style="bottom:477.355px;top:308.233px;left:211.644px;">ORC<span class="w w2"> </span>ES</div>
<div class="l f2 s4 c0" style="bottom:476.967px;top:307.017px;left:236.974px;">S</div>
<div class="l f2 s14 c0" style="bottom:477.355px;top:308.233px;left:242.407px;">TACK</div>
<div class="l f2 s4 c0" style="bottom:476.967px;top:307.017px;left:266.738px;">or<span class="w w0"> </span>R</div>
<div class="l f2 s14 c0" style="bottom:477.355px;top:308.233px;left:285.07px;">E</div>
<div class="l f2 s4 c0" style="bottom:476.967px;top:307.017px;left:289.893px;">-</div>
<div class="l f2 s14 c0" style="bottom:467.392px;top:318.195px;left:54.2241px;">QUI<span class="w w2"> </span>RES</div>
<div class="l f2 s4 c0" style="bottom:467.005px;top:316.979px;left:82.7098px;">S</div>
<div class="l f2 s14 c0" style="bottom:467.392px;top:318.195px;left:88.1434px;">TACK</div>
<div class="l f2 s4 c0" style="bottom:467.005px;top:316.979px;left:108.264px;">.<span class="w w2"> </span>These<span class="w w1"> </span>annotations<span class="w w2"> </span>are<span class="w w1"> </span>also<span class="w w2"> </span>required<span class="w w1"> </span>in<span class="w w2"> </span>order<span class="w w1"> </span>to<span class="w w2"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:457.042px;top:326.942px;left:54.2241px;">R</div>
<div class="l f2 s14 c0" style="bottom:457.429px;top:328.158px;left:60.6529px;">EQU<span class="w w2"> </span>IRE<span class="w w2"> </span>S</div>
<div class="l f2 s4 c0" style="bottom:457.042px;top:326.942px;left:93.9624px;">S</div>
<div class="l f2 s14 c0" style="bottom:457.429px;top:328.158px;left:99.396px;">TACK</div>
<div class="l f2 s4 c0" style="bottom:457.042px;top:326.942px;left:121.575px;">functions,<span class="w w2"> </span>which<span class="w w1"> </span>are<span class="w w2"> </span>presumed<span class="w w1"> </span>to<span class="w w2"> </span>access<span class="w w1"> </span>the<span class="w w2"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:447.079px;top:336.905px;left:54px;">stack<span class="w w1"> </span>transitively.<span class="w w1"> </span>F</div>
<div class="l f2 s14 c0" style="bottom:447.467px;top:338.12px;left:125.911px;">ORC<span class="w w2"> </span>ES</div>
<div class="l f2 s4 c0" style="bottom:447.079px;top:336.905px;left:151.24px;">S</div>
<div class="l f2 s14 c0" style="bottom:447.467px;top:338.12px;left:156.674px;">TACK</div>
<div class="l f2 s4 c0" style="bottom:447.079px;top:336.905px;left:179.884px;">is<span class="w w1"> </span>a<span class="w w1"> </span>trusted<span class="w w0"> </span>annotation,<span class="w w1"> </span>applied</div>
<div class="l f2 s4 c0" style="bottom:437.117px;top:346.867px;left:54px;">to<span class="w w2"> </span>only<span class="w w1"> </span>5<span class="w w2"> </span>functions,<span class="w w1"> </span>that<span class="w w2"> </span>means<span class="w w2"> </span>the<span class="w w1"> </span>function<span class="w w2"> </span>refreshes<span class="w w1"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>stack.</div>
<div class="l f2 s4 c0" style="bottom:427.154px;top:356.83px;left:54.2241px;">R</div>
<div class="l f2 s14 c0" style="bottom:427.542px;top:358.046px;left:60.6529px;">EQU<span class="w w2"> </span>IRE<span class="w w2"> </span>S</div>
<div class="l f2 s4 c0" style="bottom:427.154px;top:356.83px;left:93.9625px;">S</div>
<div class="l f2 s14 c0" style="bottom:427.542px;top:358.046px;left:99.396px;">TACK</div>
<div class="l f2 s4 c0" style="bottom:427.154px;top:356.83px;left:122.226px;">is<span class="w w1"> </span>an<span class="w w1"> </span>untrusted<span class="w w1"> </span>annotation<span class="w w1"> </span>that<span class="w w1"> </span>means<span class="w w1"> </span>the<span class="w w1"> </span>func-</div>
<div class="l f2 s4 c0" style="bottom:417.192px;top:366.792px;left:54px;">tion<span class="w w2"> </span>may<span class="w w1"> </span>only<span class="w w2"> </span>be<span class="w w1"> </span>called<span class="w w2"> </span>if<span class="w w1"> </span>the<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w1"> </span>has<span class="w w2"> </span>already<span class="w w1"> </span>been<span class="w w2"> </span>refreshed.</div>
<div class="l f2 s4 c0" style="bottom:407.229px;top:376.755px;left:65.9551px;">Similarly,<span class="w w1"> </span>we<span class="w w0"> </span>detect<span class="w w0"> </span>when<span class="w w1"> </span>host<span class="w w0"> </span>functions<span class="w w0"> </span>attempt<span class="w w1"> </span>to<span class="w w0"> </span>directly</div>
<div class="l f2 s4 c0" style="bottom:397.266px;top:386.718px;left:54px;">read<span class="w w2"> </span>or<span class="w w1"> </span>write<span class="w w2"> </span>global<span class="w w1"> </span>variables,<span class="w w2"> </span>and<span class="w w1"> </span>force<span class="w w2"> </span>the<span class="w w1"> </span>currently<span class="w w2"> </span>running<span class="w w1"> </span>trace</div>
<div class="l f2 s4 c0" style="bottom:387.304px;top:396.68px;left:54px;">to<span class="w w1"> </span>side<span class="w w0"> </span>exit.<span class="w w1"> </span>This<span class="w w0"> </span>is<span class="w w1"> </span>necessary<span class="w w1"> </span>since<span class="w w0"> </span>we<span class="w w1"> </span>cache<span class="w w0"> </span>and<span class="w w1"> </span>unbox<span class="w w0"> </span>global</div>
<div class="l f2 s4 c0" style="bottom:377.341px;top:406.643px;left:54px;">variables<span class="w w2"> </span>into<span class="w w1"> </span>the<span class="w w2"> </span>activation<span class="w w1"> </span>record<span class="w w2"> </span>during<span class="w w1"> </span>trace<span class="w w1"> </span>execution.</div>
<div class="l f2 s4 c0" style="bottom:367.378px;top:416.606px;left:65.9551px;">Since<span class="w w0"> </span>both<span class="w w0"> </span>call-stack<span class="w w0"> </span>access<span class="w w0"> </span>and<span class="w w0"> </span>global<span class="w w0"> </span>variable<span class="w w0"> </span>access<span class="w w0"> </span>are</div>
<div class="l f2 s4 c0" style="bottom:357.416px;top:426.568px;left:54px;">rarely<span class="w w2"> </span>performed<span class="w w2"> </span>by<span class="w w1"> </span>host<span class="w w2"> </span>functions,<span class="w w2"> </span>performance<span class="w w1"> </span>is<span class="w w2"> </span>not<span class="w w2"> </span>significantly</div>
<div class="l f2 s4 c0" style="bottom:347.453px;top:436.531px;left:54px;">affected<span class="w w2"> </span>by<span class="w w1"> </span>these<span class="w w2"> </span>safety<span class="w w1"> </span>mechanisms.</div>
<div class="l f2 s4 c0" style="bottom:337.49px;top:446.494px;left:65.9551px;">Another<span class="w w2"> </span>problem<span class="w w1"> </span>is<span class="w w2"> </span>that<span class="w w1"> </span>external<span class="w w2"> </span>functions<span class="w w1"> </span>can<span class="w w2"> </span>reenter<span class="w w1"> </span>the<span class="w w2"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:327.528px;top:456.456px;left:54px;">preter<span class="w w1"> </span>by<span class="w w1"> </span>calling<span class="w w2"> </span>scripts,<span class="w w1"> </span>which<span class="w w1"> </span>in<span class="w w1"> </span>turn<span class="w w1"> </span>again<span class="w w1"> </span>might<span class="w w1"> </span>want<span class="w w2"> </span>to<span class="w w1"> </span>access</div>
<div class="l f2 s4 c0" style="bottom:317.565px;top:466.419px;left:54px;">the<span class="w w2"> </span>call<span class="w w1"> </span>stack<span class="w w2"> </span>or<span class="w w2"> </span>global<span class="w w1"> </span>variables.<span class="w w2"> </span>To<span class="w w2"> </span>address<span class="w w2"> </span>this<span class="w w1"> </span>problem,<span class="w w2"> </span>we<span class="w w1"> </span>made</div>
<div class="l f2 s4 c0" style="bottom:307.602px;top:476.382px;left:54px;">the<span class="w w2"> </span>VM<span class="w w2"> </span>set<span class="w w1"> </span>a<span class="w w2"> </span>flag<span class="w w2"> </span>whenever<span class="w w2"> </span>the<span class="w w1"> </span>interpreter<span class="w w2"> </span>is<span class="w w2"> </span>reentered<span class="w w1"> </span>while<span class="w w2"> </span>a<span class="w w2"> </span>com-</div>
<div class="l f2 s4 c0" style="bottom:297.64px;top:486.344px;left:54px;">piled<span class="w w2"> </span>trace<span class="w w1"> </span>is<span class="w w1"> </span>running.</div>
<div class="l f2 s4 c0" style="bottom:287.677px;top:496.307px;left:65.9551px;">Every<span class="w w2"> </span>call<span class="w w1"> </span>to<span class="w w2"> </span>an<span class="w w1"> </span>external<span class="w w2"> </span>function<span class="w w1"> </span>then<span class="w w2"> </span>checks<span class="w w1"> </span>this<span class="w w2"> </span>flag<span class="w w1"> </span>and<span class="w w2"> </span>exits</div>
<div class="l f2 s4 c0" style="bottom:277.715px;top:506.269px;left:54px;">the<span class="w w2"> </span>trace<span class="w w2"> </span>immediately<span class="w w1"> </span>after<span class="w w2"> </span>returning<span class="w w2"> </span>from<span class="w w1"> </span>the<span class="w w2"> </span>external<span class="w w2"> </span>function<span class="w w1"> </span>call</div>
<div class="l f2 s4 c0" style="bottom:267.752px;top:516.232px;left:54px;">if<span class="w w1"> </span>it<span class="w w2"> </span>is<span class="w w1"> </span>set.<span class="w w1"> </span>There<span class="w w1"> </span>are<span class="w w1"> </span>many<span class="w w1"> </span>external<span class="w w2"> </span>functions<span class="w w1"> </span>that<span class="w w1"> </span>seldom<span class="w w1"> </span>or<span class="w w1"> </span>never</div>
<div class="l f2 s4 c0" style="bottom:257.789px;top:526.195px;left:54px;">reenter,<span class="w w1"> </span>and<span class="w w0"> </span>they<span class="w w1"> </span>can<span class="w w1"> </span>be<span class="w w0"> </span>called<span class="w w1"> </span>without<span class="w w0"> </span>problem,<span class="w w1"> </span>and<span class="w w0"> </span>will<span class="w w1"> </span>cause</div>
<div class="l f2 s4 c0" style="bottom:247.827px;top:536.157px;left:54px;">trace<span class="w w2"> </span>exit<span class="w w1"> </span>only<span class="w w1"> </span>if<span class="w w2"> </span>necessary.</div>
<div class="l f2 s4 c0" style="bottom:237.864px;top:546.12px;left:65.9551px;">The<span class="w w0"> </span>FFI’</div>
<div class="l f2 s4 c0" style="bottom:237.864px;top:546.12px;left:99.1397px;">s<span class="w w0"> </span>boxed<span class="w w1"> </span>value<span class="w w0"> </span>array<span class="w w1"> </span>requirement<span class="w w0"> </span>has<span class="w w1"> </span>a<span class="w w0"> </span>performance</div>
<div class="l f2 s4 c0" style="bottom:227.901px;top:556.083px;left:54px;">cost,<span class="w w1"> </span>so<span class="w w0"> </span>we<span class="w w1"> </span>defined<span class="w w1"> </span>a<span class="w w0"> </span>new<span class="w w1"> </span>FFI<span class="w w1"> </span>that<span class="w w1"> </span>allows<span class="w w0"> </span>C<span class="w w1"> </span>functions<span class="w w1"> </span>to<span class="w w0"> </span>be<span class="w w1"> </span>an-</div>
<div class="l f2 s4 c0" style="bottom:217.939px;top:566.045px;left:54px;">notated<span class="w w1"> </span>with<span class="w w1"> </span>their<span class="w w1"> </span>argument<span class="w w1"> </span>types<span class="w w1"> </span>so<span class="w w1"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>tracer<span class="w w0"> </span>can<span class="w w2"> </span>call<span class="w w1"> </span>them</div>
<div class="l f2 s4 c0" style="bottom:207.976px;top:576.008px;left:54px;">directly,<span class="w w2"> </span>without<span class="w w1"> </span>unnecessary<span class="w w2"> </span>argument<span class="w w1"> </span>conversions.</div>
<div class="l f2 s4 c0" style="bottom:198.013px;top:585.971px;left:65.9551px;">Currently,<span class="w w2"> </span>we<span class="w w1"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>support<span class="w w1"> </span>calling<span class="w w2"> </span>native<span class="w w1"> </span>property<span class="w w1"> </span>get<span class="w w2"> </span>and<span class="w w1"> </span>set</div>
<div class="l f2 s4 c0" style="bottom:188.051px;top:595.933px;left:54px;">override<span class="w w1"> </span>functions<span class="w w2"> </span>or<span class="w w1"> </span>DOM<span class="w w1"> </span>functions<span class="w w1"> </span>directly<span class="w w1"> </span>from<span class="w w1"> </span>trace.<span class="w w1"> </span>Support</div>
<div class="l f2 s4 c0" style="bottom:178.088px;top:605.896px;left:54px;">is<span class="w w2"> </span>planned<span class="w w1"> </span>future<span class="w w1"> </span>work.</div>
<div class="l f1 s4 c0" style="bottom:160.218px;top:623.721px;left:54px;">6.6<span class="w w10"> </span>Correctness</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:54px;">During<span class="w w0"> </span>development,<span class="w w0"> </span>we<span class="w w1"> </span>had<span class="w w0"> </span>access<span class="w w0"> </span>to<span class="w w0"> </span>existing<span class="w w0"> </span>JavaScript<span class="w w0"> </span>test</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:54px;">suites,<span class="w w1"> </span>but<span class="w w1"> </span>most<span class="w w0"> </span>of<span class="w w1"> </span>them<span class="w w1"> </span>were<span class="w w0"> </span>not<span class="w w1"> </span>designed<span class="w w1"> </span>with<span class="w w1"> </span>tracing<span class="w w0"> </span>VMs<span class="w w1"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:54px;">mind<span class="w w2"> </span>and<span class="w w1"> </span>contained<span class="w w1"> </span>few<span class="w w2"> </span>loops.</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:65.9551px;">One<span class="w w1"> </span>tool<span class="w w1"> </span>that<span class="w w0"> </span>helped<span class="w w1"> </span>us<span class="w w1"> </span>greatly<span class="w w1"> </span>was<span class="w w1"> </span>Mozilla’s<span class="w w1"> </span>JavaScript<span class="w w1"> </span>fuzz</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:54px;">tester,</div>
<div class="l f2 s14 c0" style="bottom:106.745px;top:678.843px;left:78.6182px;">JSF<span class="w w2"> </span>UNF<span class="w w2"> </span>UZZ</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:121.432px;">,<span class="w w1"> </span>which<span class="w w1"> </span>generates<span class="w w0"> </span>random<span class="w w1"> </span>JavaScript<span class="w w2"> </span>programs</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:54px;">by<span class="w w1"> </span>nesting<span class="w w0"> </span>random<span class="w w1"> </span>language<span class="w w1"> </span>elements.<span class="w w0"> </span>We<span class="w w1"> </span>modified</div>
<div class="l f2 s14 c0" style="bottom:96.7819px;top:688.805px;left:250.29px;">JSF<span class="w w2"> </span>UNF<span class="w w2"> </span>UZZ</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:54px;">to<span class="w w1"> </span>generate<span class="w w1"> </span>loops,<span class="w w1"> </span>and<span class="w w1"> </span>also<span class="w w1"> </span>to<span class="w w1"> </span>test<span class="w w1"> </span>more<span class="w w1"> </span>heavily<span class="w w1"> </span>certain<span class="w w1"> </span>constructs</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:54px;">we<span class="w w2"> </span>suspected<span class="w w1"> </span>would<span class="w w2"> </span>reveal<span class="w w1"> </span>flaws<span class="w w2"> </span>in<span class="w w1"> </span>our<span class="w w2"> </span>implementation.<span class="w w1"> </span>For<span class="w w2"> </span>exam-</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:54px;">ple,<span class="w w2"> </span>we<span class="w w2"> </span>suspected<span class="w w1"> </span>bugs<span class="w w2"> </span>in<span class="w w2"> </span>TraceMonkey’shandling<span class="w w1"> </span>of<span class="w w2"> </span>type-unstable</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:377.215px;">!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:393.004px;">$!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:410.187px;">%!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:427.37px;">&amp;!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:444.554px;">&apos;!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:461.737px;">(!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:478.92px;">)!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:496.103px;">*!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:513.286px;">+!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:530.469px;">,!&quot;#</div>
<div class="l f16 s15 c0" style="bottom:530.823px;top:254.462px;left:546.258px;">$!!&quot;#</div>
<div class="l f16 s16 c0" style="bottom:543.257px;top:243.37px;left:350.177px;">&amp;-./012#3%4%56#</div>
<div class="l f16 s16 c0" style="bottom:549.851px;top:236.777px;left:346.857px;">&amp;-.789:;#3%4,56#</div>
<div class="l f16 s16 c0" style="bottom:556.445px;top:230.183px;left:344.292px;">&amp;-.9&lt;=&gt;9&lt;/2#3$4%56#</div>
<div class="l f16 s16 c0" style="bottom:563.038px;top:223.589px;left:330.344px;">&lt;//2??.1@A&lt;9=.&gt;922?#3!4,56#</div>
<div class="l f16 s16 c0" style="bottom:569.632px;top:216.996px;left:335.554px;">&lt;//2??.B&lt;AAC0/;#3%4%56#</div>
<div class="l f16 s16 c0" style="bottom:576.226px;top:210.402px;left:340.685px;">&lt;//2??.A18-=#3&apos;4%56#</div>
<div class="l f16 s16 c0" style="bottom:582.819px;top:203.808px;left:340.584px;">&lt;//2??.A?@2D2#3&amp;4!56#</div>
<div class="l f16 s16 c0" style="bottom:589.413px;top:197.215px;left:321.39px;">1@&gt;8:?.&amp;1@&gt;.1@&gt;?.@A.1=&gt;2#3%(4(56#</div>
<div class="l f16 s16 c0" style="bottom:596.007px;top:190.621px;left:331.819px;">1@&gt;8:?.1@&gt;?.@A.1=&gt;2#3+4*56#</div>
<div class="l f16 s16 c0" style="bottom:602.6px;top:184.027px;left:329.139px;">1@&gt;8:?.1@&gt;E@?2.&lt;A-#3%(4%56#</div>
<div class="l f16 s16 c0" style="bottom:609.194px;top:177.434px;left:333.101px;">1@&gt;8:?.A?@2D2.1@&gt;?#3%4*56#</div>
<div class="l f16 s16 c0" style="bottom:615.788px;top:170.84px;left:326.864px;">/8A&gt;98FG8E.92/09?@D2#3$4!56#</div>
<div class="l f16 s16 c0" style="bottom:622.381px;top:164.246px;left:345.923px;">/9=:&gt;8.&lt;2?#3$4)56#</div>
<div class="l f16 s16 c0" style="bottom:628.975px;top:157.653px;left:343.882px;">/9=:&gt;8.7-(#3%4&amp;56#</div>
<div class="l f16 s16 c0" style="bottom:635.569px;top:151.059px;left:343.57px;">/9=:&gt;8.?;&lt;$#3(4,56#</div>
<div class="l f16 s16 c0" style="bottom:642.162px;top:144.465px;left:333.415px;">-&lt;&gt;2.B897&lt;&gt;.&gt;8H2#3$4$56#</div>
<div class="l f16 s16 c0" style="bottom:648.756px;top:137.872px;left:331.975px;">-&lt;&gt;2.B897&lt;&gt;.5:&lt;91#3$4!56#</div>
<div class="l f16 s16 c0" style="bottom:655.35px;top:131.278px;left:343.224px;">7&lt;&gt;;./89-@/#3&apos;4,56#</div>
<div class="l f16 s16 c0" style="bottom:661.943px;top:124.684px;left:331.887px;">7&lt;&gt;;.:&lt;9I&lt;F.?07?#3(4,56#</div>
<div class="l f16 s16 c0" style="bottom:668.537px;top:118.091px;left:328.879px;">7&lt;&gt;;.?:2/&gt;9&lt;F.A897#3*4$56#</div>
<div class="l f16 s16 c0" style="bottom:675.131px;top:111.497px;left:344.621px;">92J25:.-A&lt;#3&apos;4%56#</div>
<div class="l f16 s16 c0" style="bottom:681.724px;top:104.903px;left:340.53px;">?&gt;9@AJ.1&lt;?2)&apos;#3%4(56#</div>
<div class="l f16 s16 c0" style="bottom:688.318px;top:98.3097px;left:344.795px;">?&gt;9@AJ.B&lt;?&gt;&lt;#3$4(56#</div>
<div class="l f16 s16 c0" style="bottom:694.912px;top:91.716px;left:337.933px;">?&gt;9@AJ.&gt;&lt;J/F80-#3$4$56#</div>
<div class="l f16 s16 c0" style="bottom:701.505px;top:85.1223px;left:330.589px;">?&gt;9@AJ.0A:&lt;/C./8-2#3$4%56#</div>
<div class="l f16 s16 c0" style="bottom:708.099px;top:78.5287px;left:328.515px;">?&gt;9@AJ.D&lt;F@-&lt;&gt;2.@A:0&gt;#3$4,56#</div>
<div class="l f16 s15 c0" style="bottom:513.846px;top:271.438px;left:411.5px;">KA&gt;29:92&gt;#</div>
<div class="l f16 s15 c0" style="bottom:513.846px;top:271.438px;left:459.26px;">L&lt;ID2#</div>
<div class="l f1 s4 c0" style="bottom:482.857px;top:301.082px;left:317.014px;">Figure<span class="w w1"> </span>11.<span class="w w0"> </span>Fraction<span class="w w0"> </span>of<span class="w w1"> </span>dynamic<span class="w w1"> </span>bytecodes<span class="w w0"> </span>executed<span class="w w1"> </span>by<span class="w w1"> </span>inter-</div>
<div class="l f1 s4 c0" style="bottom:472.894px;top:311.045px;left:317.014px;">preter<span class="w w2"> </span>and<span class="w w1"> </span>on<span class="w w1"> </span>native<span class="w w2"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:472.832px;top:311.152px;left:424.555px;">The<span class="w w2"> </span>speedup<span class="w w1"> </span>vs.<span class="w w1"> </span>interpreter<span class="w w2"> </span>is<span class="w w1"> </span>shown</div>
<div class="l f2 s4 c0" style="bottom:462.869px;top:321.115px;left:317.014px;">in<span class="w w1"> </span>parentheses<span class="w w0"> </span>next<span class="w w1"> </span>to<span class="w w0"> </span>each<span class="w w1"> </span>test.<span class="w w0"> </span>The<span class="w w0"> </span>fraction<span class="w w1"> </span>of<span class="w w0"> </span>bytecodes<span class="w w1"> </span>exe-</div>
<div class="l f2 s4 c0" style="bottom:452.906px;top:331.078px;left:317.014px;">cuted<span class="w w0"> </span>while<span class="w w1"> </span>recording<span class="w w0"> </span>is<span class="w w0"> </span>too<span class="w w1"> </span>small<span class="w w0"> </span>to<span class="w w0"> </span>see<span class="w w0"> </span>in<span class="w w1"> </span>this<span class="w w0"> </span>figure,<span class="w w0"> </span>except</div>
<div class="l f2 s4 c0" style="bottom:442.944px;top:341.04px;left:317.014px;">for</div>
<div class="l f7 s4 c0" style="bottom:442.89px;top:341.641px;left:329.996px;">crypto-md5</div>
<div class="l f2 s4 c0" style="bottom:442.944px;top:341.04px;left:377.069px;">,<span class="w w1"> </span>where<span class="w w2"> </span>fully<span class="w w1"> </span>3%<span class="w w1"> </span>of<span class="w w1"> </span>bytecodes<span class="w w1"> </span>are<span class="w w1"> </span>executed<span class="w w2"> </span>while</div>
<div class="l f2 s4 c0" style="bottom:432.981px;top:351.003px;left:317.014px;">recording.<span class="w w1"> </span>In<span class="w w1"> </span>most<span class="w w0"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>tests,<span class="w w0"> </span>almost<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>bytecodes<span class="w w0"> </span>are<span class="w w1"> </span>exe-</div>
<div class="l f2 s4 c0" style="bottom:423.018px;top:360.966px;left:317.014px;">cuted<span class="w w1"> </span>by<span class="w w1"> </span>compiled<span class="w w1"> </span>traces.<span class="w w1"> </span>Three<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>benchmarks<span class="w w1"> </span>are<span class="w w1"> </span>not<span class="w w1"> </span>traced</div>
<div class="l f2 s4 c0" style="bottom:413.056px;top:370.928px;left:317.014px;">at<span class="w w2"> </span>all<span class="w w1"> </span>and<span class="w w1"> </span>run<span class="w w2"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>interpreter.</div>
<div class="l f2 s4 c0" style="bottom:383.561px;top:400.423px;left:317.014px;">loops<span class="w w1"> </span>and<span class="w w2"> </span>heavily<span class="w w1"> </span>branching<span class="w w1"> </span>code,<span class="w w2"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>specialized<span class="w w1"> </span>fuzz<span class="w w2"> </span>tester<span class="w w1"> </span>in-</div>
<div class="l f2 s4 c0" style="bottom:373.598px;top:410.386px;left:317.014px;">deed<span class="w w2"> </span>revealed<span class="w w2"> </span>several<span class="w w2"> </span>regressions<span class="w w2"> </span>which<span class="w w2"> </span>we<span class="w w1"> </span>subsequently<span class="w w2"> </span>corrected.</div>
<div class="l f1 s2 c0" style="bottom:349.092px;top:433.056px;left:317.014px;">7.<span class="w w3"> </span>Evaluation</div>
<div class="l f2 s4 c0" style="bottom:335.498px;top:448.486px;left:317.014px;">We<span class="w w1"> </span>evaluated<span class="w w0"> </span>our<span class="w w1"> </span>JavaScript<span class="w w0"> </span>tracing<span class="w w1"> </span>implementation<span class="w w0"> </span>using<span class="w w0"> </span>Sun-</div>
<div class="l f2 s4 c0" style="bottom:325.535px;top:458.449px;left:317.014px;">Spider,<span class="w w2"> </span>the<span class="w w1"> </span>industry<span class="w w1"> </span>standard<span class="w w1"> </span>JavaScript<span class="w w1"> </span>benchmark<span class="w w1"> </span>suite.<span class="w w2"> </span>SunSpi-</div>
<div class="l f2 s4 c0" style="bottom:315.573px;top:468.411px;left:317.014px;">der<span class="w w1"> </span>consists<span class="w w1"> </span>of<span class="w w1"> </span>26<span class="w w1"> </span>short-running<span class="w w1"> </span>(less<span class="w w1"> </span>than<span class="w w0"> </span>250ms,<span class="w w2"> </span>average<span class="w w1"> </span>26ms)</div>
<div class="l f2 s4 c0" style="bottom:305.61px;top:478.374px;left:317.014px;">JavaScript<span class="w w2"> </span>programs.<span class="w w1"> </span>This<span class="w w1"> </span>is<span class="w w1"> </span>in<span class="w w1"> </span>stark<span class="w w1"> </span>contrast<span class="w w1"> </span>to<span class="w w1"> </span>benchmark<span class="w w1"> </span>suites</div>
<div class="l f2 s4 c0" style="bottom:295.647px;top:488.337px;left:317.014px;">such<span class="w w1"> </span>as<span class="w w1"> </span>SpecJVM98<span class="w w1"> </span>(3)<span class="w w1"> </span>used<span class="w w0"> </span>to<span class="w w2"> </span>evaluate<span class="w w1"> </span>desktop<span class="w w1"> </span>and<span class="w w1"> </span>server<span class="w w0"> </span>Jav</div>
<div class="l f2 s4 c0" style="bottom:295.647px;top:488.337px;left:552.14px;">a</div>
<div class="l f2 s4 c0" style="bottom:285.685px;top:498.299px;left:317.014px;">VMs.<span class="w w1"> </span>Many<span class="w w2"> </span>programs<span class="w w1"> </span>in<span class="w w1"> </span>those<span class="w w2"> </span>benchmarks<span class="w w1"> </span>use<span class="w w1"> </span>large<span class="w w1"> </span>data<span class="w w2"> </span>sets<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:275.722px;top:508.262px;left:317.014px;">execute<span class="w w2"> </span>for<span class="w w2"> </span>minutes.<span class="w w1"> </span>The<span class="w w2"> </span>SunSpider<span class="w w1"> </span>programs<span class="w w2"> </span>carry<span class="w w1"> </span>out<span class="w w2"> </span>a<span class="w w2"> </span>variety<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:265.759px;top:518.225px;left:317.014px;">tasks,<span class="w w2"> </span>primarily<span class="w w1"> </span>3d<span class="w w2"> </span>rendering,<span class="w w1"> </span>bit-bashing,<span class="w w2"> </span>cryptographic<span class="w w1"> </span>encoding,</div>
<div class="l f2 s4 c0" style="bottom:255.797px;top:528.187px;left:317.014px;">math<span class="w w2"> </span>kernels,<span class="w w1"> </span>and<span class="w w1"> </span>string<span class="w w2"> </span>processing.</div>
<div class="l f2 s4 c0" style="bottom:245.834px;top:538.15px;left:328.969px;">All<span class="w w1"> </span>experiments<span class="w w1"> </span>were<span class="w w0"> </span>performed<span class="w w1"> </span>on<span class="w w1"> </span>a<span class="w w0"> </span>MacBook<span class="w w1"> </span>Pro<span class="w w1"> </span>with<span class="w w0"> </span>2.2</div>
<div class="l f2 s4 c0" style="bottom:235.871px;top:548.113px;left:317.014px;">GHz<span class="w w2"> </span>Core<span class="w w1"> </span>2<span class="w w1"> </span>processor<span class="w w2"> </span>and<span class="w w1"> </span>2<span class="w w1"> </span>GB<span class="w w2"> </span>RAM<span class="w w1"> </span>running<span class="w w2"> </span>MacOS<span class="w w1"> </span>10.5.</div>
<div class="l f1 s4 c0" style="bottom:225.972px;top:557.968px;left:328.969px;">Benchmark<span class="w w1"> </span>results.</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:408.095px;">The<span class="w w1"> </span>main<span class="w w0"> </span>question<span class="w w1"> </span>is<span class="w w1"> </span>whether<span class="w w0"> </span>programs</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:317.014px;">run<span class="w w2"> </span>faster<span class="w w1"> </span>with<span class="w w2"> </span>tracing.<span class="w w1"> </span>For<span class="w w2"> </span>this,<span class="w w1"> </span>we<span class="w w1"> </span>ran<span class="w w2"> </span>the<span class="w w1"> </span>standard<span class="w w2"> </span>SunSpider<span class="w w1"> </span>test</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:317.014px;">driver,<span class="w w1"> </span>which<span class="w w1"> </span>starts<span class="w w0"> </span>a<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter,<span class="w w0"> </span>loads<span class="w w1"> </span>and<span class="w w0"> </span>runs<span class="w w1"> </span>each</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:317.014px;">program<span class="w w1"> </span>once<span class="w w1"> </span>for<span class="w w0"> </span>warmup,<span class="w w1"> </span>then<span class="w w1"> </span>loads<span class="w w1"> </span>and<span class="w w1"> </span>runs<span class="w w0"> </span>each<span class="w w1"> </span>program<span class="w w1"> </span>10</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:317.014px;">times<span class="w w1"> </span>and<span class="w w2"> </span>reports<span class="w w1"> </span>the<span class="w w1"> </span>average<span class="w w1"> </span>time<span class="w w1"> </span>taken<span class="w w2"> </span>by<span class="w w1"> </span>each.<span class="w w1"> </span>We<span class="w w2"> </span>ran<span class="w w1"> </span>4<span class="w w1"> </span>differ-</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:317.014px;">ent<span class="w w1"> </span>configurations<span class="w w2"> </span>for<span class="w w1"> </span>comparison:<span class="w w1"> </span>(a)<span class="w w1"> </span>SpiderMonkey,<span class="w w2"> </span>the<span class="w w1"> </span>baseline</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:317.014px;">interpreter,<span class="w w2"> </span>(b)<span class="w w1"> </span>TraceMonkey,<span class="w w2"> </span>(d)<span class="w w1"> </span>SquirrelFish<span class="w w1"> </span>Extreme<span class="w w2"> </span>(SFX),<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:317.014px;">call-threaded<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter<span class="w w0"> </span>used<span class="w w1"> </span>in<span class="w w0"> </span>Apple’</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:502.959px;">s<span class="w w1"> </span>WebKit,<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">(e)<span class="w w2"> </span>V8,<span class="w w1"> </span>the<span class="w w1"> </span>method-compiling<span class="w w2"> </span>JavaScript<span class="w w1"> </span>VM<span class="w w2"> </span>from<span class="w w1"> </span>Google.</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:328.969px;">Figure<span class="w w2"> </span>10<span class="w w2"> </span>shows<span class="w w2"> </span>the<span class="w w1"> </span>relative<span class="w w2"> </span>speedups<span class="w w2"> </span>achieved<span class="w w2"> </span>by<span class="w w2"> </span>tracing,<span class="w w1"> </span>SFX,</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">and<span class="w w1"> </span>V8<span class="w w2"> </span>against<span class="w w1"> </span>the<span class="w w1"> </span>baseline<span class="w w2"> </span>(SpiderMonkey).<span class="w w1"> </span>Tracing<span class="w w1"> </span>achieves<span class="w w2"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:317.014px;">best<span class="w w2"> </span>speedups<span class="w w1"> </span>in<span class="w w1"> </span>integer-heavy<span class="w w2"> </span>benchmarks,<span class="w w1"> </span>up<span class="w w2"> </span>to<span class="w w1"> </span>the<span class="w w1"> </span>25x<span class="w w2"> </span>speedup</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">on</div>
<div class="l f7 s4 c0" style="bottom:106.303px;top:678.228px;left:328.222px;">bitops-bitwise-and</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:412.953px;">.</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:328.969px;">TraceMonkey<span class="w w1"> </span>is<span class="w w0"> </span>the<span class="w w0"> </span>fastest<span class="w w1"> </span>VM<span class="w w0"> </span>on<span class="w w0"> </span>9<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w0"> </span>26<span class="w w1"> </span>benchmarks</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">(</div>
<div class="l f7 s4 c0" style="bottom:86.3781px;top:698.153px;left:319.999px;">3d-morph</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:357.658px;">,</div>
<div class="l f7 s4 c0" style="bottom:86.3781px;top:698.153px;left:365.095px;">bitops-3bit-bits-in-byte</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:478.07px;">,</div>
<div class="l f7 s4 c0" style="bottom:86.3781px;top:698.153px;left:485.508px;">bitops-bitwise-</div>
<div class="l f7 s4 c0" style="bottom:76.4155px;top:708.116px;left:317.014px;">and</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:331.136px;">,</div>
<div class="l f7 s4 c0" style="bottom:76.4155px;top:708.116px;left:335.601px;">crypto-sha1</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:387.381px;">,</div>
<div class="l f7 s4 c0" style="bottom:76.4155px;top:708.116px;left:391.846px;">math-cordic</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:443.626px;">,</div>
<div class="l f7 s4 c0" style="bottom:76.4155px;top:708.116px;left:448.091px;">math-partial-sums</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:528.115px;">,</div>
<div class="l f7 s4 c0" style="bottom:76.4155px;top:708.116px;left:532.581px;">math-</div>
<div class="l f7 s4 c0" style="bottom:66.4528px;top:718.078px;left:317.014px;">spectral-norm</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:378.208px;">,</div>
<div class="l f7 s4 c0" style="bottom:66.4528px;top:718.078px;left:384.525px;">string-base64</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:445.72px;">,</div>
<div class="l f7 s4 c0" style="bottom:66.4528px;top:718.078px;left:452.036px;">string-validate-input</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:550.89px;">).</div>
</div>
<div id="page-11" class="p" style="width:612px;height:792px;background-image:url(pb.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f17 s17 c0" style="bottom:543.93px;top:236.226px;left:66.5497px;">!&quot;</div>
<div class="l f17 s17 c0" style="bottom:576.591px;top:203.565px;left:66.5497px;">#&quot;</div>
<div class="l f17 s17 c0" style="bottom:609.253px;top:170.903px;left:61.6334px;">$!&quot;</div>
<div class="l f17 s17 c0" style="bottom:641.914px;top:138.242px;left:61.6334px;">$#&quot;</div>
<div class="l f17 s17 c0" style="bottom:674.576px;top:105.58px;left:61.6334px;">%!&quot;</div>
<div class="l f17 s17 c0" style="bottom:707.237px;top:72.919px;left:61.6334px;">%#&quot;</div>
<div class="l f17 s17 c0" style="bottom:689.544px;top:90.6125px;left:488.109px;">&amp;&apos;()*+,&quot;</div>
<div class="l f17 s17 c0" style="bottom:672.056px;top:108.1px;left:488.109px;">-./&quot;</div>
<div class="l f17 s17 c0" style="bottom:654.569px;top:125.587px;left:488.109px;">01&quot;</div>
<div class="l f1 s4 c0" style="bottom:429.444px;top:354.495px;left:54px;">Figure<span class="w w1"> </span>10.</div>
<div class="l f2 s4 c0" style="bottom:429.381px;top:354.603px;left:97.7208px;">Speedup<span class="w w1"> </span>vs.<span class="w w1"> </span>a<span class="w w1"> </span>baseline<span class="w w1"> </span>JavaScript<span class="w w1"> </span>interpreter<span class="w w1"> </span>(SpiderMonkey)<span class="w w1"> </span>for<span class="w w1"> </span>our<span class="w w1"> </span>trace-based<span class="w w1"> </span>JIT<span class="w w1"> </span>compiler,<span class="w w2"> </span>Apple’s<span class="w w1"> </span>SquirrelFish<span class="w w1"> </span>Extreme</div>
<div class="l f2 s4 c0" style="bottom:419.418px;top:364.566px;left:54px;">inline<span class="w w2"> </span>threading<span class="w w2"> </span>interpreter<span class="w w1"> </span>and<span class="w w2"> </span>Google’s<span class="w w2"> </span>V8<span class="w w2"> </span>JS<span class="w w1"> </span>compiler.<span class="w w2"> </span>Our<span class="w w2"> </span>system<span class="w w2"> </span>generates<span class="w w1"> </span>particularly<span class="w w2"> </span>efficient<span class="w w2"> </span>code<span class="w w1"> </span>for<span class="w w2"> </span>programs<span class="w w2"> </span>that<span class="w w1"> </span>benefit<span class="w w2"> </span>most<span class="w w2"> </span>from</div>
<div class="l f2 s4 c0" style="bottom:409.456px;top:374.528px;left:54px;">type<span class="w w1"> </span>specialization,<span class="w w2"> </span>which<span class="w w1"> </span>includes<span class="w w1"> </span>SunSpider<span class="w w1"> </span>Benchmark<span class="w w2"> </span>programs<span class="w w1"> </span>that<span class="w w1"> </span>perform<span class="w w1"> </span>bit<span class="w w2"> </span>manipulation.<span class="w w1"> </span>We<span class="w w2"> </span>type-specialize<span class="w w1"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>in<span class="w w2"> </span>question</div>
<div class="l f2 s4 c0" style="bottom:399.493px;top:384.491px;left:54px;">to<span class="w w1"> </span>use<span class="w w1"> </span>integer<span class="w w1"> </span>arithmetic,<span class="w w1"> </span>which<span class="w w1"> </span>substantially<span class="w w1"> </span>improves<span class="w w1"> </span>performance.<span class="w w1"> </span>For<span class="w w1"> </span>one<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>benchmark<span class="w w1"> </span>programs<span class="w w1"> </span>we<span class="w w1"> </span>execute<span class="w w1"> </span>25<span class="w w1"> </span>times<span class="w w1"> </span>faster<span class="w w1"> </span>than</div>
<div class="l f2 s4 c0" style="bottom:389.531px;top:394.453px;left:54px;">the<span class="w w2"> </span>SpiderMonkey<span class="w w1"> </span>interpreter,<span class="w w2"> </span>and<span class="w w1"> </span>almost<span class="w w1"> </span>5<span class="w w2"> </span>times<span class="w w1"> </span>faster<span class="w w2"> </span>than<span class="w w1"> </span>V8<span class="w w1"> </span>and<span class="w w2"> </span>SFX.<span class="w w1"> </span>For<span class="w w2"> </span>a<span class="w w1"> </span>large<span class="w w1"> </span>number<span class="w w2"> </span>of<span class="w w1"> </span>benchmarks<span class="w w2"> </span>all<span class="w w1"> </span>three<span class="w w1"> </span>VMs<span class="w w2"> </span>produce<span class="w w1"> </span>similar</div>
<div class="l f2 s4 c0" style="bottom:379.568px;top:404.416px;left:54px;">results.<span class="w w2"> </span>We<span class="w w2"> </span>perform<span class="w w1"> </span>worst<span class="w w1"> </span>on<span class="w w2"> </span>benchmark<span class="w w1"> </span>programs<span class="w w1"> </span>that<span class="w w2"> </span>we<span class="w w1"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>trace<span class="w w1"> </span>and<span class="w w2"> </span>instead<span class="w w1"> </span>fall<span class="w w1"> </span>back<span class="w w2"> </span>onto<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.<span class="w w1"> </span>This<span class="w w2"> </span>includes<span class="w w1"> </span>the<span class="w w1"> </span>recursive</div>
<div class="l f2 s4 c0" style="bottom:369.605px;top:414.379px;left:54px;">benchmarks</div>
<div class="l f7 s4 c0" style="bottom:369.551px;top:414.98px;left:99.5667px;">access-binary-trees</div>
<div class="l f2 s4 c0" style="bottom:369.605px;top:414.379px;left:191.247px;">and</div>
<div class="l f7 s4 c0" style="bottom:369.551px;top:414.98px;left:206.436px;">control-flow-recursive</div>
<div class="l f2 s4 c0" style="bottom:369.605px;top:414.379px;left:309.996px;">,<span class="w w2"> </span>for<span class="w w1"> </span>which<span class="w w1"> </span>we<span class="w w2"> </span>currently<span class="w w1"> </span>don’t<span class="w w2"> </span>generate<span class="w w1"> </span>any<span class="w w1"> </span>native<span class="w w2"> </span>code.</div>
<div class="l f2 s4 c0" style="bottom:339.717px;top:444.267px;left:54px;">In<span class="w w1"> </span>particular,<span class="w w2"> </span>the</div>
<div class="l f7 s4 c0" style="bottom:339.664px;top:444.867px;left:116.139px;">bitops</div>
<div class="l f2 s4 c0" style="bottom:339.717px;top:444.267px;left:146.873px;">benchmarks<span class="w w1"> </span>are<span class="w w2"> </span>short<span class="w w1"> </span>programs<span class="w w1"> </span>that<span class="w w1"> </span>per-</div>
<div class="l f2 s4 c0" style="bottom:329.755px;top:454.229px;left:54px;">form<span class="w w1"> </span>many<span class="w w1"> </span>bitwise<span class="w w1"> </span>operations,<span class="w w1"> </span>so<span class="w w2"> </span>TraceMonkey<span class="w w1"> </span>can<span class="w w1"> </span>cover<span class="w w1"> </span>the<span class="w w1"> </span>en-</div>
<div class="l f2 s4 c0" style="bottom:319.792px;top:464.192px;left:54px;">tire<span class="w w2"> </span>program<span class="w w1"> </span>with<span class="w w1"> </span>1<span class="w w2"> </span>or<span class="w w1"> </span>2<span class="w w2"> </span>traces<span class="w w1"> </span>that<span class="w w1"> </span>operate<span class="w w2"> </span>on<span class="w w1"> </span>integers.<span class="w w2"> </span>TraceMon-</div>
<div class="l f2 s4 c0" style="bottom:309.829px;top:474.155px;left:54px;">key<span class="w w2"> </span>runs<span class="w w1"> </span>all<span class="w w1"> </span>the<span class="w w1"> </span>other<span class="w w2"> </span>programs<span class="w w1"> </span>in<span class="w w1"> </span>this<span class="w w2"> </span>set<span class="w w1"> </span>almost<span class="w w1"> </span>entirely<span class="w w1"> </span>as<span class="w w2"> </span>native</div>
<div class="l f2 s4 c0" style="bottom:299.867px;top:484.117px;left:54px;">code.</div>
<div class="l f7 s4 c0" style="bottom:289.85px;top:494.681px;left:65.9552px;">regexp-dna</div>
<div class="l f2 s4 c0" style="bottom:289.904px;top:494.08px;left:117.726px;">is<span class="w w0"> </span>dominated<span class="w w0"> </span>by<span class="w w0"> </span>regular<span class="w w0"> </span>expression<span class="w w0"> </span>matching,</div>
<div class="l f2 s4 c0" style="bottom:279.942px;top:504.042px;left:54px;">which<span class="w w2"> </span>is<span class="w w1"> </span>implemented<span class="w w1"> </span>in<span class="w w2"> </span>all<span class="w w1"> </span>3<span class="w w1"> </span>VMs<span class="w w2"> </span>by<span class="w w1"> </span>a<span class="w w2"> </span>special<span class="w w1"> </span>regular<span class="w w1"> </span>expression</div>
<div class="l f2 s4 c0" style="bottom:269.979px;top:514.005px;left:54px;">compiler.<span class="w w2"> </span>Thus,<span class="w w1"> </span>performance<span class="w w0"> </span>on<span class="w w2"> </span>this<span class="w w1"> </span>benchmark<span class="w w1"> </span>has<span class="w w1"> </span>little<span class="w w0"> </span>relation</div>
<div class="l f2 s4 c0" style="bottom:260.016px;top:523.968px;left:54px;">to<span class="w w2"> </span>the<span class="w w1"> </span>trace<span class="w w1"> </span>compilation<span class="w w2"> </span>approach<span class="w w1"> </span>discussed<span class="w w1"> </span>in<span class="w w2"> </span>this<span class="w w1"> </span>paper.</div>
<div class="l f2 s4 c0" style="bottom:250.054px;top:533.93px;left:65.9552px;">TraceMonkey’</div>
<div class="l f2 s4 c0" style="bottom:250.054px;top:533.93px;left:118.202px;">s<span class="w w1"> </span>smaller<span class="w w1"> </span>speedups<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w1"> </span>other<span class="w w1"> </span>benchmarks<span class="w w1"> </span>can</div>
<div class="l f2 s4 c0" style="bottom:240.091px;top:543.893px;left:54px;">be<span class="w w2"> </span>attributed<span class="w w1"> </span>to<span class="w w1"> </span>a<span class="w w2"> </span>few<span class="w w1"> </span>specific<span class="w w2"> </span>causes:</div>
<div class="l f3 s3 c0" style="bottom:215.242px;top:569.234px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:213.954px;top:570.03px;left:66.9514px;">The<span class="w w0"> </span>implementation<span class="w w0"> </span>does<span class="w w4"> </span>not<span class="w w0"> </span>currently<span class="w w4"> </span>trace<span class="w w0"> </span>recursion,<span class="w w4"> </span>so</div>
<div class="l f2 s4 c0" style="bottom:203.991px;top:579.993px;left:66.9514px;">TraceMonkey<span class="w w0"> </span>achieves<span class="w w0"> </span>a<span class="w w0"> </span>small<span class="w w0"> </span>speedup<span class="w w0"> </span>or<span class="w w0"> </span>no<span class="w w4"> </span>speedup<span class="w w0"> </span>on</div>
<div class="l f2 s4 c0" style="bottom:194.028px;top:589.956px;left:66.9514px;">benchmarks<span class="w w0"> </span>that<span class="w w4"> </span>use<span class="w w4"> </span>recursion<span class="w w4"> </span>extensively:</div>
<div class="l f7 s4 c0" style="bottom:193.975px;top:590.556px;left:238.471px;">3d-cube</div>
<div class="l f2 s4 c0" style="bottom:194.028px;top:589.956px;left:271.422px;">,</div>
<div class="l f7 s4 c0" style="bottom:193.975px;top:590.556px;left:278.981px;">3d-</div>
<div class="l f7 s4 c0" style="bottom:184.012px;top:600.519px;left:66.9514px;">raytrace</div>
<div class="l f2 s4 c0" style="bottom:184.066px;top:599.918px;left:104.61px;">,</div>
<div class="l f7 s4 c0" style="bottom:184.012px;top:600.519px;left:109.776px;">access-binary-trees</div>
<div class="l f2 s4 c0" style="bottom:184.066px;top:599.918px;left:199.214px;">,</div>
<div class="l f7 s4 c0" style="bottom:184.012px;top:600.519px;left:204.38px;">string-tagcloud</div>
<div class="l f2 s4 c0" style="bottom:184.066px;top:599.918px;left:274.99px;">,<span class="w w1"> </span>and</div>
<div class="l f7 s4 c0" style="bottom:174.049px;top:610.482px;left:66.9514px;">controlflow-recursive</div>
<div class="l f2 s4 c0" style="bottom:174.103px;top:609.881px;left:165.805px;">.</div>
<div class="l f3 s3 c0" style="bottom:161.444px;top:623.032px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:160.155px;top:623.829px;left:66.9514px;">The<span class="w w1"> </span>implementation<span class="w w0"> </span>does<span class="w w1"> </span>not<span class="w w0"> </span>currently<span class="w w1"> </span>trace</div>
<div class="l f7 s4 c0" style="bottom:160.102px;top:624.429px;left:235.516px;">eval</div>
<div class="l f2 s4 c0" style="bottom:160.155px;top:623.829px;left:257.787px;">and<span class="w w1"> </span>some</div>
<div class="l f2 s4 c0" style="bottom:150.193px;top:633.791px;left:66.9514px;">other<span class="w w0"> </span>functions<span class="w w0"> </span>implemented<span class="w w0"> </span>in<span class="w w0"> </span>C.<span class="w w1"> </span>Because</div>
<div class="l f7 s4 c0" style="bottom:150.139px;top:634.392px;left:236.616px;">date-format-</div>
<div class="l f7 s4 c0" style="bottom:140.176px;top:644.355px;left:66.9514px;">tofte</div>
<div class="l f2 s4 c0" style="bottom:140.23px;top:643.754px;left:93.9841px;">and</div>
<div class="l f7 s4 c0" style="bottom:140.176px;top:644.355px;left:110.428px;">date-format-xparb</div>
<div class="l f2 s4 c0" style="bottom:140.23px;top:643.754px;left:193.948px;">use<span class="w w1"> </span>such<span class="w w0"> </span>functions<span class="w w1"> </span>in<span class="w w0"> </span>their</div>
<div class="l f2 s4 c0" style="bottom:130.267px;top:653.717px;left:66.9514px;">main<span class="w w2"> </span>loops,<span class="w w1"> </span>we<span class="w w1"> </span>do<span class="w w2"> </span>not<span class="w w1"> </span>trace<span class="w w1"> </span>them.</div>
<div class="l f3 s3 c0" style="bottom:117.609px;top:666.868px;left:59.2303px;">•</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:66.9514px;">The<span class="w w1"> </span>implementation<span class="w w0"> </span>does<span class="w w1"> </span>not<span class="w w0"> </span>currently<span class="w w1"> </span>trace<span class="w w0"> </span>through<span class="w w1"> </span>regular</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:66.9514px;">expression</div>
<div class="l f7 s4 c0" style="bottom:106.303px;top:678.228px;left:108.704px;">replace</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:145.194px;">operations.<span class="w w1"> </span>The<span class="w w0"> </span>replace<span class="w w1"> </span>function<span class="w w0"> </span>can<span class="w w1"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:66.9514px;">passed<span class="w w1"> </span>a<span class="w w2"> </span>function<span class="w w1"> </span>object<span class="w w1"> </span>used<span class="w w1"> </span>to<span class="w w2"> </span>compute<span class="w w1"> </span>the<span class="w w1"> </span>replacement<span class="w w1"> </span>text.</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:66.9514px;">Our<span class="w w1"> </span>implementation<span class="w w0"> </span>currently<span class="w w1"> </span>does<span class="w w1"> </span>not<span class="w w0"> </span>trace<span class="w w1"> </span>functions<span class="w w1"> </span>called</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:66.9514px;">as<span class="w w2"> </span>replace<span class="w w1"> </span>functions.<span class="w w2"> </span>The<span class="w w1"> </span>run<span class="w w1"> </span>time<span class="w w2"> </span>of</div>
<div class="l f7 s4 c0" style="bottom:76.4155px;top:708.116px;left:200.246px;">string-unpack-code</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:287.123px;">is</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:66.9514px;">dominated<span class="w w2"> </span>by<span class="w w1"> </span>such<span class="w w1"> </span>a</div>
<div class="l f7 s4 c0" style="bottom:66.4528px;top:718.078px;left:143.156px;">replace</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:178.349px;">call.</div>
<div class="l f3 s3 c0" style="bottom:341.006px;top:443.47px;left:322.244px;">•</div>
<div class="l f2 s4 c0" style="bottom:339.717px;top:444.267px;left:329.965px;">Two<span class="w w1"> </span>programs<span class="w w1"> </span>trace<span class="w w0"> </span>well,<span class="w w0"> </span>but<span class="w w1"> </span>have<span class="w w1"> </span>a<span class="w w0"> </span>long<span class="w w1"> </span>compilation<span class="w w0"> </span>time.</div>
<div class="l f7 s4 c0" style="bottom:329.701px;top:454.83px;left:329.965px;">access-nbody</div>
<div class="l f2 s4 c0" style="bottom:329.755px;top:454.229px;left:388.156px;">forms<span class="w w2"> </span>a<span class="w w2"> </span>large<span class="w w2"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>traces<span class="w w2"> </span>(81).</div>
<div class="l f7 s4 c0" style="bottom:329.701px;top:454.83px;left:515.693px;">crypto-md5</div>
<div class="l f2 s4 c0" style="bottom:319.792px;top:464.192px;left:329.965px;">forms<span class="w w1"> </span>one<span class="w w1"> </span>very<span class="w w2"> </span>long<span class="w w1"> </span>trace.<span class="w w1"> </span>We<span class="w w1"> </span>expect<span class="w w1"> </span>to<span class="w w1"> </span>improve<span class="w w2"> </span>performance</div>
<div class="l f2 s4 c0" style="bottom:309.829px;top:474.155px;left:329.965px;">on<span class="w w1"> </span>this<span class="w w2"> </span>programs<span class="w w1"> </span>by<span class="w w1"> </span>improving<span class="w w1"> </span>the<span class="w w2"> </span>compilation<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w1"> </span>nano-</div>
<div class="l f2 s4 c0" style="bottom:299.867px;top:484.117px;left:329.965px;">jit.</div>
<div class="l f3 s3 c0" style="bottom:287.208px;top:497.268px;left:322.244px;">•</div>
<div class="l f2 s4 c0" style="bottom:285.919px;top:498.065px;left:329.965px;">Some<span class="w w0"> </span>programs<span class="w w1"> </span>trace<span class="w w0"> </span>very<span class="w w0"> </span>well,<span class="w w0"> </span>and<span class="w w1"> </span>speed<span class="w w0"> </span>up<span class="w w0"> </span>compared<span class="w w0"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:275.957px;top:508.027px;left:329.965px;">the<span class="w w1"> </span>interpreter,<span class="w w1"> </span>but<span class="w w1"> </span>are<span class="w w0"> </span>not<span class="w w1"> </span>as<span class="w w1"> </span>fast<span class="w w0"> </span>as<span class="w w1"> </span>SFX<span class="w w1"> </span>and/or<span class="w w1"> </span>V8,<span class="w w0"> </span>namely</div>
<div class="l f7 s4 c0" style="bottom:265.94px;top:518.591px;left:329.965px;">bitops-bits-in-byte</div>
<div class="l f2 s4 c0" style="bottom:265.994px;top:517.99px;left:419.404px;">,</div>
<div class="l f7 s4 c0" style="bottom:265.94px;top:518.591px;left:428.919px;">bitops-nsieve-bits</div>
<div class="l f2 s4 c0" style="bottom:265.994px;top:517.99px;left:513.65px;">,</div>
<div class="l f7 s4 c0" style="bottom:265.94px;top:518.591px;left:523.166px;">access-</div>
<div class="l f7 s4 c0" style="bottom:255.977px;top:528.554px;left:329.965px;">fannkuch</div>
<div class="l f2 s4 c0" style="bottom:256.031px;top:527.953px;left:367.623px;">,</div>
<div class="l f7 s4 c0" style="bottom:255.977px;top:528.554px;left:372.736px;">access-nsieve</div>
<div class="l f2 s4 c0" style="bottom:256.031px;top:527.953px;left:433.931px;">,<span class="w w1"> </span>and</div>
<div class="l f7 s4 c0" style="bottom:255.977px;top:528.554px;left:454.863px;">crypto-aes</div>
<div class="l f2 s4 c0" style="bottom:256.031px;top:527.953px;left:501.936px;">.<span class="w w1"> </span>The<span class="w w1"> </span>reason<span class="w w1"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:246.069px;top:537.915px;left:329.965px;">not<span class="w w0"> </span>clear,<span class="w w1"> </span>but<span class="w w0"> </span>all<span class="w w0"> </span>of<span class="w w1"> </span>these<span class="w w0"> </span>programs<span class="w w0"> </span>have<span class="w w1"> </span>nested<span class="w w0"> </span>loops<span class="w w0"> </span>with</div>
<div class="l f2 s4 c0" style="bottom:236.106px;top:547.878px;left:329.965px;">small<span class="w w2"> </span>bodies,<span class="w w1"> </span>so<span class="w w1"> </span>we<span class="w w1"> </span>suspect<span class="w w2"> </span>that<span class="w w1"> </span>the<span class="w w1"> </span>implementation<span class="w w2"> </span>has<span class="w w1"> </span>a<span class="w w1"> </span>rela-</div>
<div class="l f2 s4 c0" style="bottom:226.143px;top:557.841px;left:329.965px;">tively<span class="w w2"> </span>high<span class="w w1"> </span>cost<span class="w w2"> </span>for<span class="w w1"> </span>calling<span class="w w2"> </span>nested<span class="w w1"> </span>traces.</div>
<div class="l f7 s4 c0" style="bottom:226.09px;top:558.441px;left:476.548px;">string-fasta</div>
<div class="l f2 s4 c0" style="bottom:226.143px;top:557.841px;left:535.208px;">traces</div>
<div class="l f2 s4 c0" style="bottom:216.181px;top:567.803px;left:329.965px;">well,<span class="w w2"> </span>but<span class="w w1"> </span>its<span class="w w2"> </span>run<span class="w w1"> </span>time<span class="w w2"> </span>is<span class="w w2"> </span>dominated<span class="w w1"> </span>by<span class="w w2"> </span>string<span class="w w1"> </span>processing<span class="w w2"> </span>builtins,</div>
<div class="l f2 s4 c0" style="bottom:206.218px;top:577.766px;left:329.965px;">which<span class="w w2"> </span>are<span class="w w1"> </span>unaffected<span class="w w1"> </span>by<span class="w w2"> </span>tracing<span class="w w1"> </span>and<span class="w w1"> </span>seem<span class="w w2"> </span>to<span class="w w1"> </span>be<span class="w w1"> </span>less<span class="w w2"> </span>efficient<span class="w w1"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:196.255px;top:587.729px;left:329.965px;">SpiderMonkey<span class="w w2"> </span>than<span class="w w1"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>two<span class="w w1"> </span>other<span class="w w2"> </span>VMs.</div>
<div class="l f1 s4 c0" style="bottom:176.158px;top:607.781px;left:328.969px;">Detailed<span class="w w2"> </span>performance<span class="w w1"> </span>metrics.</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:446.769px;">In<span class="w w2"> </span>Figure<span class="w w1"> </span>11<span class="w w2"> </span>we<span class="w w1"> </span>show<span class="w w2"> </span>the<span class="w w1"> </span>frac-</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:317.014px;">tion<span class="w w2"> </span>of<span class="w w1"> </span>instructions<span class="w w1"> </span>interpreted<span class="w w2"> </span>and<span class="w w1"> </span>the<span class="w w1"> </span>fraction<span class="w w1"> </span>of<span class="w w2"> </span>instructions<span class="w w1"> </span>exe-</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:317.014px;">cuted<span class="w w2"> </span>as<span class="w w1"> </span>native<span class="w w2"> </span>code.<span class="w w2"> </span>This<span class="w w1"> </span>figure<span class="w w2"> </span>shows<span class="w w1"> </span>that<span class="w w2"> </span>for<span class="w w1"> </span>many<span class="w w2"> </span>programs,<span class="w w2"> </span>we</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">are<span class="w w2"> </span>able<span class="w w1"> </span>to<span class="w w1"> </span>execute<span class="w w2"> </span>almost<span class="w w1"> </span>all<span class="w w2"> </span>the<span class="w w1"> </span>code<span class="w w1"> </span>natively</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:483.636px;">.</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:328.969px;">Figure<span class="w w1"> </span>12<span class="w w2"> </span>breaks<span class="w w1"> </span>down<span class="w w1"> </span>the<span class="w w1"> </span>total<span class="w w1"> </span>execution<span class="w w2"> </span>time<span class="w w1"> </span>into<span class="w w1"> </span>four<span class="w w1"> </span>activ-</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">ities:<span class="w w1"> </span>interpreting<span class="w w1"> </span>bytecodes<span class="w w1"> </span>while<span class="w w1"> </span>not<span class="w w0"> </span>recording,<span class="w w2"> </span>recording<span class="w w0"> </span>traces</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:317.014px;">(including<span class="w w1"> </span>time<span class="w w0"> </span>taken<span class="w w1"> </span>to<span class="w w0"> </span>interpret<span class="w w1"> </span>the<span class="w w0"> </span>recorded<span class="w w1"> </span>trace),<span class="w w0"> </span>compiling</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">traces<span class="w w2"> </span>to<span class="w w1"> </span>native<span class="w w2"> </span>code,<span class="w w1"> </span>and<span class="w w1"> </span>executing<span class="w w2"> </span>native<span class="w w2"> </span>code<span class="w w1"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:96.3946px;top:687.589px;left:328.969px;">These<span class="w w1"> </span>detailed<span class="w w0"> </span>metrics<span class="w w1"> </span>allow<span class="w w0"> </span>us<span class="w w1"> </span>to<span class="w w0"> </span>estimate<span class="w w1"> </span>parameters<span class="w w0"> </span>for<span class="w w1"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">simple<span class="w w1"> </span>model<span class="w w1"> </span>of<span class="w w0"> </span>tracing<span class="w w1"> </span>performance.<span class="w w1"> </span>These<span class="w w0"> </span>estimates<span class="w w1"> </span>should<span class="w w1"> </span>be</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:317.014px;">considered<span class="w w1"> </span>very<span class="w w0"> </span>rough,<span class="w w1"> </span>as<span class="w w0"> </span>the<span class="w w1"> </span>values<span class="w w1"> </span>observed<span class="w w0"> </span>on<span class="w w1"> </span>the<span class="w w0"> </span>individual</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:317.014px;">benchmarks<span class="w w0"> </span>hav</div>
<div class="l f2 s4 c0" style="bottom:66.5067px;top:717.477px;left:376.766px;">e<span class="w w0"> </span>large<span class="w w1"> </span>standard<span class="w w0"> </span>deviations<span class="w w1"> </span>(on<span class="w w0"> </span>the<span class="w w1"> </span>order<span class="w w0"> </span>of<span class="w w0"> </span>the</div>
</div>
<div id="page-12" class="p" style="width:612px;height:792px;background-image:url(pc.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f2 s4 c0" style="bottom:711.089px;top:72.8946px;left:166.563px;">Loops<span class="w w3"> </span>Trees<span class="w w14"> </span>Traces<span class="w w3"> </span>Aborts<span class="w w14"> </span>Flushes<span class="w w3"> </span>Trees/Loop<span class="w w14"> </span>Traces/Tree<span class="w w3"> </span>Traces/Loop<span class="w w14"> </span>Speedup</div>
<div class="l f2 s4 c0" style="bottom:700.728px;top:83.2558px;left:71.4192px;">3d-cube<span class="w w15"> </span>25<span class="w w6"> </span>27<span class="w w13"> </span>29<span class="w w16"> </span>3<span class="w w17"> </span>0<span class="w w18"> </span>1.1<span class="w wc"> </span>1.1<span class="w w19"> </span>1.2<span class="w w6"> </span>2.20x</div>
<div class="l f2 s4 c0" style="bottom:690.766px;top:93.2184px;left:71.4192px;">3d-morph<span class="w w1a"> </span>5<span class="w w13"> </span>8<span class="w w16"> </span>8<span class="w wf"> </span>2<span class="w wf"> </span>0<span class="w w18"> </span>1.6<span class="w wc"> </span>1.0<span class="w w19"> </span>1.6<span class="w w6"> </span>2.86x</div>
<div class="l f2 s4 c0" style="bottom:680.803px;top:103.181px;left:71.4192px;">3d-raytrace<span class="w w1b"> </span>10<span class="w w6"> </span>25<span class="w w12"> </span>100<span class="w w1c"> </span>10<span class="w w17"> </span>1<span class="w w18"> </span>2.5<span class="w wc"> </span>4.0<span class="w w18"> </span>10.0<span class="w w1d"> </span>1.18x</div>
<div class="l f2 s4 c0" style="bottom:670.84px;top:113.144px;left:71.4192px;">access-binary-trees<span class="w w1e"> </span>0<span class="w w13"> </span>0<span class="w w16"> </span>0<span class="w wf"> </span>5<span class="w wf"> </span>0<span class="w w1f"> </span>-<span class="w w1f"> </span>-<span class="w w20"> </span>-<span class="w w1d"> </span>0.93x</div>
<div class="l f2 s4 c0" style="bottom:660.878px;top:123.106px;left:71.4192px;">access-fannkuch<span class="w w21"> </span>10<span class="w w1d"> </span>34<span class="w w13"> </span>57<span class="w w1c"> </span>24<span class="w w17"> </span>0<span class="w w18"> </span>3.4<span class="w wc"> </span>1.7<span class="w w19"> </span>5.7<span class="w w1d"> </span>2.20x</div>
<div class="l f2 s4 c0" style="bottom:650.915px;top:133.069px;left:71.4192px;">access-nbody<span class="w w22"> </span>8<span class="w w1d"> </span>16<span class="w w13"> </span>18<span class="w w23"> </span>5<span class="w w17"> </span>0<span class="w w18"> </span>2.0<span class="w wc"> </span>1.1<span class="w w19"> </span>2.3<span class="w w1d"> </span>4.19x</div>
<div class="l f2 s4 c0" style="bottom:640.952px;top:143.032px;left:71.4192px;">access-nsieve<span class="w w22"> </span>3<span class="w w13"> </span>6<span class="w w16"> </span>8<span class="w w16"> </span>3<span class="w w17"> </span>0<span class="w w18"> </span>2.0<span class="w w1e"> </span>1.3<span class="w w1e"> </span>2.7<span class="w w6"> </span>3.05x</div>
<div class="l f2 s4 c0" style="bottom:630.99px;top:152.994px;left:71.4192px;">bitops-3bit-bits-in-byte<span class="w w24"> </span>2<span class="w w13"> </span>2<span class="w w16"> </span>2<span class="w w23"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>1.0<span class="w w19"> </span>1.0<span class="w w11"> </span>25.47x</div>
<div class="l f2 s4 c0" style="bottom:621.027px;top:162.957px;left:71.4192px;">bitops-bits-in-byte<span class="w w19"> </span>3<span class="w w1c"> </span>3<span class="w w16"> </span>4<span class="w w23"> </span>1<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>1.3<span class="w w19"> </span>1.3<span class="w w1d"> </span>8.67x</div>
<div class="l f2 s4 c0" style="bottom:611.065px;top:172.919px;left:71.4192px;">bitops-bitwise-and<span class="w w19"> </span>1<span class="w w1c"> </span>1<span class="w w16"> </span>1<span class="w w16"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>1.0<span class="w w19"> </span>1.0<span class="w w11"> </span>25.20x</div>
<div class="l f2 s4 c0" style="bottom:601.102px;top:182.882px;left:71.4192px;">bitops-nsieve-bits<span class="w w21"> </span>3<span class="w w13"> </span>3<span class="w w16"> </span>5<span class="w w23"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>1.7<span class="w w19"> </span>1.7<span class="w w1d"> </span>2.75x</div>
<div class="l f2 s4 c0" style="bottom:591.139px;top:192.845px;left:71.4192px;">controlflow-recursive<span class="w w25"> </span>0<span class="w w13"> </span>0<span class="w w16"> </span>0<span class="w w23"> </span>1<span class="w w17"> </span>0<span class="w w21"> </span>-<span class="w w8"> </span>-<span class="w w20"> </span>-<span class="w w12"> </span>0.98x</div>
<div class="l f2 s4 c0" style="bottom:581.177px;top:202.807px;left:71.4192px;">crypto-aes<span class="w we"> </span>50<span class="w w1d"> </span>72<span class="w w13"> </span>78<span class="w w1c"> </span>19<span class="w w17"> </span>0<span class="w w18"> </span>1.4<span class="w wc"> </span>1.1<span class="w w19"> </span>1.6<span class="w w6"> </span>1.64x</div>
<div class="l f2 s4 c0" style="bottom:571.214px;top:212.77px;left:71.4192px;">crypto-md5<span class="w we"> </span>4<span class="w w1c"> </span>4<span class="w w16"> </span>5<span class="w w16"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>1.3<span class="w w19"> </span>1.3<span class="w w1d"> </span>2.30x</div>
<div class="l f2 s4 c0" style="bottom:561.251px;top:222.733px;left:71.4192px;">crypto-sha1<span class="w we"> </span>5<span class="w w13"> </span>5<span class="w w13"> </span>10<span class="w w23"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>2.0<span class="w w19"> </span>2.0<span class="w w1d"> </span>5.95x</div>
<div class="l f2 s4 c0" style="bottom:551.289px;top:232.695px;left:71.4192px;">date-format-tofte<span class="w w8"> </span>3<span class="w w13"> </span>3<span class="w w16"> </span>4<span class="w w16"> </span>7<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w w1e"> </span>1.3<span class="w w1e"> </span>1.3<span class="w w6"> </span>1.07x</div>
<div class="l f2 s4 c0" style="bottom:541.326px;top:242.658px;left:71.4192px;">date-format-xparb<span class="w w9"> </span>3<span class="w w13"> </span>3<span class="w w13"> </span>11<span class="w w23"> </span>3<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>3.7<span class="w w19"> </span>3.7<span class="w w1d"> </span>0.98x</div>
<div class="l f2 s4 c0" style="bottom:531.363px;top:252.621px;left:71.4192px;">math-cordic<span class="w w26"> </span>2<span class="w w13"> </span>4<span class="w w16"> </span>5<span class="w w23"> </span>1<span class="w w17"> </span>0<span class="w w18"> </span>2.0<span class="w wc"> </span>1.3<span class="w w19"> </span>2.5<span class="w w1d"> </span>4.92x</div>
<div class="l f2 s4 c0" style="bottom:521.401px;top:262.583px;left:71.4192px;">math-partial-sums<span class="w w9"> </span>2<span class="w w13"> </span>4<span class="w w16"> </span>4<span class="w w23"> </span>1<span class="w w17"> </span>0<span class="w w18"> </span>2.0<span class="w wc"> </span>1.0<span class="w w19"> </span>2.0<span class="w w1d"> </span>5.90x</div>
<div class="l f2 s4 c0" style="bottom:511.438px;top:272.546px;left:71.4192px;">math-spectral-norm<span class="w wa"> </span>15<span class="w w12"> </span>20<span class="w w1c"> </span>20<span class="w w16"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.3<span class="w wc"> </span>1.0<span class="w w19"> </span>1.3<span class="w w6"> </span>7.12x</div>
<div class="l f2 s4 c0" style="bottom:501.475px;top:282.509px;left:71.4192px;">regexp-dna<span class="w w27"> </span>2<span class="w w13"> </span>2<span class="w w16"> </span>2<span class="w w23"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w wc"> </span>1.0<span class="w w19"> </span>1.0<span class="w w1d"> </span>4.21x</div>
<div class="l f2 s4 c0" style="bottom:491.513px;top:292.471px;left:71.4192px;">string-base64<span class="w w22"> </span>3<span class="w w13"> </span>5<span class="w w16"> </span>7<span class="w w23"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.7<span class="w wc"> </span>1.4<span class="w w19"> </span>2.3<span class="w w1d"> </span>2.53x</div>
<div class="l f2 s4 c0" style="bottom:481.55px;top:302.434px;left:71.4192px;">string-fasta<span class="w w27"> </span>5<span class="w w1d"> </span>11<span class="w w13"> </span>15<span class="w w23"> </span>6<span class="w w17"> </span>0<span class="w w18"> </span>2.2<span class="w wc"> </span>1.4<span class="w w19"> </span>3.0<span class="w w1d"> </span>1.49x</div>
<div class="l f2 s4 c0" style="bottom:471.588px;top:312.396px;left:71.4192px;">string-tagcloud<span class="w w28"> </span>3<span class="w w13"> </span>6<span class="w w16"> </span>6<span class="w w23"> </span>5<span class="w w17"> </span>0<span class="w w18"> </span>2.0<span class="w wc"> </span>1.0<span class="w w19"> </span>2.0<span class="w w1d"> </span>1.09x</div>
<div class="l f2 s4 c0" style="bottom:461.625px;top:322.359px;left:71.4192px;">string-unpack-code<span class="w w1e"> </span>4<span class="w w13"> </span>4<span class="w w13"> </span>37<span class="w w23"> </span>0<span class="w w17"> </span>0<span class="w w18"> </span>1.0<span class="w w18"> </span>9.3<span class="w w19"> </span>9.3<span class="w w6"> </span>1.20x</div>
<div class="l f2 s4 c0" style="bottom:451.662px;top:332.322px;left:71.4192px;">string-validate-input<span class="w w29"> </span>6<span class="w w1d"> </span>10<span class="w w13"> </span>13<span class="w w23"> </span>1<span class="w w17"> </span>0<span class="w w18"> </span>1.7<span class="w wc"> </span>1.3<span class="w w19"> </span>2.2<span class="w w1d"> </span>1.86x</div>
<div class="l f1 s4 c0" style="bottom:427.286px;top:356.653px;left:161.455px;">Figure<span class="w w2"> </span>13.</div>
<div class="l f2 s4 c0" style="bottom:427.223px;top:356.761px;left:204.628px;">Detailed<span class="w w2"> </span>trace<span class="w w1"> </span>recording<span class="w w1"> </span>statistics<span class="w w2"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>SunSpider<span class="w w2"> </span>benchmark<span class="w w1"> </span>set.</div>
<div class="l f2 s4 c0" style="bottom:397.386px;top:386.598px;left:54px;">mean).<span class="w w1"> </span>We<span class="w w2"> </span>exclude</div>
<div class="l f7 s4 c0" style="bottom:397.333px;top:387.198px;left:126.612px;">regexp-dna</div>
<div class="l f2 s4 c0" style="bottom:397.386px;top:386.598px;left:176.513px;">from<span class="w w1"> </span>the<span class="w w1"> </span>following<span class="w w1"> </span>calculations,</div>
<div class="l f2 s4 c0" style="bottom:387.424px;top:396.56px;left:54px;">because<span class="w w2"> </span>most<span class="w w1"> </span>of<span class="w w1"> </span>its<span class="w w2"> </span>time<span class="w w1"> </span>is<span class="w w2"> </span>spent<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>regular<span class="w w1"> </span>expression<span class="w w2"> </span>matcher,</div>
<div class="l f2 s4 c0" style="bottom:377.461px;top:406.523px;left:54px;">which<span class="w w0"> </span>has<span class="w w0"> </span>much<span class="w w0"> </span>different<span class="w w1"> </span>performance<span class="w w0"> </span>characteristics<span class="w w0"> </span>from<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:367.498px;top:416.486px;left:54px;">other<span class="w w1"> </span>programs.<span class="w w1"> </span>(Note<span class="w w0"> </span>that<span class="w w1"> </span>this<span class="w w1"> </span>only<span class="w w1"> </span>makes<span class="w w0"> </span>a<span class="w w1"> </span>difference<span class="w w1"> </span>of<span class="w w1"> </span>about</div>
<div class="l f2 s4 c0" style="bottom:357.536px;top:426.448px;left:54px;">10%<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w2"> </span>results.)<span class="w w1"> </span>Dividing<span class="w w1"> </span>the<span class="w w1"> </span>total<span class="w w1"> </span>execution<span class="w w2"> </span>time<span class="w w1"> </span>in<span class="w w1"> </span>processor</div>
<div class="l f2 s4 c0" style="bottom:347.573px;top:436.411px;left:54px;">clock<span class="w w0"> </span>cycles<span class="w w1"> </span>by<span class="w w0"> </span>the<span class="w w0"> </span>number<span class="w w0"> </span>of<span class="w w0"> </span>bytecodes<span class="w w1"> </span>executed<span class="w w0"> </span>in<span class="w w0"> </span>the<span class="w w0"> </span>base</div>
<div class="l f2 s4 c0" style="bottom:337.611px;top:446.373px;left:54px;">interpreter<span class="w w1"> </span>shows<span class="w w0"> </span>that<span class="w w1"> </span>on<span class="w w0"> </span>average,<span class="w w1"> </span>a<span class="w w0"> </span>bytecode<span class="w w0"> </span>executes<span class="w w1"> </span>in<span class="w w0"> </span>about</div>
<div class="l f2 s4 c0" style="bottom:327.648px;top:456.336px;left:54px;">35<span class="w w1"> </span>cycles.<span class="w w1"> </span>Native<span class="w w1"> </span>traces<span class="w w1"> </span>take<span class="w w0"> </span>about<span class="w w1"> </span>9<span class="w w1"> </span>cycles<span class="w w1"> </span>per<span class="w w1"> </span>bytecode,<span class="w w1"> </span>a<span class="w w0"> </span>3.9x</div>
<div class="l f2 s4 c0" style="bottom:317.685px;top:466.299px;left:54px;">speedup<span class="w w2"> </span>over<span class="w w1"> </span>the<span class="w w2"> </span>interpreter.</div>
<div class="l f2 s4 c0" style="bottom:307.723px;top:476.261px;left:65.9552px;">Using<span class="w w1"> </span>similar<span class="w w1"> </span>computations,<span class="w w1"> </span>we<span class="w w1"> </span>find<span class="w w1"> </span>that<span class="w w1"> </span>trace<span class="w w1"> </span>recording<span class="w w1"> </span>takes</div>
<div class="l f2 s4 c0" style="bottom:297.76px;top:486.224px;left:54px;">about<span class="w w1"> </span>3800<span class="w w1"> </span>cycles<span class="w w1"> </span>per<span class="w w1"> </span>bytecode,<span class="w w1"> </span>and<span class="w w1"> </span>compilation<span class="w w1"> </span>3150<span class="w w1"> </span>cycles<span class="w w1"> </span>per</div>
<div class="l f2 s4 c0" style="bottom:287.797px;top:496.187px;left:54px;">bytecode.<span class="w w1"> </span>Hence,<span class="w w1"> </span>during<span class="w w1"> </span>recording<span class="w w1"> </span>and<span class="w w1"> </span>compiling<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w1"> </span>runs<span class="w w1"> </span>at</div>
<div class="l f2 s4 c0" style="bottom:277.835px;top:506.149px;left:54px;">1/200<span class="w w1"> </span>the<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>interpreter.<span class="w w2"> </span>Because<span class="w w1"> </span>it<span class="w w1"> </span>costs<span class="w w1"> </span>6950<span class="w w1"> </span>cycles<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:267.872px;top:516.112px;left:54px;">compile<span class="w w1"> </span>a<span class="w w1"> </span>bytecode,<span class="w w1"> </span>and<span class="w w1"> </span>we<span class="w w1"> </span>save<span class="w w2"> </span>26<span class="w w1"> </span>cycles<span class="w w1"> </span>each<span class="w w1"> </span>time<span class="w w1"> </span>that<span class="w w1"> </span>code<span class="w w1"> </span>is</div>
<div class="l f2 s4 c0" style="bottom:257.909px;top:526.075px;left:54px;">run<span class="w w2"> </span>natively,<span class="w w2"> </span>we<span class="w w1"> </span>break<span class="w w1"> </span>even<span class="w w2"> </span>after<span class="w w1"> </span>running<span class="w w2"> </span>a<span class="w w1"> </span>trace<span class="w w2"> </span>270<span class="w w1"> </span>times.</div>
<div class="l f2 s4 c0" style="bottom:247.947px;top:536.037px;left:65.9552px;">The<span class="w w1"> </span>other<span class="w w1"> </span>VMs<span class="w w1"> </span>we<span class="w w1"> </span>compared<span class="w w1"> </span>with<span class="w w1"> </span>achieve<span class="w w1"> </span>an<span class="w w1"> </span>overall<span class="w w1"> </span>speedup</div>
<div class="l f2 s4 c0" style="bottom:237.984px;top:546px;left:54px;">of<span class="w w1"> </span>3.0x<span class="w w0"> </span>relative<span class="w w1"> </span>to<span class="w w0"> </span>our<span class="w w1"> </span>baseline<span class="w w0"> </span>interpreter</div>
<div class="l f2 s4 c0" style="bottom:237.984px;top:546px;left:210.284px;">.<span class="w w1"> </span>Our<span class="w w0"> </span>estimated<span class="w w1"> </span>native</div>
<div class="l f2 s4 c0" style="bottom:228.022px;top:555.962px;left:54px;">code<span class="w w0"> </span>speedup<span class="w w0"> </span>of<span class="w w1"> </span>3.9x<span class="w w0"> </span>is<span class="w w0"> </span>significantly<span class="w w0"> </span>better.<span class="w w1"> </span>This<span class="w w0"> </span>suggests<span class="w w0"> </span>that</div>
<div class="l f2 s4 c0" style="bottom:218.059px;top:565.925px;left:54px;">our<span class="w w2"> </span>compilation<span class="w w1"> </span>techniques<span class="w w2"> </span>can<span class="w w1"> </span>generate<span class="w w1"> </span>more<span class="w w2"> </span>efficient<span class="w w2"> </span>native<span class="w w1"> </span>code</div>
<div class="l f2 s4 c0" style="bottom:208.096px;top:575.888px;left:54px;">than<span class="w w2"> </span>any<span class="w w1"> </span>other<span class="w w1"> </span>current<span class="w w2"> </span>JavaScript<span class="w w1"> </span>VM.</div>
<div class="l f2 s4 c0" style="bottom:198.134px;top:585.85px;left:65.9552px;">These<span class="w w2"> </span>estimates<span class="w w2"> </span>also<span class="w w1"> </span>indicate<span class="w w2"> </span>that<span class="w w2"> </span>our<span class="w w1"> </span>startup<span class="w w2"> </span>performance<span class="w w2"> </span>could</div>
<div class="l f2 s4 c0" style="bottom:188.171px;top:595.813px;left:54px;">be<span class="w w1"> </span>substantially<span class="w w2"> </span>better<span class="w w1"> </span>if<span class="w w1"> </span>we<span class="w w1"> </span>improved<span class="w w2"> </span>the<span class="w w1"> </span>speed<span class="w w1"> </span>of<span class="w w2"> </span>trace<span class="w w1"> </span>recording</div>
<div class="l f2 s4 c0" style="bottom:178.208px;top:605.776px;left:54px;">and<span class="w w1"> </span>compilation.<span class="w w1"> </span>The<span class="w w2"> </span>estimated<span class="w w1"> </span>200x<span class="w w1"> </span>slowdown<span class="w w1"> </span>for<span class="w w1"> </span>recording<span class="w w1"> </span>and</div>
<div class="l f2 s4 c0" style="bottom:168.246px;top:615.738px;left:54px;">compilation<span class="w w2"> </span>is<span class="w w1"> </span>very<span class="w w2"> </span>rough,<span class="w w2"> </span>and<span class="w w1"> </span>may<span class="w w2"> </span>be<span class="w w1"> </span>influenced<span class="w w2"> </span>by<span class="w w2"> </span>startup<span class="w w1"> </span>factors</div>
<div class="l f2 s4 c0" style="bottom:158.283px;top:625.701px;left:54px;">in<span class="w w1"> </span>the<span class="w w2"> </span>interpreter<span class="w w1"> </span>(e.g.,<span class="w w1"> </span>caches<span class="w w1"> </span>that<span class="w w1"> </span>have<span class="w w1"> </span>not<span class="w w2"> </span>warmed<span class="w w1"> </span>up<span class="w w1"> </span>yet<span class="w w1"> </span>during</div>
<div class="l f2 s4 c0" style="bottom:148.32px;top:635.664px;left:54px;">recording).<span class="w w1"> </span>One<span class="w w0"> </span>observation<span class="w w1"> </span>supporting<span class="w w0"> </span>this<span class="w w1"> </span>conjecture<span class="w w1"> </span>is<span class="w w0"> </span>that<span class="w w1"> </span>in</div>
<div class="l f2 s4 c0" style="bottom:138.358px;top:645.626px;left:54px;">the<span class="w w2"> </span>tracer,<span class="w w1"> </span>interpreted<span class="w w2"> </span>bytecodes<span class="w w1"> </span>take<span class="w w1"> </span>about<span class="w w2"> </span>180<span class="w w1"> </span>cycles<span class="w w2"> </span>to<span class="w w1"> </span>run.<span class="w w1"> </span>Still,</div>
<div class="l f2 s4 c0" style="bottom:128.395px;top:655.589px;left:54px;">recording<span class="w w1"> </span>and<span class="w w2"> </span>compilation<span class="w w1"> </span>are<span class="w w1"> </span>clearly<span class="w w1"> </span>both<span class="w w1"> </span>expensive,<span class="w w2"> </span>and<span class="w w1"> </span>a<span class="w w1"> </span>better</div>
<div class="l f2 s4 c0" style="bottom:118.432px;top:665.552px;left:54px;">implementation,<span class="w w1"> </span>possibly<span class="w w0"> </span>including<span class="w w0"> </span>redesign<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w1"> </span>LIR<span class="w w0"> </span>abstract</div>
<div class="l f2 s4 c0" style="bottom:108.47px;top:675.514px;left:54px;">syntax<span class="w w2"> </span>or<span class="w w1"> </span>encoding,<span class="w w1"> </span>would<span class="w w2"> </span>improve<span class="w w1"> </span>startup<span class="w w2"> </span>performance.</div>
<div class="l f2 s4 c0" style="bottom:98.5072px;top:685.477px;left:65.9552px;">Our<span class="w w1"> </span>performance<span class="w w1"> </span>results<span class="w w1"> </span>confirm<span class="w w1"> </span>that<span class="w w1"> </span>type<span class="w w1"> </span>specialization<span class="w w1"> </span>using</div>
<div class="l f2 s4 c0" style="bottom:88.5446px;top:695.439px;left:54px;">trace<span class="w w0"> </span>trees<span class="w w0"> </span>substantially<span class="w w0"> </span>improves<span class="w w1"> </span>performance.<span class="w w0"> </span>We<span class="w w0"> </span>are<span class="w w0"> </span>able<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:78.582px;top:705.402px;left:54px;">outperform<span class="w w1"> </span>the<span class="w w1"> </span>fastest<span class="w w1"> </span>available<span class="w w1"> </span>JavaScript<span class="w w1"> </span>compiler<span class="w w1"> </span>(V8)<span class="w w1"> </span>and<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:397.386px;top:386.598px;left:317.014px;">fastest<span class="w w1"> </span>available<span class="w w1"> </span>JavaScript<span class="w w2"> </span>inline<span class="w w1"> </span>threaded<span class="w w0"> </span>interpreter<span class="w w2"> </span>(SFX)<span class="w w1"> </span>on<span class="w w0"> </span>9</div>
<div class="l f2 s4 c0" style="bottom:387.424px;top:396.56px;left:317.014px;">of<span class="w w2"> </span>26<span class="w w1"> </span>benchmarks.</div>
<div class="l f1 s2 c0" style="bottom:349.092px;top:433.056px;left:317.014px;">8.<span class="w w3"> </span>Related<span class="w w1"> </span>Work</div>
<div class="l f1 s4 c0" style="bottom:335.561px;top:448.379px;left:317.014px;">Trace<span class="w w2"> </span>optimization<span class="w w0"> </span>for<span class="w w2"> </span>dynamic<span class="w w0"> </span>languages.</div>
<div class="l f2 s4 c0" style="bottom:335.498px;top:448.486px;left:486.339px;">The<span class="w w1"> </span>closest<span class="w w1"> </span>area<span class="w w1"> </span>of</div>
<div class="l f2 s4 c0" style="bottom:325.535px;top:458.449px;left:317.014px;">related<span class="w w1"> </span>work<span class="w w0"> </span>is<span class="w w1"> </span>on<span class="w w1"> </span>applying<span class="w w0"> </span>trace<span class="w w1"> </span>optimization<span class="w w1"> </span>to<span class="w w0"> </span>type-specialize</div>
<div class="l f2 s4 c0" style="bottom:315.573px;top:468.411px;left:317.014px;">dynamic<span class="w w1"> </span>languages.<span class="w w0"> </span>Existing<span class="w w1"> </span>work<span class="w w0"> </span>shares<span class="w w1"> </span>the<span class="w w0"> </span>idea<span class="w w1"> </span>of<span class="w w0"> </span>generating</div>
<div class="l f2 s4 c0" style="bottom:305.61px;top:478.374px;left:317.014px;">type-specialized<span class="w w1"> </span>code<span class="w w0"> </span>speculatively<span class="w w2"> </span>with<span class="w w0"> </span>guards<span class="w w1"> </span>along<span class="w w1"> </span>interpreter</div>
<div class="l f2 s4 c0" style="bottom:295.647px;top:488.337px;left:317.014px;">traces.</div>
<div class="l f2 s4 c0" style="bottom:285.685px;top:498.299px;left:328.969px;">To<span class="w w1"> </span>our<span class="w w0"> </span>knowledge,<span class="w w0"> </span>Rigo’s<span class="w w1"> </span>Psyco<span class="w w0"> </span>(16)<span class="w w0"> </span>is<span class="w w0"> </span>the<span class="w w1"> </span>only<span class="w w0"> </span>published</div>
<div class="l f2 s4 c0" style="bottom:275.722px;top:508.262px;left:317.014px;">type-specializing<span class="w w1"> </span>trace<span class="w w2"> </span>compiler<span class="w w1"> </span>for<span class="w w1"> </span>a<span class="w w1"> </span>dynamic<span class="w w1"> </span>language<span class="w w2"> </span>(Python).</div>
<div class="l f2 s4 c0" style="bottom:265.759px;top:518.225px;left:317.014px;">Psyco<span class="w w2"> </span>does<span class="w w2"> </span>not<span class="w w1"> </span>attempt<span class="w w2"> </span>to<span class="w w1"> </span>identify<span class="w w2"> </span>hot<span class="w w2"> </span>loops<span class="w w1"> </span>or<span class="w w2"> </span>inline<span class="w w2"> </span>function<span class="w w1"> </span>calls.</div>
<div class="l f2 s4 c0" style="bottom:255.797px;top:528.187px;left:317.014px;">Instead,<span class="w w2"> </span>Psyco<span class="w w1"> </span>transforms<span class="w w2"> </span>loops<span class="w w2"> </span>to<span class="w w1"> </span>mutual<span class="w w2"> </span>recursion<span class="w w1"> </span>before<span class="w w2"> </span>running</div>
<div class="l f2 s4 c0" style="bottom:245.834px;top:538.15px;left:317.014px;">and<span class="w w2"> </span>traces<span class="w w1"> </span>all<span class="w w1"> </span>operations.</div>
<div class="l f2 s4 c0" style="bottom:235.871px;top:548.113px;left:328.969px;">Pall’s<span class="w w2"> </span>LuaJIT<span class="w w1"> </span>is<span class="w w2"> </span>a<span class="w w1"> </span>Lua<span class="w w1"> </span>VM<span class="w w2"> </span>in<span class="w w1"> </span>development<span class="w w1"> </span>that<span class="w w2"> </span>uses<span class="w w1"> </span>trace<span class="w w1"> </span>com-</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:317.014px;">pilation<span class="w w2"> </span>ideas.<span class="w w1"> </span>(1).<span class="w w2"> </span>There<span class="w w1"> </span>are<span class="w w2"> </span>no<span class="w w1"> </span>publications<span class="w w2"> </span>on<span class="w w1"> </span>LuaJIT<span class="w w2"> </span>but<span class="w w1"> </span>the<span class="w w2"> </span>cre-</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:317.014px;">ator<span class="w w2"> </span>has<span class="w w1"> </span>told<span class="w w1"> </span>us<span class="w w1"> </span>that<span class="w w2"> </span>LuaJIT<span class="w w1"> </span>has<span class="w w1"> </span>a<span class="w w2"> </span>similar<span class="w w1"> </span>design<span class="w w1"> </span>to<span class="w w2"> </span>our<span class="w w1"> </span>system,<span class="w w1"> </span>but</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:317.014px;">will<span class="w w1"> </span>use<span class="w w1"> </span>a<span class="w w1"> </span>less<span class="w w0"> </span>aggressiv</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:405.862px;">e<span class="w w1"> </span>type<span class="w w1"> </span>speculation<span class="w w1"> </span>(e.g.,<span class="w w0"> </span>using<span class="w w2"> </span>a<span class="w w0"> </span>floating-</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:317.014px;">point<span class="w w1"> </span>representation<span class="w w1"> </span>for<span class="w w1"> </span>all<span class="w w1"> </span>number<span class="w w1"> </span>values)<span class="w w1"> </span>and<span class="w w1"> </span>does<span class="w w0"> </span>not<span class="w w2"> </span>generate</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:317.014px;">nested<span class="w w2"> </span>traces<span class="w w1"> </span>for<span class="w w1"> </span>nested<span class="w w2"> </span>loops.</div>
<div class="l f1 s4 c0" style="bottom:176.158px;top:607.781px;left:328.969px;">General<span class="w w0"> </span>trace<span class="w w1"> </span>optimization.</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:441.427px;">General<span class="w w0"> </span>trace<span class="w w1"> </span>optimization<span class="w w0"> </span>has</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:317.014px;">a<span class="w w0"> </span>longer<span class="w w0"> </span>history<span class="w w1"> </span>that<span class="w w0"> </span>has<span class="w w0"> </span>treated<span class="w w0"> </span>mostly<span class="w w0"> </span>native<span class="w w1"> </span>code<span class="w w0"> </span>and<span class="w w0"> </span>typed</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:317.014px;">languages<span class="w w2"> </span>like<span class="w w1"> </span>Java.<span class="w w2"> </span>Thus,<span class="w w1"> </span>these<span class="w w1"> </span>systems<span class="w w2"> </span>have<span class="w w1"> </span>focused<span class="w w2"> </span>less<span class="w w1"> </span>on<span class="w w1"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:317.014px;">specialization<span class="w w2"> </span>and<span class="w w1"> </span>more<span class="w w1"> </span>on<span class="w w2"> </span>other<span class="w w1"> </span>optimizations.</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:328.969px;">Dynamo<span class="w w1"> </span>(7)<span class="w w1"> </span>by<span class="w w1"> </span>Bala<span class="w w1"> </span>et<span class="w w1"> </span>al,<span class="w w0"> </span>introduced<span class="w w2"> </span>native<span class="w w1"> </span>code<span class="w w1"> </span>tracing<span class="w w1"> </span>as<span class="w w0"> </span>a</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">replacement<span class="w w1"> </span>for<span class="w w1"> </span>profile-guided<span class="w w1"> </span>optimization<span class="w w1"> </span>(PGO).<span class="w w1"> </span>A<span class="w w1"> </span>major<span class="w w1"> </span>goal</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:317.014px;">was<span class="w w0"> </span>to<span class="w w1"> </span>perform<span class="w w0"> </span>PGO<span class="w w0"> </span>online<span class="w w0"> </span>so<span class="w w0"> </span>that<span class="w w1"> </span>the<span class="w w0"> </span>profile<span class="w w0"> </span>was<span class="w w0"> </span>specific<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">the<span class="w w1"> </span>current<span class="w w2"> </span>execution.<span class="w w1"> </span>Dynamo<span class="w w1"> </span>used<span class="w w2"> </span>loop<span class="w w1"> </span>headers<span class="w w1"> </span>as<span class="w w1"> </span>candidate<span class="w w1"> </span>hot</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:317.014px;">traces,<span class="w w2"> </span>but<span class="w w1"> </span>did<span class="w w1"> </span>not<span class="w w2"> </span>try<span class="w w1"> </span>to<span class="w w2"> </span>create<span class="w w1"> </span>loop<span class="w w1"> </span>traces<span class="w w2"> </span>specifically.</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:328.969px;">Trace<span class="w w1"> </span>trees<span class="w w1"> </span>were<span class="w w0"> </span>originally<span class="w w1"> </span>proposed<span class="w w1"> </span>by<span class="w w1"> </span>Gal<span class="w w0"> </span>et<span class="w w1"> </span>al.<span class="w w1"> </span>(11)<span class="w w1"> </span>in<span class="w w0"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:317.014px;">context<span class="w w1"> </span>of<span class="w w1"> </span>Java,<span class="w w1"> </span>a<span class="w w0"> </span>statically<span class="w w1"> </span>typed<span class="w w1"> </span>language.<span class="w w1"> </span>Their<span class="w w0"> </span>trace<span class="w w1"> </span>trees<span class="w w1"> </span>ac-</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:317.014px;">tually<span class="w w1"> </span>inlined<span class="w w1"> </span>parts<span class="w w1"> </span>of<span class="w w1"> </span>outer<span class="w w1"> </span>loops<span class="w w1"> </span>within<span class="w w1"> </span>the<span class="w w1"> </span>inner<span class="w w1"> </span>loops<span class="w w1"> </span>(because</div>
</div>
<div id="page-13" class="p" style="width:612px;height:792px;background-image:url(pd.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f18 s15 c0" style="bottom:530.859px;top:254.425px;left:115.399px;">!&quot;#</div>
<div class="l f18 s15 c0" style="bottom:530.859px;top:254.425px;left:148.039px;">$!&quot;#</div>
<div class="l f18 s15 c0" style="bottom:530.859px;top:254.425px;left:182.073px;">%!&quot;#</div>
<div class="l f18 s15 c0" style="bottom:530.859px;top:254.425px;left:216.107px;">&amp;!&quot;#</div>
<div class="l f18 s15 c0" style="bottom:530.859px;top:254.425px;left:250.141px;">&apos;!&quot;#</div>
<div class="l f18 s15 c0" style="bottom:530.859px;top:254.425px;left:282.781px;">(!!&quot;#</div>
<div class="l f18 s16 c0" style="bottom:543.27px;top:243.358px;left:88.3613px;">)*+,-./#0$1$23#</div>
<div class="l f18 s16 c0" style="bottom:549.816px;top:236.811px;left:85.0419px;">)*+45678#0$1923#</div>
<div class="l f18 s16 c0" style="bottom:556.363px;top:230.265px;left:82.4767px;">)*+6:;&lt;6:,/#0(1$23#</div>
<div class="l f18 s16 c0" style="bottom:562.909px;top:223.719px;left:68.529px;">:,,/==+.&gt;?:6;+&lt;6//=#0!1923#</div>
<div class="l f18 s16 c0" style="bottom:569.455px;top:217.172px;left:73.739px;">:,,/==+@:??A-,8#0$1$23#</div>
<div class="l f18 s16 c0" style="bottom:576.002px;top:210.626px;left:78.8694px;">:,,/==+?.5*;#0%1$23#</div>
<div class="l f18 s16 c0" style="bottom:582.548px;top:204.08px;left:78.7728px;">:,,/==+?=&gt;/B/#0)1!23#</div>
<div class="l f18 s16 c0" style="bottom:589.094px;top:197.533px;left:59.5743px;">.&gt;&lt;57=+).&gt;&lt;+.&gt;&lt;=+&gt;?+.;&lt;/#0$C1C23#</div>
<div class="l f18 s16 c0" style="bottom:595.641px;top:190.987px;left:70.0145px;">.&gt;&lt;57=+.&gt;&lt;=+&gt;?+.;&lt;/#0&apos;1D23#</div>
<div class="l f18 s16 c0" style="bottom:602.187px;top:184.441px;left:67.3237px;">.&gt;&lt;57=+.&gt;&lt;E&gt;=/+:?*#0$C1$23#</div>
<div class="l f18 s16 c0" style="bottom:608.733px;top:177.894px;left:71.2855px;">.&gt;&lt;57=+?=&gt;/B/+.&gt;&lt;=#0$1D23#</div>
<div class="l f18 s16 c0" style="bottom:615.28px;top:171.348px;left:65.0486px;">,5?&lt;65FG5E+6/,-6=&gt;B/#0(1!23#</div>
<div class="l f18 s16 c0" style="bottom:621.826px;top:164.801px;left:84.1074px;">,6;7&lt;5+:/=#0(1&amp;23#</div>
<div class="l f18 s16 c0" style="bottom:628.373px;top:158.255px;left:82.0685px;">,6;7&lt;5+4*C#0$1)23#</div>
<div class="l f18 s16 c0" style="bottom:634.919px;top:151.709px;left:81.7548px;">,6;7&lt;5+=8:(#0C1923#</div>
<div class="l f18 s16 c0" style="bottom:641.465px;top:145.162px;left:71.5991px;">*:&lt;/+@564:&lt;+&lt;5H/#0(1(23#</div>
<div class="l f18 s16 c0" style="bottom:648.012px;top:138.616px;left:70.1597px;">*:&lt;/+@564:&lt;+27:6.#0(1!23#</div>
<div class="l f18 s16 c0" style="bottom:654.558px;top:132.07px;left:81.4089px;">4:&lt;8+,56*&gt;,#0%1923#</div>
<div class="l f18 s16 c0" style="bottom:661.104px;top:125.523px;left:70.0716px;">4:&lt;8+7:6I:F+=-4=#0C1923#</div>
<div class="l f18 s16 c0" style="bottom:667.651px;top:118.977px;left:67.0638px;">4:&lt;8+=7/,&lt;6:F+?564#0D1(23#</div>
<div class="l f18 s16 c0" style="bottom:674.197px;top:112.431px;left:82.8054px;">6/J/27+*?:#0%1$23#</div>
<div class="l f18 s16 c0" style="bottom:680.743px;top:105.884px;left:78.7148px;">=&lt;6&gt;?J+.:=/&amp;%#0$1C23#</div>
<div class="l f18 s16 c0" style="bottom:687.29px;top:99.3379px;left:82.9794px;">=&lt;6&gt;?J+@:=&lt;:#0(1C23#</div>
<div class="l f18 s16 c0" style="bottom:693.836px;top:92.7916px;left:76.1173px;">=&lt;6&gt;?J+&lt;:J,F5-*#0(1(23#</div>
<div class="l f18 s16 c0" style="bottom:700.382px;top:86.2452px;left:68.7739px;">=&lt;6&gt;?J+-?7:,A+,5*/#0(1$23#</div>
<div class="l f18 s16 c0" style="bottom:706.929px;top:79.6989px;left:66.7102px;">=&lt;6&gt;?J+B:F&gt;*:&lt;/+&gt;?7-&lt;#0(1923#</div>
<div class="l f18 s15 c0" style="bottom:515.047px;top:270.238px;left:88.6002px;">K?&lt;/676/&lt;#</div>
<div class="l f18 s15 c0" style="bottom:515.047px;top:270.238px;left:122.244px;">L5?&gt;&lt;56#</div>
<div class="l f18 s15 c0" style="bottom:515.047px;top:270.238px;left:154.642px;">M/,56*#</div>
<div class="l f18 s15 c0" style="bottom:515.047px;top:270.238px;left:183.879px;">N547&gt;F/#</div>
<div class="l f18 s15 c0" style="bottom:515.047px;top:270.238px;left:215.955px;">N:FF#O6:,/#</div>
<div class="l f18 s15 c0" style="bottom:515.047px;top:270.238px;left:250.829px;">M-?#O6:,/#</div>
<div class="l f1 s4 c0" style="bottom:482.435px;top:301.504px;left:54px;">Figure<span class="w w2"> </span>12.<span class="w w0"> </span>Fraction<span class="w w1"> </span>of<span class="w w1"> </span>time<span class="w w1"> </span>spent<span class="w w1"> </span>on<span class="w w1"> </span>major<span class="w w1"> </span>VM<span class="w w2"> </span>activities.</div>
<div class="l f2 s4 c0" style="bottom:482.372px;top:301.612px;left:279.161px;">The</div>
<div class="l f2 s4 c0" style="bottom:472.409px;top:311.575px;left:54px;">speedup<span class="w w1"> </span>vs.<span class="w w1"> </span>interpreter<span class="w w0"> </span>is<span class="w w2"> </span>shown<span class="w w0"> </span>in<span class="w w1"> </span>parentheses<span class="w w1"> </span>next<span class="w w1"> </span>to<span class="w w1"> </span>each<span class="w w1"> </span>test.</div>
<div class="l f2 s4 c0" style="bottom:462.447px;top:321.537px;left:54px;">Most<span class="w w1"> </span>programs<span class="w w2"> </span>where<span class="w w1"> </span>the<span class="w w1"> </span>VM<span class="w w1"> </span>spends<span class="w w2"> </span>the<span class="w w1"> </span>majority<span class="w w1"> </span>of<span class="w w1"> </span>its<span class="w w1"> </span>time<span class="w w2"> </span>run-</div>
<div class="l f2 s4 c0" style="bottom:452.484px;top:331.5px;left:54px;">ning<span class="w w2"> </span>native<span class="w w1"> </span>code<span class="w w1"> </span>have<span class="w w2"> </span>a<span class="w w1"> </span>good<span class="w w1"> </span>speedup.<span class="w w2"> </span>Recording<span class="w w1"> </span>and<span class="w w1"> </span>compilation</div>
<div class="l f2 s4 c0" style="bottom:442.521px;top:341.463px;left:54px;">costs<span class="w w1"> </span>can<span class="w w2"> </span>be<span class="w w1"> </span>substantial;<span class="w w1"> </span>speeding<span class="w w1"> </span>up<span class="w w1"> </span>those<span class="w w2"> </span>parts<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>implemen-</div>
<div class="l f2 s4 c0" style="bottom:432.559px;top:351.425px;left:54px;">tation<span class="w w2"> </span>would<span class="w w1"> </span>improve<span class="w w2"> </span>SunSpider<span class="w w1"> </span>performance.</div>
<div class="l f2 s4 c0" style="bottom:385.311px;top:398.673px;left:54px;">inner<span class="w w2"> </span>loops<span class="w w1"> </span>become<span class="w w1"> </span>hot<span class="w w1"> </span>first),<span class="w w2"> </span>leading<span class="w w1"> </span>to<span class="w w1"> </span>much<span class="w w1"> </span>greater<span class="w w2"> </span>tail<span class="w w1"> </span>duplica-</div>
<div class="l f2 s4 c0" style="bottom:375.348px;top:408.636px;left:54px;">tion.</div>
<div class="l f2 s4 c0" style="bottom:365.386px;top:418.598px;left:65.9552px;">YETI,<span class="w w1"> </span>from<span class="w w0"> </span>Zaleski<span class="w w1"> </span>et<span class="w w0"> </span>al.<span class="w w1"> </span>(19)<span class="w w0"> </span>applied<span class="w w1"> </span>Dynamo-style<span class="w w0"> </span>tracing</div>
<div class="l f2 s4 c0" style="bottom:355.423px;top:428.561px;left:54px;">to<span class="w w0"> </span>Java<span class="w w1"> </span>in<span class="w w0"> </span>order<span class="w w0"> </span>to<span class="w w0"> </span>achieve<span class="w w1"> </span>inlining,<span class="w w0"> </span>indirect<span class="w w0"> </span>jump<span class="w w0"> </span>elimination,</div>
<div class="l f2 s4 c0" style="bottom:345.46px;top:438.524px;left:54px;">and<span class="w w1"> </span>other<span class="w w1"> </span>optimizations.<span class="w w2"> </span>Their<span class="w w1"> </span>primary<span class="w w1"> </span>focus<span class="w w1"> </span>was<span class="w w1"> </span>on<span class="w w1"> </span>designing<span class="w w1"> </span>an</div>
<div class="l f2 s4 c0" style="bottom:335.498px;top:448.486px;left:54px;">interpreter<span class="w w2"> </span>that<span class="w w1"> </span>could<span class="w w2"> </span>easily<span class="w w1"> </span>be<span class="w w1"> </span>gradually<span class="w w2"> </span>re-engineered<span class="w w1"> </span>as<span class="w w2"> </span>a<span class="w w1"> </span>tracing</div>
<div class="l f2 s4 c0" style="bottom:325.535px;top:458.449px;left:54px;">VM.</div>
<div class="l f2 s4 c0" style="bottom:315.573px;top:468.411px;left:65.9552px;">Suganuma<span class="w w2"> </span>et<span class="w w2"> </span>al.<span class="w w2"> </span>(18)<span class="w w1"> </span>described<span class="w w2"> </span>region-based<span class="w w2"> </span>compilation<span class="w w2"> </span>(RBC),</div>
<div class="l f2 s4 c0" style="bottom:305.61px;top:478.374px;left:54px;">a<span class="w w1"> </span>relative<span class="w w1"> </span>of<span class="w w1"> </span>tracing.<span class="w w1"> </span>A<span class="w w1"> </span>region<span class="w w1"> </span>is<span class="w w1"> </span>an<span class="w w1"> </span>subprogram<span class="w w1"> </span>worth<span class="w w1"> </span>optimizing</div>
<div class="l f2 s4 c0" style="bottom:295.647px;top:488.337px;left:54px;">that<span class="w w2"> </span>can<span class="w w1"> </span>include<span class="w w2"> </span>subsets<span class="w w1"> </span>of<span class="w w1"> </span>any<span class="w w2"> </span>number<span class="w w1"> </span>of<span class="w w2"> </span>methods.<span class="w w1"> </span>Thus,<span class="w w2"> </span>the<span class="w w1"> </span>com-</div>
<div class="l f2 s4 c0" style="bottom:285.685px;top:498.299px;left:54px;">piler<span class="w w1"> </span>has<span class="w w1"> </span>more<span class="w w1"> </span>flexibility<span class="w w2"> </span>and<span class="w w1"> </span>can<span class="w w1"> </span>potentially<span class="w w1"> </span>generate<span class="w w1"> </span>better<span class="w w1"> </span>code,</div>
<div class="l f2 s4 c0" style="bottom:275.722px;top:508.262px;left:54px;">but<span class="w w2"> </span>the<span class="w w2"> </span>profiling<span class="w w2"> </span>and<span class="w w1"> </span>compilation<span class="w w2"> </span>systems<span class="w w2"> </span>are<span class="w w1"> </span>correspondingly<span class="w w2"> </span>more</div>
<div class="l f2 s4 c0" style="bottom:265.759px;top:518.225px;left:54px;">complex.</div>
<div class="l f1 s4 c0" style="bottom:255.86px;top:528.08px;left:65.9552px;">Type<span class="w w1"> </span>specialization<span class="w w0"> </span>for<span class="w w0"> </span>dynamic<span class="w w0"> </span>languages.</div>
<div class="l f2 s4 c0" style="bottom:255.797px;top:528.187px;left:242.032px;">Dynamic<span class="w w0"> </span>lan-</div>
<div class="l f2 s4 c0" style="bottom:245.834px;top:538.15px;left:54px;">guage<span class="w w1"> </span>implementors<span class="w w1"> </span>have<span class="w w1"> </span>long<span class="w w1"> </span>recognized<span class="w w1"> </span>the<span class="w w1"> </span>importance<span class="w w1"> </span>of<span class="w w1"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:235.871px;top:548.113px;left:54px;">specialization<span class="w w2"> </span>for<span class="w w1"> </span>performance.<span class="w w2"> </span>Most<span class="w w2"> </span>previous<span class="w w1"> </span>work<span class="w w2"> </span>has<span class="w w2"> </span>focused<span class="w w1"> </span>on</div>
<div class="l f2 s4 c0" style="bottom:225.909px;top:558.075px;left:54px;">methods<span class="w w2"> </span>instead<span class="w w1"> </span>of<span class="w w1"> </span>traces.</div>
<div class="l f2 s4 c0" style="bottom:215.946px;top:568.038px;left:65.9552px;">Chambers<span class="w w1"> </span>et.<span class="w w0"> </span>al<span class="w w1"> </span>(9)<span class="w w1"> </span>pioneered<span class="w w0"> </span>the<span class="w w1"> </span>idea<span class="w w1"> </span>of<span class="w w0"> </span>compiling<span class="w w1"> </span>multiple</div>
<div class="l f2 s4 c0" style="bottom:205.984px;top:578px;left:54px;">versions<span class="w w1"> </span>of<span class="w w1"> </span>a<span class="w w1"> </span>procedure<span class="w w1"> </span>specialized<span class="w w1"> </span>for<span class="w w1"> </span>the<span class="w w1"> </span>input<span class="w w1"> </span>types<span class="w w0"> </span>in<span class="w w2"> </span>the<span class="w w1"> </span>lan-</div>
<div class="l f2 s4 c0" style="bottom:196.021px;top:587.963px;left:54px;">guage<span class="w w1"> </span>Self.<span class="w w0"> </span>In<span class="w w1"> </span>one<span class="w w0"> </span>implementation,<span class="w w1"> </span>they<span class="w w0"> </span>generated<span class="w w1"> </span>a<span class="w w1"> </span>specialized</div>
<div class="l f2 s4 c0" style="bottom:186.058px;top:597.926px;left:54px;">method<span class="w w2"> </span>online<span class="w w1"> </span>each<span class="w w2"> </span>time<span class="w w2"> </span>a<span class="w w1"> </span>method<span class="w w2"> </span>was<span class="w w2"> </span>called<span class="w w1"> </span>with<span class="w w2"> </span>new<span class="w w2"> </span>input<span class="w w1"> </span>types.</div>
<div class="l f2 s4 c0" style="bottom:176.096px;top:607.888px;left:54px;">In<span class="w w1"> </span>another,<span class="w w1"> </span>they<span class="w w0"> </span>used<span class="w w1"> </span>an<span class="w w1"> </span>offline<span class="w w1"> </span>whole-program<span class="w w0"> </span>static<span class="w w1"> </span>analysis<span class="w w1"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:166.133px;top:617.851px;left:54px;">infer<span class="w w1"> </span>input<span class="w w1"> </span>types<span class="w w1"> </span>and<span class="w w1"> </span>constant<span class="w w1"> </span>receiver<span class="w w2"> </span>types<span class="w w1"> </span>at<span class="w w1"> </span>call<span class="w w1"> </span>sites.<span class="w w1"> </span>Interest-</div>
<div class="l f2 s4 c0" style="bottom:156.17px;top:627.814px;left:54px;">ingly,<span class="w w2"> </span>the<span class="w w1"> </span>two<span class="w w2"> </span>techniques<span class="w w1"> </span>produced<span class="w w2"> </span>nearly<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w2"> </span>performance.</div>
<div class="l f2 s4 c0" style="bottom:146.208px;top:637.776px;left:65.9552px;">Salib<span class="w w2"> </span>(17)<span class="w w1"> </span>designed<span class="w w2"> </span>a<span class="w w1"> </span>type<span class="w w2"> </span>inference<span class="w w2"> </span>algorithm<span class="w w1"> </span>for<span class="w w2"> </span>Python<span class="w w1"> </span>based</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:54px;">on<span class="w w2"> </span>the<span class="w w1"> </span>Cartesian<span class="w w2"> </span>Product<span class="w w1"> </span>Algorithm<span class="w w1"> </span>and<span class="w w2"> </span>used<span class="w w1"> </span>the<span class="w w2"> </span>results<span class="w w1"> </span>to<span class="w w2"> </span>special-</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:54px;">ize<span class="w w2"> </span>on<span class="w w1"> </span>types<span class="w w1"> </span>and<span class="w w2"> </span>translate<span class="w w1"> </span>the<span class="w w1"> </span>program<span class="w w2"> </span>to<span class="w w1"> </span>C++.</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:65.9552px;">McCloskey<span class="w w1"> </span>(14)<span class="w w0"> </span>has<span class="w w0"> </span>work<span class="w w1"> </span>in<span class="w w0"> </span>progress<span class="w w0"> </span>based<span class="w w1"> </span>on<span class="w w0"> </span>a<span class="w w0"> </span>language-</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:54px;">independent<span class="w w0"> </span>type<span class="w w0"> </span>inference<span class="w w0"> </span>that<span class="w w1"> </span>is<span class="w w0"> </span>used<span class="w w0"> </span>to<span class="w w0"> </span>generate<span class="w w0"> </span>efficient<span class="w w0"> </span>C</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:54px;">implementations<span class="w w2"> </span>of<span class="w w1"> </span>JavaScript<span class="w w2"> </span>and<span class="w w1"> </span>Python<span class="w w1"> </span>programs.</div>
<div class="l f1 s4 c0" style="bottom:86.4946px;top:697.445px;left:65.9552px;">Native<span class="w w2"> </span>code<span class="w w1"> </span>generation<span class="w w1"> </span>by<span class="w w1"> </span>interpreters.</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:218.246px;">The<span class="w w1"> </span>traditional<span class="w w2"> </span>inter-</div>
<div class="l f2 s4 c0" style="bottom:76.4692px;top:707.515px;left:54px;">preter<span class="w w1"> </span>design<span class="w w1"> </span>is<span class="w w0"> </span>a<span class="w w1"> </span>virtual<span class="w w1"> </span>machine<span class="w w1"> </span>that<span class="w w0"> </span>directly<span class="w w1"> </span>executes<span class="w w1"> </span>ASTs<span class="w w1"> </span>or</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:54px;">machine-code-like<span class="w w2"> </span>bytecodes.<span class="w w2"> </span>Researchers<span class="w w1"> </span>have<span class="w w2"> </span>shown<span class="w w2"> </span>how<span class="w w2"> </span>to<span class="w w1"> </span>gen-</div>
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:317.014px;">erate<span class="w w1"> </span>native<span class="w w1"> </span>code<span class="w w1"> </span>with<span class="w w1"> </span>nearly<span class="w w1"> </span>the<span class="w w1"> </span>same<span class="w w1"> </span>structure<span class="w w1"> </span>but<span class="w w1"> </span>better<span class="w w1"> </span>perfor-</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:317.014px;">mance.</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:328.969px;">Call<span class="w w1"> </span>threading,<span class="w w1"> </span>also<span class="w w0"> </span>known<span class="w w2"> </span>as<span class="w w0"> </span>context<span class="w w1"> </span>threading<span class="w w1"> </span>(8),<span class="w w1"> </span>compiles</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:317.014px;">methods<span class="w w1"> </span>by<span class="w w0"> </span>generating<span class="w w1"> </span>a<span class="w w0"> </span>native<span class="w w1"> </span>call<span class="w w0"> </span>instruction<span class="w w1"> </span>to<span class="w w0"> </span>an<span class="w w1"> </span>interpreter</div>
<div class="l f2 s4 c0" style="bottom:670.243px;top:113.741px;left:317.014px;">method<span class="w w1"> </span>for<span class="w w1"> </span>each<span class="w w1"> </span>interpreter<span class="w w1"> </span>bytecode.<span class="w w0"> </span>A<span class="w w2"> </span>call-return<span class="w w0"> </span>pair<span class="w w1"> </span>has<span class="w w1"> </span>been</div>
<div class="l f2 s4 c0" style="bottom:660.28px;top:123.704px;left:317.014px;">shown<span class="w w2"> </span>to<span class="w w1"> </span>be<span class="w w2"> </span>a<span class="w w1"> </span>potentially<span class="w w1"> </span>much<span class="w w2"> </span>more<span class="w w1"> </span>efficient<span class="w w2"> </span>dispatch<span class="w w1"> </span>mechanism</div>
<div class="l f2 s4 c0" style="bottom:650.317px;top:133.667px;left:317.014px;">than<span class="w w2"> </span>the<span class="w w1"> </span>indirect<span class="w w1"> </span>jumps<span class="w w2"> </span>used<span class="w w1"> </span>in<span class="w w1"> </span>standard<span class="w w2"> </span>bytecode<span class="w w1"> </span>interpreters.</div>
<div class="l f2 s4 c0" style="bottom:640.355px;top:143.629px;left:328.969px;">Inline<span class="w w1"> </span>threading<span class="w w1"> </span>(15)<span class="w w0"> </span>copies<span class="w w1"> </span>chunks<span class="w w1"> </span>of<span class="w w0"> </span>interpreter<span class="w w1"> </span>native<span class="w w1"> </span>code</div>
<div class="l f2 s4 c0" style="bottom:630.392px;top:153.592px;left:317.014px;">which<span class="w w1"> </span>implement<span class="w w1"> </span>the<span class="w w2"> </span>required<span class="w w1"> </span>bytecodes<span class="w w1"> </span>into<span class="w w1"> </span>a<span class="w w1"> </span>native<span class="w w2"> </span>code<span class="w w1"> </span>cache,</div>
<div class="l f2 s4 c0" style="bottom:620.429px;top:163.555px;left:317.014px;">thus<span class="w w2"> </span>acting<span class="w w1"> </span>as<span class="w w2"> </span>a<span class="w w1"> </span>simple<span class="w w2"> </span>per-method<span class="w w1"> </span>JIT<span class="w w2"> </span>compiler<span class="w w1"> </span>that<span class="w w2"> </span>eliminates<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:610.467px;top:173.517px;left:317.014px;">dispatch<span class="w w2"> </span>overhead.</div>
<div class="l f2 s4 c0" style="bottom:600.504px;top:183.48px;left:328.969px;">Neither<span class="w w2"> </span>call<span class="w w2"> </span>threading<span class="w w1"> </span>nor<span class="w w2"> </span>inline<span class="w w1"> </span>threading<span class="w w2"> </span>perform<span class="w w2"> </span>type<span class="w w1"> </span>special-</div>
<div class="l f2 s4 c0" style="bottom:590.541px;top:193.443px;left:317.014px;">ization.</div>
<div class="l f2 s4 c0" style="bottom:580.579px;top:203.405px;left:328.969px;">Apple’s<span class="w w1"> </span>SquirrelFish<span class="w w1"> </span>Extreme<span class="w w1"> </span>(5)<span class="w w0"> </span>is<span class="w w1"> </span>a<span class="w w1"> </span>JavaScript<span class="w w1"> </span>implementa-</div>
<div class="l f2 s4 c0" style="bottom:570.616px;top:213.368px;left:317.014px;">tion<span class="w w1"> </span>based<span class="w w1"> </span>on<span class="w w1"> </span>call<span class="w w1"> </span>threading<span class="w w1"> </span>with<span class="w w1"> </span>selective<span class="w w1"> </span>inline<span class="w w1"> </span>threading.<span class="w w1"> </span>Com-</div>
<div class="l f2 s4 c0" style="bottom:560.653px;top:223.331px;left:317.014px;">bined<span class="w w1"> </span>with<span class="w w1"> </span>efficient<span class="w w1"> </span>interpreter<span class="w w0"> </span>engineering,<span class="w w1"> </span>these<span class="w w1"> </span>threading<span class="w w1"> </span>tech-</div>
<div class="l f2 s4 c0" style="bottom:550.691px;top:233.293px;left:317.014px;">niques<span class="w w2"> </span>have<span class="w w2"> </span>given<span class="w w1"> </span>SFX<span class="w w2"> </span>excellent<span class="w w1"> </span>performance<span class="w w2"> </span>on<span class="w w1"> </span>the<span class="w w2"> </span>standard<span class="w w2"> </span>Sun-</div>
<div class="l f2 s4 c0" style="bottom:540.728px;top:243.256px;left:317.014px;">Spider<span class="w w2"> </span>benchmarks.</div>
<div class="l f2 s4 c0" style="bottom:530.766px;top:253.218px;left:328.969px;">Google’s<span class="w w1"> </span>V8<span class="w w0"> </span>is<span class="w w0"> </span>a<span class="w w1"> </span>JavaScript<span class="w w0"> </span>implementation<span class="w w1"> </span>primarily<span class="w w0"> </span>based</div>
<div class="l f2 s4 c0" style="bottom:520.803px;top:263.181px;left:317.014px;">on<span class="w w0"> </span>inline<span class="w w0"> </span>threading,<span class="w w1"> </span>with<span class="w w0"> </span>call<span class="w w0"> </span>threading<span class="w w0"> </span>only<span class="w w0"> </span>for<span class="w w0"> </span>very<span class="w w1"> </span>complex</div>
<div class="l f2 s4 c0" style="bottom:510.84px;top:273.144px;left:317.014px;">operations.</div>
<div class="l f1 s2 c0" style="bottom:489.233px;top:292.915px;left:317.014px;">9.<span class="w w3"> </span>Conclusions</div>
<div class="l f2 s4 c0" style="bottom:475.639px;top:308.345px;left:317.014px;">This<span class="w w1"> </span>paper<span class="w w2"> </span>described<span class="w w1"> </span>how<span class="w w1"> </span>to<span class="w w1"> </span>run<span class="w w1"> </span>dynamic<span class="w w1"> </span>languages<span class="w w2"> </span>efficiently<span class="w w1"> </span>by</div>
<div class="l f2 s4 c0" style="bottom:465.676px;top:318.308px;left:317.014px;">recording<span class="w w1"> </span>hot<span class="w w1"> </span>traces<span class="w w0"> </span>and<span class="w w1"> </span>generating<span class="w w1"> </span>type-specialized<span class="w w0"> </span>native<span class="w w2"> </span>code.</div>
<div class="l f2 s4 c0" style="bottom:455.714px;top:328.27px;left:317.014px;">Our<span class="w w1"> </span>technique<span class="w w1"> </span>focuses<span class="w w2"> </span>on<span class="w w1"> </span>aggressively<span class="w w1"> </span>inlined<span class="w w1"> </span>loops,<span class="w w1"> </span>and<span class="w w1"> </span>for<span class="w w1"> </span>each</div>
<div class="l f2 s4 c0" style="bottom:445.751px;top:338.233px;left:317.014px;">loop,<span class="w w0"> </span>it<span class="w w0"> </span>generates<span class="w w0"> </span>a<span class="w w1"> </span>tree<span class="w w0"> </span>of<span class="w w0"> </span>native<span class="w w0"> </span>code<span class="w w0"> </span>traces<span class="w w0"> </span>representing<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:435.788px;top:348.196px;left:317.014px;">paths<span class="w w1"> </span>and<span class="w w1"> </span>value<span class="w w1"> </span>types<span class="w w0"> </span>through<span class="w w1"> </span>the<span class="w w1"> </span>loop<span class="w w1"> </span>observed<span class="w w1"> </span>at<span class="w w1"> </span>run<span class="w w0"> </span>time.<span class="w w1"> </span>We</div>
<div class="l f2 s4 c0" style="bottom:425.826px;top:358.158px;left:317.014px;">explained<span class="w w1"> </span>how<span class="w w1"> </span>to<span class="w w1"> </span>identify<span class="w w1"> </span>loop<span class="w w1"> </span>nesting<span class="w w1"> </span>relationships<span class="w w1"> </span>and<span class="w w0"> </span>generate</div>
<div class="l f2 s4 c0" style="bottom:415.863px;top:368.121px;left:317.014px;">nested<span class="w w0"> </span>traces<span class="w w0"> </span>in<span class="w w0"> </span>order<span class="w w0"> </span>to<span class="w w1"> </span>avoid<span class="w w0"> </span>excessive<span class="w w0"> </span>code<span class="w w0"> </span>duplication<span class="w w0"> </span>due</div>
<div class="l f2 s4 c0" style="bottom:405.9px;top:378.084px;left:317.014px;">to<span class="w w0"> </span>the<span class="w w1"> </span>many<span class="w w0"> </span>paths<span class="w w0"> </span>through<span class="w w0"> </span>a<span class="w w1"> </span>loop<span class="w w0"> </span>nest.<span class="w w0"> </span>We<span class="w w1"> </span>described<span class="w w0"> </span>our<span class="w w0"> </span>type</div>
<div class="l f2 s4 c0" style="bottom:395.938px;top:388.046px;left:317.014px;">specialization<span class="w w0"> </span>algorithm.<span class="w w0"> </span>W</div>
<div class="l f2 s4 c0" style="bottom:395.938px;top:388.046px;left:419.473px;">e<span class="w w0"> </span>also<span class="w w0"> </span>described<span class="w w1"> </span>our<span class="w w0"> </span>trace<span class="w w0"> </span>compiler,</div>
<div class="l f2 s4 c0" style="bottom:385.975px;top:398.009px;left:317.014px;">which<span class="w w0"> </span>translates<span class="w w0"> </span>a<span class="w w1"> </span>trace<span class="w w0"> </span>from<span class="w w0"> </span>an<span class="w w0"> </span>intermediate<span class="w w0"> </span>representation<span class="w w0"> </span>to</div>
<div class="l f2 s4 c0" style="bottom:376.013px;top:407.971px;left:317.014px;">optimized<span class="w w2"> </span>native<span class="w w1"> </span>code<span class="w w2"> </span>in<span class="w w1"> </span>two<span class="w w1"> </span>linear<span class="w w2"> </span>passes.</div>
<div class="l f2 s4 c0" style="bottom:366.05px;top:417.934px;left:328.969px;">Our<span class="w w1"> </span>experimental<span class="w w1"> </span>results<span class="w w1"> </span>show<span class="w w0"> </span>that<span class="w w1"> </span>in<span class="w w1"> </span>practice<span class="w w1"> </span>loops<span class="w w1"> </span>typically</div>
<div class="l f2 s4 c0" style="bottom:356.087px;top:427.897px;left:317.014px;">are<span class="w w1"> </span>entered<span class="w w1"> </span>with<span class="w w1"> </span>only<span class="w w1"> </span>a<span class="w w1"> </span>few<span class="w w1"> </span>different<span class="w w1"> </span>combinations<span class="w w1"> </span>of<span class="w w1"> </span>value<span class="w w1"> </span>types</div>
<div class="l f2 s4 c0" style="bottom:346.125px;top:437.859px;left:317.014px;">of<span class="w w1"> </span>variables.<span class="w w1"> </span>Thus,<span class="w w1"> </span>a<span class="w w1"> </span>small<span class="w w1"> </span>number<span class="w w1"> </span>of<span class="w w1"> </span>traces<span class="w w1"> </span>per<span class="w w1"> </span>loop<span class="w w1"> </span>is<span class="w w0"> </span>sufficient</div>
<div class="l f2 s4 c0" style="bottom:336.162px;top:447.822px;left:317.014px;">to<span class="w w1"> </span>run<span class="w w0"> </span>a<span class="w w1"> </span>program<span class="w w0"> </span>efficiently</div>
<div class="l f2 s4 c0" style="bottom:336.162px;top:447.822px;left:419.778px;">.<span class="w w1"> </span>Our<span class="w w0"> </span>experiments<span class="w w1"> </span>also<span class="w w0"> </span>show<span class="w w1"> </span>that<span class="w w1"> </span>on</div>
<div class="l f2 s4 c0" style="bottom:326.199px;top:457.785px;left:317.014px;">programs<span class="w w2"> </span>amenable<span class="w w1"> </span>to<span class="w w1"> </span>tracing,<span class="w w2"> </span>we<span class="w w1"> </span>achieve<span class="w w2"> </span>speedups<span class="w w1"> </span>of<span class="w w1"> </span>2x<span class="w w2"> </span>to<span class="w w1"> </span>20x.</div>
<div class="l f1 s2 c0" style="bottom:304.592px;top:477.556px;left:317.014px;">10.<span class="w w3"> </span>Future<span class="w w1"> </span>W</div>
<div class="l f1 s2 c0" style="bottom:304.592px;top:477.556px;left:386.614px;">ork</div>
<div class="l f2 s4 c0" style="bottom:290.998px;top:492.986px;left:317.014px;">Work<span class="w w1"> </span>is<span class="w w0"> </span>underway<span class="w w1"> </span>in<span class="w w0"> </span>a<span class="w w0"> </span>number<span class="w w1"> </span>of<span class="w w0"> </span>areas<span class="w w1"> </span>to<span class="w w0"> </span>further<span class="w w0"> </span>improve<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:281.035px;top:502.949px;left:317.014px;">performance<span class="w w1"> </span>of<span class="w w1"> </span>our<span class="w w1"> </span>trace-based<span class="w w1"> </span>JavaScript<span class="w w2"> </span>compiler.<span class="w w1"> </span>We<span class="w w2"> </span>currently</div>
<div class="l f2 s4 c0" style="bottom:271.073px;top:512.911px;left:317.014px;">do<span class="w w1"> </span>not<span class="w w0"> </span>trace<span class="w w1"> </span>across<span class="w w0"> </span>recursive<span class="w w1"> </span>function<span class="w w0"> </span>calls,<span class="w w1"> </span>but<span class="w w0"> </span>plan<span class="w w1"> </span>to<span class="w w0"> </span>add<span class="w w1"> </span>the</div>
<div class="l f2 s4 c0" style="bottom:261.11px;top:522.874px;left:317.014px;">support<span class="w w1"> </span>for<span class="w w1"> </span>this<span class="w w1"> </span>capability<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>near<span class="w w1"> </span>term.<span class="w w1"> </span>We<span class="w w2"> </span>are<span class="w w1"> </span>also<span class="w w1"> </span>exploring</div>
<div class="l f2 s4 c0" style="bottom:251.147px;top:532.837px;left:317.014px;">adoption<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>existing<span class="w w2"> </span>work<span class="w w1"> </span>on<span class="w w1"> </span>tree<span class="w w1"> </span>recompilation<span class="w w1"> </span>in<span class="w w1"> </span>the<span class="w w1"> </span>context</div>
<div class="l f2 s4 c0" style="bottom:241.185px;top:542.799px;left:317.014px;">of<span class="w w1"> </span>the<span class="w w2"> </span>presented<span class="w w1"> </span>dynamic<span class="w w1"> </span>compiler<span class="w w1"> </span>in<span class="w w2"> </span>order<span class="w w1"> </span>to<span class="w w1"> </span>minimize<span class="w w1"> </span>JIT<span class="w w1"> </span>pause</div>
<div class="l f2 s4 c0" style="bottom:231.222px;top:552.762px;left:317.014px;">times<span class="w w1"> </span>and<span class="w w2"> </span>obtain<span class="w w1"> </span>the<span class="w w1"> </span>best<span class="w w1"> </span>of<span class="w w2"> </span>both<span class="w w1"> </span>worlds,<span class="w w1"> </span>fast<span class="w w2"> </span>tree<span class="w w1"> </span>stitching<span class="w w1"> </span>as<span class="w w1"> </span>well</div>
<div class="l f2 s4 c0" style="bottom:221.26px;top:562.724px;left:317.014px;">as<span class="w w2"> </span>the<span class="w w1"> </span>improved<span class="w w2"> </span>code<span class="w w1"> </span>quality<span class="w w1"> </span>due<span class="w w2"> </span>to<span class="w w1"> </span>tree<span class="w w1"> </span>recompilation.</div>
<div class="l f2 s4 c0" style="bottom:211.297px;top:572.687px;left:328.969px;">We<span class="w w2"> </span>also<span class="w w0"> </span>plan<span class="w w1"> </span>on<span class="w w1"> </span>adding<span class="w w1"> </span>support<span class="w w0"> </span>for<span class="w w2"> </span>tracing<span class="w w0"> </span>across<span class="w w1"> </span>regular<span class="w w1"> </span>ex-</div>
<div class="l f2 s4 c0" style="bottom:201.334px;top:582.65px;left:317.014px;">pression<span class="w w0"> </span>substitutions<span class="w w1"> </span>using<span class="w w0"> </span>lambda<span class="w w0"> </span>functions,<span class="w w1"> </span>function<span class="w w0"> </span>applica-</div>
<div class="l f2 s4 c0" style="bottom:191.372px;top:592.612px;left:317.014px;">tions<span class="w w0"> </span>and<span class="w w1"> </span>expression<span class="w w0"> </span>evaluation<span class="w w1"> </span>using</div>
<div class="l f7 s4 c0" style="bottom:191.318px;top:593.213px;left:461.227px;">eval</div>
<div class="l f2 s4 c0" style="bottom:191.372px;top:592.612px;left:480.056px;">.<span class="w w0"> </span>All<span class="w w1"> </span>these<span class="w w0"> </span>language</div>
<div class="l f2 s4 c0" style="bottom:181.409px;top:602.575px;left:317.014px;">constructs<span class="w w1"> </span>are<span class="w w0"> </span>currently<span class="w w1"> </span>executed<span class="w w1"> </span>via<span class="w w0"> </span>interpretation,<span class="w w1"> </span>which<span class="w w0"> </span>limits</div>
<div class="l f2 s4 c0" style="bottom:171.446px;top:612.538px;left:317.014px;">our<span class="w w2"> </span>performance<span class="w w1"> </span>for<span class="w w1"> </span>applications<span class="w w2"> </span>that<span class="w w1"> </span>use<span class="w w1"> </span>those<span class="w w2"> </span>features.</div>
<div class="l f1 s2 c0" style="bottom:149.839px;top:632.309px;left:317.014px;">Acknowledgments</div>
<div class="l f2 s4 c0" style="bottom:136.245px;top:647.739px;left:317.014px;">Parts<span class="w w1"> </span>of<span class="w w1"> </span>this<span class="w w0"> </span>effort<span class="w w1"> </span>have<span class="w w1"> </span>been<span class="w w1"> </span>sponsored<span class="w w0"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>National<span class="w w0"> </span>Science</div>
<div class="l f2 s4 c0" style="bottom:126.282px;top:657.702px;left:317.014px;">Foundation<span class="w w2"> </span>under<span class="w w1"> </span>grants<span class="w w2"> </span>CNS-0615443<span class="w w1"> </span>and<span class="w w2"> </span>CNS-0627747,<span class="w w1"> </span>as<span class="w w2"> </span>well</div>
<div class="l f2 s4 c0" style="bottom:116.32px;top:667.664px;left:317.014px;">as<span class="w w1"> </span>by<span class="w w1"> </span>the<span class="w w1"> </span>California<span class="w w1"> </span>MICRO<span class="w w1"> </span>Program<span class="w w0"> </span>and<span class="w w2"> </span>industrial<span class="w w0"> </span>sponsor<span class="w w2"> </span>Sun</div>
<div class="l f2 s4 c0" style="bottom:106.357px;top:677.627px;left:317.014px;">Microsystems<span class="w w2"> </span>under<span class="w w1"> </span>Project<span class="w w1"> </span>No.<span class="w w2"> </span>07-127.</div>
<div class="l f2 s4 c0" style="bottom:96.3945px;top:687.59px;left:328.969px;">The<span class="w w1"> </span>U.S.<span class="w w2"> </span>Government<span class="w w1"> </span>is<span class="w w1"> </span>authorized<span class="w w2"> </span>to<span class="w w1"> </span>reproduce<span class="w w1"> </span>and<span class="w w1"> </span>distribute</div>
<div class="l f2 s4 c0" style="bottom:86.4319px;top:697.552px;left:317.014px;">reprints<span class="w w2"> </span>for<span class="w w1"> </span>Governmental<span class="w w2"> </span>purposes<span class="w w1"> </span>notwithstanding<span class="w w1"> </span>any<span class="w w2"> </span>copyright</div>
<div class="l f2 s4 c0" style="bottom:76.4693px;top:707.515px;left:317.014px;">annotation<span class="w w2"> </span>thereon.<span class="w w1"> </span>Any<span class="w w2"> </span>opinions,<span class="w w2"> </span>findings,<span class="w w1"> </span>and<span class="w w2"> </span>conclusions<span class="w w1"> </span>or<span class="w w2"> </span>rec-</div>
<div class="l f2 s4 c0" style="bottom:66.5066px;top:717.477px;left:317.014px;">ommendations<span class="w w1"> </span>expressed<span class="w w1"> </span>here<span class="w w1"> </span>are<span class="w w0"> </span>those<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>author<span class="w w1"> </span>and<span class="w w0"> </span>should</div>
</div>
<div id="page-14" class="p" style="width:612px;height:792px;background-image:url(pe.png);background-position:0 0;background-size:612px 792px;background-repeat:no-repeat;">
<div class="l f2 s4 c0" style="bottom:710.093px;top:73.8909px;left:54px;">not<span class="w w1"> </span>be<span class="w w0"> </span>interpreted<span class="w w0"> </span>as<span class="w w1"> </span>necessarily<span class="w w0"> </span>representing<span class="w w1"> </span>the<span class="w w0"> </span>official<span class="w w1"> </span>views,</div>
<div class="l f2 s4 c0" style="bottom:700.13px;top:83.8536px;left:54px;">policies<span class="w w1"> </span>or<span class="w w1"> </span>endorsements,<span class="w w1"> </span>either<span class="w w0"> </span>expressed<span class="w w1"> </span>or<span class="w w1"> </span>implied,<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>Na-</div>
<div class="l f2 s4 c0" style="bottom:690.168px;top:93.8162px;left:54px;">tional<span class="w w2"> </span>Science<span class="w w2"> </span>foundation<span class="w w1"> </span>(NSF),<span class="w w2"> </span>any<span class="w w2"> </span>other<span class="w w1"> </span>agency<span class="w w2"> </span>of<span class="w w2"> </span>the<span class="w w2"> </span>U.S.<span class="w w1"> </span>Gov-</div>
<div class="l f2 s4 c0" style="bottom:680.205px;top:103.779px;left:54px;">ernment,<span class="w w2"> </span>or<span class="w w1"> </span>any<span class="w w1"> </span>of<span class="w w2"> </span>the<span class="w w1"> </span>companies<span class="w w2"> </span>mentioned<span class="w w1"> </span>above.</div>
<div class="l f1 s2 c0" style="bottom:658.93px;top:123.218px;left:54px;">References</div>
<div class="l f2 s3 c0" style="bottom:646.547px;top:138.327px;left:57.9851px;">[1]<span class="w w1"> </span>LuaJIT<span class="w w3"> </span>roadmap<span class="w w10"> </span>2008<span class="w w3"> </span>-<span class="w w10"> </span>http://lua-users.org/lists/lua-l/2008-</div>
<div class="l f2 s3 c0" style="bottom:637.581px;top:147.294px;left:70.7651px;">02/msg00051.html.</div>
<div class="l f2 s3 c0" style="bottom:625.875px;top:159px;left:57.9851px;">[2]<span class="w w1"> </span>Mozilla<span class="w w0"> </span>—<span class="w w0"> </span>Firefox<span class="w w0"> </span>web<span class="w w0"> </span>browser<span class="w w1"> </span>and<span class="w w0"> </span>Thunderbird<span class="w w0"> </span>email<span class="w w0"> </span>client<span class="w w0"> </span>-</div>
<div class="l f2 s3 c0" style="bottom:616.909px;top:167.966px;left:70.7651px;">http://www.mozilla.com.</div>
<div class="l f2 s3 c0" style="bottom:605.202px;top:179.672px;left:57.9851px;">[3]<span class="w w1"> </span>SPECJVM98<span class="w w1"> </span>-<span class="w w2"> </span>http://www.spec.org/jvm98/.</div>
<div class="l f2 s3 c0" style="bottom:593.496px;top:191.378px;left:57.9851px;">[4]<span class="w w1"> </span>SpiderMonkey<span class="w w17"> </span>(JavaScript-C)<span class="w w17"> </span>Engine<span class="w wf"> </span>-</div>
<div class="l f2 s3 c0" style="bottom:584.53px;top:200.345px;left:70.7651px;">http://www.mozilla.org/js/spidermonkey/.</div>
<div class="l f2 s3 c0" style="bottom:572.824px;top:212.051px;left:57.9851px;">[5]<span class="w w1"> </span>Surfin’<span class="w w1"> </span>Safari<span class="w w0"> </span>-<span class="w w2"> </span>Blog<span class="w w0"> </span>Archive<span class="w w2"> </span>-<span class="w w1"> </span>Announcing<span class="w w0"> </span>SquirrelFish<span class="w w2"> </span>Extreme<span class="w w0"> </span>-</div>
<div class="l f2 s3 c0" style="bottom:563.857px;top:221.017px;left:70.7651px;">http://webkit.org/blog/214/introducing-squirrelfish-extreme/.</div>
<div class="l f2 s3 c0" style="bottom:552.151px;top:232.723px;left:57.9851px;">[6]<span class="w w1"> </span>A.<span class="w w0"> </span>Aho,<span class="w w1"> </span>R.<span class="w w1"> </span>Sethi,<span class="w w1"> </span>J.<span class="w w0"> </span>Ullman,<span class="w w1"> </span>and<span class="w w1"> </span>M.<span class="w w0"> </span>Lam.<span class="w w4"> </span>Compilers:<span class="w w1"> </span>Principles,</div>
<div class="l f2 s3 c0" style="bottom:543.185px;top:241.69px;left:70.7651px;">techniques,<span class="w w2"> </span>and<span class="w w1"> </span>tools,<span class="w w2"> </span>2006.</div>
<div class="l f2 s3 c0" style="bottom:531.479px;top:253.396px;left:57.9851px;">[7]<span class="w w1"> </span>V.<span class="w w1"> </span>Bala,<span class="w w1"> </span>E.<span class="w w0"> </span>Duesterwald,<span class="w w1"> </span>and<span class="w w1"> </span>S.<span class="w w1"> </span>Banerjia.<span class="w w2a"> </span>Dynamo:<span class="w w1"> </span>A<span class="w w1"> </span>transparent</div>
<div class="l f2 s3 c0" style="bottom:522.512px;top:262.362px;left:70.7651px;">dynamic<span class="w w2"> </span>optimization<span class="w w1"> </span>system.<span class="w w0"> </span>In</div>
<div class="l fa s3 c0" style="bottom:522.696px;top:262.442px;left:180.023px;">Proceedings<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>ACM<span class="w w2"> </span>SIGPLAN</div>
<div class="l fa s3 c0" style="bottom:513.729px;top:271.408px;left:70.7651px;">Conference<span class="w w2"> </span>on<span class="w w1"> </span>Programming<span class="w w1"> </span>Language<span class="w w1"> </span>Design<span class="w w2"> </span>and<span class="w w1"> </span>Implementation</div>
<div class="l f2 s3 c0" style="bottom:513.546px;top:271.329px;left:291.111px;">,</div>
<div class="l f2 s3 c0" style="bottom:504.58px;top:280.295px;left:70.7651px;">pages<span class="w w2"> </span>1–12.<span class="w w1"> </span>ACM<span class="w w2"> </span>Press,<span class="w w2"> </span>2000.</div>
<div class="l f2 s3 c0" style="bottom:492.874px;top:292.001px;left:57.9851px;">[8]<span class="w w1"> </span>M.<span class="w w1"> </span>Berndl,<span class="w w1"> </span>B.<span class="w w2"> </span>Vitale,<span class="w w1"> </span>M.<span class="w w2"> </span>Zaleski,<span class="w w1"> </span>and<span class="w w2"> </span>A.<span class="w w1"> </span>Brown.<span class="w w0"> </span>Context<span class="w w2"> </span>Threading:</div>
<div class="l f2 s3 c0" style="bottom:483.907px;top:300.967px;left:70.7651px;">a<span class="w w1"> </span>Flexible<span class="w w1"> </span>and<span class="w w1"> </span>Efficient<span class="w w2"> </span>Dispatch<span class="w w1"> </span>Technique<span class="w w1"> </span>for<span class="w w1"> </span>Virtual<span class="w w2"> </span>Machine<span class="w w1"> </span>In-</div>
<div class="l f2 s3 c0" style="bottom:474.941px;top:309.934px;left:70.7651px;">terpreters.<span class="w w0"> </span>In</div>
<div class="l fa s3 c0" style="bottom:475.124px;top:310.014px;left:116.627px;">Code<span class="w w1"> </span>Generation<span class="w w2"> </span>and<span class="w w1"> </span>Optimization,<span class="w w1"> </span>2005.<span class="w w1"> </span>CGO<span class="w w1"> </span>2005.</div>
<div class="l fa s3 c0" style="bottom:466.158px;top:318.98px;left:70.7651px;">International<span class="w w2"> </span>Symposium<span class="w w1"> </span>on</div>
<div class="l f2 s3 c0" style="bottom:465.974px;top:318.9px;left:161.09px;">,<span class="w w2"> </span>pages<span class="w w1"> </span>15–26,<span class="w w2"> </span>2005.</div>
<div class="l f2 s3 c0" style="bottom:454.268px;top:330.606px;left:57.9851px;">[9]<span class="w w1"> </span>C.<span class="w w0"> </span>Chambers<span class="w w1"> </span>and<span class="w w1"> </span>D.<span class="w w0"> </span>Ungar.<span class="w w4"> </span>Customization:<span class="w w0"> </span>Optimizing<span class="w w1"> </span>Compiler</div>
<div class="l f2 s3 c0" style="bottom:445.302px;top:339.573px;left:70.7651px;">Technology<span class="w w1"> </span>for<span class="w w1"> </span>SELF,<span class="w w1"> </span>a<span class="w w1"> </span>Dynamically-Typed<span class="w w1"> </span>O<span class="w w0"> </span>bject-Oriented<span class="w w1"> </span>Pro-</div>
<div class="l f2 s3 c0" style="bottom:436.336px;top:348.539px;left:70.7651px;">gramming<span class="w w1"> </span>Language.<span class="w w2a"> </span>In</div>
<div class="l fa s3 c0" style="bottom:436.519px;top:348.619px;left:157.004px;">Proceedings<span class="w w1"> </span>of<span class="w w1"> </span>the<span class="w w0"> </span>ACM<span class="w w1"> </span>SIGPLAN<span class="w w1"> </span>1989</div>
<div class="l fa s3 c0" style="bottom:427.553px;top:357.585px;left:70.7651px;">Conference<span class="w w2"> </span>on<span class="w w1"> </span>Programming<span class="w w1"> </span>Language<span class="w w1"> </span>Design<span class="w w2"> </span>and<span class="w w1"> </span>Implementation</div>
<div class="l f2 s3 c0" style="bottom:427.369px;top:357.505px;left:291.111px;">,</div>
<div class="l f2 s3 c0" style="bottom:418.403px;top:366.472px;left:70.7651px;">pages<span class="w w2"> </span>146–160.<span class="w w1"> </span>ACM<span class="w w2"> </span>New<span class="w w2"> </span>York,<span class="w w2"> </span>NY,<span class="w w2"> </span>USA,<span class="w w2"> </span>1989.</div>
<div class="l f2 s3 c0" style="bottom:710.308px;top:74.5666px;left:317.014px;">[10]<span class="w w1"> </span>A.<span class="w w1"> </span>Gal.</div>
<div class="l fa s3 c0" style="bottom:710.491px;top:74.6463px;left:362.103px;">Efficient<span class="w w2"> </span>Bytecode<span class="w w1"> </span>Verification<span class="w w1"> </span>and<span class="w w2"> </span>Compilation<span class="w w1"> </span>in<span class="w w1"> </span>a<span class="w w1"> </span>Virtual</div>
<div class="l fa s3 c0" style="bottom:701.525px;top:83.6126px;left:333.779px;">Machine<span class="w w1"> </span>Dissertation</div>
<div class="l f2 s3 c0" style="bottom:701.342px;top:83.5329px;left:403.706px;">.<span class="w w0"> </span>PhD<span class="w w1"> </span>thesis,<span class="w w1"> </span>University<span class="w w1"> </span>Of<span class="w w1"> </span>California,<span class="w w1"> </span>Irvine,</div>
<div class="l f2 s3 c0" style="bottom:692.375px;top:92.4993px;left:333.779px;">2006.</div>
<div class="l f2 s3 c0" style="bottom:680.42px;top:104.454px;left:317.014px;">[11]<span class="w w1"> </span>A.<span class="w w1"> </span>Gal,<span class="w w1"> </span>C.<span class="w w1"> </span>W.<span class="w w1"> </span>Probst,<span class="w w1"> </span>and<span class="w w1"> </span>M.<span class="w w1"> </span>Franz.<span class="w w4"> </span>HotpathVM:<span class="w w1"> </span>An<span class="w w1"> </span>effective<span class="w w1"> </span>JIT</div>
<div class="l f2 s3 c0" style="bottom:671.454px;top:113.421px;left:333.779px;">compiler<span class="w w1"> </span>for<span class="w w0"> </span>resource-constrained<span class="w w0"> </span>devices.<span class="w w2a"> </span>In</div>
<div class="l fa s3 c0" style="bottom:671.637px;top:113.501px;left:493.287px;">Proceedings<span class="w w1"> </span>of<span class="w w0"> </span>the</div>
<div class="l fa s3 c0" style="bottom:662.671px;top:122.467px;left:333.779px;">International<span class="w w1"> </span>Conference<span class="w w1"> </span>on<span class="w w1"> </span>Virtual<span class="w w1"> </span>Execution<span class="w w1"> </span>Environments</div>
<div class="l f2 s3 c0" style="bottom:662.488px;top:122.387px;left:532.935px;">,<span class="w w1"> </span>pages</div>
<div class="l f2 s3 c0" style="bottom:653.521px;top:131.354px;left:333.779px;">144–153.<span class="w w2"> </span>ACM<span class="w w2"> </span>Press,<span class="w w1"> </span>2006.</div>
<div class="l f2 s3 c0" style="bottom:641.566px;top:143.309px;left:317.014px;">[12]<span class="w w1"> </span>C.<span class="w w1"> </span>Garrett,<span class="w w1"> </span>J.<span class="w w1"> </span>Dean,<span class="w w1"> </span>D.<span class="w w1"> </span>Grove,<span class="w w1"> </span>and<span class="w w1"> </span>C.<span class="w w1"> </span>Chambers.<span class="w w0"> </span>Measurement<span class="w w1"> </span>and</div>
<div class="l f2 s3 c0" style="bottom:632.6px;top:152.275px;left:333.779px;">Application<span class="w w2"> </span>of<span class="w w1"> </span>Dynamic<span class="w w2"> </span>Receiver<span class="w w2"> </span>Class<span class="w w1"> </span>Distributions.<span class="w w1"> </span>1994.</div>
<div class="l f2 s3 c0" style="bottom:620.644px;top:164.23px;left:317.014px;">[13]<span class="w w1"> </span>J.<span class="w w1"> </span>Ha,<span class="w w1"> </span>M.<span class="w w2"> </span>R.<span class="w w1"> </span>Haghighat,<span class="w w1"> </span>S.<span class="w w2"> </span>Cong,<span class="w w1"> </span>and<span class="w w1"> </span>K.<span class="w w1"> </span>S.<span class="w w2"> </span>McKinley.<span class="w w0"> </span>A<span class="w w2"> </span>concurrent</div>
<div class="l f2 s3 c0" style="bottom:611.678px;top:173.197px;left:333.779px;">trace-based<span class="w w1"> </span>just-in-time<span class="w w1"> </span>compiler<span class="w w0"> </span>for<span class="w w1"> </span>javascript.<span class="w w4"> </span>Dept.of<span class="w w0"> </span>Computer</div>
<div class="l f2 s3 c0" style="bottom:602.712px;top:182.163px;left:333.779px;">Sciences,<span class="w w2"> </span>The<span class="w w1"> </span>University<span class="w w2"> </span>of<span class="w w2"> </span>Texas<span class="w w2"> </span>at<span class="w w1"> </span>Austin,<span class="w w2"> </span>TR-09-06,<span class="w w1"> </span>2009.</div>
<div class="l f2 s3 c0" style="bottom:590.756px;top:194.118px;left:317.014px;">[14]<span class="w w1"> </span>B.<span class="w w1"> </span>McCloskey.<span class="w w2"> </span>Personal<span class="w w1"> </span>communication.</div>
<div class="l f2 s3 c0" style="bottom:578.801px;top:206.073px;left:317.014px;">[15]<span class="w w1"> </span>I.<span class="w w1"> </span>Piumarta<span class="w w2"> </span>and<span class="w w2"> </span>F.<span class="w w2"> </span>Riccardi.<span class="w w1"> </span>Optimizing<span class="w w2"> </span>direct<span class="w w1"> </span>threaded<span class="w w2"> </span>code<span class="w w2"> </span>by<span class="w w1"> </span>selec-</div>
<div class="l f2 s3 c0" style="bottom:569.835px;top:215.04px;left:333.779px;">tive<span class="w w2"> </span>inlining.<span class="w w0"> </span>In</div>
<div class="l fa s3 c0" style="bottom:570.018px;top:215.119px;left:387.542px;">Proceedings<span class="w w2"> </span>of<span class="w w1"> </span>the<span class="w w1"> </span>ACM<span class="w w2"> </span>SIGPLAN<span class="w w1"> </span>1998<span class="w w1"> </span>conference</div>
<div class="l fa s3 c0" style="bottom:561.052px;top:224.086px;left:333.779px;">on<span class="w w1"> </span>Programming<span class="w w1"> </span>language<span class="w w1"> </span>design<span class="w w0"> </span>and<span class="w w1"> </span>implementation</div>
<div class="l f2 s3 c0" style="bottom:560.869px;top:224.006px;left:513.675px;">,<span class="w w1"> </span>pages<span class="w w1"> </span>291–</div>
<div class="l f2 s3 c0" style="bottom:551.902px;top:232.973px;left:333.779px;">300.<span class="w w2"> </span>ACM<span class="w w2"> </span>New<span class="w w1"> </span>York,<span class="w w2"> </span>NY</div>
<div class="l f2 s3 c0" style="bottom:551.902px;top:232.973px;left:416.357px;">,<span class="w w2"> </span>USA,<span class="w w1"> </span>1998.</div>
<div class="l f2 s3 c0" style="bottom:539.947px;top:244.928px;left:317.014px;">[16]<span class="w w1"> </span>A.<span class="w w0"> </span>Rigo.<span class="w w4"> </span>Representation-Based<span class="w w1"> </span>Just-In-time<span class="w w0"> </span>Specialization<span class="w w1"> </span>and<span class="w w1"> </span>the</div>
<div class="l f2 s3 c0" style="bottom:530.981px;top:253.894px;left:333.779px;">Psyco<span class="w w2"> </span>Prototype<span class="w w1"> </span>for<span class="w w2"> </span>Python.<span class="w w1"> </span>In</div>
<div class="l fa s3 c0" style="bottom:531.164px;top:253.974px;left:435.166px;">PEPM</div>
<div class="l f2 s3 c0" style="bottom:530.981px;top:253.894px;left:456.414px;">,<span class="w w2"> </span>2004.</div>
<div class="l f2 s3 c0" style="bottom:519.025px;top:265.849px;left:317.014px;">[17]<span class="w w1"> </span>M.<span class="w w0"> </span>Salib.<span class="w w10"> </span>Starkiller:<span class="w w1"> </span>A<span class="w w0"> </span>Static<span class="w w0"> </span>Type<span class="w w1"> </span>Inferencer<span class="w w0"> </span>and<span class="w w1"> </span>Compiler<span class="w w0"> </span>for</div>
<div class="l f2 s3 c0" style="bottom:510.059px;top:274.816px;left:333.779px;">Python.<span class="w w1"> </span>In</div>
<div class="l fa s3 c0" style="bottom:510.242px;top:274.895px;left:369.859px;">Master’s<span class="w w2"> </span>Thesis</div>
<div class="l f2 s3 c0" style="bottom:510.059px;top:274.816px;left:420.238px;">,<span class="w w2"> </span>2004.</div>
<div class="l f2 s3 c0" style="bottom:498.104px;top:286.771px;left:317.014px;">[18]<span class="w w1"> </span>T.<span class="w w1"> </span>Suganuma,<span class="w w2"> </span>T.<span class="w w1"> </span>Yasue,<span class="w w2"> </span>and<span class="w w1"> </span>T.<span class="w w2"> </span>Nakatani.<span class="w w0"> </span>A<span class="w w1"> </span>Region-Based<span class="w w2"> </span>Compila-</div>
<div class="l f2 s3 c0" style="bottom:489.138px;top:295.737px;left:333.779px;">tion<span class="w w1"> </span>Technique<span class="w w2"> </span>for<span class="w w1"> </span>Dynamic<span class="w w1"> </span>Compilers.</div>
<div class="l fa s3 c0" style="bottom:489.321px;top:295.817px;left:468.368px;">ACM<span class="w w2"> </span>Transactions<span class="w w1"> </span>on<span class="w w1"> </span>Pro-</div>
<div class="l fa s3 c0" style="bottom:480.354px;top:304.783px;left:333.779px;">gramming<span class="w w2"> </span>Languages<span class="w w2"> </span>and<span class="w w1"> </span>Systems<span class="w w2"> </span>(TOPLAS)</div>
<div class="l f2 s3 c0" style="bottom:480.171px;top:304.704px;left:479.91px;">,<span class="w w2"> </span>28(1):134–174,<span class="w w1"> </span>2006.</div>
<div class="l f2 s3 c0" style="bottom:468.216px;top:316.659px;left:317.014px;">[19]<span class="w w1"> </span>M.<span class="w w0"> </span>Zaleski,<span class="w w1"> </span>A.<span class="w w0"> </span>D.<span class="w w0"> </span>Brown,<span class="w w1"> </span>and<span class="w w0"> </span>K.<span class="w w1"> </span>Stoodley.<span class="w w2a"> </span>YETI:<span class="w w0"> </span>A<span class="w w0"> </span>graduallY</div>
<div class="l f2 s3 c0" style="bottom:459.25px;top:325.625px;left:333.779px;">Extensible<span class="w w0"> </span>Trace<span class="w w1"> </span>Interpreter.<span class="w w10"> </span>In</div>
<div class="l fa s3 c0" style="bottom:459.433px;top:325.705px;left:447.299px;">Proceedings<span class="w w1"> </span>of<span class="w w0"> </span>the<span class="w w0"> </span>International</div>
<div class="l fa s3 c0" style="bottom:450.467px;top:334.671px;left:333.779px;">Conference<span class="w w1"> </span>on<span class="w w1"> </span>Virtual<span class="w w1"> </span>Execution<span class="w w1"> </span>Environments</div>
<div class="l f2 s3 c0" style="bottom:450.283px;top:334.591px;left:487.41px;">,<span class="w w1"> </span>pages<span class="w w1"> </span>83–93.<span class="w w1"> </span>ACM</div>
<div class="l f2 s3 c0" style="bottom:441.317px;top:343.558px;left:333.779px;">Press,<span class="w w2"> </span>2007.</div>
</div>
</div></body></html>

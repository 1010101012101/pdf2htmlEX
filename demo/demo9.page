<div class="pd w0 h0"><div id="pf9" class="pf" data-page-no="9"><div class="pc pc9"><img class="bi" alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABMgAAAYwCAIAAAAI8uQFAAAACXBIWXMAABYlAAAWJQFJUiTwAAAeuklEQVR42uzXMQEAAAjDMMC/580DdyKhXzfJAAAAwNdJAAAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAADAWEoAAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAMBYSgAAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAwFhKAAAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAADAWEoAAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEqDt1yEBAAAAgKD/rz1hhAk2AQAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAjKUEAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAABhLAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAIwlAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAABgLAEAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAAAwlgAAABhLAAAAjCUAAADGEgAAAGMJAAAAxhIAAABjCQAAgLEEAADAWAIAAICxBAAAwFgCAABgLAEAADCWAAAAYCwBAAAwlgAAABhLAAAAjCUAAAAYSwAAAIwlAAAAxhIAAABjCQAAgLEEAAAAYwkAAICxBAAAwFgCAABgLAEAAMBYAgAAYCwBAAAwlgAAABhLAAAAMJYAAAAYSwAAAIwlAAAAxhIAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAADGEgAAAGMJAACAsQQAAMBYAgAAgLEEAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAADGEgAAAGMJAACAsQQAAABjCQAAgLEEAADAWAIAAGAsAQAAwFgCAABgLAEAADCWAAAAGEsAAACMpQQAAAAYSwAAAIwlAAAAxhIAAABjCQAAAMYSAAAAYwkAAICxBAAAwFgCAACAsQQAAMBYAgAAYCwBAAAwlgAAAGAsAQAAMJYAAAAYSwAAAIwlAAAAGEsAAACMJQAAAMYSAAAAYwkAAICxBAAAAGMJAACAsQQAAMBYAgAAYCwBAADAWAIAAGAsAQAAMJYAAAAYSwAAADCWAAAAGEsAAACMJQAAAMYSAAAAjCUAAACPAKB3D11PBfOFAAAAAElFTkSuQmCC"/><div class="t m0 x11 h3 y53 ff2 fs3 fc0 sc0 ls0 ws8">When a<span class="_ _7"> </span>trace<span class="_ _7"> </span>call returns,<span class="_ _7"> </span>the<span class="_ _7"> </span>monitor restores<span class="_ _7"> </span>the<span class="_ _7"> </span>interpreter</div><div class="t m0 xd h3 y54 ff2 fs3 fc0 sc0 ls0 wsa">state. First, the monitor checks the reason for the trace e<span class="_ _1"></span>xit and</div><div class="t m0 xd h3 y55 ff2 fs3 fc0 sc0 ls0 ws8">applies blacklisting<span class="_ _7"> </span>if<span class="_ _7"> </span>needed. Then,<span class="_ _7"> </span>it<span class="_ _7"> </span>pops or<span class="_ _7"> </span>synthesizes<span class="_ _7"> </span>inter<span class="_ _1"></span>-</div><div class="t m0 xd h3 y56 ff2 fs3 fc0 sc0 ls0 ws6">preter Jav<span class="_ _1"></span>aScript call stack frames as<span class="_ _5"> </span>needed. Finally<span class="_ _1"></span>,<span class="_ _3"> </span>it copies the</div><div class="t m0 xd h3 y57 ff2 fs3 fc0 sc0 ls0 ws2">imported v<span class="_ _1"></span>ariables back<span class="_ _5"> </span>from the trace acti<span class="_ _1"></span>v<span class="_ _1"></span>ation record<span class="_ _5"> </span>to the in-</div><div class="t m0 xd h3 y58 ff2 fs3 fc0 sc0 ls0 ws4">terpreter state.</div><div class="t m0 x11 h3 y59 ff2 fs3 fc0 sc0 ls0 ws2">At least in<span class="_ _6"> </span>the current implementation,<span class="_ _6"> </span>these steps ha<span class="_ _1"></span>ve<span class="_ _6"> </span>a non-</div><div class="t m0 xd h3 y5a ff2 fs3 fc0 sc0 ls0 ws5">negligible runtime cost, so minimizing the number of interpreter<span class="_ _1"></span>-</div><div class="t m0 xd h3 y5b ff2 fs3 fc0 sc0 ls0 ws14">to-trace and trace-to-interpreter transitions is essential for perfor-</div><div class="t m0 xd h3 y5c ff2 fs3 fc0 sc0 ls0 ws13">mance. (see also Section 3.3). Our<span class="_ _b"> </span>experiments (see<span class="_ _b"> </span>Figure 12)</div><div class="t m0 xd h3 y5d ff2 fs3 fc0 sc0 ls0 ws13">show<span class="_ _b"> </span>that for programs<span class="_ _b"> </span>we can<span class="_ _b"> </span>trace well such<span class="_ _b"> </span>transitions hap-</div><div class="t m0 xd h3 y5e ff2 fs3 fc0 sc0 ls0 ws2">pen infrequently and hence do not contribute signiﬁcantly to total</div><div class="t m0 xd h3 y5f ff2 fs3 fc0 sc0 ls0 ws8">runtime. In<span class="_ _7"> </span>a fe<span class="_ _1"></span>w<span class="_ _7"> </span>programs,<span class="_ _7"> </span>where the<span class="_ _7"> </span>system is<span class="_ _7"> </span>pre<span class="_ _1"></span>vented<span class="_ _7"> </span>from</div><div class="t m0 xd h3 y60 ff2 fs3 fc0 sc0 ls0 ws14">recording branch traces for<span class="_ _7"> </span>hot<span class="_ _7"> </span>s<span class="_ _1"></span>ide e<span class="_ _1"></span>xits by aborts,<span class="_ _7"> </span>this<span class="_ _7"> </span>cost<span class="_ _7"> </span>can</div><div class="t m0 xd h3 y61 ff2 fs3 fc0 sc0 ls0 ws4">rise to up to 10% of total ex<span class="_ _1"></span>ecution time.</div><div class="t m0 xd ha y20a ff1 fs3 fc0 sc0 ls0 ws4">6.2<span class="_ _8"> </span>T<span class="_ _4"></span>race Stitching</div><div class="t m0 xd h3 y179 ff2 fs3 fc0 sc0 ls0 ws14">T<span class="_ _1"></span>ransitions from<span class="_ _7"> </span>a<span class="_ _6"> </span>trace to a branch<span class="_ _7"> </span>trace<span class="_ _7"> </span>at<span class="_ _6"> </span>a side exit<span class="_ _7"> </span>a<span class="_ _1"></span>v<span class="_ _1"></span>oid<span class="_ _7"> </span>the</div><div class="t m0 xd h3 y17a ff2 fs3 fc0 sc0 ls0 ws14">costs of calling traces from the monitor<span class="_ _1"></span>, in a feature called <span class="ffa ws1">trace</span></div><div class="t m0 xd h3 y17b ffa fs3 fc0 sc0 ls0 ws1">stitching<span class="ff2 ws5">. At a side e<span class="_ _1"></span>xit, the e<span class="_ _1"></span>xiting trace only needs to write li<span class="_ _1"></span>ve</span></div><div class="t m0 xd h3 y20b ff2 fs3 fc0 sc0 ls0 ws4">register<span class="_ _1"></span>-carried<span class="_ _3"> </span>values<span class="_ _3"> </span>back<span class="_ _3"> </span>to<span class="_ _3"> </span>its trace<span class="_ _3"> </span>acti<span class="_ _1"></span>v<span class="_ _1"></span>ation record.<span class="_ _3"> </span>In<span class="_ _3"> </span>our<span class="_ _3"> </span>im-</div><div class="t m0 xd h3 y20c ff2 fs3 fc0 sc0 ls0 ws2">plementation, identical<span class="_ _5"> </span>type maps yield identical<span class="_ _5"> </span>activ<span class="_ _1"></span>ation record</div><div class="t m0 xd h3 y20d ff2 fs3 fc0 sc0 ls0 ws14">layouts, so the trace acti<span class="_ _1"></span>v<span class="_ _1"></span>ation record can be reused immediately</div><div class="t m0 xd h3 y20e ff2 fs3 fc0 sc0 ls0 ws4">by the branch trace.</div><div class="t m0 x11 h3 y20f ff2 fs3 fc0 sc0 ls0 wsa">In programs with<span class="_ _7"> </span>branchy trace trees with<span class="_ _7"> </span>small traces, trace</div><div class="t m0 xd h3 y1cf ff2 fs3 fc0 sc0 ls0 ws8">stitching has<span class="_ _7"> </span>a noticeable<span class="_ _7"> </span>cost. Although writing<span class="_ _7"> </span>to memory<span class="_ _7"> </span>and</div><div class="t m0 xd h3 y1f3 ff2 fs3 fc0 sc0 ls0 ws0">then soon<span class="_ _a"> </span>reading<span class="_ _a"> </span>back<span class="_ _a"> </span>would<span class="_ _a"> </span>be e<span class="_ _1"></span>xpected<span class="_ _a"> </span>to ha<span class="_ _1"></span>v<span class="_ _1"></span>e a<span class="_ _a"> </span>high<span class="_ _a"> </span>L1</div><div class="t m0 xd h3 y1f4 ff2 fs3 fc0 sc0 ls0 ws5">cache hit<span class="_ _6"> </span>rate, for small<span class="_ _6"> </span>traces the<span class="_ _6"> </span>increased instruction count<span class="_ _6"> </span>has</div><div class="t m0 xd h3 y1f5 ff2 fs3 fc0 sc0 ls0 ws0">a noticeable<span class="_ _a"> </span>cost.<span class="_ _a"> </span>Also, if<span class="_ _a"> </span>the<span class="_ _a"> </span>writes<span class="_ _a"> </span>and reads<span class="_ _a"> </span>are<span class="_ _a"> </span>very<span class="_ _a"> </span>close</div><div class="t m0 xd h3 y1f6 ff2 fs3 fc0 sc0 ls0 ws0">in the<span class="_ _a"> </span>dynamic instruction<span class="_ _a"> </span>stream, we<span class="_ _a"> </span>hav<span class="_ _1"></span>e found<span class="_ _a"> </span>that<span class="_ _a"> </span>current</div><div class="t m0 xd h3 y1f7 ff2 fs3 fc0 sc0 ls0 ws8">x86 processors<span class="_ _7"> </span>often incur<span class="_ _7"> </span>penalties<span class="_ _7"> </span>of 6<span class="_ _7"> </span>cycles<span class="_ _7"> </span>or more<span class="_ _7"> </span>(e.g., if</div><div class="t m0 xd h3 y1f8 ff2 fs3 fc0 sc0 ls0 ws5">the instructions use dif<span class="_ _1"></span>ferent base registers<span class="_ _6"> </span>with equal values, the</div><div class="t m0 xd h3 y1f9 ff2 fs3 fc0 sc0 ls0 ws6">processor may<span class="_ _3"> </span>not be<span class="_ _3"> </span>able to<span class="_ _3"> </span>detect that the<span class="_ _3"> </span>addresses are<span class="_ _3"> </span>the same</div><div class="t m0 xd h3 y1fa ff2 fs3 fc0 sc0 ls0 ws4">right away).</div><div class="t m0 x11 h3 y1fb ff2 fs3 fc0 sc0 ls0 ws5">The alternate<span class="_ _6"> </span>solution is to<span class="_ _6"> </span>recompile an<span class="_ _6"> </span>entire trace tree,<span class="_ _6"> </span>thus</div><div class="t m0 xd h3 y1fc ff2 fs3 fc0 sc0 ls0 ws8">achieving<span class="_ _7"> </span>inter<span class="_ _1"></span>-trace<span class="_ _7"> </span>register<span class="_ _7"> </span>allocation<span class="_ _7"> </span>(10).<span class="_ _7"> </span>The<span class="_ _7"> </span>disadvantage<span class="_ _7"> </span>is</div><div class="t m0 xd h3 y1fd ff2 fs3 fc0 sc0 ls0 wsd">that tree recompilation<span class="_ _3"> </span>tak<span class="_ _1"></span>es time<span class="_ _3"> </span>quadratic<span class="_ _9"> </span>in the number of traces.</div><div class="t m0 xd h3 y1fe ff2 fs3 fc0 sc0 ls0 ws13">W<span class="_ _4"></span>e believe that the cost of recompiling a trace tree e<span class="_ _1"></span>v<span class="_ _1"></span>ery time</div><div class="t m0 xd h3 y1ff ff2 fs3 fc0 sc0 ls0 ws12">a branch<span class="_ _b"> </span>is<span class="_ _b"> </span>added w<span class="_ _1"></span>ould be<span class="_ _b"> </span>prohibiti<span class="_ _1"></span>v<span class="_ _1"></span>e. That<span class="_ _b"> </span>problem<span class="_ _b"> </span>might<span class="_ _b"> </span>be</div><div class="t m0 xd h3 y200 ff2 fs3 fc0 sc0 ls0 ws8">mitigated by<span class="_ _7"> </span>recompiling only<span class="_ _7"> </span>at certain<span class="_ _7"> </span>points, or<span class="_ _7"> </span>only for<span class="_ _7"> </span>very</div><div class="t m0 xd h3 y201 ff2 fs3 fc0 sc0 ls0 ws4">hot, stable trees.</div><div class="t m0 x11 h3 y202 ff2 fs3 fc0 sc0 ls0 wsa">In the future,<span class="_ _7"> </span>multicore hardware is<span class="_ _7"> </span>expected to<span class="_ _7"> </span>be common,</div><div class="t m0 xd h3 y203 ff2 fs3 fc0 sc0 ls0 ws14">making background tree recompilation attracti<span class="_ _1"></span>ve. In<span class="_ _7"> </span>a<span class="_ _7"> </span>closely<span class="_ _7"> </span>re-</div><div class="t m0 xd h3 y204 ff2 fs3 fc0 sc0 ls0 ws8">lated project (13)<span class="_ _7"> </span>background recompilation yielded<span class="_ _7"> </span>speedups of</div><div class="t m0 xd h3 y205 ff2 fs3 fc0 sc0 ls0 ws14">up to 1.25x on<span class="_ _7"> </span>benchmarks<span class="_ _7"> </span>with<span class="_ _6"> </span>many branch traces. W<span class="_ _4"></span>e plan to</div><div class="t m0 xd h3 y206 ff2 fs3 fc0 sc0 ls0 ws4">apply this technique to T<span class="_ _1"></span>raceMonke<span class="_ _1"></span>y as future work.</div><div class="t m0 xd ha y210 ff1 fs3 fc0 sc0 ls0 ws4">6.3<span class="_ _8"> </span>T<span class="_ _4"></span>race Recording</div><div class="t m0 xd h3 yc0 ff2 fs3 fc0 sc0 ls0 wsd">The job of<span class="_ _9"> </span>the trace recorder is to<span class="_ _9"> </span>emit LIR with identical semantics</div><div class="t m0 xd h3 yc1 ff2 fs3 fc0 sc0 ls0 ws2">to the currently<span class="_ _5"> </span>running interpreter bytecode trace. A<span class="_ _5"> </span>good imple-</div><div class="t m0 xd h3 yc2 ff2 fs3 fc0 sc0 ls0 ws5">mentation should ha<span class="_ _1"></span>ve lo<span class="_ _1"></span>w impact<span class="_ _6"> </span>on non-tracing interpreter per-</div><div class="t m0 xd h3 y116 ff2 fs3 fc0 sc0 ls0 ws5">formance and a con<span class="_ _1"></span>venient w<span class="_ _1"></span>ay for implementers to maintain se-</div><div class="t m0 xd h3 yc4 ff2 fs3 fc0 sc0 ls0 ws4">mantic equiv<span class="_ _1"></span>alence.</div><div class="t m0 x11 h3 yc5 ff2 fs3 fc0 sc0 ls0 ws4">In our implementation,<span class="_ _3"> </span>the only direct modiﬁcation<span class="_ _3"> </span>to the inter<span class="_ _1"></span>-</div><div class="t m0 xd h3 yc6 ff2 fs3 fc0 sc0 ls0 ws4">preter is<span class="_ _3"> </span>a call<span class="_ _3"> </span>to the<span class="_ _3"> </span>trace monitor<span class="_ _3"> </span>at loop<span class="_ _3"> </span>edges. In<span class="_ _3"> </span>our benchmark</div><div class="t m0 xd h3 y88 ff2 fs3 fc0 sc0 ls0 ws5">results (see Figure 12) the total time spent in the monitor (for all</div><div class="t m0 xd h3 y89 ff2 fs3 fc0 sc0 ls0 ws8">activities)<span class="_ _7"> </span>is<span class="_ _7"> </span>usually less<span class="_ _7"> </span>than<span class="_ _7"> </span>5%, so<span class="_ _7"> </span>we<span class="_ _7"> </span>consider the<span class="_ _7"> </span>interpreter</div><div class="t m0 xd h3 y8a ff2 fs3 fc0 sc0 ls0 ws14">impact requirement met. Incrementing<span class="_ _7"> </span>the<span class="_ _7"> </span>loop<span class="_ _7"> </span>hit<span class="_ _6"> </span>counter is ex-</div><div class="t m0 xd h3 y8b ff2 fs3 fc0 sc0 ls0 wsd">pensiv<span class="_ _1"></span>e because it<span class="_ _3"> </span>requires<span class="_ _3"> </span>us<span class="_ _3"> </span>to<span class="_ _9"> </span>look up the loop in the trace cache,</div><div class="t m0 xd h3 y8c ff2 fs3 fc0 sc0 ls0 ws2">but<span class="_ _5"> </span>we ha<span class="_ _1"></span>ve<span class="_ _5"> </span>tuned our<span class="_ _5"> </span>loops to<span class="_ _6"> </span>become hot<span class="_ _5"> </span>and trace<span class="_ _5"> </span>very quickly</div><div class="t m0 xd h3 y8d ff2 fs3 fc0 sc0 ls0 ws6">(on the second<span class="_ _3"> </span>iteration). The hit counter<span class="_ _5"> </span>implementation could be</div><div class="t m0 xd h3 y8e ff2 fs3 fc0 sc0 ls0 ws5">improv<span class="_ _1"></span>ed, which<span class="_ _6"> </span>might gi<span class="_ _1"></span>ve<span class="_ _6"> </span>us a small<span class="_ _6"> </span>increase in o<span class="_ _1"></span>verall<span class="_ _6"> </span>perfor-</div><div class="t m0 xd h3 y8f ff2 fs3 fc0 sc0 ls0 ws5">mance, as<span class="_ _6"> </span>well as more<span class="_ _6"> </span>ﬂexibility with<span class="_ _6"> </span>tuning hotness thresholds.</div><div class="t m0 xd h3 y90 ff2 fs3 fc0 sc0 ls0 ws2">Once a<span class="_ _6"> </span>loop is blacklisted<span class="_ _5"> </span>we nev<span class="_ _1"></span>er call<span class="_ _5"> </span>into the trace monitor<span class="_ _5"> </span>for</div><div class="t m0 xd h3 y91 ff2 fs3 fc0 sc0 ls0 ws4">that loop (see Section 3.3).</div><div class="t m0 x10 h3 y53 ff2 fs3 fc0 sc0 ls0 ws15">Recording is activ<span class="_ _1"></span>ated by a pointer sw<span class="_ _1"></span>ap that sets the inter-</div><div class="t m0 xf h3 y54 ff2 fs3 fc0 sc0 ls0 ws8">preter’<span class="_ _1"></span>s dispatch table to<span class="_ _7"> </span>call a single “interrupt” routine for ev-</div><div class="t m0 xf h3 y55 ff2 fs3 fc0 sc0 ls0 ws8">ery bytecode.<span class="_ _7"> </span>The interrupt<span class="_ _7"> </span>routine ﬁrst<span class="_ _7"> </span>calls<span class="_ _7"> </span>a bytecode-speciﬁc</div><div class="t m0 xf h3 y56 ff2 fs3 fc0 sc0 ls0 wsa">recording routine.<span class="_ _7"> </span>Then, it turns<span class="_ _7"> </span>off recording<span class="_ _7"> </span>if necessary (e.g.,</div><div class="t m0 xf h3 y57 ff2 fs3 fc0 sc0 ls0 ws2">the trace<span class="_ _6"> </span>ended). Finally<span class="_ _4"></span>, it jumps to<span class="_ _5"> </span>the standard interpreter<span class="_ _6"> </span>byte-</div><div class="t m0 xf h3 y58 ff2 fs3 fc0 sc0 ls0 wsd">code implementation.<span class="_ _9"> </span>Some bytecodes ha<span class="_ _1"></span>ve<span class="_ _9"> </span>effects on<span class="_ _9"> </span>the type map</div><div class="t m0 xf h3 y59 ff2 fs3 fc0 sc0 ls0 ws5">that cannot<span class="_ _6"> </span>be predicted before<span class="_ _6"> </span>executing<span class="_ _6"> </span>the bytecode (e.g.,<span class="_ _6"> </span>call-</div><div class="t m0 xf h3 y5a ff2 fs3 fc0 sc0 ls0 ws2">ing <span class="ff7 ws1">String.charCodeAt</span>, which returns an inte<span class="_ _1"></span>ger or <span class="ffa ws8">NaN </span>if the</div><div class="t m0 xf h3 y5b ff2 fs3 fc0 sc0 ls0 ws4">index<span class="_ _3"> </span>argument<span class="_ _3"> </span>is<span class="_ _3"> </span>out of<span class="_ _3"> </span>range).<span class="_ _3"> </span>For<span class="_ _3"> </span>these, we<span class="_ _3"> </span>arrange<span class="_ _3"> </span>for the<span class="_ _3"> </span>inter<span class="_ _1"></span>-</div><div class="t m0 xf h3 y5c ff2 fs3 fc0 sc0 ls0 ws5">preter to<span class="_ _6"> </span>call into<span class="_ _6"> </span>the recorder again<span class="_ _6"> </span>after e<span class="_ _1"></span>xecuting<span class="_ _6"> </span>the bytecode.</div><div class="t m0 xf h3 y5d ff2 fs3 fc0 sc0 ls0 ws2">Since such hooks are relati<span class="_ _1"></span>vely<span class="_ _6"> </span>rare, we embed them directly into</div><div class="t m0 xf h3 y5e ff2 fs3 fc0 sc0 ls0 ws5">the interpreter<span class="_ _1"></span>,<span class="_ _6"> </span>with an additional runtime check<span class="_ _6"> </span>to see whether a</div><div class="t m0 xf h3 y5f ff2 fs3 fc0 sc0 ls0 ws4">recorder is currently activ<span class="_ _1"></span>e.</div><div class="t m0 x10 h3 y60 ff2 fs3 fc0 sc0 ls0 ws4">While separating the interpreter from<span class="_ _3"> </span>the recorder reduces indi-</div><div class="t m0 xf h3 y61 ff2 fs3 fc0 sc0 ls0 wsd">vidual code complexity<span class="_ _4"></span>, it also requires careful implementation<span class="_ _3"> </span>and</div><div class="t m0 xf h3 y62 ff2 fs3 fc0 sc0 ls0 ws4">extensi<span class="_ _1"></span>ve testing to achie<span class="_ _1"></span>v<span class="_ _1"></span>e semantic equi<span class="_ _1"></span>valence.</div><div class="t m0 x10 h3 y63 ff2 fs3 fc0 sc0 ls0 ws2">In some cases achie<span class="_ _1"></span>ving this equi<span class="_ _1"></span>v<span class="_ _1"></span>alence is dif<span class="_ _1"></span>ﬁcult since Spi-</div><div class="t m0 xf h3 y64 ff2 fs3 fc0 sc0 ls0 ws5">derMonkey<span class="_ _6"> </span>follows<span class="_ _6"> </span>a <span class="ffa">fat-bytecode </span>design, which<span class="_ _6"> </span>was found to<span class="_ _6"> </span>be</div><div class="t m0 xf h3 y65 ff2 fs3 fc0 sc0 ls0 ws4">beneﬁcial to pure interpreter performance.</div><div class="t m0 x10 h3 y66 ff2 fs3 fc0 sc0 ls0 ws1a">In fat-bytecode designs,<span class="_ _b"> </span>individual bytecodes<span class="_ _b"> </span>can implement</div><div class="t m0 xf h3 y67 ff2 fs3 fc0 sc0 ls0 ws10">complex<span class="_ _a"> </span>processing<span class="_ _b"> </span>(e.g., the <span class="ff7">getprop<span class="_ _b"> </span></span>bytecode, which imple-</div><div class="t m0 xf h3 y68 ff2 fs3 fc0 sc0 ls0 wsd">ments full Jav<span class="_ _1"></span>aScript property v<span class="_ _1"></span>alue access, including special cases</div><div class="t m0 xf h3 y69 ff2 fs3 fc0 sc0 ls0 ws4">for cached and dense array access).</div><div class="t m0 x10 h3 y6a ff2 fs3 fc0 sc0 ls0 ws10">Fat bytecodes ha<span class="_ _1"></span>ve<span class="_ _a"> </span>tw<span class="_ _1"></span>o adv<span class="_ _1"></span>antages: fe<span class="_ _1"></span>wer bytecodes means</div><div class="t m0 xf h3 y6b ff2 fs3 fc0 sc0 ls0 ws6">lower<span class="_ _3"> </span>dispatch cost, and<span class="_ _3"> </span>bigger bytecode<span class="_ _5"> </span>implementations gi<span class="_ _1"></span>v<span class="_ _1"></span>e the</div><div class="t m0 xf h3 y6c ff2 fs3 fc0 sc0 ls0 ws4">compiler more opportunities to optimize the interpreter<span class="_ _1"></span>.</div><div class="t m0 x10 h3 y6d ff2 fs3 fc0 sc0 ls0 ws2f">Fat bytecodes are a problem for T<span class="_ _1"></span>raceMonk<span class="_ _1"></span>ey because the<span class="_ _1"></span>y</div><div class="t m0 xf h3 y6e ff2 fs3 fc0 sc0 ls0 ws12">require the recorder to reimplement the same special<span class="_ _b"> </span>case logic</div><div class="t m0 xf h3 y6f ff2 fs3 fc0 sc0 ls0 ws1a">in the same way<span class="_ _4"></span>. Also, the advantages are reduced because (a)</div><div class="t m0 xf h3 y70 ff2 fs3 fc0 sc0 ls0 ws8">dispatch costs are eliminated entirely in compiled traces, (b) the</div><div class="t m0 xf h3 y71 ff2 fs3 fc0 sc0 ls0 ws10">traces contain only one<span class="_ _a"> </span>special<span class="_ _b"> </span>case, not the interpreter’<span class="_ _1"></span>s<span class="_ _a"> </span>lar<span class="_ _1"></span>ge</div><div class="t m0 xf h3 y72 ff2 fs3 fc0 sc0 ls0 ws2">chunk of<span class="_ _5"> </span>code, and<span class="_ _5"> </span>(c) T<span class="_ _1"></span>raceMonke<span class="_ _1"></span>y spends<span class="_ _5"> </span>less time<span class="_ _5"> </span>running the</div><div class="t m0 xf h3 y73 ff2 fs3 fc0 sc0 ls0 ws4">base interpreter<span class="_ _1"></span>.</div><div class="t m0 x10 h3 y74 ff2 fs3 fc0 sc0 ls0 ws4">One way we ha<span class="_ _1"></span>ve<span class="_ _3"> </span>mitigated these problems is by implementing</div><div class="t m0 xf h3 y75 ff2 fs3 fc0 sc0 ls0 ws5">certain comple<span class="_ _1"></span>x bytecodes<span class="_ _6"> </span>in the recorder<span class="_ _6"> </span>as sequences of<span class="_ _6"> </span>simple</div><div class="t m0 xf h3 y76 ff2 fs3 fc0 sc0 ls0 ws7">bytecodes. Expressing the original semantics this w<span class="_ _1"></span>ay is not too dif-</div><div class="t m0 xf h3 y77 ff2 fs3 fc0 sc0 ls0 ws4">ﬁcult, and recording simple bytecodes is much easier<span class="_ _4"></span>. This enables</div><div class="t m0 xf h3 y78 ff2 fs3 fc0 sc0 ls0 ws4">us to<span class="_ _3"> </span>retain the<span class="_ _3"> </span>advantages<span class="_ _3"> </span>of f<span class="_ _1"></span>at bytecodes<span class="_ _3"> </span>while a<span class="_ _1"></span>voiding<span class="_ _3"> </span>some of</div><div class="t m0 xf h3 y79 ff2 fs3 fc0 sc0 ls0 ws6">their problems<span class="_ _3"> </span>for trace<span class="_ _3"> </span>recording. This is<span class="_ _3"> </span>particularly ef<span class="_ _1"></span>fecti<span class="_ _1"></span>ve<span class="_ _3"> </span>for</div><div class="t m0 xf h3 y7a ff2 fs3 fc0 sc0 ls0 ws2">fat bytecodes<span class="_ _5"> </span>that recurse back<span class="_ _5"> </span>into the interpreter<span class="_ _1"></span>,<span class="_ _5"> </span>for example<span class="_ _5"> </span>to</div><div class="t m0 xf h3 y7b ff2 fs3 fc0 sc0 ls0 ws2">con<span class="_ _1"></span>vert<span class="_ _5"> </span>an object into<span class="_ _5"> </span>a primitiv<span class="_ _1"></span>e v<span class="_ _1"></span>alue<span class="_ _5"> </span>by in<span class="_ _1"></span>voking<span class="_ _5"> </span>a well-known</div><div class="t m0 xf h3 y7c ff2 fs3 fc0 sc0 ls0 ws4">method on the object, since it lets us inline this function call.</div><div class="t m0 x10 h3 y7d ff2 fs3 fc0 sc0 ls0 ws6">It is important to note<span class="_ _5"> </span>that we split fat<span class="_ _3"> </span>opcodes into thinner op-</div><div class="t m0 xf h3 y7e ff2 fs3 fc0 sc0 ls0 ws6">codes only<span class="_ _3"> </span>during recording. When<span class="_ _3"> </span>running purely interpretati<span class="_ _1"></span>vely</div><div class="t m0 xf h3 y7f ff2 fs3 fc0 sc0 ls0 ws6">(i.e. code<span class="_ _3"> </span>that has been blacklisted),<span class="_ _3"> </span>the interpreter directly and<span class="_ _3"> </span>ef-</div><div class="t m0 xf h3 y80 ff2 fs3 fc0 sc0 ls0 ws4">ﬁciently ex<span class="_ _1"></span>ecutes the fat opcodes.</div><div class="t m0 xf ha y211 ff1 fs3 fc0 sc0 ls0 ws1d">6.4 Preemption</div><div class="t m0 xf h3 yc1 ff2 fs3 fc0 sc0 ls0 ws4">SpiderMonkey<span class="_ _4"></span>, lik<span class="_ _1"></span>e man<span class="_ _1"></span>y<span class="_ _3"> </span>VMs,<span class="_ _3"> </span>needs to<span class="_ _3"> </span>preempt<span class="_ _3"> </span>the<span class="_ _3"> </span>user<span class="_ _3"> </span>program</div><div class="t m0 xf h3 yc2 ff2 fs3 fc0 sc0 ls0 ws10">periodically<span class="_ _1"></span>.<span class="_ _b"> </span>The main<span class="_ _a"> </span>reasons<span class="_ _b"> </span>are to<span class="_ _b"> </span>prevent<span class="_ _a"> </span>inﬁnitely<span class="_ _b"> </span>looping</div><div class="t m0 xf h3 y116 ff2 fs3 fc0 sc0 ls0 ws4">scripts from locking up the host system and to schedule GC.</div><div class="t m0 x10 h3 yc4 ff2 fs3 fc0 sc0 ls0 ws6">In the interpreter<span class="_ _1"></span>, this had been implemented by setting a “pre-</div><div class="t m0 xf h3 yc5 ff2 fs3 fc0 sc0 ls0 ws8">empt no<span class="_ _1"></span>w”<span class="_ _7"> </span>ﬂag that<span class="_ _7"> </span>was<span class="_ _7"> </span>checked<span class="_ _7"> </span>on e<span class="_ _1"></span>v<span class="_ _1"></span>ery backw<span class="_ _1"></span>ard jump.<span class="_ _7"> </span>This</div><div class="t m0 xf h3 yc6 ff2 fs3 fc0 sc0 ls0 ws4">strategy carried o<span class="_ _1"></span>ver<span class="_ _3"> </span>into T<span class="_ _1"></span>raceMonke<span class="_ _1"></span>y: the VM inserts a<span class="_ _3"> </span>guard on</div><div class="t m0 xf h3 y88 ff2 fs3 fc0 sc0 ls0 ws14">the preemption ﬂag at e<span class="_ _1"></span>very<span class="_ _7"> </span>loop<span class="_ _7"> </span>edge.<span class="_ _7"> </span>W<span class="_ _4"></span>e measured less<span class="_ _7"> </span>than<span class="_ _7"> </span>a</div><div class="t m0 xf h3 y89 ff2 fs3 fc0 sc0 ls0 ws5">1% increase in runtime on most benchmarks for this e<span class="_ _1"></span>xtra guard.</div><div class="t m0 xf h3 y8a ff2 fs3 fc0 sc0 ls0 ws4">In practice, the<span class="_ _3"> </span>cost is<span class="_ _3"> </span>detectable only for<span class="_ _3"> </span>programs with<span class="_ _3"> </span>very<span class="_ _3"> </span>short</div><div class="t m0 xf h3 y8b ff2 fs3 fc0 sc0 ls0">loops.</div><div class="t m0 x10 h3 y8c ff2 fs3 fc0 sc0 ls0 wsa">W<span class="_ _4"></span>e tested and rejected a solution that av<span class="_ _1"></span>oided the guards by</div><div class="t m0 xf h3 y8d ff2 fs3 fc0 sc0 ls0 ws8">compiling the<span class="_ _7"> </span>loop edge<span class="_ _7"> </span>as an unconditional<span class="_ _7"> </span>jump, and<span class="_ _7"> </span>patching</div><div class="t m0 xf h3 y8e ff2 fs3 fc0 sc0 ls0 ws12">the jump target to an e<span class="_ _1"></span>xit routine when preemption is required.</div><div class="t m0 xf h3 y8f ff2 fs3 fc0 sc0 ls0 ws12">This solution<span class="_ _b"> </span>can<span class="_ _b"> </span>mak<span class="_ _1"></span>e the<span class="_ _b"> </span>normal<span class="_ _b"> </span>case<span class="_ _b"> </span>slightly<span class="_ _7"> </span>faster,<span class="_ _7"> </span>but then</div><div class="t m0 xf h3 y90 ff2 fs3 fc0 sc0 ls0 ws6">preemption becomes<span class="_ _3"> </span>very slo<span class="_ _1"></span>w<span class="_ _4"></span>. The implementation<span class="_ _3"> </span>was also v<span class="_ _1"></span>ery</div><div class="t m0 xf h3 y91 ff2 fs3 fc0 sc0 ls0 wsd">complex,<span class="_ _9"> </span>especially trying to<span class="_ _9"> </span>restart execution<span class="_ _9"> </span>after the preemption.</div></div><div class="pi" data-data='{"ctm":[1.673203,0.000000,0.000000,1.673203,0.000000,0.000000]}'></div></div></div>
